module.exports=[55739,e=>{"use strict";let t;var s=e.i(47909),i=e.i(74017),n=e.i(96250),r=e.i(59756),o=e.i(61916),a=e.i(14444),c=e.i(37092),l=e.i(69741),h=e.i(16795),u=e.i(87718),d=e.i(95169),p=e.i(47587),f=e.i(66012),b=e.i(70101),g=e.i(26937),m=e.i(10372),y=e.i(93695);e.i(52474);var S=e.i(220),C=e.i(89171);class w extends Error{constructor(e){super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,w.prototype),null!==e&&"object"==typeof e&&(this.url="string"==typeof e.url?e.url:"",this.status="number"==typeof e.status?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,null!==e.response&&"object"==typeof e.response?this.response=e.response:null!==e.data&&"object"==typeof e.data?this.response=e.data:this.response={}),this.originalError||e instanceof w||(this.originalError=e),"undefined"!=typeof DOMException&&e instanceof DOMException&&("AbortError"==e.name||20==e.code)&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=this.response?.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":this.originalError?.cause?.message?.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong."),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}}let O=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function R(e,t,s){let i=Object.assign({},s||{}),n=i.encode||E;if(!O.test(e))throw TypeError("argument name is invalid");let r=n(t);if(r&&!O.test(r))throw TypeError("argument val is invalid");let o=e+"="+r;if(null!=i.maxAge){let e=i.maxAge-0;if(isNaN(e)||!isFinite(e))throw TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(e)}if(i.domain){if(!O.test(i.domain))throw TypeError("option domain is invalid");o+="; Domain="+i.domain}if(i.path){if(!O.test(i.path))throw TypeError("option path is invalid");o+="; Path="+i.path}if(i.expires){var a;if(a=i.expires,"[object Date]"!==Object.prototype.toString.call(a)&&!(a instanceof Date)||isNaN(i.expires.valueOf()))throw TypeError("option expires is invalid");o+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(o+="; HttpOnly"),i.secure&&(o+="; Secure"),i.priority)switch("string"==typeof i.priority?i.priority.toLowerCase():i.priority){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(i.sameSite)switch("string"==typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case!0:case"strict":o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"none":o+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return o}function v(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}function E(e){return encodeURIComponent(e)}let T="undefined"!=typeof navigator&&"ReactNative"===navigator.product||e.g.HermesInternal;function P(e){if(e)try{let s=decodeURIComponent(t(e.split(".")[1]).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)||{}}catch(e){}return{}}function I(e,t=0){let s=P(e);return!(Object.keys(s).length>0&&(!s.exp||s.exp-t>Date.now()/1e3))}t="function"!=typeof atob||T?e=>{let t=String(e).replace(/=+$/,"");if(t.length%4==1)throw Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var s,i,n=0,r=0,o="";i=t.charAt(r++);~i&&(s=n%4?64*s+i:i,n++%4)&&(o+=String.fromCharCode(255&s>>(-2*n&6))))i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return o}:atob;let A="pb_auth";class k{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!I(this.token)}get isSuperuser(){let e=P(this.token);return"auth"==e.type&&("_superusers"==this.record?.collectionName||!this.record?.collectionName&&"pbc_3142635823"==e.collectionId)}get isAdmin(){return console.warn("Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),this.isSuperuser}get isAuthRecord(){return console.warn("Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),"auth"==P(this.token).type&&!this.isSuperuser}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=A){let s=function(e,t){let s={};if("string"!=typeof e)return s;let i=Object.assign({},{}).decode||v,n=0;for(;n<e.length;){let t=e.indexOf("=",n);if(-1===t)break;let r=e.indexOf(";",n);if(-1===r)r=e.length;else if(r<t){n=e.lastIndexOf(";",t-1)+1;continue}let o=e.slice(n,t).trim();if(void 0===s[o]){let n=e.slice(t+1,r).trim();34===n.charCodeAt(0)&&(n=n.slice(1,-1));try{s[o]=i(n)}catch(e){s[o]=n}}n=r+1}return s}(e||"")[t]||"",i={};try{i=JSON.parse(s),("object"!=typeof i||Array.isArray(i))&&(i={})}catch(e){}this.save(i.token||"",i.record||i.model||null)}exportToCookie(e,t=A){let s={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},i=P(this.token);s.expires=new Date(i?.exp?1e3*i.exp:"1970-01-01"),e=Object.assign({},s,e);let n={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null},r=R(t,JSON.stringify(n),e),o="undefined"!=typeof Blob?new Blob([r]).size:r.length;if(n.record&&o>4096){n.record={id:n.record?.id,email:n.record?.email};let s=["collectionId","collectionName","verified"];for(let e in this.record)s.includes(e)&&(n.record[e]=this.record[e]);r=R(t,JSON.stringify(n),e)}return r}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.record),()=>{for(let t=this._onChangeCallbacks.length-1;t>=0;t--)if(this._onChangeCallbacks[t]==e)return delete this._onChangeCallbacks[t],void this._onChangeCallbacks.splice(t,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.record)}}class j extends k{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get record(){let e=this._storageGet(this.storageKey)||{};return e.record||e.model||null}get model(){return this.record}save(e,t){this._storageSet(this.storageKey,{token:e,record:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){return this.storageFallback[e]}_storageSet(e,t){this.storageFallback[e]=t}_storageRemove(e){delete this.storageFallback[e]}_bindStorageEvent(){}}class q{constructor(e){this.client=e}}class U extends q{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,s,i){return i=Object.assign({method:"POST",body:{email:t,template:s,collection:e}},i),this.client.send("/api/settings/test/email",i).then(()=>!0)}async generateAppleClientSecret(e,t,s,i,n,r){return r=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:s,privateKey:i,duration:n}},r),this.client.send("/api/settings/apple/generate-client-secret",r)}}let x=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function L(e){if(e)for(let t in e.query=e.query||{},e)x.includes(t)||(e.query[t]=e[t],delete e[t])}function N(e){let t=[];for(let i in e){let n=encodeURIComponent(i);for(let r of Array.isArray(e[i])?e[i]:[e[i]]){var s;null!==(r=null==(s=r)?null:s instanceof Date?encodeURIComponent(s.toISOString().replace("T"," ")):"object"==typeof s?encodeURIComponent(JSON.stringify(s)):encodeURIComponent(s))&&t.push(n+"="+r)}}return t.join("&")}class _ extends q{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,s){if(!e)throw Error("topic must be set.");let i=e;if(s){L(s=Object.assign({},s));let e="options="+encodeURIComponent(JSON.stringify({query:s.query,headers:s.headers}));i+=(i.includes("?")?"&":"?")+e}let n=function(e){let s;try{s=JSON.parse(e?.data)}catch{}t(s||{})};return this.subscriptions[i]||(this.subscriptions[i]=[]),this.subscriptions[i].push(n),this.isConnected?1===this.subscriptions[i].length?await this.submitSubscriptions():this.eventSource?.addEventListener(i,n):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,n)}async unsubscribe(e){let t=!1;if(e){let s=this.getSubscriptionsByTopic(e);for(let e in s)if(this.hasSubscriptionListeners(e)){for(let t of this.subscriptions[e])this.eventSource?.removeEventListener(e,t);delete this.subscriptions[e],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){for(let e of(t=!0,this.subscriptions[s]))this.eventSource?.removeEventListener(s,e);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){let s=!1,i=this.getSubscriptionsByTopic(e);for(let e in i){if(!Array.isArray(this.subscriptions[e])||!this.subscriptions[e].length)continue;let i=!1;for(let s=this.subscriptions[e].length-1;s>=0;s--)this.subscriptions[e][s]===t&&(i=!0,delete this.subscriptions[e][s],this.subscriptions[e].splice(s,1),this.eventSource?.removeEventListener(e,t));i&&(this.subscriptions[e].length||delete this.subscriptions[e],s||this.hasSubscriptionListeners(e)||(s=!0))}this.hasSubscriptionListeners()?s&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){if(this.subscriptions=this.subscriptions||{},e)return!!this.subscriptions[e]?.length;for(let e in this.subscriptions)if(this.subscriptions[e]?.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!e?.isAbort)throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};for(let s in e=e.includes("?")?e:e+"?",this.subscriptions)(s+"?").startsWith(e)&&(t[s]=this.subscriptions[s]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource)for(let e in this.removeAllSubscriptionListeners(),this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{this.clientId=e?.lastEventId,this.submitSubscriptions().then(async()=>{let e=3;for(;this.hasUnsentSubscriptions()&&e>0;)e--,await this.submitSubscriptions()}).then(()=>{for(let e of this.pendingConnects)e.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let t=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in t)for(let i of t[s])i(e)}).catch(e=>{this.clientId="",this.connectErrorHandler(e)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let t of this.pendingConnects)t.reject(new w(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),this.eventSource?.close(),this.eventSource=null,this.clientId="",!e){for(let e of(this.reconnectAttempts=0,this.pendingConnects))e.resolve();this.pendingConnects=[]}}}class D extends q{decode(e){return e}async getFullList(e,t){if("number"==typeof e)return this._getFullList(e,t);let s=500;return(t=Object.assign({},e,t)).batch&&(s=t.batch,delete t.batch),this._getFullList(s,t)}async getList(e=1,t=30,s){return(s=Object.assign({method:"GET"},s)).query=Object.assign({page:e,perPage:t},s.query),this.client.send(this.baseCrudPath,s).then(e=>(e.items=e.items?.map(e=>this.decode(e))||[],e))}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(e=>{if(!e?.items?.length)throw new w({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return e.items[0]})}async getOne(e,t){if(!e)throw new w({url:this.client.buildURL(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(e=>this.decode(e))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(e=>this.decode(e))}async update(e,t,s){return s=Object.assign({method:"PATCH",body:t},s),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),s).then(e=>this.decode(e))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let s=[],i=async n=>this.getList(n,e||500,t).then(e=>{let t=e.items;return s=s.concat(t),t.length==e.perPage?i(n+1):s});return i(1)}}function F(e,t,s,i){let n=void 0!==i;return n||void 0!==s?n?(console.warn(e),t.body=Object.assign({},t.body,s),t.query=Object.assign({},t.query,i),t):Object.assign(t,s):t}function M(e){e._resetAutoRefresh?.()}class K extends D{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return"_superusers"==this.collectionIdOrName||"_pbc_2773867675"==this.collectionIdOrName}async subscribe(e,t,s){if(!e)throw Error("Missing topic.");if(!t)throw Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,s)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if("number"==typeof e)return super.getFullList(e,t);let s=Object.assign({},e,t);return super.getFullList(s)}async getList(e=1,t=30,s){return super.getList(e,t,s)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,s){return super.update(e,t,s).then(e=>{if(this.client.authStore.record?.id===e?.id&&(this.client.authStore.record?.collectionId===this.collectionIdOrName||this.client.authStore.record?.collectionName===this.collectionIdOrName)){let t=Object.assign({},this.client.authStore.record.expand),s=Object.assign({},this.client.authStore.record,e);t&&(s.expand=Object.assign(t,e.expand)),this.client.authStore.save(this.client.authStore.token,s)}return e})}async delete(e,t){return super.delete(e,t).then(t=>(t&&this.client.authStore.record?.id===e&&(this.client.authStore.record?.collectionId===this.collectionIdOrName||this.client.authStore.record?.collectionName===this.collectionIdOrName)&&this.client.authStore.clear(),t))}authResponse(e){let t=this.decode(e?.record||{});return this.client.authStore.save(e?.token,t),Object.assign({},e,{token:e?.token||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET",fields:"mfa,otp,password,oauth2"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e)}async authWithPassword(e,t,s){var i,n,r,o;let a,c,l,h;s=Object.assign({method:"POST",body:{identity:e,password:t}},s),this.isSuperusers&&(a=s.autoRefreshThreshold,delete s.autoRefreshThreshold,s.autoRefresh||M(this.client));let u=await this.client.send(this.baseCollectionPath+"/auth-with-password",s);return u=this.authResponse(u),a&&this.isSuperusers&&(i=this.client,n=a,r=()=>this.authRefresh({autoRefresh:!0}),o=()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s)),M(i),c=i.beforeSend,l=i.authStore.record,h=i.authStore.onChange((e,t)=>{(!e||t?.id!=l?.id||(t?.collectionId||l?.collectionId)&&t?.collectionId!=l?.collectionId)&&M(i)}),i._resetAutoRefresh=function(){h(),i.beforeSend=c,delete i._resetAutoRefresh},i.beforeSend=async(e,t)=>{let s=i.authStore.token;if(t.query?.autoRefresh)return c?c(e,t):{url:e,sendOptions:t};let a=i.authStore.isValid;if(a&&I(i.authStore.token,n))try{await r()}catch(e){a=!1}a||await o();let l=t.headers||{};for(let e in l)if("authorization"==e.toLowerCase()&&s==l[e]&&i.authStore.token){l[e]=i.authStore.token;break}return t.headers=l,c?c(e,t):{url:e,sendOptions:t}}),u}async authWithOAuth2Code(e,t,s,i,n,r,o){let a={method:"POST",body:{provider:e,code:t,codeVerifier:s,redirectURL:i,createData:n}};return a=F("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).",a,r,o),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",a).then(e=>this.authResponse(e))}authWithOAuth2(...e){if(e.length>1||"string"==typeof e?.[0])return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code(e?.[0]||"",e?.[1]||"",e?.[2]||"",e?.[3]||"",e?.[4]||{},e?.[5]||{},e?.[6]||{});let t=e?.[0]||{},s=null;t.urlCallback||(s=H(void 0));let i=new _(this.client);function n(){s?.close(),i.unsubscribe()}let r={},o=t.requestKey;return o&&(r.requestKey=o),this.listAuthMethods(r).then(e=>{let r=e.oauth2.providers.find(e=>e.name===t.provider);if(!r)throw new w(Error(`Missing or invalid provider "${t.provider}".`));let a=this.client.buildURL("/api/oauth2-redirect"),c=o?this.client.cancelControllers?.[o]:void 0;return c&&(c.signal.onabort=()=>{n()}),new Promise(async(e,o)=>{try{await i.subscribe("@oauth2",async s=>{let l=i.clientId;try{if(!s.state||l!==s.state)throw Error("State parameters don't match.");if(s.error||!s.code)throw Error("OAuth2 redirect error or missing code: "+s.error);let i=Object.assign({},t);delete i.provider,delete i.scopes,delete i.createData,delete i.urlCallback,c?.signal?.onabort&&(c.signal.onabort=null);let n=await this.authWithOAuth2Code(r.name,s.code,r.codeVerifier,a,t.createData,i);e(n)}catch(e){o(new w(e))}n()});let l={state:i.clientId};t.scopes?.length&&(l.scope=t.scopes.join(" "));let h=this._replaceQueryParams(r.authURL+a,l),u=t.urlCallback||function(e){s?s.location.href=e:s=H(e)};await u(h)}catch(e){n(),o(new w(e))}})}).catch(e=>{throw n(),e})}async authRefresh(e,t){let s={method:"POST"};return s=F("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",s,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",s).then(e=>this.authResponse(e))}async requestPasswordReset(e,t,s){let i={method:"POST",body:{email:e}};return i=F("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",i,t,s),this.client.send(this.baseCollectionPath+"/request-password-reset",i).then(()=>!0)}async confirmPasswordReset(e,t,s,i,n){let r={method:"POST",body:{token:e,password:t,passwordConfirm:s}};return r=F("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",r,i,n),this.client.send(this.baseCollectionPath+"/confirm-password-reset",r).then(()=>!0)}async requestVerification(e,t,s){let i={method:"POST",body:{email:e}};return i=F("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",i,t,s),this.client.send(this.baseCollectionPath+"/request-verification",i).then(()=>!0)}async confirmVerification(e,t,s){let i={method:"POST",body:{token:e}};return i=F("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",i,t,s),this.client.send(this.baseCollectionPath+"/confirm-verification",i).then(()=>{let t=P(e),s=this.client.authStore.record;return s&&!s.verified&&s.id===t.id&&s.collectionId===t.collectionId&&(s.verified=!0,this.client.authStore.save(this.client.authStore.token,s)),!0})}async requestEmailChange(e,t,s){let i={method:"POST",body:{newEmail:e}};return i=F("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",i,t,s),this.client.send(this.baseCollectionPath+"/request-email-change",i).then(()=>!0)}async confirmEmailChange(e,t,s,i){let n={method:"POST",body:{token:e,password:t}};return n=F("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",n,s,i),this.client.send(this.baseCollectionPath+"/confirm-email-change",n).then(()=>{let t=P(e),s=this.client.authStore.record;return s&&s.id===t.id&&s.collectionId===t.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(e,t){return this.client.collection("_externalAuths").getFullList(Object.assign({},t,{filter:this.client.filter("recordRef = {:id}",{id:e})}))}async unlinkExternalAuth(e,t,s){let i=await this.client.collection("_externalAuths").getFirstListItem(this.client.filter("recordRef = {:recordId} && provider = {:provider}",{recordId:e,provider:t}));return this.client.collection("_externalAuths").delete(i.id,s).then(()=>!0)}async requestOTP(e,t){return t=Object.assign({method:"POST",body:{email:e}},t),this.client.send(this.baseCollectionPath+"/request-otp",t)}async authWithOTP(e,t,s){return s=Object.assign({method:"POST",body:{otpId:e,password:t}},s),this.client.send(this.baseCollectionPath+"/auth-with-otp",s).then(e=>this.authResponse(e))}async impersonate(e,t,s){(s=Object.assign({method:"POST",body:{duration:t}},s)).headers=s.headers||{},s.headers.Authorization||(s.headers.Authorization=this.client.authStore.token);let i=new es(this.client.baseURL,new k,this.client.lang),n=await i.send(this.baseCollectionPath+"/impersonate/"+encodeURIComponent(e),s);return i.authStore.save(n?.token,this.decode(n?.record||{})),i}_replaceQueryParams(e,t={}){let s=e,i="";e.indexOf("?")>=0&&(s=e.substring(0,e.indexOf("?")),i=e.substring(e.indexOf("?")+1));let n={};for(let e of i.split("&")){if(""==e)continue;let t=e.split("=");n[decodeURIComponent(t[0].replace(/\+/g," "))]=decodeURIComponent((t[1]||"").replace(/\+/g," "))}for(let e in t)t.hasOwnProperty(e)&&(null==t[e]?delete n[e]:n[e]=t[e]);for(let e in i="",n)n.hasOwnProperty(e)&&(""!=i&&(i+="&"),i+=encodeURIComponent(e.replace(/%20/g,"+"))+"="+encodeURIComponent(n[e].replace(/%20/g,"+")));return""!=i?s+"?"+i:s}}function H(e){throw new w(Error("Not in a browser context - please pass a custom urlCallback function."))}class $ extends D{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,s){return s=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},s),this.client.send(this.baseCrudPath+"/import",s).then(()=>!0)}async getScaffolds(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCrudPath+"/meta/scaffolds",e)}async truncate(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/truncate",t).then(()=>!0)}}class B extends q{async getList(e=1,t=30,s){return(s=Object.assign({method:"GET"},s)).query=Object.assign({page:e,perPage:t},s.query),this.client.send("/api/logs",s)}async getOne(e,t){if(!e)throw new w({url:this.client.buildURL("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}}class W extends q{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}}class G extends q{getUrl(e,t,s={}){return console.warn("Please replace pb.files.getUrl() with pb.files.getURL()"),this.getURL(e,t,s)}getURL(e,t,s={}){if(!t||!e?.id||!e?.collectionId&&!e?.collectionName)return"";let i=[];i.push("api"),i.push("files"),i.push(encodeURIComponent(e.collectionId||e.collectionName)),i.push(encodeURIComponent(e.id)),i.push(encodeURIComponent(t));let n=this.client.buildURL(i.join("/"));if(Object.keys(s).length){!1===s.download&&delete s.download;let e=new URLSearchParams(s);n+=(n.includes("?")?"&":"?")+e}return n}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(e=>e?.token||"")}}class V extends q{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return console.warn("Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()"),this.getDownloadURL(e,t)}getDownloadURL(e,t){return this.client.buildURL(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}}class J extends q{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/crons",e)}async run(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/crons/${encodeURIComponent(e)}`,t).then(()=>!0)}}function z(t){return"undefined"!=typeof Blob&&t instanceof Blob||"undefined"!=typeof File&&t instanceof File||null!==t&&"object"==typeof t&&t.uri&&("undefined"!=typeof navigator&&"ReactNative"===navigator.product||e.g.HermesInternal)}function X(e){return e&&("FormData"===e.constructor?.name||"undefined"!=typeof FormData&&e instanceof FormData)}function Q(e){for(let t in e)for(let s of Array.isArray(e[t])?e[t]:[e[t]])if(z(s))return!0;return!1}let Y=/^[\-\.\d]+$/;function Z(e){if("string"!=typeof e)return e;if("true"==e)return!0;if("false"==e)return!1;if(("-"===e[0]||e[0]>="0"&&e[0]<="9")&&Y.test(e)){let t=+e;if(""+t===e)return t}return e}class ee extends q{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(e){return this.subs[e]||(this.subs[e]=new et(this.requests,e)),this.subs[e]}async send(e){let t=new FormData,s=[];for(let e=0;e<this.requests.length;e++){let i=this.requests[e];if(s.push({method:i.method,url:i.url,headers:i.headers,body:i.json}),i.files)for(let s in i.files)for(let n of i.files[s]||[])t.append("requests."+e+"."+s,n)}return t.append("@jsonPayload",JSON.stringify({requests:s})),e=Object.assign({method:"POST",body:t},e),this.client.send("/api/batch",e)}}class et{constructor(e,t){this.requests=[],this.requests=e,this.collectionIdOrName=t}upsert(e,t){t=Object.assign({body:e||{}},t);let s={method:"PUT",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(s,t),this.requests.push(s)}create(e,t){t=Object.assign({body:e||{}},t);let s={method:"POST",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(s,t),this.requests.push(s)}update(e,t,s){s=Object.assign({body:t||{}},s);let i={method:"PATCH",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(e)};this.prepareRequest(i,s),this.requests.push(i)}delete(e,t){t=Object.assign({},t);let s={method:"DELETE",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(e)};this.prepareRequest(s,t),this.requests.push(s)}prepareRequest(e,t){let s;if(L(t),e.headers=t.headers,e.json={},e.files={},void 0!==t.query){let s=N(t.query);s&&(e.url+=(e.url.includes("?")?"&":"?")+s)}let i=t.body;for(let t in X(i)&&(s={},i.forEach((e,t)=>{if("@jsonPayload"===t&&"string"==typeof e)try{let t=JSON.parse(e);Object.assign(s,t)}catch(e){console.warn("@jsonPayload error:",e)}else void 0!==s[t]?(Array.isArray(s[t])||(s[t]=[s[t]]),s[t].push(Z(e))):s[t]=Z(e)}),i=s),i){let s=i[t];if(z(s))e.files[t]=e.files[t]||[],e.files[t].push(s);else if(Array.isArray(s)){let i=[],n=[];for(let e of s)z(e)?i.push(e):n.push(e);if(i.length>0&&i.length==s.length)for(let s of(e.files[t]=e.files[t]||[],i))e.files[t].push(s);else if(e.json[t]=n,i.length>0){let s=t;for(let n of(t.startsWith("+")||t.endsWith("+")||(s+="+"),e.files[s]=e.files[s]||[],i))e.files[s].push(n)}}else e.json[t]=s}}}class es{get baseUrl(){return this.baseURL}set baseUrl(e){this.baseURL=e}constructor(e="/",t,s="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=e,this.lang=s,t?this.authStore=t:this.authStore=new j,this.collections=new $(this),this.files=new G(this),this.logs=new B(this),this.settings=new U(this),this.realtime=new _(this),this.health=new W(this),this.backups=new V(this),this.crons=new J(this)}get admins(){return this.collection("_superusers")}createBatch(){return new ee(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new K(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let s in t){let i=t[s];switch(typeof i){case"boolean":case"number":i=""+i;break;case"string":i="'"+i.replace(/'/g,"\\'")+"'";break;default:i=null===i?"null":i instanceof Date?"'"+i.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(i).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+s+"}",i)}return e}getFileUrl(e,t,s={}){return console.warn("Please replace pb.getFileUrl() with pb.files.getURL()"),this.files.getURL(e,t,s)}buildUrl(e){return console.warn("Please replace pb.buildUrl() with pb.buildURL()"),this.buildURL(e)}buildURL(e){let t=this.baseURL;return e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let s=this.buildURL(e);if(this.beforeSend){let e=Object.assign({},await this.beforeSend(s,t));void 0!==e.url||void 0!==e.options?(s=e.url||s,t=e.options||t):Object.keys(e).length&&(t=e,console?.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(void 0!==t.query){let e=N(t.query);e&&(s+=(s.includes("?")?"&":"?")+e),delete t.query}return"application/json"==this.getHeader(t.headers,"Content-Type")&&t.body&&"string"!=typeof t.body&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(s,t).then(async e=>{let s={};try{s=await e.json()}catch(e){if(t.signal?.aborted||"undefined"!=typeof DOMException&&e instanceof DOMException&&("AbortError"==e.name||20==e.code))throw e}if(this.afterSend&&(s=await this.afterSend(e,s,t)),e.status>=400)throw new w({url:e.url,status:e.status,data:s});return s}).catch(e=>{throw new w(e)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=function(e){if("undefined"==typeof FormData||void 0===e||"object"!=typeof e||null===e||X(e)||!Q(e))return e;let t=new FormData;for(let s in e){let i=e[s];if(void 0!==i)if("object"!=typeof i||Q({data:i}))for(let e of Array.isArray(i)?i:[i])t.append(s,e);else{let e={};e[s]=i,t.append("@jsonPayload",JSON.stringify(e))}}return t}(t.body),L(t),t.query=Object.assign({},t.params,t.query),void 0===t.requestKey&&(!1===t.$autoCancel||!1===t.query.$autoCancel?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,null!==this.getHeader(t.headers,"Content-Type")||X(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),null===this.getHeader(t.headers,"Accept-Language")&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&null===this.getHeader(t.headers,"Authorization")&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&null!==t.requestKey){let s=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(s);let i=new AbortController;this.cancelControllers[s]=i,t.signal=i.signal}return t}getHeader(e,t){for(let s in e=e||{},t=t.toLowerCase(),e)if(s.toLowerCase()==t)return e[s];return null}}var ei=e.i(538),en=e.i(83019),er=e.i(58632);async function eo(e){let t=e.nextUrl.searchParams.get("uploadId");if(!t)return C.NextResponse.json({error:"Missing ID"},{status:400});let s=(0,en.getProgress)(t),i=-1===s?0:s;return C.NextResponse.json({id:t,percent:i,formattedPercent:`${Math.round(i)}%`})}async function ea(e){let t=e.nextUrl.searchParams.get("uploadId")||"unknown";console.log("--- BẮT ĐẦU API UPLOAD (SERVER SIDE) ---",t);try{let s;(0,en.setProgress)(t,0);let i=await e.formData(),n=i.get("file");if(!n||!(n instanceof File))return C.NextResponse.json({success:!1,message:"File không hợp lệ"},{status:400});let r=i.get("roomId"),o=i.get("sender"),a=i.get("receiver")||"",c=i.get("type"),l=i.get("batchId")||void 0,h="true"===i.get("skipSaveMessage"),u="https://files.hupuna.vn/",d="chat@hupuna.com",p="Hupuna888",f=new es(u);f.autoCancellation(!1);try{try{await f.admins.authWithPassword(d,p)}catch{await f.collection("users").authWithPassword(d,p)}}catch(e){return console.error("Lỗi đăng nhập System PB:",e),C.NextResponse.json({success:!1,message:"Không thể đăng nhập vào hệ thống lưu trữ"},{status:401})}let b=new FormData;b.append("file",n);let g=i.get("title")||n.name;b.append("title",g),i.has("folder")&&b.append("folder",i.get("folder")),f.authStore.model?.id&&b.append("users_id",f.authStore.model.id),(0,en.setProgress)(t,10);let m=await f.collection("files").create(b);(0,en.setProgress)(t,100);let y=u.endsWith("/")?u.slice(0,-1):u,S=`${y}/api/files/${m.collectionId}/${m.id}/${m.file}`,w={roomId:r,sender:o,receiver:a,type:c,fileName:m.file,fileUrl:S,timestamp:Date.now(),batchId:l,uploadId:t};if(!h&&r)try{s=await (0,er.addRow)(ei.MESSAGES_COLLECTION_NAME,w)}catch(e){console.error("Lỗi lưu DB:",e)}return setTimeout(()=>(0,en.clearProgress)(t),2e3),C.NextResponse.json({success:!0,link:S,data:w,_id:s,saved:!!s,result:{id:m.id,url:S,filename:m.file}})}catch(i){console.error("❌ Lỗi API Upload:",i),(0,en.setProgress)(t,-1);let e="Lỗi server nội bộ",s=500;return i instanceof w?(s=i.status,e=i.message,console.error("PB Response:",i.response)):i instanceof Error&&(e=i.message),C.NextResponse.json({success:!1,message:e},{status:s})}}e.s(["GET",()=>eo,"POST",()=>ea,"runtime",0,"nodejs"],35932);var ec=e.i(35932);let el=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:""},distDir:".next-local",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/upload/route.ts",nextConfigOutput:"",userland:ec}),{workAsyncStorage:eh,workUnitAsyncStorage:eu,serverHooks:ed}=el;function ep(){return(0,n.patchFetch)({workAsyncStorage:eh,workUnitAsyncStorage:eu})}async function ef(e,t,s){el.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/upload/route";n=n.replace(/\/index$/,"")||"/";let C=await el.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!C)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:w,params:O,nextConfig:R,parsedUrl:v,isDraftMode:E,prerenderManifest:T,routerServerContext:P,isOnDemandRevalidate:I,revalidateOnlyGenerated:A,resolvedPathname:k,clientReferenceManifest:j,serverActionsManifest:q}=C,U=(0,l.normalizeAppPath)(n),x=!!(T.dynamicRoutes[U]||T.routes[k]),L=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,v,!1):t.end("This page could not be found"),null);if(x&&!E){let e=!!T.routes[k],t=T.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await L();throw new y.NoFallbackError}}let N=null;!x||el.isDev||E||(N="/index"===(N=k)?"/":N);let _=!0===el.isDev||!x,D=x&&!_;q&&j&&(0,a.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:j,serverActionsManifest:q,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:q})});let F=e.method||"GET",M=(0,o.getTracer)(),K=M.getActiveScopeSpan(),H={params:O,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,s,i)=>el.onRequestError(e,t,i,P)},sharedContext:{buildId:w}},$=new h.NodeNextRequest(e),B=new h.NodeNextResponse(t),W=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let a=async e=>el.handle(W,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=M.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=s.get("next.route");if(i){let t=`${F} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${n}`)}),c=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var o,l;let h=async({previousCacheEntry:i})=>{try{if(!c&&I&&A&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(r);e.fetchMetrics=H.renderOpts.fetchMetrics;let o=H.renderOpts.pendingWaitUntil;o&&s.waitUntil&&(s.waitUntil(o),o=void 0);let l=H.renderOpts.collectedTags;if(!x)return await (0,f.sendResponse)($,B,n,H.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,b.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let s=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,i=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:S.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:s,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await el.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:I})},P),t}},u=await el.handleResponse({req:e,nextConfig:R,cacheKey:N,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:A,responseGenerator:h,waitUntil:s.waitUntil,isMinimalMode:c});if(!x)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==S.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});c||t.setHeader("x-nextjs-cache",I?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,b.fromNodeOutgoingHttpHeaders)(u.value.headers);return c&&x||d.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)($,B,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};K?await l(K):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${F} ${n}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await el.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:I})}),x)throw t;return await (0,f.sendResponse)($,B,new Response(null,{status:500})),null}}e.s(["handler",()=>ef,"patchFetch",()=>ep,"routeModule",()=>el,"serverHooks",()=>ed,"workAsyncStorage",()=>eh,"workUnitAsyncStorage",()=>eu],55739)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_7944e7c7.js.map