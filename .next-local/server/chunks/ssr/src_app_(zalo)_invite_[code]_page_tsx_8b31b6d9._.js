module.exports=[91985,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(45112),f=a.i(71987),g=a.i(74362),h=a.i(20461);function i({isOpen:a,inviteCode:d,onClose:i,onJoin:j}){let[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(null);(0,c.useEffect)(()=>{a&&d&&(async()=>{n(!0),r(null);try{let a=await fetch(`/api/groups/invite/${d}`),b=await a.json();if(!a.ok||!b.success)throw Error(b.message||"Link không hợp lệ hoặc đã hết hạn");l(b.group)}catch(a){r(a instanceof Error?a.message:"Không thể tải thông tin nhóm")}finally{n(!1)}})()},[a,d]);let s=async()=>{p(!0);try{await j(),i()}catch(a){alert(a instanceof Error?a.message:"Tham gia nhóm thất bại")}finally{p(!1)}};return a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,b.jsxs)("div",{className:"w-full max-w-md bg-white rounded-xl shadow-2xl overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-br from-blue-600 to-indigo-700 text-white px-6 py-4 flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Tham gia nhóm"}),(0,b.jsx)("button",{onClick:i,className:"p-1 hover:cursor-pointer hover:bg-white/20 rounded-full transition",children:(0,b.jsx)(g.HiX,{className:"w-5 h-5"})})]}),(0,b.jsx)("div",{className:"p-6",children:m?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Đang tải thông tin nhóm..."})]}):q?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:"X"}),(0,b.jsx)("p",{className:"text-red-600 mb-4",children:q}),(0,b.jsx)("button",{onClick:i,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Đóng"})]}):k?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center ",children:[k.avatar?(0,b.jsx)(f.default,{src:(0,e.getProxyUrl)(k.avatar),alt:"",width:36,height:36,className:"w-20 h-20 object-cover rounded-full"}):(0,b.jsx)("div",{className:"w-[1.25rem] h-[1.25rem] bg-gradient-to-br rounded-full from-indigo-500 to-purple-600 text-white font-bold text-sm flex items-center justify-center",children:k.name?.charAt(0).toUpperCase()}),(0,b.jsx)("h4",{className:"text-xl font-bold text-gray-800 mb-2",children:k.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(h.PiUserCircleGearDuotone,{className:"w-4 h-4"}),(0,b.jsxs)("span",{className:"text-sm",children:[k.members?.length||0," thành viên"]})]})]}),k.description&&(0,b.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,b.jsx)("p",{className:"text-sm text-gray-700",children:k.description})}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:i,className:"flex-1 px-4 hover:cursor-pointer py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition",disabled:o,children:"Hủy"}),(0,b.jsx)("button",{onClick:s,disabled:o,className:"flex-1 px-4 py-3 hover:cursor-pointer bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Đang tham gia...":"Tham gia nhóm"})]})]}):null})]})}):null}var j=a.i(83915);function k(){let a=(0,d.useRouter)(),f=(0,d.useParams)(),g=f?.code,[h,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null);(0,c.useEffect)(()=>{try{let b=JSON.parse(localStorage.getItem("info_user")||"{}");b&&b._id?(m(b),k(!0)):a.push(`/?redirect=/invite/${g}`)}catch{a.push(`/?redirect=/invite/${g}`)}},[g,a]);let n=async()=>{if(!l||!g)return;let b=await fetch(`/api/groups/invite/${g}`),c=await b.json(),d=c?.group?.members||[],f=await fetch("/api/groups/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inviteCode:g,userId:l._id,userName:l.name})}),h=await f.json();if(!f.ok||!h.success)throw Error(h.message||"Tham gia nhóm thất bại");if(h.notifyId&&h.notifyContent&&h.groupId){let a=(0,j.io)((0,e.resolveSocketUrl)(),{transports:["websocket"],withCredentials:!1});a.on("connect",()=>{let b=d.map(a=>"string"==typeof a?{_id:String(a)}:{_id:String(a._id),role:a.role,name:a.name,avatar:a.avatar}),c=[...b,{_id:String(l._id),role:"MEMBER",name:l.name,avatar:l.avatar,joinedAt:Date.now()}];a.emit("group_members_updated",{roomId:String(h.groupId),members:c,prevMembers:b,sender:String(l._id),senderName:l.name}),a.emit("send_message",{_id:h.notifyId,roomId:h.groupId,sender:l._id,senderName:l.name||"Thành viên mới",type:"notify",content:h.notifyContent,timestamp:Date.now(),isGroup:!0,members:c.map(a=>a._id)}),setTimeout(()=>a.disconnect(),500)})}a.push("/home")};return(0,b.jsx)(i,{isOpen:h,inviteCode:g,onClose:()=>{k(!1),a.push("/home")},onJoin:n})}a.s(["default",()=>k],91985)}];

//# sourceMappingURL=src_app_%28zalo%29_invite_%5Bcode%5D_page_tsx_8b31b6d9._.js.map