{"version":3,"sources":["../../../../src/components/%28memonts%29/PostCard.tsx","../../../../src/components/%28memonts%29/ImageGrid.tsx","../../../../src/components/%28memonts%29/VideoGrid.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport Image from 'next/image';\r\nimport { formatTimeAgo } from '@/utils/dateUtils';\r\nimport { HiHandThumbUp, HiChatBubbleLeftRight, HiArrowUpTray, HiEllipsisVertical } from 'react-icons/hi2';\r\nimport ImageGrid from './ImageGrid';\r\nimport VideoGrid from './VideoGrid';\r\nimport { useCurrentUser } from '@/hooks/(profile)/useCurrentUser';\r\nimport ReactionButton from '@/components/(chatPopup)/components/ReactionButton';\r\nimport { uploadFileWithProgress } from '@/utils/uploadHelper';\r\n\r\nfunction toMegaStream(url: string) {\r\n  return url.startsWith('https://mega.nz/') ? `/api/mega-stream?url=${encodeURIComponent(url)}` : url;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nasync function uploadFileMega(file: File): Promise<string | null> {\r\n  const uploadId = `up_${Date.now()}_${Math.random().toString(36).slice(2)}`;\r\n  const form = new FormData();\r\n  form.append('file', file);\r\n  form.append('roomId', 'moments-feed');\r\n  form.append('sender', 'system');\r\n  form.append('type', 'file');\r\n  form.append('folderName', 'moments-feed');\r\n  const res = await fetch(`/api/upload?uploadId=${uploadId}`, { method: 'POST', body: form });\r\n  const json = await res.json();\r\n  return json?.success ? json.link : null;\r\n}\r\n\r\ntype FeedPost = {\r\n  id: string;\r\n  author: { id: string; name: string; avatar?: string };\r\n  content: string;\r\n  images?: string[];\r\n  videos?: string[];\r\n  files?: string[];\r\n  createdAt: number;\r\n  likes: number;\r\n  comments: number;\r\n  liked?: boolean;\r\n};\r\n\r\ntype PostComment = {\r\n  id: string;\r\n  userId: string;\r\n  username?: string;\r\n  avatar?: string;\r\n  content: string;\r\n  createdAt: number;\r\n  parentId?: string;\r\n  reactions?: Record<string, string[]>;\r\n};\r\n\r\nexport default function PostCard({ post, onLike }: { post: FeedPost; onLike: (id: string) => void }) {\r\n  const time = useMemo(() => formatTimeAgo(post.createdAt), [post.createdAt]);\r\n  const shareLink = useMemo(\r\n    () => (typeof window !== 'undefined' ? `${window.location.origin}/moments/${post.id}` : `/moments/${post.id}`),\r\n    [post.id],\r\n  );\r\n\r\n  const { currentUser, currentId } = useCurrentUser();\r\n  const isOwner = useMemo(() => String(post.author.id) === String(currentId), [post.author.id, currentId]);\r\n  const [deleted, setDeleted] = useState(false);\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [editContent, setEditContent] = useState<string>(post.content || '');\r\n  const [contentOverride, setContentOverride] = useState<string | null>(null);\r\n  const [showComments, setShowComments] = useState(false);\r\n  const [comments, setComments] = useState<PostComment[]>([]);\r\n  const [loadingComments, setLoadingComments] = useState(false);\r\n  const [newComment, setNewComment] = useState('');\r\n  const [commentsCount, setCommentsCount] = useState<number>(post.comments);\r\n  const [showMenu, setShowMenu] = useState(false);\r\n  const [menuTab, setMenuTab] = useState<'post' | 'media'>('post');\r\n  const [imagesOverride, setImagesOverride] = useState<string[]>(post.images || []);\r\n  const [videosOverride, setVideosOverride] = useState<string[]>(post.videos || []);\r\n  const [filesOverride, setFilesOverride] = useState<string[]>(post.files || []);\r\n  const mediaAddRef = useRef<HTMLInputElement | null>(null);\r\n  const docAddRef = useRef<HTMLInputElement | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [uploadLabel, setUploadLabel] = useState('');\r\n\r\n  useEffect(() => {\r\n    setCommentsCount(post.comments);\r\n  }, [post.comments]);\r\n\r\n  useEffect(() => {\r\n    setImagesOverride(post.images || []);\r\n    setVideosOverride(post.videos || []);\r\n    setFilesOverride(post.files || []);\r\n  }, [post.images, post.videos, post.files]);\r\n\r\n  const loadComments = async () => {\r\n    setLoadingComments(true);\r\n    try {\r\n      const res = await fetch('/api/posts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'readComments', postId: post.id, limit: 50 }),\r\n        cache: 'no-store',\r\n      });\r\n      const json = await res.json();\r\n      const arr = Array.isArray(json?.data) ? (json.data as Record<string, unknown>[]) : [];\r\n      const list: PostComment[] = arr.map((c: Record<string, unknown>) => ({\r\n        id: String((c['_id'] as string) ?? (c['id'] as string) ?? ''),\r\n        userId: String((c['userId'] as string) || ''),\r\n        username: c['username'] ? String(c['username'] as string) : undefined,\r\n        avatar: c['avatar'] ? String(c['avatar'] as string) : undefined,\r\n        content: String((c['content'] as string) || ''),\r\n        createdAt: Number((c['createdAt'] as number) || Date.now()),\r\n        parentId: c['parentId'] ? String(c['parentId'] as string) : undefined,\r\n        reactions: (c['reactions'] as Record<string, string[]>) || {},\r\n      }));\r\n      setComments(list);\r\n    } catch {}\r\n    setLoadingComments(false);\r\n  };\r\n\r\n  const handleShare = async () => {\r\n    try {\r\n      if (navigator.share) {\r\n        await navigator.share({ title: 'Chia sẻ bài viết', url: shareLink });\r\n      } else if (navigator.clipboard) {\r\n        await navigator.clipboard.writeText(shareLink);\r\n        alert('Đã sao chép liên kết bài viết');\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  const handleToggleComments = async () => {\r\n    const next = !showComments;\r\n    setShowComments(next);\r\n    if (next && comments.length === 0) {\r\n      await loadComments();\r\n    }\r\n  };\r\n\r\n  const [replyToCommentId, setReplyToCommentId] = useState<string | null>(null);\r\n\r\n  const handleSubmitComment = async () => {\r\n    const content = newComment.trim();\r\n    if (!content || !currentId) return;\r\n    try {\r\n      const res = await fetch('/api/posts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          action: 'addComment',\r\n          postId: post.id,\r\n          data: {\r\n            userId: currentId,\r\n            username: currentUser?.['name'],\r\n            avatar: currentUser?.['avatar'],\r\n            content,\r\n            parentId: replyToCommentId || undefined,\r\n          },\r\n        }),\r\n      });\r\n      const json = await res.json();\r\n      const newId = String(json?._id || '');\r\n      const now = Date.now();\r\n      const added: PostComment = {\r\n        id: newId || `${post.id}-${now}`,\r\n        userId: String(currentId),\r\n        username: String(currentUser?.['name'] || ''),\r\n        avatar: currentUser?.['avatar'] ? String(currentUser['avatar']) : undefined,\r\n        content,\r\n        createdAt: now,\r\n        parentId: replyToCommentId || undefined,\r\n        reactions: {},\r\n      };\r\n      setComments((prev) => [...prev, added]);\r\n      setCommentsCount((prev) => prev + 1);\r\n      setNewComment('');\r\n      setReplyToCommentId(null);\r\n    } catch {}\r\n  };\r\n\r\n  const handleToggleReaction = async (commentId: string, emoji: string) => {\r\n    const find = comments.find((c) => c.id === commentId);\r\n    if (!find || !currentId) return;\r\n    const current = find.reactions?.[emoji] || [];\r\n    const hasReacted = current.includes(currentId);\r\n    try {\r\n      await fetch('/api/posts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          action: 'toggleCommentReaction',\r\n          commentId,\r\n          userId: currentId,\r\n          emoji,\r\n          like: !hasReacted,\r\n        }),\r\n      });\r\n      setComments((prev) =>\r\n        prev.map((c) => {\r\n          if (c.id !== commentId) return c;\r\n          const oldArr = c.reactions?.[emoji] || [];\r\n          const set = new Set(oldArr);\r\n          if (hasReacted) set.delete(currentId);\r\n          else set.add(currentId);\r\n          return { ...c, reactions: { ...(c.reactions || {}), [emoji]: Array.from(set) } };\r\n        }),\r\n      );\r\n    } catch {}\r\n  };\r\n\r\n  const handleReply = (c: PostComment) => {\r\n    setReplyToCommentId(c.id);\r\n    const mention = c.username ? `@${c.username} ` : '';\r\n    setNewComment((prev) => (prev ? prev : mention));\r\n  };\r\n\r\n  const removeImageAt = (idx: number) => {\r\n    setImagesOverride((prev) => prev.filter((_, i) => i !== idx));\r\n  };\r\n  const removeVideoAt = (idx: number) => {\r\n    setVideosOverride((prev) => prev.filter((_, i) => i !== idx));\r\n  };\r\n  const removeFileAt = (idx: number) => {\r\n    setFilesOverride((prev) => prev.filter((_, i) => i !== idx));\r\n  };\r\n\r\n  const handleAddMediaFiles = async (fl: FileList | null) => {\r\n    if (!fl) return;\r\n    const arr = Array.from(fl).slice(0, 6);\r\n    const total = arr.length || 1;\r\n    let base = 0;\r\n    setUploadLabel('Ảnh/video');\r\n    setUploading(true);\r\n    setUploadProgress(0);\r\n    for (const file of arr) {\r\n      const uploadId = `up_${Date.now()}_${Math.random().toString(36).slice(2)}`;\r\n      const form = new FormData();\r\n      form.append('file', file);\r\n      form.append('roomId', 'moments-feed');\r\n      form.append('sender', 'system');\r\n      form.append('type', 'file');\r\n      form.append('folderName', 'moments-feed');\r\n      const res = await uploadFileWithProgress(`/api/upload?uploadId=${uploadId}`, form, (p) => {\r\n        setUploadProgress(Math.min(100, base + p / total));\r\n      });\r\n      if (res && 'success' in res && res.success) {\r\n        const link = res.link;\r\n        if (file.type.startsWith('image/')) setImagesOverride((p) => [...p, link]);\r\n        else if (file.type.startsWith('video/')) setVideosOverride((p) => [...p, link]);\r\n      }\r\n      base = Math.min(100, base + 100 / total);\r\n      setUploadProgress(base);\r\n    }\r\n    setUploading(false);\r\n  };\r\n\r\n  const handleAddDocFiles = async (fl: FileList | null) => {\r\n    if (!fl) return;\r\n    const arr = Array.from(fl).slice(0, 6);\r\n    const total = arr.length || 1;\r\n    let base = 0;\r\n    setUploadLabel('Tập tin');\r\n    setUploading(true);\r\n    setUploadProgress(0);\r\n    for (const f of arr) {\r\n      const uploadId = `up_${Date.now()}_${Math.random().toString(36).slice(2)}`;\r\n      const form = new FormData();\r\n      form.append('file', f);\r\n      form.append('roomId', 'moments-feed');\r\n      form.append('sender', 'system');\r\n      form.append('type', 'file');\r\n      form.append('folderName', 'moments-feed');\r\n      const res = await uploadFileWithProgress(`/api/upload?uploadId=${uploadId}`, form, (p) => {\r\n        setUploadProgress(Math.min(100, base + p / total));\r\n      });\r\n      if (res && 'success' in res && res.success) {\r\n        const link = res.link;\r\n        setFilesOverride((p) => [...p, link]);\r\n      }\r\n      base = Math.min(100, base + 100 / total);\r\n      setUploadProgress(base);\r\n    }\r\n    setUploading(false);\r\n  };\r\n\r\n  const handleSaveMedia = async () => {\r\n    if (!isOwner || !post.id) return;\r\n    try {\r\n      await fetch('/api/posts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          action: 'update',\r\n          field: '_id',\r\n          value: post.id,\r\n          data: { images: imagesOverride, videos: videosOverride, files: filesOverride },\r\n        }),\r\n      });\r\n      setShowMenu(false);\r\n    } catch {}\r\n  };\r\n\r\n  const handleDeletePost = async () => {\r\n    if (!isOwner || !post.id) return;\r\n    try {\r\n      await fetch('/api/posts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'delete', postId: post.id }),\r\n      });\r\n      setDeleted(true);\r\n    } catch {}\r\n  };\r\n\r\n  const handleStartEdit = () => {\r\n    if (!isOwner) return;\r\n    setEditContent(contentOverride ?? post.content ?? '');\r\n    setIsEditing(true);\r\n  };\r\n\r\n  const handleSaveEdit = async () => {\r\n    const nextContent = editContent.trim();\r\n    if (!isOwner || !nextContent) {\r\n      setIsEditing(false);\r\n      return;\r\n    }\r\n    try {\r\n      await fetch('/api/posts', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'update', field: '_id', value: post.id, data: { content: nextContent } }),\r\n      });\r\n      setContentOverride(nextContent);\r\n    } catch {}\r\n    setIsEditing(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-3xl border shadow-sm\">\r\n      <div className=\"p-4 flex gap-3 flex-col\">\r\n        <div className=\"flex items-center gap-2 justify-between\">\r\n          <div className=\"flex items-start gap-2\">\r\n            <Image\r\n              src={post.author.avatar ? toMegaStream(post.author.avatar) : ''}\r\n              width={44}\r\n              height={44}\r\n              alt=\"avatar\"\r\n              className=\"rounded-full\"\r\n              unoptimized\r\n            />\r\n            <div className=\"flex flex-col\">\r\n              <p className=\"font-bold text-sm\">{post.author.name}</p>\r\n              <p className=\"text-xs text-gray-500\">{time}</p>\r\n            </div>\r\n          </div>\r\n          <div className=\"relative\">\r\n            {isOwner && !deleted && (\r\n              <>\r\n                <button onClick={() => setShowMenu((v) => !v)} className=\"p-2 rounded-lg hover:bg-gray-100\">\r\n                  <HiEllipsisVertical />\r\n                </button>\r\n                {showMenu && (\r\n                  <div className=\"absolute right-0 top-8 bg-white border rounded-2xl shadow-xl w-64 z-10\">\r\n                    <div className=\"flex border-b\">\r\n                      <button\r\n                        onClick={() => setMenuTab('post')}\r\n                        className={`flex-1 py-2 text-sm ${\r\n                          menuTab === 'post' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-600'\r\n                        }`}\r\n                      >\r\n                        Bài viết\r\n                      </button>\r\n                      <button\r\n                        onClick={() => setMenuTab('media')}\r\n                        className={`flex-1 py-2 text-sm ${\r\n                          menuTab === 'media' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-600'\r\n                        }`}\r\n                      >\r\n                        Media\r\n                      </button>\r\n                    </div>\r\n                    {menuTab === 'post' ? (\r\n                      <div className=\"p-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            setShowMenu(false);\r\n                            handleStartEdit();\r\n                          }}\r\n                          className=\"w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100 text-sm\"\r\n                        >\r\n                          Sửa nội dung\r\n                        </button>\r\n                        <button\r\n                          onClick={() => {\r\n                            setShowMenu(false);\r\n                            handleDeletePost();\r\n                          }}\r\n                          className=\"w-full text-left px-3 py-2 rounded-lg hover:bg-red-50 text-sm text-red-600\"\r\n                        >\r\n                          Xóa bài viết\r\n                        </button>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"p-2 space-y-2 max-h-72 overflow-y-auto\">\r\n                        {uploading && (\r\n                          <div className=\"px-3 py-2 rounded-xl bg-indigo-50 border border-indigo-100\">\r\n                            <div className=\"flex items-center justify-between text-xs text-indigo-700\">\r\n                              <span>Đang tải lên {uploadLabel}</span>\r\n                              <span>{Math.round(uploadProgress)}%</span>\r\n                            </div>\r\n                            <div className=\"mt-1 h-2 bg-gray-200 rounded-full\">\r\n                              <div\r\n                                className=\"h-2 bg-indigo-600 rounded-full\"\r\n                                style={{ width: `${Math.round(uploadProgress)}%` }}\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                        <input\r\n                          ref={mediaAddRef}\r\n                          type=\"file\"\r\n                          multiple\r\n                          accept=\"image/*,video/*\"\r\n                          className=\"hidden\"\r\n                          onChange={(e) => handleAddMediaFiles(e.target.files)}\r\n                        />\r\n                        <input\r\n                          ref={docAddRef}\r\n                          type=\"file\"\r\n                          multiple\r\n                          className=\"hidden\"\r\n                          onChange={(e) => handleAddDocFiles(e.target.files)}\r\n                        />\r\n                        {imagesOverride.length > 0 && (\r\n                          <div>\r\n                            <p className=\"text-xs text-gray-500 mb-1\">Ảnh ({imagesOverride.length})</p>\r\n                            {imagesOverride.map((src, i) => (\r\n                              <div\r\n                                key={i}\r\n                                className=\"flex items-center justify-between px-3 py-1 rounded-lg hover:bg-gray-100\"\r\n                              >\r\n                                <span className=\"text-xs\">Ảnh {i + 1}</span>\r\n                                <button onClick={() => removeImageAt(i)} className=\"text-xs text-red-600\">\r\n                                  Xóa\r\n                                </button>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                        {videosOverride.length > 0 && (\r\n                          <div>\r\n                            <p className=\"text-xs text-gray-500 mb-1\">Video ({videosOverride.length})</p>\r\n                            {videosOverride.map((src, i) => (\r\n                              <div\r\n                                key={i}\r\n                                className=\"flex items-center justify-between px-3 py-1 rounded-lg hover:bg-gray-100\"\r\n                              >\r\n                                <span className=\"text-xs\">Video {i + 1}</span>\r\n                                <button onClick={() => removeVideoAt(i)} className=\"text-xs text-red-600\">\r\n                                  Xóa\r\n                                </button>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                        {filesOverride.length > 0 && (\r\n                          <div>\r\n                            <p className=\"text-xs text-gray-500 mb-1\">File ({filesOverride.length})</p>\r\n                            {filesOverride.map((src, i) => (\r\n                              <div\r\n                                key={i}\r\n                                className=\"flex items-center justify-between px-3 py-1 rounded-lg hover:bg-gray-100\"\r\n                              >\r\n                                <span className=\"text-xs\">File {i + 1}</span>\r\n                                <button onClick={() => removeFileAt(i)} className=\"text-xs text-red-600\">\r\n                                  Xóa\r\n                                </button>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex items-center gap-2 pt-1\">\r\n                          <button\r\n                            disabled={uploading}\r\n                            onClick={() => mediaAddRef.current?.click()}\r\n                            className={`px-3 py-1 rounded-lg text-sm ${uploading ? 'bg-gray-200 text-gray-400' : 'bg-gray-100'}`}\r\n                          >\r\n                            Thêm ảnh/video\r\n                          </button>\r\n                          <button\r\n                            disabled={uploading}\r\n                            onClick={() => docAddRef.current?.click()}\r\n                            className={`px-3 py-1 rounded-lg text-sm ${uploading ? 'bg-gray-200 text-gray-400' : 'bg-gray-100'}`}\r\n                          >\r\n                            Thêm file\r\n                          </button>\r\n                        </div>\r\n                        <div className=\"pt-2\">\r\n                          <button\r\n                            onClick={handleSaveMedia}\r\n                            className=\"w-full px-3 py-2 rounded-lg bg-indigo-600 text-white text-sm\"\r\n                          >\r\n                            Lưu thay đổi media\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {isEditing && (\r\n          <div className=\"px-4\">\r\n            <textarea\r\n              value={editContent}\r\n              onChange={(e) => setEditContent(e.target.value)}\r\n              className=\"w-full rounded-xl border p-2 text-sm\"\r\n              rows={3}\r\n            />\r\n            <div className=\"mt-2 flex items-center gap-2\">\r\n              <button onClick={handleSaveEdit} className=\"px-3 py-1 rounded-xl bg-indigo-600 text-white text-sm\">\r\n                Lưu\r\n              </button>\r\n              <button onClick={() => setIsEditing(false)} className=\"px-3 py-1 rounded-xl bg-gray-200 text-sm\">\r\n                Huỷ\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex-1\">\r\n          {!deleted && (contentOverride ?? post.content) ? (\r\n            <p className=\"mt-2 px-4 text-sm whitespace-pre-line\">{contentOverride ?? post.content}</p>\r\n          ) : null}\r\n          {imagesOverride.length && !deleted ? <ImageGrid images={imagesOverride} /> : null}\r\n          {videosOverride.length ? <VideoGrid videos={videosOverride} /> : null}\r\n          {filesOverride.length ? (\r\n            <div className=\"mt-2 space-y-2\">\r\n              {filesOverride.map((src, i) => (\r\n                <a\r\n                  key={i}\r\n                  href={toMegaStream(src)}\r\n                  className=\"block bg-gray-100 px-3 py-2 rounded-xl text-sm\"\r\n                  target=\"_blank\"\r\n                >\r\n                  File {i + 1}\r\n                </a>\r\n              ))}\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"px-4 pb-3 flex justify-between text-xs text-gray-500\">\r\n        <div className=\"flex gap-1 items-center\">\r\n          <HiHandThumbUp className=\"text-indigo-600\" />\r\n          {post.likes}\r\n        </div>\r\n        <span>{commentsCount} bình luận</span>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-3 gap-2 px-2 pb-3\">\r\n        <button\r\n          onClick={() => onLike(post.id)}\r\n          className=\"bg-gray-100 py-2 rounded-2xl flex items-center justify-center gap-2\"\r\n        >\r\n          <HiHandThumbUp /> Thích\r\n        </button>\r\n        <button\r\n          onClick={handleToggleComments}\r\n          className=\"bg-gray-100 py-2 rounded-2xl flex items-center justify-center gap-2\"\r\n        >\r\n          <HiChatBubbleLeftRight /> Bình luận\r\n        </button>\r\n        <a\r\n          href={shareLink}\r\n          className=\"bg-gray-100 py-2 rounded-2xl flex items-center justify-center gap-2\"\r\n          onClick={(e) => {\r\n            e.preventDefault();\r\n            handleShare();\r\n          }}\r\n        >\r\n          <HiArrowUpTray /> Chia sẻ\r\n        </a>\r\n      </div>\r\n\r\n      {showComments && (\r\n        <div className=\"px-4 pb-4\">\r\n          <div className=\"space-y-3\">\r\n            {loadingComments ? (\r\n              <div className=\"text-sm text-gray-500\">Đang tải bình luận...</div>\r\n            ) : comments.length === 0 ? (\r\n              <div className=\"text-sm text-gray-500\">Chưa có bình luận</div>\r\n            ) : (\r\n              (() => {\r\n                const byParent: Record<string, PostComment[]> = {};\r\n                comments.forEach((c) => {\r\n                  const key = c.parentId || '__root__';\r\n                  (byParent[key] ||= []).push(c);\r\n                });\r\n\r\n                const renderNode = (node: PostComment, depth: number) => (\r\n                  <div key={node.id} className={`flex items-start gap-2 ${depth > 0 ? 'pl-10' : ''}`}>\r\n                    <Image\r\n                      src={node.avatar ? toMegaStream(node.avatar) : ''}\r\n                      width={depth > 0 ? 24 : 28}\r\n                      height={depth > 0 ? 24 : 28}\r\n                      alt=\"avatar\"\r\n                      className=\"rounded-full\"\r\n                      unoptimized\r\n                    />\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <p className=\"text-xs font-semibold\">{node.username || 'Người dùng'}</p>\r\n                        <span className=\"text-[10px] text-gray-500\">{formatTimeAgo(node.createdAt)}</span>\r\n                      </div>\r\n                      <p className=\"text-sm\">{node.content}</p>\r\n                      <div className=\"mt-2 flex items-center gap-2 relative\">\r\n                        <div className=\"relative\">\r\n                          <ReactionButton\r\n                            isMine={String(node.userId) === String(currentId)}\r\n                            visible={true}\r\n                            className=\"static translate-y-0 top-auto\"\r\n                            onPick={(emoji) => handleToggleReaction(node.id, emoji)}\r\n                          />\r\n                        </div>\r\n                        <button onClick={() => handleReply(node)} className=\"text-xs text-indigo-600\">\r\n                          Trả lời\r\n                        </button>\r\n                      </div>\r\n                      {node.reactions && Object.keys(node.reactions).length > 0 && (\r\n                        <div className=\"mt-1 flex flex-wrap gap-1 text-xs\">\r\n                          {Object.entries(node.reactions).map(([emoji, users]) => (\r\n                            <span key={emoji} className=\"px-2 py-0.5 rounded-full bg-gray-100\">\r\n                              {emoji} {users.length}\r\n                            </span>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n                      {(byParent[node.id] || []).map((child) => renderNode(child, depth + 1))}\r\n                    </div>\r\n                  </div>\r\n                );\r\n\r\n                return (byParent['__root__'] || []).map((root) => (\r\n                  <div key={root.id} className=\"space-y-2\">\r\n                    {renderNode(root, 0)}\r\n                  </div>\r\n                ));\r\n              })()\r\n            )}\r\n          </div>\r\n          <div className=\"mt-3 flex items-center gap-2\">\r\n            <input\r\n              value={newComment}\r\n              onChange={(e) => setNewComment(e.target.value)}\r\n              placeholder={currentId ? 'Viết bình luận...' : 'Đăng nhập để bình luận'}\r\n              className=\"flex-1 px-3 py-2 rounded-xl border\"\r\n              disabled={!currentId}\r\n            />\r\n            <button\r\n              onClick={handleSubmitComment}\r\n              disabled={!currentId || !newComment.trim()}\r\n              className=\"px-3 py-2 rounded-xl bg-indigo-600 text-white\"\r\n            >\r\n              Gửi\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","'use client';\r\n\r\nimport Image from 'next/image';\r\n\r\nfunction toMegaStream(url: string) {\r\n  return url;\r\n}\r\n\r\nexport default function ImageGrid({ images }: { images?: string[] }) {\r\n  if (!images?.length) return null;\r\n  return (\r\n    <div className=\"grid  gap-2\">\r\n      {images.slice(0, 4).map((src, i) => (\r\n        <Image\r\n          alt={`Image ${i}`}\r\n          width={200}\r\n          height={200}\r\n          key={i}\r\n          src={toMegaStream(src)}\r\n          className=\"w-full h-64 rounded-2xl object-cover\"\r\n          unoptimized={src.includes('mega.nz')}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport React from \"react\";\r\n\r\nfunction toMegaStream(url: string) {\r\n  return url;\r\n}\r\n\r\nexport default function VideoGrid({ videos }: { videos?: string[] }) {\r\n  if (!videos?.length) return null;\r\n  return (\r\n    <div className=\"grid  gap-2\">\r\n      {videos.slice(0, 4).map((src, i) => (\r\n        <video\r\n          key={i}\r\n          src={toMegaStream(src)}\r\n          controls\r\n          className=\"w-full h-64 rounded-2xl object-cover\"\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}