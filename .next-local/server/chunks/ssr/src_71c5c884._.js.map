{"version":3,"sources":["../../../../src/hooks/%28profile%29/useCurrentUser.tsx","../../../../src/app/%28zalo%29/moments/page.tsx","../../../../src/components/ComingSoonPage.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useMemo } from 'react';\r\n\r\nexport function useCurrentUser() {\r\n  const currentUser = useMemo(() => {\r\n    try {\r\n      const raw = typeof window !== 'undefined' ? localStorage.getItem('info_user') : null;\r\n      return raw ? (JSON.parse(raw) as Record<string, unknown>) : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  const currentId = useMemo(() => {\r\n    return String(currentUser?.['_id'] || (currentUser?.['username'] as string) || '');\r\n  }, [currentUser]);\r\n\r\n  return { currentUser, currentId };\r\n}\r\n","/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React, { useState, useCallback, useEffect } from 'react';\r\nimport { useCurrentUser } from '@/hooks/(profile)/useCurrentUser';\r\nimport PostComposer from '@/components/(memonts)/PostComposer';\r\nimport PostCard from '@/components/(memonts)/PostCard';\r\nimport ComingSoonPage from '@/components/ComingSoonPage';\r\n\r\nfunction toMegaStream(url: string) {\r\n  return url;\r\n}\r\n\r\n/* ------------------------------ TYPES ------------------------------ */\r\ntype FeedPost = {\r\n  id: string;\r\n  author: { id: string; name: string; avatar?: string };\r\n  content: string;\r\n  images?: string[];\r\n  videos?: string[];\r\n  files?: string[];\r\n  createdAt: number;\r\n  likes: number;\r\n  comments: number;\r\n  liked?: boolean;\r\n};\r\n\r\n/* uploads handled inside PostComposer */\r\n\r\n/* ------------------------------ MAIN PAGE ------------------------------ */\r\nexport default function MomentsPage() {\r\n  const { currentUser, currentId } = useCurrentUser();\r\n\r\n  const authorInfo = currentUser\r\n    ? {\r\n        id: String(currentUser._id || currentUser.username),\r\n        name: String(currentUser.name),\r\n        avatar:\r\n          typeof (currentUser as Record<string, unknown>).avatar === 'string'\r\n            ? toMegaStream(String((currentUser as Record<string, unknown>).avatar))\r\n            : undefined,\r\n      }\r\n    : null;\r\n\r\n  const [posts, setPosts] = useState<FeedPost[]>([]);\r\n  const [skip, setSkip] = useState(0);\r\n  const limit = 20;\r\n\r\n  /* ------------------------------ CREATE POST ------------------------------ */\r\n  const handleCreatePost = async (payload: Omit<FeedPost, 'id' | 'likes' | 'comments' | 'createdAt'>) => {\r\n    const res = await fetch('/api/posts', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        action: 'create',\r\n        data: {\r\n          authorId: payload.author.id,\r\n          authorName: payload.author.name,\r\n          authorAvatar: payload.author.avatar,\r\n          content: payload.content,\r\n          images: payload.images || [],\r\n          videos: payload.videos || [],\r\n          files: payload.files || [],\r\n          visibility: 'public',\r\n        },\r\n      }),\r\n    });\r\n\r\n    const json = await res.json();\r\n\r\n    if (json?._id) {\r\n      setPosts((prev) => [\r\n        {\r\n          id: json._id,\r\n          author: payload.author,\r\n          content: payload.content,\r\n          images: payload.images,\r\n          videos: payload.videos,\r\n          files: payload.files,\r\n          createdAt: Date.now(),\r\n          likes: 0,\r\n          comments: 0,\r\n          liked: false,\r\n        },\r\n        ...prev,\r\n      ]);\r\n    }\r\n  };\r\n\r\n  /* ------------------------------ LIKE POST ------------------------------ */\r\n  const handleLike = async (postId: string) => {\r\n    const post = posts.find((p) => p.id === postId);\r\n    const like = !post?.liked;\r\n\r\n    await fetch('/api/posts', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        action: 'toggleLike',\r\n        postId,\r\n        userId: currentId,\r\n        data: { like },\r\n      }),\r\n    });\r\n\r\n    setPosts((prev) =>\r\n      prev.map((p) => (p.id === postId ? { ...p, liked: like, likes: p.likes + (like ? 1 : -1) } : p)),\r\n    );\r\n  };\r\n\r\n  /* ----------------------------- MAP DB DOC ----------------------------- */\r\n  const mapPostDoc = useCallback(\r\n    (d: {\r\n      _id: string;\r\n      authorId: string;\r\n      authorName?: string;\r\n      authorAvatar?: string;\r\n      content?: string;\r\n      images?: string[];\r\n      videos?: string[];\r\n      files?: string[];\r\n      createdAt?: number;\r\n      likedBy?: string[];\r\n      commentsCount?: number;\r\n    }): FeedPost => ({\r\n      id: String(d._id),\r\n      author: {\r\n        id: String(d.authorId),\r\n        name: d.authorName || '',\r\n        avatar: d.authorAvatar ? toMegaStream(d.authorAvatar) : undefined,\r\n      },\r\n      content: d.content || '',\r\n      images: d.images?.map(toMegaStream) || [],\r\n      videos: d.videos?.map(toMegaStream) || [],\r\n      files: d.files?.map(toMegaStream) || [],\r\n      createdAt: d.createdAt || Date.now(),\r\n      likes: d.likedBy?.length || 0,\r\n      comments: d.commentsCount || 0,\r\n      liked: d.likedBy?.includes(currentId),\r\n    }),\r\n    [currentId],\r\n  );\r\n\r\n  /* ------------------------------ LOAD MORE ------------------------------ */\r\n  const loadPosts = async () => {\r\n    const res = await fetch(`/api/posts?skip=${skip}&limit=${limit}`);\r\n    const json = await res.json();\r\n\r\n    const arr = Array.isArray(json.data) ? json.data.map(mapPostDoc) : [];\r\n\r\n    setPosts((prev) => [...prev, ...arr]);\r\n    setSkip((prev) => prev + arr.length);\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadPosts();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  /* ------------------------------ UI ------------------------------ */\r\n  return (\r\n    // <div className=\"h-full overflow-y-auto bg-gradient-to-br from-slate-50 via-white to-indigo-50\">\r\n    //   <div className=\"max-w-2xl mx-auto px-4 py-6 space-y-4 pb-32\">\r\n    //     <PostComposer\r\n    //       onPost={handleCreatePost}\r\n    //       author={\r\n    //         authorInfo ? { ...authorInfo, avatar: authorInfo.avatar ? String(authorInfo.avatar) : undefined } : null\r\n    //       }\r\n    //     />\r\n    //     {posts.map((p) => (\r\n    //       <PostCard key={p.id} post={p} onLike={handleLike} />\r\n    //     ))}\r\n    //   </div>\r\n    // </div>\r\n    <ComingSoonPage />\r\n  );\r\n}\r\n","// app/(pages)/coming-soon/page.tsx   (hoặc bất kỳ route nào bạn muốn)\r\n\r\n'use client';\r\n\r\nimport { HiSparkles, HiRocketLaunch, HiClock, HiCheckBadge } from 'react-icons/hi2';\r\n\r\nexport default function ComingSoonPage() {\r\n  return (\r\n    <main className=\"relative h-[100vh] min-h-screen w-full flex items-center justify-center overflow-hidden bg-gradient-to-br from-blue-600 via-blue-500 to-cyan-400\">\r\n      {/* Hiệu ứng nền động */}\r\n      <div className=\"absolute inset-0\">\r\n        <div className=\"absolute top-0 left-0 w-96 h-96 bg-white/10 rounded-full blur-3xl animate-pulse\" />\r\n        <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-cyan-300/20 rounded-full blur-3xl animate-pulse delay-700\" />\r\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-blue-400/20 rounded-full blur-3xl animate-ping\" />\r\n      </div>\r\n\r\n      <div className=\"relative z-10 max-w-4xl mx-auto px-6 text-center\">\r\n        {/* Logo + Tên */}\r\n        \r\n\r\n        {/* Card chính – Glassmorphism đỉnh cao */}\r\n        <div className=\"bg-white/10 backdrop-blur-2xl rounded-3xl shadow-3xl border border-white/20 p-7\">\r\n          <div className=\"flex flex-col items-center\">\r\n            {/* Icon lớn */}\r\n            <div className=\"p-3 bg-white/20 rounded-3xl shadow-2xl mb-4 animate-bounce\">\r\n              <HiRocketLaunch className=\"w-24 h-24 text-white\" />\r\n            </div>\r\n\r\n            {/* Tiêu đề */}\r\n            <h2 className=\"text-xl md:text-6xl font-black text-white mb-6 leading-tight\">\r\n              Đang được\r\n              <br />\r\n              <span className=\"bg-gradient-to-r from-cyan-300 to-white bg-clip-text text-transparent\">hoàn thiện</span>\r\n            </h2>\r\n\r\n        \r\n\r\n            {/* Danh sách tính năng sắp ra mắt */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 w-full mb-12\">\r\n              {[\r\n                { icon: HiSparkles, text: 'Giao diện đẹp như mơ' },\r\n                { icon: HiClock, text: 'Tin nhắn siêu nhanh' },\r\n                { icon: HiCheckBadge, text: 'Bảo mật tuyệt đối' },\r\n              ].map((item, i) => (\r\n                <div\r\n                  key={i}\r\n                  className=\"flex flex-col items-center gap-4 md:p-6 p-1 bg-white/10 rounded-2xl backdrop-blur-xl border border-white/20 hover:scale-105 transition-transform duration-300\"\r\n                >\r\n                  <item.icon className=\"md:w-12 md:h-12 w-8 h-8 text-cyan-300\" />\r\n                  <span className=\"text-white font-semibold text-lg\">{item.text}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Nút hành động */}\r\n            <div className=\"flex flex-col sm:flex-row gap-6 justify-center\">\r\n              <button\r\n                onClick={() => (window.location.href = '/home')}\r\n                className=\"px-6 py-4 bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white font-bold text-xl rounded-2xl shadow-2xl hover:shadow-3xl transition-all duration-300 active:scale-95 flex items-center justify-center gap-3\"\r\n              >\r\n                <HiRocketLaunch className=\"w-7 h-7 \" />\r\n                Vào ứng dụng ngay\r\n              </button>\r\n\r\n              <button\r\n                onClick={() => alert('Sắp có thông báo khi ra mắt chính thức!')}\r\n                className=\"px-6 py-3 bg-white/20 backdrop-blur-xl border-2 border-white/50 text-white font-bold text-xl rounded-2xl hover:bg-white/30 transition-all duration-300 active:scale-95\"\r\n              >\r\n                Nhận thông báo khi sẵn sàng\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"mt-16 text-white/70 text-sm\">\r\n          <p>© {new Date().getFullYear()} Hupuna – Được xây dựng với tình yêu và công nghệ</p>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}