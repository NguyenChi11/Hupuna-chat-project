{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/ChatItem.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { formatTimeAgo } from '../../utils/dateUtils';\r\nimport { formatMessagePreview } from './Sidebar';\r\nimport type { ChatItem as ChatItemType, GroupConversation } from '@/types/Group';\r\nimport type { User } from '@/types/User';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl } from '@/utils/utils';\r\n\r\n// React Icons – Bộ hiện đại nhất 2025\r\nimport {\r\n  HiEye,\r\n  HiEyeSlash,\r\n  HiUserGroup,\r\n  HiCheck,\r\n  HiOutlineMapPin,\r\n  HiPlus,\r\n  HiEllipsisHorizontal,\r\n  HiChevronUp,\r\n} from 'react-icons/hi2';\r\n\r\ninterface ChatItemProps {\r\n  item: ChatItemType;\r\n  isGroup: boolean;\r\n  selectedChat: ChatItemType | null;\r\n  onSelectChat: (item: ChatItemType) => void;\r\n  currentUserId: string;\r\n  onChatAction: (roomId: string, actionType: 'pin' | 'hide', isChecked: boolean, isGroupChat: boolean) => void;\r\n  categoryTags?: { id: string; label: string; color: string }[];\r\n  userTags?: { id: string; label: string; color: string }[];\r\n  onOpenTagManager?: () => void;\r\n}\r\n\r\nexport default function ChatItem({\r\n  item,\r\n  isGroup,\r\n  selectedChat,\r\n  onSelectChat,\r\n  onChatAction,\r\n  currentUserId,\r\n  categoryTags = [],\r\n  userTags = [],\r\n  onOpenTagManager,\r\n}: ChatItemProps) {\r\n  const CATEGORY_TAGS = categoryTags;\r\n  const USER_TAGS = userTags;\r\n  const isSelected = selectedChat?._id === item._id;\r\n  const [showMenu, setShowMenu] = useState(false);\r\n  const [menuPosition, setMenuPosition] = useState<{ x: number; y: number; align?: 'top' | 'bottom' } | null>(null);\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  const longPressTimerRef = useRef<number | null>(null);\r\n  const longPressTriggeredRef = useRef(false);\r\n  const [imgError, setImgError] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setImgError(false);\r\n  }, [item.avatar]);\r\n\r\n  const unreadCount = item.unreadCount || 0;\r\n  const isPinned = !!item.isPinned;\r\n  const isHidden = !!item.isHidden;\r\n  const [chatCategories, setChatCategories] = useState<string[]>([]);\r\n  const storageKey = `chatCategories:${String(currentUserId)}:${String(item._id)}`;\r\n  useEffect(() => {\r\n    try {\r\n      const fromServer =\r\n        (item as unknown as { categories?: string[] }).categories ||\r\n        (item as unknown as { categoriesBy?: Record<string, string[]> }).categoriesBy?.[String(currentUserId)] ||\r\n        [];\r\n      if (Array.isArray(fromServer) && fromServer.length > 0) {\r\n        setChatCategories(fromServer.filter((x) => typeof x === 'string'));\r\n      } else {\r\n        const raw = typeof window !== 'undefined' ? localStorage.getItem(storageKey) : null;\r\n        if (raw) {\r\n          const arr = JSON.parse(raw);\r\n          if (Array.isArray(arr)) setChatCategories(arr.filter((x) => typeof x === 'string'));\r\n        }\r\n      }\r\n    } catch {}\r\n  }, [currentUserId, item, storageKey]);\r\n  useEffect(() => {\r\n    const handler = (ev: Event) => {\r\n      try {\r\n        const anyEv = ev as unknown as { detail?: { userId?: string; roomId?: string; categories?: string[] } };\r\n        const detail = anyEv.detail || {};\r\n        if (String(detail.userId) !== String(currentUserId)) return;\r\n        if (String(detail.roomId) !== String(item._id)) return;\r\n        const arr = Array.isArray(detail.categories)\r\n          ? detail.categories.filter((x: unknown) => typeof x === 'string')\r\n          : [];\r\n        setChatCategories(arr);\r\n        try {\r\n          localStorage.setItem(storageKey, JSON.stringify(arr));\r\n        } catch {}\r\n      } catch {}\r\n    };\r\n    window.addEventListener('chatCategoriesUpdated', handler as EventListener);\r\n    return () => {\r\n      window.removeEventListener('chatCategoriesUpdated', handler as EventListener);\r\n    };\r\n  }, [currentUserId, item._id, storageKey]);\r\n\r\n  const [chatTags, setChatTags] = useState<string[]>([]);\r\n  const storageKeyTags = `chatTags:${String(currentUserId)}:${String(item._id)}`;\r\n  useEffect(() => {\r\n    try {\r\n      const fromServer =\r\n        (item as unknown as { tags?: string[] }).tags ||\r\n        (item as unknown as { tagsBy?: Record<string, string[]> }).tagsBy?.[String(currentUserId)] ||\r\n        [];\r\n      if (Array.isArray(fromServer) && fromServer.length > 0) {\r\n        setChatTags(fromServer.filter((x) => typeof x === 'string'));\r\n      } else {\r\n        const raw = typeof window !== 'undefined' ? localStorage.getItem(storageKeyTags) : null;\r\n        if (raw) {\r\n          const arr = JSON.parse(raw);\r\n          if (Array.isArray(arr)) setChatTags(arr.filter((x) => typeof x === 'string'));\r\n        }\r\n      }\r\n    } catch {}\r\n  }, [currentUserId, item, storageKeyTags]);\r\n  useEffect(() => {\r\n    const handler = (ev: Event) => {\r\n      try {\r\n        const anyEv = ev as unknown as { detail?: { userId?: string; roomId?: string; tags?: string[] } };\r\n        const detail = anyEv.detail || {};\r\n        if (String(detail.userId) !== String(currentUserId)) return;\r\n        if (String(detail.roomId) !== String(item._id)) return;\r\n        const arr = Array.isArray(detail.tags) ? detail.tags.filter((x: unknown) => typeof x === 'string') : [];\r\n        setChatTags(arr);\r\n        try {\r\n          localStorage.setItem(storageKeyTags, JSON.stringify(arr));\r\n        } catch {}\r\n      } catch {}\r\n    };\r\n    window.addEventListener('chatTagsUpdated', handler as EventListener);\r\n    return () => {\r\n      window.removeEventListener('chatTagsUpdated', handler as EventListener);\r\n    };\r\n  }, [currentUserId, item._id, storageKeyTags]);\r\n  const toggleTag = (id: string) => {\r\n    setChatTags((prev) => {\r\n      const next = prev.includes(id) ? prev.filter((x) => x !== id) : [...prev, id];\r\n      try {\r\n        localStorage.setItem(storageKeyTags, JSON.stringify(next));\r\n      } catch {}\r\n      const isGroupChat = isGroup;\r\n      const apiRoute = isGroupChat ? '/api/groups' : '/api/users';\r\n      const payload = isGroupChat\r\n        ? {\r\n            action: 'updateTags',\r\n            _id: String(currentUserId),\r\n            conversationId: String(item._id),\r\n            data: { tags: next },\r\n          }\r\n        : {\r\n            action: 'updateTags',\r\n            currentUserId: String(currentUserId),\r\n            roomId: String(item._id),\r\n            data: { tags: next },\r\n          };\r\n      try {\r\n        fetch(apiRoute, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload),\r\n        }).catch(() => {});\r\n      } catch {}\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const [activeGroupCall, setActiveGroupCall] = useState(false);\r\n  useEffect(() => {\r\n    if (!isGroup) {\r\n      setActiveGroupCall(false);\r\n      return;\r\n    }\r\n    try {\r\n      const raw = localStorage.getItem('ACTIVE_GROUP_CALL_ROOMS');\r\n      const arr = raw ? (JSON.parse(raw) as string[]) : [];\r\n      const has = Array.isArray(arr) && arr.map(String).includes(String(item._id));\r\n      setActiveGroupCall(!!has);\r\n    } catch {\r\n      setActiveGroupCall(false);\r\n    }\r\n    const handler = (e: Event) => {\r\n      const d = (e as unknown as { detail?: { rooms?: string[] } }).detail || {};\r\n      const rooms = Array.isArray(d.rooms) ? d.rooms.map(String) : [];\r\n      const has = rooms.includes(String(item._id));\r\n      setActiveGroupCall(!!has);\r\n    };\r\n    window.addEventListener('activeGroupCallsUpdated', handler as EventListener);\r\n    return () => window.removeEventListener('activeGroupCallsUpdated', handler as EventListener);\r\n  }, [isGroup, item._id]);\r\n\r\n  const toggleCategory = (id: string) => {\r\n    setChatCategories((prev) => {\r\n      const next = prev.includes(id) ? [] : [id];\r\n      try {\r\n        localStorage.setItem(storageKey, JSON.stringify(next));\r\n      } catch {}\r\n      const isGroupChat = isGroup;\r\n      const apiRoute = isGroupChat ? '/api/groups' : '/api/users';\r\n      const payload = isGroupChat\r\n        ? {\r\n            action: 'updateCategories',\r\n            _id: String(currentUserId),\r\n            conversationId: String(item._id),\r\n            data: { categories: next },\r\n          }\r\n        : {\r\n            action: 'updateCategories',\r\n            currentUserId: String(currentUserId),\r\n            roomId: String(item._id),\r\n            data: { categories: next },\r\n          };\r\n      try {\r\n        fetch(apiRoute, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload),\r\n        }).catch(() => {});\r\n      } catch {}\r\n      return next;\r\n    });\r\n  };\r\n\r\n  // Tối ưu: Gộp logic lấy tên + avatar char\r\n  const displayName = React.useMemo(() => {\r\n    if (isGroup) {\r\n      const group = item as GroupConversation;\r\n      if (group.name?.trim()) return group.name.trim();\r\n      const names = group.members\r\n        ?.map((m) => (m as unknown as User)?.name)\r\n        .filter(Boolean)\r\n        .slice(0, 3)\r\n        .join(', ');\r\n      return names || 'Nhóm trống';\r\n    }\r\n    const user = item as User;\r\n    return user.nicknames?.[currentUserId] || user.name || user.username || 'Người dùng';\r\n  }, [item, isGroup, currentUserId]);\r\n\r\n  const lastMessage = item.lastMessage || (isGroup ? 'Nhóm mới tạo' : 'Bắt đầu trò chuyện');\r\n  const timeDisplay = formatTimeAgo(item.lastMessageAt);\r\n\r\n  const PRESENCE_THRESHOLD_MS = 5 * 60 * 1000;\r\n  const presenceOnline = (() => {\r\n    if (isGroup) return undefined;\r\n    const u = item as User;\r\n    const ls = u.lastSeen ?? null;\r\n    if (ls != null) return Date.now() - ls <= PRESENCE_THRESHOLD_MS;\r\n    return !!u.online;\r\n  })();\r\n\r\n  const sanitizeUrl = (u?: string) => {\r\n    if (!u) return '';\r\n    const s = String(u).trim();\r\n    return s.replace(/^[('\"]+/, '').replace(/[)'\"]+$/, '');\r\n  };\r\n  const avatarSrc = React.useMemo(() => sanitizeUrl(getProxyUrl(item.avatar)), [item.avatar]);\r\n\r\n  const resolvedAvatarSrc = React.useMemo(() => {\r\n    const s = avatarSrc;\r\n    if (!s) return '/logo/avata.webp';\r\n    try {\r\n      const u = new URL(s);\r\n      const ok =\r\n        (u.protocol === 'https:' && u.hostname === 'files.hupuna.vn' && u.pathname.startsWith('/api/files/')) ||\r\n        (u.protocol === 'http:' &&\r\n          u.hostname === '117.4.242.30' &&\r\n          u.port === '8090' &&\r\n          u.pathname.startsWith('/api/files/')) ||\r\n        (u.protocol === 'https:' && u.hostname === 'cdn.jsdelivr.net') ||\r\n        (u.protocol === 'https:' && u.hostname === 'mega.nz' && u.pathname.startsWith('/file/'));\r\n      return ok ? s : '/logo/avata.webp';\r\n    } catch {\r\n      return '/logo/avata.webp';\r\n    }\r\n  }, [avatarSrc]);\r\n\r\n  // Context menu thông minh\r\n  const handleContextMenu = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const x = e.clientX;\r\n    const y = e.clientY;\r\n    const menuWidth = 240;\r\n\r\n    const finalX = x + menuWidth > window.innerWidth ? window.innerWidth - menuWidth - 16 : x + 12;\r\n    const isBottomHalf = y > window.innerHeight / 2;\r\n\r\n    setMenuPosition({\r\n      x: finalX,\r\n      y: y,\r\n      align: isBottomHalf ? 'bottom' : 'top',\r\n    });\r\n    setShowMenu(true);\r\n  };\r\n\r\n  const clearLongPressTimer = () => {\r\n    if (longPressTimerRef.current != null) {\r\n      clearTimeout(longPressTimerRef.current);\r\n      longPressTimerRef.current = null;\r\n    }\r\n  };\r\n\r\n  const handleTouchStart = (e: React.TouchEvent) => {\r\n    clearLongPressTimer();\r\n    longPressTriggeredRef.current = false;\r\n    const t = e.touches && e.touches[0];\r\n    const x0 = t ? t.clientX : 0;\r\n    const y0 = t ? t.clientY : 0;\r\n    longPressTimerRef.current = window.setTimeout(() => {\r\n      const menuWidth = 240;\r\n      const finalX = x0 + menuWidth > window.innerWidth ? window.innerWidth - menuWidth - 16 : x0 + 12;\r\n      const isBottomHalf = y0 > window.innerHeight / 2;\r\n\r\n      setMenuPosition({\r\n        x: finalX,\r\n        y: y0,\r\n        align: isBottomHalf ? 'bottom' : 'top',\r\n      });\r\n      setShowMenu(true);\r\n      longPressTriggeredRef.current = true;\r\n    }, 500);\r\n  };\r\n\r\n  const handleTouchEnd = (e: React.TouchEvent) => {\r\n    const triggered = longPressTriggeredRef.current;\r\n    clearLongPressTimer();\r\n    if (triggered) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  };\r\n\r\n  const handleTouchMove = () => {\r\n    clearLongPressTimer();\r\n  };\r\n\r\n  const handleAction = (type: 'pin' | 'hide') => {\r\n    setShowMenu(false);\r\n    onChatAction(item._id, type, type === 'pin' ? !isPinned : !isHidden, isGroup);\r\n  };\r\n\r\n  // Click outside để đóng menu\r\n  useEffect(() => {\r\n    if (!showMenu) return;\r\n    const close = (e: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\r\n        setShowMenu(false);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', close);\r\n    return () => document.removeEventListener('mousedown', close);\r\n  }, [showMenu]);\r\n\r\n  const [showTagSelector, setShowTagSelector] = useState(false);\r\n  const [tagMenuPos, setTagMenuPos] = useState<{ x: number; y: number; align?: 'top' | 'bottom' } | null>(null);\r\n  const [isTagExpanded, setIsTagExpanded] = useState(false);\r\n\r\n  return (\r\n    <>\r\n      {/* Chat Item – SIÊU ĐẸP */}\r\n      <div\r\n        onClick={() => onSelectChat(item)}\r\n        onContextMenu={handleContextMenu}\r\n        onTouchStart={handleTouchStart}\r\n        onTouchEnd={handleTouchEnd}\r\n        onTouchCancel={clearLongPressTimer}\r\n        onTouchMove={handleTouchMove}\r\n        className={`\r\n          group relative mx-1 rounded-[0.25rem] transition-all duration-300 cursor-pointer\r\n          ${\r\n            isSelected\r\n              ? 'bg-blue-100 shadow-xl'\r\n              : 'hover:bg-gradient-to-r hover:from-gray-50 hover:to-indigo-50 hover:shadow-lg'\r\n          }\r\n          ${isHidden ? 'opacity-60' : ''}\r\n        `}\r\n      >\r\n        <div className=\"flex items-center gap-1 md:gap-2 py-[0.5rem] md:py-1 px-2 \">\r\n          <div className=\"flex flex-col items-center gap-2\">\r\n            {/* Avatar + Online + Group Icon */}\r\n            <div className=\"relative flex-shrink-0\">\r\n              <div\r\n                className={`\r\n                w-12 h-12  rounded-4xl overflow-hidden ring-2 ring-white shadow-2xl flex items-center justify-center text-white font-bold text-2xl\r\n                ${\r\n                  isGroup\r\n                    ? 'bg-gradient-to-br from-sky-500 via-blue-500 to-blue-500'\r\n                    : 'bg-gradient-to-br from-indigo-500 to-blue-600'\r\n                }\r\n              `}\r\n              >\r\n                {item.avatar && !imgError ? (\r\n                  <Image\r\n                    src={resolvedAvatarSrc}\r\n                    alt={displayName}\r\n                    width={64}\r\n                    height={64}\r\n                    className=\"w-full h-full object-cover\"\r\n                    onError={() => setImgError(true)}\r\n                  />\r\n                ) : (\r\n                  <Image\r\n                    src=\"/logo/avata.webp\"\r\n                    alt={displayName}\r\n                    width={64}\r\n                    height={64}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                )}\r\n              </div>\r\n\r\n              {/* Online indicator (chỉ cá nhân) */}\r\n              {!isGroup && (\r\n                <div\r\n                  className={`absolute bottom-0 right-0 w-3 md:w-4\r\n               h-3 md:h-4 rounded-full border-2 md:border-3 border-white shadow-lg\r\n                ${presenceOnline ? 'bg-green-400' : 'bg-gray-400'}`}\r\n                />\r\n              )}\r\n\r\n              {/* Group icon */}\r\n              {isGroup && (\r\n                <div className=\"absolute -bottom-1 -right-1 p-1 bg-white rounded-2xl shadow-xl\">\r\n                  <HiUserGroup className=\"w-4 h-4 text-purple-600\" />\r\n                </div>\r\n              )}\r\n\r\n              {/* Pin icon – đẹp hơn */}\r\n              {isPinned && (\r\n                <div className=\"absolute -top-2 -left-2 p-1 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl shadow-xl animate-pulse\">\r\n                  <HiOutlineMapPin className=\"w-4 h-4 text-white rotate-12\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n            {chatCategories.length > 0 && (\r\n              <div className=\"\">\r\n                <div className=\"flex flex-wrap gap-1\">\r\n                  {chatCategories.map((cat) => {\r\n                    const found = CATEGORY_TAGS.find((c) => c.id === cat);\r\n                    if (!found) return null;\r\n                    return (\r\n                      <span\r\n                        key={cat}\r\n                        className=\"inline-flex items-center gap-1.5 px-1 py-0.5 rounded-full text-[10px] font-medium bg-white/80 border border-gray-200 text-gray-700 shadow-sm\"\r\n                      >\r\n                        <span className={`w-2 h-2 rounded-full ${found.color}`} />\r\n                        <span className=\"truncate max-w-[1.75rem]\">{found.label}</span>\r\n                      </span>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Nội dung */}\r\n          <div className=\"flex-1 min-w-0 ml-1 transition-colors duration-150 border-b pb-2 border-gray-200 lg:border-b-0\">\r\n            <div className=\"flex items-center justify-between mb-1\">\r\n              <h4\r\n                className={`\r\n                 text-[1rem] md:text-[1.125rem] font-medium truncate max-w-[11rem]\r\n                  ${unreadCount > 0 ? 'text-gray-900' : 'text-gray-500'}\r\n                `}\r\n              >\r\n                {displayName}\r\n              </h4>\r\n              <span className=\"text-sm text-gray-500 flex items-center gap-1\">\r\n                <HiCheck className=\"w-4 h-4 text-indigo-500\" />\r\n                {timeDisplay}\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p\r\n                  className={`\r\n                  text-[0.875rem] md:text-[1rem] truncate max-w-[13rem]\r\n                  ${unreadCount > 0 ? 'font-semibold text-gray-800' : 'text-gray-600'}\r\n                `}\r\n                >\r\n                  {item.isRecall ? 'Tin nhắn đã được thu hồi' : formatMessagePreview(lastMessage)}\r\n                </p>\r\n                {activeGroupCall && isGroup && (\r\n                  <span className=\"bg-green-500 text-xs rounded-md px-1.5 py-0.5 text-white inline-block mt-1\">\r\n                    Cuộc gọi đang diễn ra\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              {/* Unread Badge – đẹp hơn Zalo */}\r\n              {unreadCount > 0 && (\r\n                <div className=\"relative\">\r\n                  <div className=\"relative w-6 h-6 flex items-center justify-center bg-gradient-to-r from-red-500 to-pink-600 rounded-full shadow-xl\">\r\n                    <span className=\"text-sm font-bold text-white\">{unreadCount > 99 ? '99+' : unreadCount}</span>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n            {(chatTags.length > 0 || showTagSelector) && (\r\n              <div className=\"flex flex-wrap items-center gap-1 mt-2 relative z-10 w-full\">\r\n                {(isTagExpanded ? chatTags : chatTags.slice(0, 3)).map((tagId) => {\r\n                  const found = USER_TAGS.find((t) => t.id === tagId);\r\n                  if (!found) return null;\r\n                  return (\r\n                    <span\r\n                      key={tagId}\r\n                      className={`inline-block px-1.5 py-0.5 mb-[0.25rem] text-[10px] font-bold text-white rounded-[0.125rem] shadow-sm ${found.color} whitespace-nowrap`}\r\n                    >\r\n                      {found.label}\r\n                    </span>\r\n                  );\r\n                })}\r\n                {!isTagExpanded && chatTags.length > 3 && (\r\n                  <button\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setIsTagExpanded(true);\r\n                    }}\r\n                    className=\"inline-flex items-center justify-center px-1 py-0.5 mb-[0.25rem] text-[10px] bg-gray-200 hover:bg-gray-300 text-gray-600 rounded-[0.125rem] transition-colors\"\r\n                  >\r\n                    <HiEllipsisHorizontal className=\"w-3 h-3\" />\r\n                  </button>\r\n                )}\r\n                {isTagExpanded && chatTags.length > 3 && (\r\n                  <button\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setIsTagExpanded(false);\r\n                    }}\r\n                    className=\"inline-flex items-center justify-center px-1 py-0.5 mb-[0.25rem] text-[10px] bg-gray-200 hover:bg-gray-300 text-gray-600 rounded-[0.125rem] transition-colors\"\r\n                    title=\"Thu gọn\"\r\n                  >\r\n                    <HiChevronUp className=\"w-3 h-3\" />\r\n                  </button>\r\n                )}\r\n                <div className=\"relative\">\r\n                  <button\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      if (showTagSelector) {\r\n                        setShowTagSelector(false);\r\n                      } else {\r\n                        const rect = e.currentTarget.getBoundingClientRect();\r\n                        const isBottomHalf = rect.bottom > window.innerHeight / 2;\r\n                        setTagMenuPos({\r\n                          x: rect.left,\r\n                          y: isBottomHalf ? rect.top - 4 : rect.bottom + 4,\r\n                          align: isBottomHalf ? 'bottom' : 'top',\r\n                        });\r\n                        setShowTagSelector(true);\r\n                      }\r\n                    }}\r\n                    className={`cursor-pointer p-0.5 rounded-[0.1  25rem] hover:bg-gray-200 text-gray-400 hover:text-gray-600 transition-colors ${\r\n                      chatTags.length > 0 ? 'opacity-0 group-hover:opacity-100' : ''\r\n                    } ${showTagSelector ? 'opacity-100 bg-gray-200 text-gray-600' : ''}`}\r\n                    title=\"Thêm thẻ tag\"\r\n                  >\r\n                    <HiPlus className=\"w-3.5 h-3.5\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {showMenu && menuPosition && (\r\n        <>\r\n          <div className=\"fixed inset-0 z-[9998] \" onClick={() => setShowMenu(false)} />\r\n\r\n          <div\r\n            ref={menuRef}\r\n            style={{\r\n              top: menuPosition.align === 'bottom' ? 'auto' : menuPosition.y,\r\n              bottom: menuPosition.align === 'bottom' ? window.innerHeight - menuPosition.y : 'auto',\r\n              left: menuPosition.x,\r\n              position: 'fixed',\r\n            }}\r\n            className={`z-[9999] w-60 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden animate-in fade-in duration-200 ${\r\n              menuPosition.align === 'bottom' ? 'slide-in-from-bottom-2' : 'slide-in-from-top-2'\r\n            }`}\r\n          >\r\n            {/* Ghim */}\r\n            <button\r\n              onClick={() => handleAction('pin')}\r\n              className=\"flex cursor-pointer items-center w-full px-4 py-3 hover:bg-gray-50 transition-colors gap-3 group\"\r\n            >\r\n              <HiOutlineMapPin\r\n                className={`w-5 h-5 ${isPinned ? 'text-orange-500 rotate-45' : 'text-gray-400 group-hover:text-gray-600'}`}\r\n              />\r\n              <span className=\"flex-1 text-left text-gray-700 font-medium text-sm\">\r\n                {isPinned ? 'Bỏ ghim' : 'Ghim lên đầu'}\r\n              </span>\r\n              {isPinned && <HiCheck className=\"w-4 h-4 text-orange-500\" />}\r\n            </button>\r\n\r\n            {/* Ẩn/Hiện */}\r\n            <button\r\n              onClick={() => handleAction('hide')}\r\n              className=\"flex cursor-pointer items-center w-full px-4 py-3 hover:bg-gray-50 transition-colors gap-3 group border-t border-gray-100\"\r\n            >\r\n              {isHidden ? (\r\n                <HiEye className=\"w-5 h-5 text-green-500\" />\r\n              ) : (\r\n                <HiEyeSlash className=\"w-5 h-5 text-gray-400 group-hover:text-gray-600\" />\r\n              )}\r\n              <span className=\"flex-1 text-left text-gray-700 font-medium text-sm\">\r\n                {isHidden ? 'Hiện lại' : 'Ẩn trò chuyện'}\r\n              </span>\r\n              {isHidden && <HiCheck className=\"w-4 h-4 text-green-500\" />}\r\n            </button>\r\n            <div className=\"border-t border-gray-100\">\r\n              <div className=\"px-4 py-2 text-xs text-gray-500\">Theo thẻ phân loại</div>\r\n              <div className=\"max-h-30 overflow-auto custom-scrollbar\">\r\n                {CATEGORY_TAGS.map((cat) => {\r\n                  const checked = chatCategories.includes(cat.id);\r\n                  return (\r\n                    <button\r\n                      key={cat.id}\r\n                      onClick={() => toggleCategory(cat.id)}\r\n                      className=\"flex cursor-pointer items-center w-full px-4 py-2 hover:bg-gray-50 transition-colors gap-3\"\r\n                    >\r\n                      <span className={`inline-block w-3.5 h-3.5 rounded-sm ${cat.color} border border-white`} />\r\n                      <span className=\"flex-1 text-left text-gray-700 text-sm\">{cat.label}</span>\r\n                      <input type=\"checkbox\" checked={checked} readOnly className=\"w-4 h-4\" />\r\n                    </button>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n            <div className=\"border-t border-gray-100\">\r\n              <div className=\"flex items-center justify-between px-4 py-2\">\r\n                <div className=\"text-xs text-gray-500\">Theo thẻ tags</div>\r\n                <button\r\n                  onClick={() => {\r\n                    setShowMenu(false);\r\n                    setShowTagSelector(true);\r\n                  }}\r\n                  className=\"text-xs text-blue-600 hover:text-blue-700 font-medium\"\r\n                >\r\n                  + Thêm\r\n                </button>\r\n              </div>\r\n              <div className=\"max-h-30 overflow-auto custom-scrollbar\">\r\n                {USER_TAGS.map((tag) => {\r\n                  const checked = chatTags.includes(tag.id);\r\n                  return (\r\n                    <button\r\n                      key={tag.id}\r\n                      onClick={() => toggleTag(tag.id)}\r\n                      className=\"flex cursor-pointer items-center w-full px-4 py-2 hover:bg-gray-50 transition-colors gap-3\"\r\n                    >\r\n                      <span className={`inline-block w-3.5 h-3.5 rounded-sm ${tag.color} border border-white`} />\r\n                      <span className=\"flex-1 text-left text-gray-700 text-sm\">{tag.label}</span>\r\n                      <input type=\"checkbox\" checked={checked} readOnly className=\"w-4 h-4\" />\r\n                    </button>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n      {showTagSelector && tagMenuPos && (\r\n        <>\r\n          <div\r\n            className=\"fixed inset-0 z-[9998]\"\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              setShowTagSelector(false);\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              top: tagMenuPos.align === 'bottom' ? 'auto' : tagMenuPos.y,\r\n              bottom: tagMenuPos.align === 'bottom' ? window.innerHeight - tagMenuPos.y : 'auto',\r\n              left: tagMenuPos.x,\r\n              position: 'fixed',\r\n            }}\r\n            className=\"z-[9999] w-48 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden animate-in fade-in zoom-in-95 duration-200\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"p-1 max-h-48 overflow-y-auto custom-scrollbar\">\r\n              {USER_TAGS.length === 0 && <div className=\"text-xs text-gray-400 text-center py-2\">Chưa có thẻ nào</div>}\r\n              {USER_TAGS.map((tag) => (\r\n                <button\r\n                  key={tag.id}\r\n                  onClick={() => toggleTag(tag.id)}\r\n                  className=\"flex items-center w-full gap-2 px-2 py-1.5 hover:bg-gray-50 rounded text-left transition-colors group/item\"\r\n                >\r\n                  <div className={`w-3 h-3 rounded-full ${tag.color} shadow-sm`} />\r\n                  <span className=\"flex-1 text-xs font-medium text-gray-700 truncate\">{tag.label}</span>\r\n                  {chatTags.includes(tag.id) && <HiCheck className=\"w-3.5 h-3.5 text-blue-500\" />}\r\n                </button>\r\n              ))}\r\n            </div>\r\n            <div className=\"border-t border-gray-100 p-1 bg-gray-50\">\r\n              <button\r\n                onClick={() => {\r\n                  setShowTagSelector(false);\r\n                  onOpenTagManager?.();\r\n                }}\r\n                className=\"flex items-center justify-center w-full gap-1 px-2 py-1.5 text-xs text-blue-600 font-bold hover:bg-blue-100 rounded transition-colors\"\r\n              >\r\n                <HiPlus className=\"w-3 h-3\" /> Quản lý thẻ\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1120, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/SidebarMobileMenu.tsx"],"sourcesContent":["'use client';\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n\r\nimport React, { useRef, useEffect } from 'react';\r\nimport { FILTER_CONFIG, FilterType } from '../(chatPopup)/MessageFilter';\r\nimport { FaPlus } from 'react-icons/fa6';\r\nimport { HiFolder } from 'react-icons/hi2';\r\n\r\ninterface SidebarMobileMenuProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  filterType: FilterType;\r\n  setFilterType: (filter: FilterType) => void;\r\n  counts: {\r\n    all: number;\r\n    unread: number;\r\n    read: number;\r\n    group: number;\r\n    personal: number;\r\n    hidden: number;\r\n    [key: string]: number;\r\n  };\r\n  onOpenCreateGroup: () => void;\r\n  onOpenGlobalFolder: () => void;\r\n  buttonRef: React.RefObject<HTMLButtonElement | null>;\r\n  onlyGroups?: boolean;\r\n  onlyPersonal?: boolean;\r\n}\r\n\r\nexport default function SidebarMobileMenu({\r\n  isOpen,\r\n  onClose,\r\n  filterType,\r\n  setFilterType,\r\n  counts,\r\n  onOpenCreateGroup,\r\n  onOpenGlobalFolder,\r\n  buttonRef,\r\n  onlyGroups = false,\r\n  onlyPersonal = false,\r\n}: SidebarMobileMenuProps) {\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        menuRef.current &&\r\n        !menuRef.current.contains(event.target as Node) &&\r\n        buttonRef.current &&\r\n        !buttonRef.current.contains(event.target as Node)\r\n      ) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n    }\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, [isOpen, onClose, buttonRef]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const filters: FilterType[] =\r\n    counts.hidden > 0\r\n      ? ['all', 'group', 'personal', 'unread', 'read', 'hidden']\r\n      : ['all', 'group', 'personal', 'unread', 'read'];\r\n\r\n  let displayedFilters = filters;\r\n  if (onlyGroups) {\r\n    displayedFilters = filters.filter((f) => f !== 'personal');\r\n  } else if (onlyPersonal) {\r\n    displayedFilters = filters.filter((f) => f !== 'group');\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={menuRef}\r\n      className=\"absolute top-12 right-0 z-50 w-64 bg-white rounded-lg shadow-xl border border-gray-100 py-1 animate-in fade-in zoom-in-95 duration-200 origin-top-right\"\r\n    >\r\n      <div className=\"space-y-0.5\">\r\n        {/* Actions */}\r\n        {!onlyPersonal && (\r\n          <button\r\n            onClick={() => {\r\n              onOpenCreateGroup();\r\n              onClose();\r\n            }}\r\n            className=\"w-full cursor-pointer flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 transition-colors text-gray-700 text-sm font-medium\"\r\n          >\r\n            <div className=\"flex items-center justify-center w-5 h-5 text-gray-500\">\r\n              <FaPlus className=\"w-4 h-4\" />\r\n            </div>\r\n            <span>Tạo nhóm mới</span>\r\n          </button>\r\n        )}\r\n\r\n        <div className=\"my-1 border-t border-gray-100\" />\r\n\r\n        {/* Filters */}\r\n        <div className=\"text-xs font-semibold text-gray-400 px-4 py-2 uppercase tracking-wider\">Bộ lọc tin nhắn</div>\r\n\r\n        {displayedFilters.map((filter) => {\r\n          const { label, icon: Icon, color } = FILTER_CONFIG[filter];\r\n          const isActive = filterType === filter;\r\n          const count = counts[filter];\r\n\r\n          // Map colors for active state\r\n          const activeTextClass =\r\n            {\r\n              indigo: 'text-indigo-600',\r\n              blue: 'text-blue-600',\r\n              green: 'text-emerald-600',\r\n              purple: 'text-purple-600',\r\n              pink: 'text-pink-600',\r\n              gray: 'text-gray-600',\r\n            }[color] || 'text-gray-600';\r\n\r\n          const activeBgClass =\r\n            {\r\n              indigo: 'bg-indigo-50',\r\n              blue: 'bg-blue-50',\r\n              green: 'bg-emerald-50',\r\n              purple: 'bg-purple-50',\r\n              pink: 'bg-pink-50',\r\n              gray: 'bg-gray-50',\r\n            }[color] || 'bg-gray-50';\r\n\r\n          return (\r\n            <button\r\n              key={filter}\r\n              onClick={() => {\r\n                setFilterType(filter);\r\n                onClose();\r\n              }}\r\n              className={`\r\n                w-full cursor-pointer flex items-center justify-between px-4 py-2.5 transition-colors text-sm\r\n                ${isActive ? `${activeBgClass} ${activeTextClass} font-medium` : 'text-gray-600 hover:bg-gray-50'}\r\n              `}\r\n            >\r\n              <div className=\"flex items-center gap-3\">\r\n                <Icon className={`w-5 h-5 ${isActive ? activeTextClass : 'text-gray-400'}`} />\r\n                <span>{label}</span>\r\n              </div>\r\n\r\n              {count > 0 && (\r\n                <span\r\n                  className={`\r\n                  text-xs px-2 py-0.5 rounded-full font-medium\r\n                  ${isActive ? 'bg-white/60' : 'bg-gray-100 text-gray-600'}\r\n                `}\r\n                >\r\n                  {count > 99 ? '99+' : count}\r\n                </span>\r\n              )}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA,oDAAoD,GAEpD;AACA;AACA;;;AALA;;;;AA6Be,SAAS,kBAAkB,EACxC,MAAM,EACN,OAAO,EACP,UAAU,EACV,aAAa,EACb,MAAM,EACN,iBAAiB,EACjB,kBAAkB,EAClB,SAAS,EACT,aAAa,KAAK,EAClB,eAAe,KAAK,EACG;;IACvB,MAAM,UAAU,IAAA,uKAAM,EAAiB;IAEvC,IAAA,0KAAS;uCAAC;YACR,MAAM;kEAAqB,CAAC;oBAC1B,IACE,QAAQ,OAAO,IACf,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,KACtC,UAAU,OAAO,IACjB,CAAC,UAAU,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GACxC;wBACA;oBACF;gBACF;;YAEA,IAAI,QAAQ;gBACV,SAAS,gBAAgB,CAAC,aAAa;YACzC;YACA;+CAAO;oBACL,SAAS,mBAAmB,CAAC,aAAa;gBAC5C;;QACF;sCAAG;QAAC;QAAQ;QAAS;KAAU;IAE/B,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,UACJ,OAAO,MAAM,GAAG,IACZ;QAAC;QAAO;QAAS;QAAY;QAAU;QAAQ;KAAS,GACxD;QAAC;QAAO;QAAS;QAAY;QAAU;KAAO;IAEpD,IAAI,mBAAmB;IACvB,IAAI,YAAY;QACd,mBAAmB,QAAQ,MAAM,CAAC,CAAC,IAAM,MAAM;IACjD,OAAO,IAAI,cAAc;QACvB,mBAAmB,QAAQ,MAAM,CAAC,CAAC,IAAM,MAAM;IACjD;IAEA,qBACE,6LAAC;QACC,KAAK;QACL,WAAU;kBAEV,cAAA,6LAAC;YAAI,WAAU;;gBAEZ,CAAC,8BACA,6LAAC;oBACC,SAAS;wBACP;wBACA;oBACF;oBACA,WAAU;;sCAEV,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,4JAAM;gCAAC,WAAU;;;;;;;;;;;sCAEpB,6LAAC;sCAAK;;;;;;;;;;;;8BAIV,6LAAC;oBAAI,WAAU;;;;;;8BAGf,6LAAC;oBAAI,WAAU;8BAAyE;;;;;;gBAEvF,iBAAiB,GAAG,CAAC,CAAC;oBACrB,MAAM,EAAE,KAAK,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,GAAG,wKAAa,CAAC,OAAO;oBAC1D,MAAM,WAAW,eAAe;oBAChC,MAAM,QAAQ,MAAM,CAAC,OAAO;oBAE5B,8BAA8B;oBAC9B,MAAM,kBACJ;wBACE,QAAQ;wBACR,MAAM;wBACN,OAAO;wBACP,QAAQ;wBACR,MAAM;wBACN,MAAM;oBACR,CAAC,CAAC,MAAM,IAAI;oBAEd,MAAM,gBACJ;wBACE,QAAQ;wBACR,MAAM;wBACN,OAAO;wBACP,QAAQ;wBACR,MAAM;wBACN,MAAM;oBACR,CAAC,CAAC,MAAM,IAAI;oBAEd,qBACE,6LAAC;wBAEC,SAAS;4BACP,cAAc;4BACd;wBACF;wBACA,WAAW,CAAC;;gBAEV,EAAE,WAAW,GAAG,cAAc,CAAC,EAAE,gBAAgB,YAAY,CAAC,GAAG,iCAAiC;cACpG,CAAC;;0CAED,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAK,WAAW,CAAC,QAAQ,EAAE,WAAW,kBAAkB,iBAAiB;;;;;;kDAC1E,6LAAC;kDAAM;;;;;;;;;;;;4BAGR,QAAQ,mBACP,6LAAC;gCACC,WAAW,CAAC;;kBAEZ,EAAE,WAAW,gBAAgB,4BAA4B;gBAC3D,CAAC;0CAEE,QAAQ,KAAK,QAAQ;;;;;;;uBAtBrB;;;;;gBA2BX;;;;;;;;;;;;AAIR;GAtIwB;KAAA"}},
    {"offset": {"line": 1331, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/Sidebar.tsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\r\n'use client';\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n\r\nimport React, { useState, useCallback, useRef, useMemo, useEffect } from 'react';\r\nimport ChatItem from './ChatItem';\r\nimport SearchResults from '@/components/(chatPopup)/SearchResults';\r\nimport { User } from '../../types/User';\r\nimport type { GroupConversation, ChatItem as ChatItemType } from '../../types/Group';\r\nimport { getProxyUrl, normalizeNoAccent, computeMatchScore, hasDiacritics, accentAwareIncludes } from '../../utils/utils';\r\nimport MessageFilter, { FilterType } from '../(chatPopup)/MessageFilter';\r\nimport SidebarMobileMenu from './SidebarMobileMenu';\r\n\r\nimport Image from 'next/image';\r\nimport { FaPlus } from 'react-icons/fa6';\r\n\r\n// React Icons – Bộ hiện đại nhất 2025\r\nimport {\r\n  HiMagnifyingGlass,\r\n  HiXMark,\r\n  HiUserCircle,\r\n  HiChatBubbleLeftRight,\r\n  HiEllipsisVertical,\r\n  HiCalendarDays,\r\n  HiClock,\r\n  HiUserGroup,\r\n  HiChevronDown,\r\n} from 'react-icons/hi2';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\n\r\nimport RoomSearchResultsModal from '@/components/(search)/RoomSearchResultsModal';\r\nimport ComingSoonModal from '@/components/modal/ComingSoonModal';\r\nimport CategoryManagerModal from '@/components/modal/CategoryManagerModal';\r\nimport TagManagerModal from '@/components/modal/TagManagerModal';\r\n\r\ninterface SidebarProps {\r\n  currentUser: User;\r\n  groups: GroupConversation[];\r\n  allUsers: User[];\r\n  searchTerm: string;\r\n  setSearchTerm: (term: string) => void;\r\n  setShowCreateGroupModal: (show: boolean) => void;\r\n  selectedChat: ChatItemType | null;\r\n  onSelectChat: (item: ChatItemType) => void;\r\n  onChatAction: (roomId: string, actionType: 'pin' | 'hide', isChecked: boolean, isGroup: boolean) => void;\r\n  onNavigateToMessage: (message: Message, searchKeyword?: string) => void;\r\n  styleWidget?: string;\r\n  onlyGroups?: boolean;\r\n  onlyPersonal?: boolean;\r\n}\r\n\r\ninterface Message {\r\n  _id: string;\r\n  content?: string;\r\n  type: 'text' | 'image' | 'file' | 'sticker' | 'video' | 'reminder';\r\n  fileName?: string;\r\n  timestamp: number;\r\n  sender: string;\r\n  senderName: string;\r\n  roomId: string;\r\n  roomName: string;\r\n  isGroupChat: boolean;\r\n  partnerId?: string;\r\n  partnerName?: string;\r\n  fileUrl?: string;\r\n}\r\n\r\ninterface GlobalSearchResult {\r\n  contacts: ChatItemType[];\r\n  messages: Message[];\r\n}\r\n\r\nconst getChatDisplayName = (chat: ChatItemType, currentUserId?: string): string => {\r\n  const maybeGroup = chat as GroupConversation;\r\n  const isGroupChat = maybeGroup.isGroup === true || Array.isArray(maybeGroup.members);\r\n\r\n  if (isGroupChat) {\r\n    return (maybeGroup.name || '').trim() || 'Nhóm';\r\n  }\r\n\r\n  const user = chat as User;\r\n  if (currentUserId && user.nicknames?.[currentUserId]) {\r\n    return user.nicknames[currentUserId].trim();\r\n  }\r\n  return (user.name || user.username || 'Người dùng').trim();\r\n};\r\n\r\nexport const formatMessagePreview = (content: string | undefined, maxLength: number = 50): string => {\r\n  if (!content) return '';\r\n  const formatted = content.replace(/@\\[([^\\]]+)\\]\\([^)]+\\)/g, '@$1');\r\n  if (formatted.length > maxLength) {\r\n    return formatted.slice(0, maxLength) + '...';\r\n  }\r\n  return formatted;\r\n};\r\n\r\nexport const parseMentions = (text: string): { mentions: string[]; displayText: string } => {\r\n  const mentionRegex = /@\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\r\n  const mentions: string[] = [];\r\n  let match;\r\n\r\n  while ((match = mentionRegex.exec(text)) !== null) {\r\n    mentions.push(match[2]);\r\n  }\r\n\r\n  return { mentions, displayText: text };\r\n};\r\n\r\nexport default function Sidebar({\r\n  currentUser,\r\n  groups,\r\n  allUsers,\r\n  searchTerm,\r\n  setSearchTerm,\r\n  setShowCreateGroupModal,\r\n  selectedChat,\r\n  onSelectChat,\r\n  onChatAction,\r\n  onNavigateToMessage,\r\n  styleWidget = '',\r\n  onlyGroups = false,\r\n  onlyPersonal = false,\r\n}: SidebarProps) {\r\n  const [activeExtraTab, setActiveExtraTab] = useState<'calendar' | 'reminder' | 'offline'>('calendar');\r\n  const currentUserId = currentUser._id;\r\n  const [activeTab, setActiveTab] = useState<'all' | 'contacts' | 'messages' | 'files'>('all');\r\n  const [globalSearchResults, setGlobalSearchResults] = useState<GlobalSearchResult>({\r\n    contacts: [],\r\n    messages: [],\r\n  });\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const debounceRef = useRef<NodeJS.Timeout | null>(null);\r\n  const searchInputRef = useRef<HTMLInputElement>(null);\r\n  const [filterType, setFilterType] = useState<FilterType>('all');\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const isWidgetIframe = pathname === '/chat-iframe' || (pathname?.startsWith('/chat-iframe') ?? false);\r\n  const [showGlobalFolder, setShowGlobalFolder] = useState(false);\r\n  const [showMobileMenu, setShowMobileMenu] = useState(false);\r\n  const mobileMenuButtonRef = useRef<HTMLButtonElement>(null);\r\n  const [showComingSoon, setShowComingSoon] = useState<{ isOpen: boolean; title: string; desc: string }>({\r\n    isOpen: false,\r\n    title: '',\r\n    desc: '',\r\n  });\r\n  const [roomResultsModal, setRoomResultsModal] = useState<{\r\n    roomId: string;\r\n    roomName: string;\r\n    roomAvatar?: string;\r\n    isGroupChat: boolean;\r\n  } | null>(null);\r\n  const [showFilterDropdown, setShowFilterDropdown] = useState(false);\r\n  const filterDropdownRef = useRef<HTMLDivElement>(null);\r\n  const [showCategoryManager, setShowCategoryManager] = useState(false);\r\n  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);\r\n  const [userCategoryTags, setUserCategoryTags] = useState<{ id: string; label: string; color: string }[]>(\r\n    currentUser?.categoryTags || [],\r\n  );\r\n\r\n  useEffect(() => {\r\n    function handleClickOutside(event: MouseEvent) {\r\n      if (filterDropdownRef.current && !filterDropdownRef.current.contains(event.target as Node)) {\r\n        setShowFilterDropdown(false);\r\n      }\r\n    }\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n  useEffect(() => {\r\n    setUserCategoryTags(currentUser?.categoryTags || []);\r\n  }, [currentUser]);\r\n  useEffect(() => {\r\n    async function loadUserData() {\r\n      if (!currentUserId) return;\r\n      try {\r\n        const res = await fetch('/api/users', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'getById', _id: String(currentUserId) }),\r\n        });\r\n        const data = await res.json();\r\n        const row = (data && data.row) || (Array.isArray(data?.data) ? data.data[0] : null);\r\n\r\n        if (row) {\r\n          const cats = (row.categoryTags as { id: string; label: string; color: string }[]) || [];\r\n          setUserCategoryTags(Array.isArray(cats) ? cats : []);\r\n\r\n          const tags = (row.userTags as { id: string; label: string; color: string }[]) || [];\r\n          setUserTags(Array.isArray(tags) ? tags : []);\r\n        }\r\n      } catch {}\r\n    }\r\n    loadUserData();\r\n  }, [currentUserId]);\r\n  useEffect(() => {\r\n    function handleTagsUpdated(e: Event) {\r\n      const ev = e as CustomEvent<{ userId: string; tags: { id: string; label: string; color: string }[] }>;\r\n      const detail = ev.detail;\r\n      if (!detail) return;\r\n      if (String(detail.userId) !== String(currentUserId)) return;\r\n      setUserCategoryTags(Array.isArray(detail.tags) ? detail.tags : []);\r\n    }\r\n    if (typeof window !== 'undefined') {\r\n      window.addEventListener('userCategoryTagsUpdated', handleTagsUpdated as EventListener);\r\n    }\r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        window.removeEventListener('userCategoryTagsUpdated', handleTagsUpdated as EventListener);\r\n      }\r\n    };\r\n  }, [currentUserId]);\r\n\r\n  const [showTagManager, setShowTagManager] = useState(false);\r\n  const [selectedTags, setSelectedTags] = useState<string[]>([]);\r\n  const [showTagFilterDropdown, setShowTagFilterDropdown] = useState(false);\r\n  const [userTags, setUserTags] = useState<{ id: string; label: string; color: string }[]>(currentUser?.userTags || []);\r\n  const tagFilterDropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    function handleClickOutsideTag(event: MouseEvent) {\r\n      if (tagFilterDropdownRef.current && !tagFilterDropdownRef.current.contains(event.target as Node)) {\r\n        setShowTagFilterDropdown(false);\r\n      }\r\n    }\r\n    document.addEventListener('mousedown', handleClickOutsideTag);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutsideTag);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setUserTags(currentUser?.userTags || []);\r\n  }, [currentUser]);\r\n\r\n  useEffect(() => {\r\n    function handleUserTagsUpdated(e: Event) {\r\n      const ev = e as CustomEvent<{ userId: string; tags: { id: string; label: string; color: string }[] }>;\r\n      const detail = ev.detail;\r\n      if (!detail) return;\r\n      if (String(detail.userId) !== String(currentUserId)) return;\r\n      setUserTags(Array.isArray(detail.tags) ? detail.tags : []);\r\n    }\r\n    if (typeof window !== 'undefined') {\r\n      window.addEventListener('userTagsUpdated', handleUserTagsUpdated as EventListener);\r\n    }\r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        window.removeEventListener('userTagsUpdated', handleUserTagsUpdated as EventListener);\r\n      }\r\n    };\r\n  }, [currentUserId]);\r\n  const getItemCategories = useCallback(\r\n    (chat: ChatItemType) => {\r\n      const serverCats =\r\n        (chat as unknown as { categories?: string[] }).categories ||\r\n        (chat as unknown as { categoriesBy?: Record<string, string[]> }).categoriesBy?.[String(currentUserId)] ||\r\n        [];\r\n      if (Array.isArray(serverCats) && serverCats.length > 0) return serverCats.filter((x) => typeof x === 'string');\r\n      try {\r\n        const k = `chatCategories:${String(currentUserId)}:${String(chat._id)}`;\r\n        const raw = typeof window !== 'undefined' ? localStorage.getItem(k) : null;\r\n        if (!raw) return [];\r\n        const arr = JSON.parse(raw);\r\n        if (Array.isArray(arr)) return arr.filter((x) => typeof x === 'string');\r\n      } catch {}\r\n      return [];\r\n    },\r\n    [currentUserId],\r\n  );\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const raw = typeof window !== 'undefined' ? localStorage.getItem('__return_room_results__') : null;\r\n      if (!raw) return;\r\n      const data = JSON.parse(raw);\r\n      if (data && data.origin === 'sidebar') {\r\n        setSearchTerm((data.keyword || '').toString());\r\n        setRoomResultsModal({\r\n          roomId: data.roomId,\r\n          roomName: data.roomName,\r\n          roomAvatar: data.roomAvatar,\r\n          isGroupChat: !!data.isGroupChat,\r\n        });\r\n        localStorage.removeItem('__return_room_results__');\r\n      }\r\n    } catch {}\r\n  }, [selectedChat]);\r\n\r\n  // === TẤT CẢ LOGIC GIỮ NGUYÊN NHƯ BẠN ĐÃ VIẾT ===\r\n  const handleGlobalSearch = useCallback(\r\n    async (term: string) => {\r\n      if (!term.trim() || !currentUser) {\r\n        setGlobalSearchResults({ contacts: [], messages: [] });\r\n        return;\r\n      }\r\n\r\n      const normalizedTerm = normalizeNoAccent(term);\r\n      const hasDia = hasDiacritics(term);\r\n      let allChats: ChatItemType[] = [...groups, ...allUsers];\r\n      if (onlyGroups) {\r\n        allChats = [...groups];\r\n      } else if (onlyPersonal) {\r\n        allChats = [...allUsers];\r\n      }\r\n\r\n      const contactResults = allChats\r\n        .filter((c) => accentAwareIncludes(getChatDisplayName(c, String(currentUserId)), term))\r\n        .map((c) => ({\r\n          item: c,\r\n          score: computeMatchScore(getChatDisplayName(c, String(currentUserId)), term),\r\n        }))\r\n        .sort((a, b) => {\r\n          if (b.score !== a.score) return b.score - a.score;\r\n          const aName = getChatDisplayName(a.item, String(currentUserId));\r\n          const bName = getChatDisplayName(b.item, String(currentUserId));\r\n          return aName.localeCompare(bName);\r\n        })\r\n        .slice(0, 10)\r\n        .map((x) => x.item);\r\n\r\n      try {\r\n        const res = await fetch('/api/messages', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            action: 'globalSearch',\r\n            data: { userId: currentUser._id, searchTerm: term, limit: 200 },\r\n          }),\r\n        });\r\n\r\n        const messageData = await res.json();\r\n        const rawMessages = (messageData.data || []) as Message[];\r\n        let messages: Message[] = rawMessages;\r\n        if (onlyGroups) {\r\n          messages = rawMessages.filter((m: Message) => m.isGroupChat);\r\n        } else if (onlyPersonal) {\r\n          messages = rawMessages.filter((m: Message) => !m.isGroupChat);\r\n        }\r\n\r\n        const getMessageSearchText = (m: Message): string => {\r\n          if (m.type === 'file') return m.fileName || 'File';\r\n          if (m.type === 'image') return 'Hình ảnh';\r\n          if (m.type === 'video') return 'Video';\r\n          if (m.type === 'sticker') return 'Sticker';\r\n          return m.content || '';\r\n        };\r\n\r\n        messages = messages.filter((m) => accentAwareIncludes(getMessageSearchText(m), term));\r\n\r\n        messages = [...messages].sort((a, b) => {\r\n          const sa = computeMatchScore(getMessageSearchText(a), term);\r\n          const sb = computeMatchScore(getMessageSearchText(b), term);\r\n          if (sb !== sa) return sb - sa;\r\n          return (b.timestamp || 0) - (a.timestamp || 0);\r\n        });\r\n\r\n        setGlobalSearchResults({\r\n          contacts: contactResults,\r\n          messages: messages,\r\n        });\r\n      } catch (e) {\r\n        console.error('Global search error:', e);\r\n        setGlobalSearchResults({ contacts: contactResults, messages: [] });\r\n      }\r\n    },\r\n    [currentUser, groups, allUsers, onlyGroups, onlyPersonal, currentUserId],\r\n  );\r\n\r\n  const handleSearchChange = (value: string) => {\r\n    setSearchTerm(value);\r\n    if (debounceRef.current) clearTimeout(debounceRef.current);\r\n\r\n    if (!value.trim()) {\r\n      setGlobalSearchResults({ contacts: [], messages: [] });\r\n      setIsSearching(false);\r\n      return;\r\n    }\r\n\r\n    setIsSearching(true);\r\n    debounceRef.current = setTimeout(() => {\r\n      handleGlobalSearch(value);\r\n      setIsSearching(false);\r\n    }, 400);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (searchTerm.trim() && globalSearchResults.contacts.length === 0 && globalSearchResults.messages.length === 0) {\r\n      setIsSearching(true);\r\n      void (async () => {\r\n        await handleGlobalSearch(searchTerm);\r\n        setIsSearching(false);\r\n      })();\r\n    }\r\n  }, [searchTerm, globalSearchResults.contacts.length, globalSearchResults.messages.length, handleGlobalSearch]);\r\n  const regularMessages = useMemo(() => globalSearchResults.messages, [globalSearchResults.messages]);\r\n\r\n  const fileMessages = useMemo(() => globalSearchResults.messages, [globalSearchResults.messages]);\r\n\r\n  const groupedMessages = useMemo(() => {\r\n    const getRoomAvatar = (roomId: string, isGroupChat: boolean | undefined) => {\r\n      if (isGroupChat) {\r\n        const g = groups.find((gr) => String(gr._id) === String(roomId));\r\n        return g?.avatar;\r\n      }\r\n      const parts = String(roomId).split('_');\r\n      const me = String(currentUserId);\r\n      const partnerId = parts[0] === me ? parts[1] : parts[1] === me ? parts[0] : parts.find((p) => p !== me);\r\n      const u = allUsers.find((x) => String(x._id) === String(partnerId));\r\n      return u?.avatar;\r\n    };\r\n    const map = new Map();\r\n    regularMessages.forEach((msg) => {\r\n      if (!msg.roomId) return;\r\n      const key = msg.roomId;\r\n      if (!map.has(key)) {\r\n        map.set(key, {\r\n          roomId: msg.roomId,\r\n          roomName: msg.roomName || 'Cuộc trò chuyện',\r\n          isGroupChat: msg.isGroupChat || false,\r\n          avatar: getRoomAvatar(msg.roomId, msg.isGroupChat || false),\r\n          messages: [],\r\n          latestTimestamp: msg.timestamp || Date.now(),\r\n        });\r\n      }\r\n      map.get(key).messages.push(msg);\r\n    });\r\n    return Array.from(map.values());\r\n  }, [regularMessages]);\r\n\r\n  const groupedFiles = useMemo(() => {\r\n    const getRoomAvatar = (roomId: string, isGroupChat: boolean | undefined) => {\r\n      if (isGroupChat) {\r\n        const g = groups.find((gr) => String(gr._id) === String(roomId));\r\n        return g?.avatar;\r\n      }\r\n      const parts = String(roomId).split('_');\r\n      const me = String(currentUserId);\r\n      const partnerId = parts[0] === me ? parts[1] : parts[1] === me ? parts[0] : parts.find((p) => p !== me);\r\n      const u = allUsers.find((x) => String(x._id) === String(partnerId));\r\n      return u?.avatar;\r\n    };\r\n    const map = new Map();\r\n    fileMessages.forEach((msg) => {\r\n      if (!msg.roomId) return;\r\n      const key = msg.roomId;\r\n      if (!map.has(key)) {\r\n        map.set(key, {\r\n          roomId: msg.roomId,\r\n          roomName: msg.roomName || 'Cuộc trò chuyện',\r\n          isGroupChat: msg.isGroupChat || false,\r\n          avatar: getRoomAvatar(msg.roomId, msg.isGroupChat || false),\r\n          files: [],\r\n          latestTimestamp: msg.timestamp || Date.now(),\r\n        });\r\n      }\r\n      map.get(key).files.push(msg);\r\n    });\r\n    return Array.from(map.values());\r\n  }, [fileMessages]);\r\n\r\n  const hasSearchResults = globalSearchResults.contacts.length > 0 || globalSearchResults.messages.length > 0;\r\n  const isSearchActive = searchTerm.trim().length > 0;\r\n\r\n  const handleSelectContact = (contact: ChatItemType) => {\r\n    onSelectChat(contact);\r\n    setSearchTerm('');\r\n    setGlobalSearchResults({ contacts: [], messages: [] });\r\n  };\r\n\r\n  const mixedChats = useMemo<ChatItemType[]>(() => {\r\n    if (onlyGroups) {\r\n      return [...groups];\r\n    }\r\n    if (onlyPersonal) {\r\n      return [...allUsers];\r\n    }\r\n    return [...groups, ...allUsers];\r\n  }, [groups, allUsers, onlyGroups, onlyPersonal, currentUserId]);\r\n  const categoriesMap = useMemo(() => {\r\n    const map = new Map<string, string[]>();\r\n    mixedChats.forEach((c: ChatItemType) => {\r\n      map.set(String(c._id), getItemCategories(c));\r\n    });\r\n    return map;\r\n  }, [mixedChats, getItemCategories]);\r\n\r\n  const filteredAndSortedChats = useMemo(() => {\r\n    let filtered = mixedChats.filter((chat: ChatItemType) => {\r\n      const isHidden = chat.isHidden;\r\n      const displayName = getChatDisplayName(chat, String(currentUserId));\r\n      const matchesSearch = isSearchActive ? accentAwareIncludes(displayName, searchTerm) : true;\r\n\r\n      if (isSearchActive) return matchesSearch;\r\n      if (filterType === 'hidden') return isHidden && matchesSearch;\r\n      return !isHidden && matchesSearch;\r\n    });\r\n\r\n    if (!isSearchActive) {\r\n      if (filterType === 'group') {\r\n        filtered = filtered.filter((c) => c.isGroup === true || Array.isArray((c as GroupConversation).members));\r\n      } else if (filterType === 'personal') {\r\n        filtered = filtered.filter((c) => !(c.isGroup === true || Array.isArray((c as GroupConversation).members)));\r\n      } else if (filterType === 'unread') {\r\n        filtered = filtered.filter((c) => (c.unreadCount || 0) > 0);\r\n      } else if (filterType === 'read') {\r\n        filtered = filtered.filter((c) => (c.unreadCount || 0) === 0);\r\n      }\r\n    }\r\n\r\n    if (!isSearchActive && filterType !== 'hidden') {\r\n      // no-op, handled above\r\n    }\r\n\r\n    filtered.sort((a, b) => {\r\n      const timeA = a.lastMessageAt || 0;\r\n      const timeB = b.lastMessageAt || 0;\r\n      const aPinned = a.isPinned || false;\r\n      const bPinned = b.isPinned || false;\r\n\r\n      if (aPinned && !bPinned) return -1;\r\n      if (!aPinned && bPinned) return 1;\r\n      if (timeA === 0 && timeB === 0) {\r\n        return getChatDisplayName(a).localeCompare(getChatDisplayName(b));\r\n      }\r\n      return timeB - timeA;\r\n    });\r\n\r\n    if (selectedCategories.length > 0) {\r\n      filtered = filtered.filter((c) => {\r\n        const cats = categoriesMap.get(String(c._id)) || [];\r\n        return cats.some((cat) => selectedCategories.includes(cat));\r\n      });\r\n    }\r\n\r\n    if (selectedTags.length > 0) {\r\n      filtered = filtered.filter((c) => {\r\n        const tags =\r\n          (c as unknown as { tags?: string[] }).tags ||\r\n          (c as unknown as { tagsBy?: Record<string, string[]> }).tagsBy?.[String(currentUserId)] ||\r\n          [];\r\n        // Fallback local storage\r\n        if (!tags || tags.length === 0) {\r\n          try {\r\n            const k = `chatTags:${String(currentUserId)}:${String(c._id)}`;\r\n            const raw = typeof window !== 'undefined' ? localStorage.getItem(k) : null;\r\n            if (raw) {\r\n              const arr = JSON.parse(raw);\r\n              if (Array.isArray(arr)) {\r\n                return arr.some((t) => selectedTags.includes(t));\r\n              }\r\n            }\r\n          } catch {}\r\n        }\r\n        return tags.some((t) => selectedTags.includes(t));\r\n      });\r\n    }\r\n\r\n    return filtered;\r\n  }, [\r\n    mixedChats,\r\n    searchTerm,\r\n    filterType,\r\n    isSearchActive,\r\n    selectedCategories,\r\n    categoriesMap,\r\n    selectedTags,\r\n    currentUserId,\r\n  ]);\r\n\r\n  const filterCounts = useMemo(() => {\r\n    const visible = mixedChats.filter((c) => !c.isHidden);\r\n    const hidden = mixedChats.filter((c) => c.isHidden);\r\n    const groupVisible = visible.filter((c) => c.isGroup === true || Array.isArray((c as GroupConversation).members));\r\n    const personalVisible = visible.filter(\r\n      (c) => !(c.isGroup === true || Array.isArray((c as GroupConversation).members)),\r\n    );\r\n    return {\r\n      all: visible.length,\r\n      unread: visible.filter((c) => (c.unreadCount || 0) > 0).length,\r\n      read: visible.filter((c) => (c.unreadCount || 0) === 0).length,\r\n      group: groupVisible.length,\r\n      personal: personalVisible.length,\r\n      hidden: hidden.length,\r\n    };\r\n  }, [mixedChats]);\r\n\r\n  useEffect(() => {\r\n    if (filterType === 'hidden' && filterCounts.hidden === 0) {\r\n      setFilterType('all');\r\n    }\r\n  }, [filterType, filterCounts.hidden]);\r\n\r\n  return (\r\n    <aside\r\n      id=\"left-sidebar-container\"\r\n      className=\"relative flex flex-col h-[100dvh] lg:h-full bg-gradient-to-br from-slate-50 via-white to-indigo-50 border-r border-gray-200 w-full lg:w-[20rem] shadow-2xl overflow-hidden\"\r\n    >\r\n      {/* HEADER GRADIENT SIÊU SANG */}\r\n      <div className=\"bg-blue-400 shadow-2xl lg:bg-white lg:shadow-none mb-1\">\r\n        <div className=\"px-2 pb-3 pt-3 lg:px-2 lg:py-3 \">\r\n          <div className=\"flex items-center gap-4 lg:gap-3\">\r\n            <div className=\"relative flex-1 group\">\r\n              {/* Icon kính lúp */}\r\n              <HiMagnifyingGlass className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/70 lg:text-gray-500 pointer-events-none  transition-colors duration-300 group-focus-within:text-[#0068ff] group-focus-within:opacity-100\" />\r\n\r\n              <input\r\n                ref={searchInputRef}\r\n                type=\"text\"\r\n                placeholder=\"Tìm kiếm\"\r\n                value={searchTerm}\r\n                onChange={(e) => handleSearchChange(e.target.value)}\r\n                className=\"w-full pl-11 pr-10 py-1 bg-transparent rounded-xl focus:outline-none focus:bg-white transition-all duration-300 text-base text-white placeholder-white/70 focus:text-gray-800 focus:placeholder-gray-500 lg:pl-10 lg:py-2 lg:bg-[#EAEDF0] lg:rounded-md lg:text-sm lg:text-gray-900 lg:placeholder-gray-500 lg:focus:ring-1 lg:focus:ring-[#0068ff]\"\r\n              />\r\n\r\n              {/* Nút xóa */}\r\n              {searchTerm && (\r\n                <button\r\n                  onClick={() => {\r\n                    setSearchTerm('');\r\n                    setGlobalSearchResults({ contacts: [], messages: [] });\r\n                  }}\r\n                  className=\"absolute cursor-pointer right-3 lg:right-2 top-1/2 -translate-y-1/2 w-7 h-7 lg:w-6 lg:h-6 rounded-full bg-white/20 hover:bg-white/30 group-focus-within:bg-gray-300 group-focus-within:hover:bg-gray-400 lg:bg-transparent lg:hover:bg-gray-200 lg:group-focus-within:bg-transparent transition-all duration-300 flex items-center justify-center active:scale-95\"\r\n                >\r\n                  <HiXMark className=\"w-4 h-4 text-white group-focus-within:text-gray-600 lg:text-gray-500 transition-colors duration-300\" />\r\n                </button>\r\n              )}\r\n            </div>\r\n\r\n            {!isWidgetIframe && (\r\n              <div className=\"flex items-center gap-4 lg:gap-1\">\r\n                {!onlyPersonal && (\r\n                  <button\r\n                    onClick={() => setShowCreateGroupModal(true)}\r\n                    className=\"cursor-pointer w-8 h-8 flex items-center justify-center bg-white/20 hover:bg-white/30 rounded-3xl backdrop-blur-sm lg:bg-transparent lg:hover:bg-gray-100 lg:rounded-md transition-all active:scale-95 group\"\r\n                    title=\"Tạo nhóm mới\"\r\n                  >\r\n                    {/* Old Icon */}\r\n                    <FaPlus className=\"w-4 h-4 text-white lg:hidden\" />\r\n                    {/* New Icon */}\r\n                    <div className=\"hidden lg:block relative\">\r\n                      <HiUserGroup className=\"w-5 h-5 text-gray-600 group-hover:text-[#0068ff] transition-colors\" />\r\n                      <span className=\"absolute -top-1 -right-1 text-[10px] text-gray-600 font-bold\">+</span>\r\n                    </div>\r\n                  </button>\r\n                )}\r\n\r\n                <div className=\"relative\">\r\n                  <button\r\n                    ref={mobileMenuButtonRef}\r\n                    onClick={() => setShowMobileMenu(!showMobileMenu)}\r\n                    className=\"cursor-pointer p-1 w-8 h-8 flex items-center justify-center bg-white/20 hover:bg-white/30 rounded-3xl backdrop-blur-sm lg:bg-transparent lg:hover:bg-gray-100 lg:rounded-md transition-all active:scale-95 group\"\r\n                  >\r\n                    {/* Old Icon */}\r\n                    <HiEllipsisVertical className=\"w-5 h-5 text-white text-sm lg:hidden\" />\r\n                    {/* New Icon */}\r\n                    <FaPlus className=\"hidden lg:block w-5 h-5 text-gray-600 group-hover:text-[#0068ff] transition-colors\" />\r\n                  </button>\r\n\r\n                  <SidebarMobileMenu\r\n                    isOpen={showMobileMenu}\r\n                    onClose={() => setShowMobileMenu(false)}\r\n                    filterType={filterType}\r\n                    setFilterType={setFilterType}\r\n                    counts={filterCounts}\r\n                    onOpenCreateGroup={() => setShowCreateGroupModal(true)}\r\n                    onOpenGlobalFolder={() => setShowGlobalFolder(true)}\r\n                    buttonRef={mobileMenuButtonRef}\r\n                    onlyGroups={onlyGroups}\r\n                    onlyPersonal={onlyPersonal}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center justify-between px-4 bg-white border-b border-gray-200 select-none\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <button\r\n              onClick={() => setFilterType('all')}\r\n              className={`relative py-3 text-sm font-medium transition-colors cursor-pointer ${\r\n                filterType === 'all' ||\r\n                (filterType === 'group' && onlyGroups) ||\r\n                (filterType === 'personal' && onlyPersonal)\r\n                  ? 'text-blue-600'\r\n                  : 'text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Tất cả\r\n              {(filterType === 'all' ||\r\n                (filterType === 'group' && onlyGroups) ||\r\n                (filterType === 'personal' && onlyPersonal)) && (\r\n                <span className=\"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 rounded-t-full\" />\r\n              )}\r\n            </button>\r\n            <button\r\n              onClick={() => setFilterType('unread')}\r\n              className={`relative py-3 text-sm font-medium transition-colors cursor-pointer ${\r\n                filterType === 'unread' ? 'text-blue-600' : 'text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Chưa đọc\r\n              {filterType === 'unread' && (\r\n                <span className=\"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 rounded-t-full\" />\r\n              )}\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"flex justify-end items-center gap-4\">\r\n            <div className=\"relative\" ref={tagFilterDropdownRef}>\r\n              <button\r\n                onClick={() => setShowTagFilterDropdown(!showTagFilterDropdown)}\r\n                className={`flex items-center gap-1 text-sm font-medium py-3 transition-colors cursor-pointer ${\r\n                  selectedTags.length > 0 ? 'text-blue-600' : 'text-gray-500 hover:text-gray-700'\r\n                }`}\r\n              >\r\n                Tags\r\n                <HiChevronDown\r\n                  className={`w-4 h-4 transition-transform duration-200 ${showTagFilterDropdown ? 'rotate-180' : ''}`}\r\n                />\r\n              </button>\r\n              {showTagFilterDropdown && (\r\n                <div className=\"absolute right-[-5.7rem] top-full mt-1 w-64 bg-white rounded-lg shadow-xl border border-gray-100 py-2 z-50\">\r\n                  <div className=\"px-4 pb-2 text-xs text-gray-500\">Theo thẻ tags</div>\r\n                  <div className=\"max-h-64 overflow-auto custom-scrollbar\">\r\n                    {userTags.map((tag) => {\r\n                      const checked = selectedTags.includes(tag.id);\r\n                      return (\r\n                        <button\r\n                          key={tag.id}\r\n                          onClick={() => {\r\n                            setSelectedTags((prev) => (checked ? prev.filter((x) => x !== tag.id) : [...prev, tag.id]));\r\n                          }}\r\n                          className=\"w-full flex items-center gap-3 px-4 py-2 hover:bg-gray-50 cursor-pointer\"\r\n                        >\r\n                          <span\r\n                            className={`inline-block w-3.5 h-3.5 rounded-sm ${tag.color} border border-white shadow-sm`}\r\n                          />\r\n                          <span className=\"flex-1 text-left text-sm text-gray-800\">{tag.label}</span>\r\n                          <input type=\"checkbox\" checked={checked} readOnly className=\"w-4 h-4\" />\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                  <div className=\"border-t mt-2 pt-2\">\r\n                    <button\r\n                      onClick={() => {\r\n                        setShowTagManager(true);\r\n                        setShowTagFilterDropdown(false);\r\n                      }}\r\n                      className=\"w-full p-1 text-sm text-[#0068ff] hover:bg-gray-50 cursor-pointer\"\r\n                    >\r\n                      Quản lý thẻ tags\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"relative\" ref={filterDropdownRef}>\r\n              <button\r\n                onClick={() => setShowFilterDropdown(!showFilterDropdown)}\r\n                className={`flex items-center gap-1 text-sm font-medium py-3 transition-colors cursor-pointer ${\r\n                  selectedCategories.length > 0 ? 'text-blue-600' : 'text-gray-500 hover:text-gray-700'\r\n                }`}\r\n              >\r\n                Phân loại\r\n                <HiChevronDown\r\n                  className={`w-4 h-4 transition-transform duration-200 ${showFilterDropdown ? 'rotate-180' : ''}`}\r\n                />\r\n              </button>\r\n\r\n              {showFilterDropdown && (\r\n                <div className=\"absolute right-0 top-full mt-1 w-64 bg-white rounded-lg shadow-xl border border-gray-100 py-2 z-50\">\r\n                  <div className=\"px-4 pb-2 text-xs text-gray-500\">Theo thẻ phân loại</div>\r\n                  <div className=\"max-h-64 overflow-auto\">\r\n                    {userCategoryTags.map((cat) => {\r\n                      const checked = selectedCategories.includes(cat.id);\r\n                      return (\r\n                        <button\r\n                          key={cat.id}\r\n                          onClick={() => {\r\n                            setSelectedCategories((prev) =>\r\n                              checked ? prev.filter((x) => x !== cat.id) : [...prev, cat.id],\r\n                            );\r\n                          }}\r\n                          className=\"w-full flex items-center gap-3 px-4 py-2 hover:bg-gray-50 cursor-pointer\"\r\n                        >\r\n                          <span\r\n                            className={`inline-block w-3.5 h-3.5 rounded-sm ${cat.color} border border-white shadow-sm`}\r\n                          />\r\n                          <span className=\"flex-1 text-left text-sm text-gray-800\">{cat.label}</span>\r\n                          <input type=\"checkbox\" checked={checked} readOnly className=\"w-4 h-4\" />\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                  <div className=\"border-t mt-2 pt-2\">\r\n                    <button\r\n                      onClick={() => {\r\n                        setShowCategoryManager(true);\r\n                        setShowFilterDropdown(false);\r\n                      }}\r\n                      className=\"w-full p-1  text-sm text-[#0068ff] hover:bg-gray-50 cursor-pointer\"\r\n                    >\r\n                      Quản lý thẻ phân loại\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {onlyGroups && (\r\n        <div className=\"flex items-center justify-around px-2 py-3 bg-white border-b border-gray-200 md:hidden\">\r\n          <button\r\n            onClick={() =>\r\n              setShowComingSoon({\r\n                isOpen: true,\r\n                title: 'Lịch nhóm',\r\n                desc: 'Tính năng Lịch nhóm đang được phát triển để giúp bạn quản lý thời gian hiệu quả hơn.',\r\n              })\r\n            }\r\n            className={`flex flex-col items-center justify-center gap-1 p-2 rounded-xl transition-all duration-200 flex-1 mx-1 ${\r\n              activeExtraTab === 'calendar'\r\n                ? 'bg-blue-50 text-blue-600 shadow-sm'\r\n                : 'text-gray-500 hover:bg-gray-50 hover:text-gray-700'\r\n            }`}\r\n          >\r\n            <HiCalendarDays className=\"w-6 h-6\" />\r\n            <span className=\"text-[10px] font-medium leading-none\">Lịch</span>\r\n          </button>\r\n          <button\r\n            onClick={() =>\r\n              setShowComingSoon({\r\n                isOpen: true,\r\n                title: 'Nhắc hẹn',\r\n                desc: 'Tính năng Nhắc hẹn sẽ sớm ra mắt để bạn không bỏ lỡ bất kỳ sự kiện quan trọng nào.',\r\n              })\r\n            }\r\n            className={`flex flex-col items-center justify-center gap-1 p-2 rounded-xl transition-all duration-200 flex-1 mx-1 ${\r\n              activeExtraTab === 'reminder'\r\n                ? 'bg-blue-50 text-blue-600 shadow-sm'\r\n                : 'text-gray-500 hover:bg-gray-50 hover:text-gray-700'\r\n            }`}\r\n          >\r\n            <HiClock className=\"w-6 h-6\" />\r\n            <span className=\"text-[10px] font-medium leading-none\">Nhắc hẹn</span>\r\n          </button>\r\n          <button\r\n            onClick={() =>\r\n              setShowComingSoon({\r\n                isOpen: true,\r\n                title: 'Nhóm Offline',\r\n                desc: 'Tính năng Nhóm Offline đang được xây dựng để kết nối mọi người dễ dàng hơn.',\r\n              })\r\n            }\r\n            className={`flex flex-col items-center justify-center gap-1 p-2 rounded-xl transition-all duration-200 flex-1 mx-1 ${\r\n              activeExtraTab === 'offline'\r\n                ? 'bg-blue-50 text-blue-600 shadow-sm'\r\n                : 'text-gray-500 hover:bg-gray-50 hover:text-gray-700'\r\n            }`}\r\n          >\r\n            <HiUserGroup className=\"w-6 h-6\" />\r\n            <span className=\"text-[10px] font-medium leading-none\">Nhóm Offline</span>\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Chat List */}\r\n      <div className=\"flex-1 overflow-x-hidden overflow-y-auto bg-gradient-to-b from-white/80 to-gray-50/80 custom-scrollbar\">\r\n        {isSearchActive ? (\r\n          <SearchResults\r\n            activeTab={activeTab}\r\n            setActiveTab={setActiveTab}\r\n            isSearching={isSearching}\r\n            hasResults={hasSearchResults}\r\n            contacts={globalSearchResults.contacts}\r\n            groupedMessages={groupedMessages}\r\n            groupedFiles={groupedFiles}\r\n            fileMessages={fileMessages}\r\n            searchTerm={searchTerm}\r\n            onSelectContact={handleSelectContact}\r\n            onNavigateToMessage={(msg) => {\r\n              onNavigateToMessage(msg, searchTerm);\r\n              // Giữ nguyên searchTerm và danh sách kết quả để không bị mất\r\n            }}\r\n            currentUserId={String(currentUserId)}\r\n            onOpenRoomResults={(rid, rname, isGroup, avatar) =>\r\n              setRoomResultsModal({ roomId: rid, roomName: rname, isGroupChat: isGroup, roomAvatar: avatar })\r\n            }\r\n          />\r\n        ) : (\r\n          <>\r\n            {filteredAndSortedChats.length === 0 ? (\r\n              <div className=\"flex flex-col items-center justify-center h-full text-center px-8 text-gray-400\">\r\n                <div className=\"p-8 bg-gray-100 rounded-full mb-6\">\r\n                  <HiChatBubbleLeftRight className=\"w-16 h-16 text-gray-300\" />\r\n                </div>\r\n                <p className=\"text-lg font-medium text-gray-500\">\r\n                  {filterType === 'unread' && 'Không có tin nhắn chưa đọc'}\r\n                  {filterType === 'read' && 'Không có tin nhắn đã đọc'}\r\n                  {filterType === 'hidden' && 'Không có cuộc trò chuyện ẩn'}\r\n                  {filterType === 'all' && 'Bắt đầu một cuộc trò chuyện mới!'}\r\n                </p>\r\n                {filterType === 'all' && <p className=\"text-sm mt-2 text-gray-400\">Nhấn vào nút tạo nhóm để bắt đầu</p>}\r\n              </div>\r\n            ) : (\r\n              <div className={`space-y-1 pb-20 ${styleWidget}`}>\r\n                {filteredAndSortedChats.map((item: ChatItemType) => {\r\n                  const isGroupItem = item.isGroup === true || Array.isArray(item.members);\r\n                  return (\r\n                    <ChatItem\r\n                      key={item._id}\r\n                      item={item}\r\n                      isGroup={isGroupItem}\r\n                      selectedChat={selectedChat}\r\n                      onSelectChat={onSelectChat}\r\n                      onChatAction={onChatAction}\r\n                      currentUserId={String(currentUserId)}\r\n                      categoryTags={userCategoryTags}\r\n                      userTags={userTags}\r\n                      onOpenTagManager={() => setShowTagManager(true)}\r\n                    />\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Fade Bottom */}\r\n      <div className=\"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-gray-100 to-transparent pointer-events-none\" />\r\n\r\n      {roomResultsModal && (\r\n        <RoomSearchResultsModal\r\n          isOpen={!!roomResultsModal}\r\n          roomId={roomResultsModal.roomId}\r\n          roomName={roomResultsModal.roomName}\r\n          roomAvatar={roomResultsModal.roomAvatar}\r\n          isGroupChat={roomResultsModal.isGroupChat}\r\n          keyword={searchTerm}\r\n          allUsers={allUsers}\r\n          anchorToParent\r\n          onClose={() => setRoomResultsModal(null)}\r\n          onNavigateToMessage={(m, kw) => {\r\n            onNavigateToMessage(m, kw);\r\n            setRoomResultsModal(null);\r\n          }}\r\n        />\r\n      )}\r\n      {showComingSoon.isOpen && (\r\n        <ComingSoonModal\r\n          isOpen={showComingSoon.isOpen}\r\n          onClose={() => setShowComingSoon({ ...showComingSoon, isOpen: false })}\r\n          title={showComingSoon.title}\r\n          description={showComingSoon.desc}\r\n        />\r\n      )}\r\n      {showCategoryManager && (\r\n        <CategoryManagerModal\r\n          isOpen={showCategoryManager}\r\n          onClose={() => setShowCategoryManager(false)}\r\n          currentUserId={String(currentUserId)}\r\n          currentUser={currentUser}\r\n          groups={groups}\r\n          allUsers={allUsers}\r\n        />\r\n      )}\r\n      {showTagManager && (\r\n        <TagManagerModal\r\n          isOpen={showTagManager}\r\n          onClose={() => setShowTagManager(false)}\r\n          currentUserId={String(currentUserId)}\r\n          currentUser={currentUser}\r\n          groups={groups}\r\n          allUsers={allUsers}\r\n        />\r\n      )}\r\n    </aside>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2778, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/button.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ntype ButtonProps = {\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  children?: React.ReactNode;\r\n  disabled?: boolean;\r\n  title?: string;\r\n  onClick?: React.MouseEventHandler<HTMLButtonElement>;\r\n  type?: 'button' | 'submit' | 'reset';\r\n};\r\n\r\nexport const ButtonBase = ({\r\n  children,\r\n  className = 'text-white bg-green-500 hover:bg-green-700',\r\n  style,\r\n  onClick,\r\n  type = 'button',\r\n  title,\r\n  disabled = false,\r\n  ...rest\r\n}: ButtonProps) => {\r\n  return (\r\n    <button\r\n      type={type}\r\n      title={title}\r\n      className={`${className} flex items-center cursor-pointer justify-center gap-2 py-[0.5rem] px-[1.25rem] text-md font-medium rounded-md`}\r\n      style={{\r\n        ...style,\r\n        backgroundColor: disabled ? '#CECECE' : '',\r\n        cursor: disabled ? 'not-allowed' : '',\r\n      }}\r\n      disabled={disabled}\r\n      onClick={onClick}\r\n      {...rest}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;;;;AAYO,MAAM,aAAa,CAAC,EACzB,QAAQ,EACR,YAAY,4CAA4C,EACxD,KAAK,EACL,OAAO,EACP,OAAO,QAAQ,EACf,KAAK,EACL,WAAW,KAAK,EAChB,GAAG,MACS;IACZ,qBACE,6LAAC;QACC,MAAM;QACN,OAAO;QACP,WAAW,GAAG,UAAU,8GAA8G,CAAC;QACvI,OAAO;YACL,GAAG,KAAK;YACR,iBAAiB,WAAW,YAAY;YACxC,QAAQ,WAAW,gBAAgB;QACrC;QACA,UAAU;QACV,SAAS;QACR,GAAG,IAAI;kBAEP;;;;;;AAGP;KA3Ba"}},
    {"offset": {"line": 2814, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/alert.tsx"],"sourcesContent":["// confirmAlert.tsx\r\n\r\nimport React from 'react';\r\nimport { createRoot } from 'react-dom/client';\r\nimport { ButtonBase } from './button';\r\n\r\nimport { HiXMark, HiCheckCircle, HiInformationCircle } from 'react-icons/hi2';\r\n\r\ninterface ConfirmOptions {\r\n  title?: string;\r\n  message: string;\r\n  okText?: string;\r\n  cancelText?: string | null;\r\n  onOk?: () => void;\r\n  onCancel?: () => void;\r\n}\r\n\r\nexport function confirmAlert(options: ConfirmOptions) {\r\n  const { title = 'Xác nhận', message, okText = 'Đồng ý', cancelText = 'Hủy', onOk, onCancel } = options;\r\n\r\n  // Lớp phủ bóng + container (giữ nguyên như cũ)\r\n  const container = document.createElement('div');\r\n  container.className = 'fixed inset-0 z-[9999] flex items-center justify-center bg-black/30';\r\n  document.body.appendChild(container);\r\n\r\n  const root = createRoot(container);\r\n\r\n  const close = () => {\r\n    root.unmount();\r\n    container.remove();\r\n  };\r\n\r\n  const AlertBox = () => (\r\n    <div className=\"w-full max-w-sm animate-in fade-in zoom-in duration-200\" onClick={(e) => e.stopPropagation()}>\r\n      {/* Card nhỏ xinh – Glassmorphism nhẹ nhàng */}\r\n      <div className=\"bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/50 overflow-hidden\">\r\n        {/* Header xanh dương nhẹ */}\r\n        <div className=\"bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-5 text-white\">\r\n          <div className=\"flex items-center justify-center gap-3\">\r\n            <HiInformationCircle className=\"w-8 h-8\" />\r\n            <h3 className=\"text-xl font-bold\">{title}</h3>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Nội dung */}\r\n        <div className=\"p-6 text-center\">\r\n          <p className=\"text-gray-700 text-lg leading-relaxed\">{message}</p>\r\n        </div>\r\n\r\n        {/* Nút bấm */}\r\n        <div className=\"flex gap-3 px-6 pb-6\">\r\n          {cancelText !== null && (\r\n            <ButtonBase\r\n              onClick={() => {\r\n                close();\r\n                onCancel?.();\r\n              }}\r\n              className=\"flex-1 py-4 text-lg font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-2\"\r\n            >\r\n              <HiXMark className=\"w-5 h-5\" />\r\n              {cancelText}\r\n            </ButtonBase>\r\n          )}\r\n\r\n          <ButtonBase\r\n            onClick={() => {\r\n              close();\r\n              onOk?.();\r\n            }}\r\n            className=\"flex-1 py-4 text-lg font-bold text-white bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 rounded-2xl shadow-lg hover:shadow-xl transition-all active:scale-95 flex items-center justify-center gap-2\"\r\n          >\r\n            <HiCheckCircle className=\"w-5 h-5\" />\r\n            {okText}\r\n          </ButtonBase>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  root.render(<AlertBox />);\r\n}\r\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;;AAGnB;AACA;AAEA;;;;;AAWO,SAAS,aAAa,OAAuB;IAClD,MAAM,EAAE,QAAQ,UAAU,EAAE,OAAO,EAAE,SAAS,QAAQ,EAAE,aAAa,KAAK,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG;IAE/F,+CAA+C;IAC/C,MAAM,YAAY,SAAS,aAAa,CAAC;IACzC,UAAU,SAAS,GAAG;IACtB,SAAS,IAAI,CAAC,WAAW,CAAC;IAE1B,MAAM,OAAO,IAAA,mLAAU,EAAC;IAExB,MAAM,QAAQ;QACZ,KAAK,OAAO;QACZ,UAAU,MAAM;IAClB;IAEA,MAAM,WAAW,kBACf,6LAAC;YAAI,WAAU;YAA0D,SAAS,CAAC,IAAM,EAAE,eAAe;sBAExG,cAAA,6LAAC;gBAAI,WAAU;;kCAEb,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,yKAAmB;oCAAC,WAAU;;;;;;8CAC/B,6LAAC;oCAAG,WAAU;8CAAqB;;;;;;;;;;;;;;;;;kCAKvC,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAE,WAAU;sCAAyC;;;;;;;;;;;kCAIxD,6LAAC;wBAAI,WAAU;;4BACZ,eAAe,sBACd,6LAAC,qJAAU;gCACT,SAAS;oCACP;oCACA;gCACF;gCACA,WAAU;;kDAEV,6LAAC,6JAAO;wCAAC,WAAU;;;;;;oCAClB;;;;;;;0CAIL,6LAAC,qJAAU;gCACT,SAAS;oCACP;oCACA;gCACF;gCACA,WAAU;;kDAEV,6LAAC,mKAAa;wCAAC,WAAU;;;;;;oCACxB;;;;;;;;;;;;;;;;;;;;;;;;IAOX,KAAK,MAAM,eAAC,6LAAC;;;;;AACf"}},
    {"offset": {"line": 2965, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/RoleBadge.tsx"],"sourcesContent":["import React from 'react';\r\nimport { GroupRole } from '@/types/Group';\r\nimport { FaCrown, FaUserShield } from 'react-icons/fa';\r\n\r\ninterface RoleBadgeProps {\r\n  role: GroupRole;\r\n  className?: string;\r\n  showIcon?: boolean;\r\n}\r\n\r\nexport default function RoleBadge({ role, className = '', showIcon = true }: RoleBadgeProps) {\r\n  if (role === 'OWNER') {\r\n    return (\r\n      <span\r\n        className={`px-2 py-0.5 rounded-full text-[10px] sm:text-xs font-bold bg-gradient-to-r from-yellow-400 to-orange-500 text-white shadow-sm flex items-center gap-1 ${className}`}\r\n      >\r\n        {showIcon && <FaCrown className=\"w-3 h-3\" />}\r\n        Trưởng nhóm\r\n      </span>\r\n    );\r\n  }\r\n  if (role === 'ADMIN') {\r\n    return (\r\n      <span\r\n        className={`px-2 py-0.5 rounded-full text-[10px] sm:text-xs font-bold bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-sm flex items-center gap-1 ${className}`}\r\n      >\r\n        {showIcon && <FaUserShield className=\"w-3 h-3\" />}\r\n        Phó nhóm\r\n      </span>\r\n    );\r\n  }\r\n  return null;\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAQe,SAAS,UAAU,EAAE,IAAI,EAAE,YAAY,EAAE,EAAE,WAAW,IAAI,EAAkB;IACzF,IAAI,SAAS,SAAS;QACpB,qBACE,6LAAC;YACC,WAAW,CAAC,sJAAsJ,EAAE,WAAW;;gBAE9K,0BAAY,6LAAC,4JAAO;oBAAC,WAAU;;;;;;gBAAa;;;;;;;IAInD;IACA,IAAI,SAAS,SAAS;QACpB,qBACE,6LAAC;YACC,WAAW,CAAC,oJAAoJ,EAAE,WAAW;;gBAE5K,0BAAY,6LAAC,iKAAY;oBAAC,WAAU;;;;;;gBAAa;;;;;;;IAIxD;IACA,OAAO;AACT;KAtBwB"}},
    {"offset": {"line": 3024, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/ModalMembers.tsx"],"sourcesContent":["'use client';\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport Image from 'next/image';\r\nimport { createPortal } from 'react-dom';\r\nimport { useRouter } from 'next/navigation';\r\nimport { HiX, HiSearch } from 'react-icons/hi';\r\nimport CreateGroupModal from '../../app/(zalo)/home/CreateGroupModal';\r\nimport { User } from '../../types/User';\r\nimport { MemberInfo, GroupRole } from '../../types/Group';\r\nimport { getProxyUrl, resolveSocketUrl, normalizeNoAccent, hasDiacritics, accentAwareIncludes } from '../../utils/utils';\r\nimport { useToast } from './toast';\r\nimport { confirmAlert } from './alert';\r\nimport { HiUserMinus, HiUserPlus, HiEllipsisVertical } from 'react-icons/hi2';\r\nimport ICPeopleGroup from '@/components/svg/ICPeopleGroup';\r\nimport io from 'socket.io-client';\r\nimport { KeyIcon } from 'lucide-react';\r\nimport RoleBadge from './RoleBadge';\r\n\r\ntype LocalMemberInfo = MemberInfo & { originalName?: string };\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  members: MemberInfo[];\r\n  onClose: () => void;\r\n  currentUser: User;\r\n  allUsers: User[];\r\n  groupName?: string;\r\n  conversationId?: string;\r\n  reLoad?: () => void;\r\n  onMembersAdded: (users: User[]) => void;\r\n  onMemberRemoved?: (memberId: string, memberName: string) => void;\r\n  onRoleChange?: (memberId: string, memberName: string, newRole: 'ADMIN' | 'MEMBER') => void;\r\n  sendNotifyMessage?: (text: string) => Promise<void> | void;\r\n  lastUpdated?: number;\r\n}\r\n\r\n// 🔥 Helper function để normalize ID\r\nfunction normalizeId(value: unknown): string {\r\n  if (!value) return '';\r\n  if (typeof value === 'string') return value;\r\n  if (typeof value === 'number') return String(value);\r\n  if (typeof value === 'object' && value !== null) {\r\n    if ('_id' in value) return normalizeId(value._id);\r\n    if ('id' in value) return normalizeId(value.id);\r\n  }\r\n  return String(value);\r\n}\r\n\r\n// 🔥 Helper function để so sánh ID\r\nfunction compareIds(id1: unknown, id2: unknown): boolean {\r\n  const normalized1 = normalizeId(id1);\r\n  const normalized2 = normalizeId(id2);\r\n\r\n  if (normalized1 === normalized2) return true;\r\n\r\n  // So sánh cả dạng number\r\n  const num1 = Number(normalized1);\r\n  const num2 = Number(normalized2);\r\n  if (!isNaN(num1) && !isNaN(num2) && num1 === num2) return true;\r\n\r\n  return false;\r\n}\r\n\r\nexport default function GroupMembersModal({\r\n  members,\r\n  onClose,\r\n  isOpen,\r\n  groupName,\r\n  currentUser,\r\n  allUsers,\r\n  conversationId,\r\n  reLoad,\r\n  onMembersAdded,\r\n  onMemberRemoved,\r\n  onRoleChange,\r\n  sendNotifyMessage,\r\n  lastUpdated,\r\n}: Props) {\r\n  const isDesktop = typeof window !== 'undefined' && window.matchMedia('(min-width: 768px)').matches;\r\n  const [showCreateGroupModal, setShowCreateGroupModal] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [localMembers, setLocalMembers] = useState<LocalMemberInfo[]>([]);\r\n  const [loadingAction, setLoadingAction] = useState<string | null>(null);\r\n  const [editingNicknameMember, setEditingNicknameMember] = useState<{\r\n    id: string;\r\n    name: string;\r\n    currentVal: string;\r\n  } | null>(null);\r\n  const [activeTab, setActiveTab] = useState<'all' | 'admin' | 'invited' | 'blocked'>('all');\r\n  const [showSearch, setShowSearch] = useState(false);\r\n  const [openMenuId, setOpenMenuId] = useState<string | null>(null);\r\n  const toast = useToast();\r\n  const router = useRouter();\r\n\r\n  // 🔥 Tạo user map với nhiều key formats\r\n  const userMap = React.useMemo(() => {\r\n    const map = new Map<string, User>();\r\n\r\n    // Add current user\r\n    if (currentUser) {\r\n      const currentId = normalizeId(currentUser._id || currentUser.id);\r\n      if (currentId) {\r\n        map.set(currentId, currentUser);\r\n\r\n        // Thêm key dạng number nếu có thể\r\n        if (!isNaN(Number(currentId))) {\r\n          map.set(String(Number(currentId)), currentUser);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Add all users\r\n    allUsers.forEach((user) => {\r\n      const userId = normalizeId(user._id || user.id);\r\n      if (userId) {\r\n        map.set(userId, user);\r\n\r\n        // Thêm key dạng number nếu có thể\r\n        if (!isNaN(Number(userId))) {\r\n          map.set(String(Number(userId)), user);\r\n        }\r\n      }\r\n    });\r\n\r\n    return map;\r\n  }, [currentUser, allUsers]);\r\n\r\n  useEffect(() => {\r\n    const enriched: MemberInfo[] = (members || [])\r\n      .map((m: unknown) => {\r\n        const raw = m as Partial<MemberInfo> & { id?: string | number; _id?: string | number };\r\n        const memberId = normalizeId(raw._id ?? raw.id);\r\n        console.log(`[ModalMembers] Process member ${memberId}:`, {\r\n          name: raw.name,\r\n          role: raw.role,\r\n          addedBy: raw.addedBy,\r\n          rawObject: raw,\r\n        });\r\n\r\n        if (!memberId) {\r\n          console.warn('⚠️ Member without ID:', raw);\r\n          return null;\r\n        }\r\n\r\n        const baseRole = (raw.role as GroupRole) ?? 'MEMBER';\r\n        const baseJoinedAt = typeof raw.joinedAt === 'number' ? raw.joinedAt : Date.now();\r\n\r\n        // 🔥 Tìm user info trong userMap\r\n        let foundUser = userMap.get(memberId);\r\n\r\n        // Thử tìm với number format nếu chưa có\r\n        if (!foundUser && !isNaN(Number(memberId))) {\r\n          foundUser = userMap.get(String(Number(memberId)));\r\n        }\r\n\r\n        const myId = normalizeId(currentUser._id || currentUser.id);\r\n\r\n        const originalName = raw.name || foundUser?.name || 'Thành viên';\r\n        // 🔥 Use nickname from Group Member Data (Global) or Personal Nickname (Local)\r\n        const nickname = raw.nickname || foundUser?.nicknames?.[myId];\r\n        const name = nickname || originalName;\r\n        const avatar = raw.avatar || foundUser?.avatar;\r\n\r\n        return {\r\n          _id: memberId,\r\n          name,\r\n          avatar,\r\n          role: baseRole,\r\n          joinedAt: baseJoinedAt,\r\n          addedBy: raw.addedBy,\r\n          originalName,\r\n        } as LocalMemberInfo;\r\n      })\r\n      .filter(Boolean) as LocalMemberInfo[];\r\n\r\n    // 🔥 Deduplicate members by ID\r\n    const uniqueMembersMap = new Map<string, LocalMemberInfo>();\r\n    enriched.forEach((m) => {\r\n      const id = normalizeId(m._id || m.id);\r\n      if (!uniqueMembersMap.has(id)) {\r\n        uniqueMembersMap.set(id, m);\r\n      }\r\n    });\r\n\r\n    setLocalMembers(Array.from(uniqueMembersMap.values()));\r\n  }, [members, allUsers, userMap, currentUser, conversationId, lastUpdated]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const myId = normalizeId(currentUser._id || currentUser.id);\r\n  const myMemberInfo = localMembers.find((m) => compareIds(m._id || m.id, myId));\r\n  const myRole: GroupRole = myMemberInfo?.role || 'MEMBER';\r\n\r\n  const canKick = (targetRole: GroupRole) => {\r\n    if (myRole === 'OWNER') return true;\r\n    if (myRole === 'ADMIN' && targetRole === 'MEMBER') return true;\r\n    return false;\r\n  };\r\n\r\n  const canPromote = (targetRole: GroupRole) => myRole === 'OWNER' && targetRole === 'MEMBER';\r\n  const canDemote = (targetRole: GroupRole) => myRole === 'OWNER' && targetRole === 'ADMIN';\r\n\r\n  const handleOpenProfile = (targetUserId: string) => {\r\n    const id = normalizeId(targetUserId);\r\n    router.push(`/profile/${id}`);\r\n  };\r\n\r\n  const handleOptimisticAddMember = (newUsers: User[]) => {\r\n    const newMembersFormatted: MemberInfo[] = newUsers.map((u) => ({\r\n      _id: normalizeId(u._id ?? u.id),\r\n      name: u.name,\r\n      avatar: u.avatar,\r\n      role: 'MEMBER',\r\n      joinedAt: Date.now(),\r\n      addedBy: myId, // ✅ Include addedBy for optimistic UI\r\n    }));\r\n    setLocalMembers((prev) => [...prev, ...newMembersFormatted]);\r\n    setShowCreateGroupModal(false);\r\n    onMembersAdded(newUsers);\r\n  };\r\n\r\n  const handleAction = async (action: 'kick' | 'promote' | 'demote', targetUserId: string) => {\r\n    if (!conversationId) return;\r\n    setLoadingAction(targetUserId);\r\n\r\n    const targetMember = localMembers.find((m) => compareIds(m._id || m.id, targetUserId));\r\n    const targetName = targetMember ? targetMember.name : 'Thành viên';\r\n\r\n    try {\r\n      const prevMembersSnapshot = [...localMembers];\r\n      const res = await fetch('/api/groups', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(\r\n          action === 'kick'\r\n            ? { conversationId, targetUserId, action: 'kickMember', _id: myId }\r\n            : {\r\n                conversationId,\r\n                targetUserId,\r\n                action: 'changeRole',\r\n                data: { role: action === 'promote' ? 'ADMIN' : 'MEMBER' },\r\n                _id: myId,\r\n              },\r\n        ),\r\n      });\r\n\r\n      if (res.ok) {\r\n        if (action === 'kick') {\r\n          setLocalMembers((prev) => prev.filter((m) => !compareIds(m._id || m.id, targetUserId)));\r\n          if (onMemberRemoved) onMemberRemoved(targetUserId, targetName);\r\n\r\n          // 🔥 Báo realtime để cập nhật sidebar & đóng phòng cho người bị kick\r\n          try {\r\n            const roomIdStr = String(conversationId || '');\r\n            const nextMembers = prevMembersSnapshot.filter((m) => !compareIds(m._id || m.id, targetUserId));\r\n            const payloadMembers = nextMembers.map((m) => ({\r\n              _id: String(m._id || m.id || ''),\r\n              role: m.role,\r\n              name: m.name,\r\n              avatar: m.avatar,\r\n            }));\r\n            const prevMembers = prevMembersSnapshot.map((m) => ({\r\n              _id: String(m._id || m.id || ''),\r\n            }));\r\n            const sock = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n            sock.emit('group_members_updated', {\r\n              roomId: roomIdStr,\r\n              members: payloadMembers,\r\n              prevMembers,\r\n              sender: myId,\r\n              senderName: currentUser.name,\r\n              groupName,\r\n            });\r\n            setTimeout(() => sock.disconnect(), 500);\r\n          } catch {}\r\n        } else if (action === 'promote' || action === 'demote') {\r\n          const newRole: GroupRole = action === 'promote' ? 'ADMIN' : 'MEMBER';\r\n          setLocalMembers((prev) =>\r\n            prev.map((m) => (compareIds(m._id || m.id, targetUserId) ? { ...m, role: newRole } : m)),\r\n          );\r\n          onRoleChange?.(targetUserId, targetName, newRole);\r\n        }\r\n        reLoad?.();\r\n      } else {\r\n        toast({ type: 'error', message: 'Thao tác thất bại', duration: 3000 });\r\n      }\r\n    } catch {\r\n      toast({ type: 'error', message: 'Lỗi mạng, vui lòng thử lại', duration: 3000 });\r\n    } finally {\r\n      setLoadingAction(null);\r\n    }\r\n  };\r\n\r\n  const handleLeaveGroup = async () => {\r\n    if (!conversationId) return;\r\n    try {\r\n      const res = await fetch('/api/groups', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          action: 'leaveGroup',\r\n          conversationId,\r\n          _id: myId,\r\n        }),\r\n      });\r\n      if (!res.ok) throw new Error('Leave failed');\r\n      const actorName = currentUser.name || 'Một thành viên';\r\n      const text = `${actorName} đã rời nhóm`;\r\n      try {\r\n        await sendNotifyMessage?.(text);\r\n      } catch {}\r\n      try {\r\n        const roomIdStr = String(conversationId);\r\n        const nextMembers = localMembers.filter((m) => !compareIds(m._id || m.id, myId));\r\n        const payloadMembers = nextMembers.map((m) => ({\r\n          _id: String(m._id || m.id || ''),\r\n          role: m.role,\r\n          name: m.name,\r\n          avatar: m.avatar,\r\n        }));\r\n        const prevMembers = localMembers.map((m) => ({ _id: String(m._id || m.id || '') }));\r\n        const sock = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n        sock.emit('group_members_updated', {\r\n          roomId: roomIdStr,\r\n          members: payloadMembers,\r\n          prevMembers,\r\n          sender: myId,\r\n          senderName: currentUser.name,\r\n          groupName,\r\n        });\r\n        setTimeout(() => sock.disconnect(), 500);\r\n      } catch {}\r\n      setLocalMembers((prev) => prev.filter((m) => !compareIds(m._id || m.id, myId)));\r\n      reLoad?.();\r\n      onClose();\r\n    } catch {\r\n      toast({ type: 'error', message: 'Rời nhóm thất bại', duration: 3000 });\r\n    }\r\n  };\r\n  const searchUser = localMembers.filter((item) => accentAwareIncludes(item.name || '', searchTerm));\r\n\r\n  const displayMembers = searchUser.filter((m) => {\r\n    if (activeTab === 'all') return true;\r\n    if (activeTab === 'admin') return m.role === 'OWNER' || m.role === 'ADMIN';\r\n    // TODO: Implement invited and blocked lists when data is available\r\n    if (activeTab === 'invited') return false;\r\n    if (activeTab === 'blocked') return false;\r\n    return true;\r\n  });\r\n\r\n  const existingMemberIds = localMembers.map((m) => normalizeId(m._id || m.id));\r\n  const setNickname = async (targetId: string, nickname: string) => {\r\n    if (!conversationId) return;\r\n\r\n    try {\r\n      // 1. Call API\r\n      const res = await fetch('/api/groups', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          action: 'updateMemberNickname',\r\n          conversationId,\r\n          targetUserId: targetId,\r\n          data: { nickname },\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) throw new Error('Failed to update nickname');\r\n\r\n      // 2. Optimistic Update Local State\r\n      const v = String(nickname || '').trim();\r\n      setLocalMembers((prev) =>\r\n        prev.map((m) => {\r\n          if (compareIds(m._id || m.id, targetId)) {\r\n            const foundUser = userMap.get(normalizeId(targetId)) || userMap.get(String(Number(targetId)));\r\n            const globalNickname = foundUser?.nicknames?.[myId];\r\n            const originalName = (m as LocalMemberInfo).originalName || foundUser?.name || m.name;\r\n            const resolvedName = v || globalNickname || originalName;\r\n            return { ...m, name: resolvedName || 'Thành viên', nickname: v };\r\n          }\r\n          return m;\r\n        }),\r\n      );\r\n\r\n      // 3. Emit Socket Event for real-time update\r\n      try {\r\n        const socket = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n        socket.emit('room_nickname_updated', {\r\n          roomId: conversationId,\r\n          targetUserId: targetId,\r\n          nickname: v,\r\n        });\r\n        setTimeout(() => socket.disconnect(), 500);\r\n      } catch {}\r\n\r\n      // 4. Reload data\r\n      reLoad?.();\r\n\r\n      // 5. Send Notification\r\n      if (sendNotifyMessage) {\r\n        const actorName = currentUser.name || 'Một thành viên';\r\n        const targetMember = localMembers.find((m) => compareIds(m._id || m.id, targetId));\r\n        const foundUser = userMap.get(normalizeId(targetId)) || userMap.get(String(Number(targetId)));\r\n        const targetName = foundUser?.name || targetMember?.name || 'Thành viên';\r\n\r\n        let msg = '';\r\n        if (v) {\r\n          msg = `${actorName} đã đặt biệt danh cho ${targetName} là \"${v}\".`;\r\n        } else {\r\n          msg = `${actorName} đã xóa biệt danh của ${targetName}.`;\r\n        }\r\n        sendNotifyMessage(msg);\r\n      }\r\n    } catch {\r\n      toast({ type: 'error', message: 'Cập nhật biệt danh thất bại', duration: 3000 });\r\n    }\r\n  };\r\n\r\n  const modalNode = (\r\n    <div\r\n      className={`${isDesktop ? 'absolute inset-0' : 'fixed inset-0'} z-50 flex items-stretch justify-center ${\r\n        isDesktop ? 'bg-black/20' : 'bg-black/40'\r\n      } backdrop-blur-sm sm:px-0`}\r\n    >\r\n      <div className=\"bg-white w-full h-full rounded-none overflow-hidden flex flex-col\">\r\n        {/* HEADER */}\r\n        <div className=\"flex-none bg-blue-400 text-white\">\r\n          <div className=\"flex items-center justify-between px-4 py-2\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <button onClick={onClose} className=\"p-2 rounded-full cursor-pointer hover:bg-white/20 active:scale-95\">\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n                </svg>\r\n              </button>\r\n              <h2 className=\"text-lg font-bold\">Thành viên</h2>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => setShowCreateGroupModal(true)}\r\n                className=\"p-2 rounded-full cursor-pointer hover:bg-white/20 active:scale-95\"\r\n                title=\"Thêm thành viên\"\r\n              >\r\n                <HiUserPlus className=\"w-6 h-6\" />\r\n              </button>\r\n\r\n              <button\r\n                onClick={() => setShowSearch((v) => !v)}\r\n                className=\"p-2 rounded-full cursor-pointer hover:bg-white/20 active:scale-95\"\r\n                title=\"Tìm kiếm\"\r\n              >\r\n                <HiSearch className=\"w-6 h-6\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n          {showSearch && (\r\n            <div className=\"px-4 pb-3\">\r\n              <div className=\"relative\">\r\n                <HiSearch className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/90 focus:outline-none focus:bg-white focus:text-gray-900 transition-all\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  placeholder=\"Tìm kiếm thành viên\"\r\n                  className=\"w-full pl-10 pr-4 py-2.5 rounded-xl bg-white/15 text-white  focus:outline-none focus:bg-white focus:text-gray-900 transition-all\"\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* BODY */}\r\n        <div className=\"flex-1 flex flex-col min-h-0  bg-white sm:bg-gray-50\">\r\n          {/* Tabs */}\r\n          <div className=\"flex items-center gap-6 px-4 border-b border-gray-200 overflow-x-auto custom-scrollbar\">\r\n            <button\r\n              onClick={() => setActiveTab('all')}\r\n              className={`cursor-pointer py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap shrink-0 ${\r\n                activeTab === 'all'\r\n                  ? 'border-gray-900 text-gray-900'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Tất cả\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('admin')}\r\n              className={`cursor-pointer py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap shrink-0 ${\r\n                activeTab === 'admin'\r\n                  ? 'border-gray-900 text-gray-900'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Trưởng và phó nhóm\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('invited')}\r\n              className={`cursor-pointer py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap shrink-0 ${\r\n                activeTab === 'invited'\r\n                  ? 'border-gray-900 text-gray-900'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Đã mời\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('blocked')}\r\n              className={`cursor-pointer py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap shrink-0 ${\r\n                activeTab === 'blocked'\r\n                  ? 'border-gray-900 text-gray-900'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Đã chặn\r\n            </button>\r\n          </div>\r\n          {/* NICKNAME MODAL - style giống Zalo */}\r\n          {editingNicknameMember && (\r\n            <div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\r\n              <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden\">\r\n                <div className=\"p-5 border-b border-gray-100 flex justify-between items-center\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900\">Đặt biệt danh</h3>\r\n                  <button onClick={() => setEditingNicknameMember(null)} className=\"p-2 hover:bg-gray-100 rounded-full\">\r\n                    <HiX className=\"w-6 h-6 text-gray-500\" />\r\n                  </button>\r\n                </div>\r\n                <div className=\"p-6 space-y-5\">\r\n                  <p className=\"text-base text-gray-600\">\r\n                    Đặt biệt danh cho <b>{editingNicknameMember.name}</b> trong nhóm này.\r\n                  </p>\r\n                  <input\r\n                    type=\"text\"\r\n                    autoFocus\r\n                    defaultValue={editingNicknameMember.currentVal || editingNicknameMember.name}\r\n                    className=\"w-full px-4 py-3 border border-gray-300 rounded-2xl text-base focus:outline-none focus:border-[#0088ff] focus:ring-2 focus:ring-[#0088ff]/30\"\r\n                    placeholder=\"Nhập biệt danh...\"\r\n                    onKeyDown={(e) => {\r\n                      if (e.key === 'Enter') {\r\n                        setNickname(editingNicknameMember.id, e.currentTarget.value);\r\n                        setEditingNicknameMember(null);\r\n                      }\r\n                    }}\r\n                    id=\"nickname-input\"\r\n                  />\r\n                  <div className=\"flex gap-3 justify-end\">\r\n                    <button\r\n                      onClick={() => setEditingNicknameMember(null)}\r\n                      className=\"px-6 py-3 text-gray-600 font-medium rounded-2xl hover:bg-gray-100\"\r\n                    >\r\n                      Hủy\r\n                    </button>\r\n                    <button\r\n                      onClick={() => {\r\n                        const val = (document.getElementById('nickname-input') as HTMLInputElement)?.value;\r\n                        setNickname(editingNicknameMember.id, val);\r\n                        setEditingNicknameMember(null);\r\n                      }}\r\n                      className=\"px-6 py-3 bg-[#0088ff] text-white font-medium rounded-2xl hover:bg-[#0070d9] transition-colors\"\r\n                    >\r\n                      Lưu\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Member List */}\r\n          <div className=\"flex-1 overflow-y-auto px-4 py-4 custom-scrollbar\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h3 className=\"text-sm font-semibold text-gray-500 uppercase tracking-wide\">Danh sách thành viên</h3>\r\n              <span className=\"text-xl font-bold text-[#0088ff]\">{displayMembers.length}</span>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              {displayMembers.map((member) => {\r\n                const memberId = normalizeId(member._id || member.id);\r\n                const memberRole: GroupRole = member.role;\r\n                const isMe = compareIds(memberId, myId);\r\n                const isLoading = loadingAction === memberId;\r\n\r\n                return (\r\n                  <div\r\n                    key={memberId}\r\n                    className={`flex items-center justify-between gap-4 py-3 px-3 rounded-2xl hover:bg-gray-50 transition-colors relative group ${isLoading ? 'opacity-60' : ''}`}\r\n                  >\r\n                    <div className=\"flex items-center gap-4\">\r\n                      {/* Avatar */}\r\n                      <div\r\n                        className=\"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 cursor-pointer\"\r\n                        onClick={() => handleOpenProfile(memberId)}\r\n                      >\r\n                        {member.avatar ? (\r\n                          <Image\r\n                            src={getProxyUrl(member.avatar)}\r\n                            alt={member.name}\r\n                            width={48}\r\n                            height={48}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        ) : (\r\n                          <Image\r\n                            src=\"/logo/avata.webp\"\r\n                            alt={member.name}\r\n                            width={48}\r\n                            height={48}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Info */}\r\n                      <div className=\" min-w-0 space-y-1\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <p className=\"text-base font-medium text-gray-900\">{member.name}</p>\r\n\r\n                          {isMe && (\r\n                            <span className=\"px-2.5  py-1 bg-[#0088ff]/10 text-[#0088ff] rounded-full text-xs font-medium\">\r\n                              Bạn\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n\r\n                        <div className=\" gap-3 flex \">\r\n                          <RoleBadge role={member.role} />\r\n                        </div>\r\n                        {member.addedBy && (\r\n                          <div className=\"text-xs text-gray-500\">\r\n                            {compareIds(member.addedBy, myId) ? (\r\n                              'Thêm bởi bạn'\r\n                            ) : (\r\n                              <>\r\n                                {'Thêm bởi '}\r\n                                <span className=\"font-medium\">\r\n                                  {(() => {\r\n                                    const adder = userMap.get(normalizeId(member.addedBy));\r\n                                    if (!adder) console.warn('[ModalMembers] Unknown adder:', member.addedBy);\r\n                                    return adder?.name || 'Người dùng';\r\n                                  })()}\r\n                                </span>\r\n                              </>\r\n                            )}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {!isLoading && (\r\n                      <div className=\"relative\">\r\n                        <button\r\n                          onClick={() => setOpenMenuId(openMenuId === memberId ? null : memberId)}\r\n                          className=\"p-2 rounded-full cursor-pointer hover:bg-gray-200 active:scale-95\"\r\n                          title=\"Thêm\"\r\n                        >\r\n                          <HiEllipsisVertical className=\"w-5 h-5 text-gray-700\" />\r\n                        </button>\r\n                        {openMenuId === memberId && (\r\n                          <>\r\n                            <div className=\"fixed inset-0 z-10\" onClick={() => setOpenMenuId(null)} />\r\n                            <div className=\"absolute right-0 top-full mt-1 w-56 bg-white rounded-xl shadow-xl border border-gray-200 z-20 overflow-hidden\">\r\n                              <button\r\n                                onClick={() => {\r\n                                  const currentRoomNick = String(member.nickname || '');\r\n                                  setEditingNicknameMember({\r\n                                    id: memberId,\r\n                                    name: member.name,\r\n                                    currentVal: currentRoomNick,\r\n                                  });\r\n                                  setOpenMenuId(null);\r\n                                }}\r\n                                className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50\"\r\n                              >\r\n                                Đặt biệt danh\r\n                              </button>\r\n\r\n                              {/* {!isMe && canPromote(memberRole) && (\r\n                                <button\r\n                                  onClick={() => {\r\n                                    confirmAlert({\r\n                                      title: 'Phân làm Phó nhóm',\r\n                                      message: `Phân ${member.name} làm Phó nhóm?`,\r\n                                      okText: 'Phân quyền',\r\n                                      onOk: () => handleAction('promote', memberId),\r\n                                    });\r\n                                    setOpenMenuId(null);\r\n                                  }}\r\n                                  className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50\"\r\n                                >\r\n                                  Phân làm Phó nhóm\r\n                                </button>\r\n                              )} */}\r\n                              {!isMe && canPromote(memberRole) && (\r\n                                <button\r\n                                  onClick={() => {\r\n                                    confirmAlert({\r\n                                      title: 'Bổ nhiệm làm Phó nhóm',\r\n                                      message: `Bổ nhiệm ${member.name} làm Phó nhóm?`,\r\n                                      okText: 'Bổ nhiệm',\r\n                                      onOk: () => handleAction('promote', memberId),\r\n                                    });\r\n                                    setOpenMenuId(null);\r\n                                  }}\r\n                                  className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50\"\r\n                                >\r\n                                  Bổ nhiệm làm Phó nhóm\r\n                                </button>\r\n                              )}\r\n                              {!isMe && canDemote(memberRole) && (\r\n                                <button\r\n                                  onClick={() => {\r\n                                    confirmAlert({\r\n                                      title: 'Hủy quyền Phó nhóm',\r\n                                      message: `Hủy quyền Phó nhóm ${member.name}?`,\r\n                                      okText: 'Có',\r\n                                      onOk: () => handleAction('demote', memberId),\r\n                                    });\r\n                                    setOpenMenuId(null);\r\n                                  }}\r\n                                  className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50\"\r\n                                >\r\n                                  Bãi nhiệm\r\n                                </button>\r\n                              )}\r\n                              {!isMe && canKick(memberRole) && (\r\n                                <button\r\n                                  onClick={() => {\r\n                                    confirmAlert({\r\n                                      title: 'Xóa thành viên',\r\n                                      message: `Xóa ${member.name} khỏi nhóm?`,\r\n                                      okText: 'Xóa',\r\n                                      onOk: () => handleAction('kick', memberId),\r\n                                    });\r\n                                    setOpenMenuId(null);\r\n                                  }}\r\n                                  className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50 text-red-600\"\r\n                                >\r\n                                  Xóa khỏi nhóm\r\n                                </button>\r\n                              )}\r\n                            </div>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Loading overlay */}\r\n                    {isLoading && (\r\n                      <div className=\"absolute inset-0 bg-white/70 rounded-2xl flex items-center justify-center\">\r\n                        <div className=\"w-8 h-8 border-4 border-[#0088ff] border-t-transparent rounded-full animate-spin\" />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n\r\n              {displayMembers.length === 0 && (\r\n                <div className=\"text-center py-20 text-gray-400\">\r\n                  <HiSearch className=\"w-20 h-20 mx-auto mb-6 opacity-30\" />\r\n                  <p className=\"text-lg font-medium\">Không tìm thấy thành viên</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer hidden for clean full-screen */}\r\n      </div>\r\n\r\n      {showCreateGroupModal && (\r\n        <CreateGroupModal\r\n          mode=\"add\"\r\n          conversationId={conversationId}\r\n          existingMemberIds={existingMemberIds}\r\n          currentUser={currentUser}\r\n          allUsers={allUsers}\r\n          onClose={() => setShowCreateGroupModal(false)}\r\n          reLoad={reLoad}\r\n          onMembersAdded={handleOptimisticAddMember}\r\n          onGroupCreated={() => setShowCreateGroupModal(false)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n  const target =\r\n    isDesktop && typeof document !== 'undefined' ? document.getElementById('right-sidebar-container') : null;\r\n  return isDesktop && target ? createPortal(modalNode, target) : modalNode;\r\n}\r\n"],"names":[],"mappings":";;;;;AACA,oDAAoD,GAEpD;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AAEA;;;AAlBA;;;;;;;;;;;;;AAsCA,qCAAqC;AACrC,SAAS,YAAY,KAAc;IACjC,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,IAAI,OAAO,UAAU,UAAU,OAAO,OAAO;IAC7C,IAAI,OAAO,UAAU,YAAY,UAAU,MAAM;QAC/C,IAAI,SAAS,OAAO,OAAO,YAAY,MAAM,GAAG;QAChD,IAAI,QAAQ,OAAO,OAAO,YAAY,MAAM,EAAE;IAChD;IACA,OAAO,OAAO;AAChB;AAEA,mCAAmC;AACnC,SAAS,WAAW,GAAY,EAAE,GAAY;IAC5C,MAAM,cAAc,YAAY;IAChC,MAAM,cAAc,YAAY;IAEhC,IAAI,gBAAgB,aAAa,OAAO;IAExC,yBAAyB;IACzB,MAAM,OAAO,OAAO;IACpB,MAAM,OAAO,OAAO;IACpB,IAAI,CAAC,MAAM,SAAS,CAAC,MAAM,SAAS,SAAS,MAAM,OAAO;IAE1D,OAAO;AACT;AAEe,SAAS,kBAAkB,EACxC,OAAO,EACP,OAAO,EACP,MAAM,EACN,SAAS,EACT,WAAW,EACX,QAAQ,EACR,cAAc,EACd,MAAM,EACN,cAAc,EACd,eAAe,EACf,YAAY,EACZ,iBAAiB,EACjB,WAAW,EACL;;IACN,MAAM,YAAY,+CAAkB,eAAe,OAAO,UAAU,CAAC,sBAAsB,OAAO;IAClG,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,yKAAQ,EAAC;IACjE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAoB,EAAE;IACtE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAgB;IAClE,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,IAAA,yKAAQ,EAIxD;IACV,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAA0C;IACpF,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAgB;IAC5D,MAAM,QAAQ,IAAA,kJAAQ;IACtB,MAAM,SAAS,IAAA,kJAAS;IAExB,wCAAwC;IACxC,MAAM,UAAU,wKAAK,CAAC,OAAO;8CAAC;YAC5B,MAAM,MAAM,IAAI;YAEhB,mBAAmB;YACnB,IAAI,aAAa;gBACf,MAAM,YAAY,YAAY,YAAY,GAAG,IAAI,YAAY,EAAE;gBAC/D,IAAI,WAAW;oBACb,IAAI,GAAG,CAAC,WAAW;oBAEnB,kCAAkC;oBAClC,IAAI,CAAC,MAAM,OAAO,aAAa;wBAC7B,IAAI,GAAG,CAAC,OAAO,OAAO,aAAa;oBACrC;gBACF;YACF;YAEA,gBAAgB;YAChB,SAAS,OAAO;sDAAC,CAAC;oBAChB,MAAM,SAAS,YAAY,KAAK,GAAG,IAAI,KAAK,EAAE;oBAC9C,IAAI,QAAQ;wBACV,IAAI,GAAG,CAAC,QAAQ;wBAEhB,kCAAkC;wBAClC,IAAI,CAAC,MAAM,OAAO,UAAU;4BAC1B,IAAI,GAAG,CAAC,OAAO,OAAO,UAAU;wBAClC;oBACF;gBACF;;YAEA,OAAO;QACT;6CAAG;QAAC;QAAa;KAAS;IAE1B,IAAA,0KAAS;uCAAC;YACR,MAAM,WAAyB,CAAC,WAAW,EAAE,EAC1C,GAAG;wDAAC,CAAC;oBACJ,MAAM,MAAM;oBACZ,MAAM,WAAW,YAAY,IAAI,GAAG,IAAI,IAAI,EAAE;oBAC9C,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,SAAS,CAAC,CAAC,EAAE;wBACxD,MAAM,IAAI,IAAI;wBACd,MAAM,IAAI,IAAI;wBACd,SAAS,IAAI,OAAO;wBACpB,WAAW;oBACb;oBAEA,IAAI,CAAC,UAAU;wBACb,QAAQ,IAAI,CAAC,yBAAyB;wBACtC,OAAO;oBACT;oBAEA,MAAM,WAAW,AAAC,IAAI,IAAI,IAAkB;oBAC5C,MAAM,eAAe,OAAO,IAAI,QAAQ,KAAK,WAAW,IAAI,QAAQ,GAAG,KAAK,GAAG;oBAE/E,iCAAiC;oBACjC,IAAI,YAAY,QAAQ,GAAG,CAAC;oBAE5B,wCAAwC;oBACxC,IAAI,CAAC,aAAa,CAAC,MAAM,OAAO,YAAY;wBAC1C,YAAY,QAAQ,GAAG,CAAC,OAAO,OAAO;oBACxC;oBAEA,MAAM,OAAO,YAAY,YAAY,GAAG,IAAI,YAAY,EAAE;oBAE1D,MAAM,eAAe,IAAI,IAAI,IAAI,WAAW,QAAQ;oBACpD,+EAA+E;oBAC/E,MAAM,WAAW,IAAI,QAAQ,IAAI,WAAW,WAAW,CAAC,KAAK;oBAC7D,MAAM,OAAO,YAAY;oBACzB,MAAM,SAAS,IAAI,MAAM,IAAI,WAAW;oBAExC,OAAO;wBACL,KAAK;wBACL;wBACA;wBACA,MAAM;wBACN,UAAU;wBACV,SAAS,IAAI,OAAO;wBACpB;oBACF;gBACF;uDACC,MAAM,CAAC;YAEV,+BAA+B;YAC/B,MAAM,mBAAmB,IAAI;YAC7B,SAAS,OAAO;+CAAC,CAAC;oBAChB,MAAM,KAAK,YAAY,EAAE,GAAG,IAAI,EAAE,EAAE;oBACpC,IAAI,CAAC,iBAAiB,GAAG,CAAC,KAAK;wBAC7B,iBAAiB,GAAG,CAAC,IAAI;oBAC3B;gBACF;;YAEA,gBAAgB,MAAM,IAAI,CAAC,iBAAiB,MAAM;QACpD;sCAAG;QAAC;QAAS;QAAU;QAAS;QAAa;QAAgB;KAAY;IAEzE,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,OAAO,YAAY,YAAY,GAAG,IAAI,YAAY,EAAE;IAC1D,MAAM,eAAe,aAAa,IAAI,CAAC,CAAC,IAAM,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE;IACxE,MAAM,SAAoB,cAAc,QAAQ;IAEhD,MAAM,UAAU,CAAC;QACf,IAAI,WAAW,SAAS,OAAO;QAC/B,IAAI,WAAW,WAAW,eAAe,UAAU,OAAO;QAC1D,OAAO;IACT;IAEA,MAAM,aAAa,CAAC,aAA0B,WAAW,WAAW,eAAe;IACnF,MAAM,YAAY,CAAC,aAA0B,WAAW,WAAW,eAAe;IAElF,MAAM,oBAAoB,CAAC;QACzB,MAAM,KAAK,YAAY;QACvB,OAAO,IAAI,CAAC,CAAC,SAAS,EAAE,IAAI;IAC9B;IAEA,MAAM,4BAA4B,CAAC;QACjC,MAAM,sBAAoC,SAAS,GAAG,CAAC,CAAC,IAAM,CAAC;gBAC7D,KAAK,YAAY,EAAE,GAAG,IAAI,EAAE,EAAE;gBAC9B,MAAM,EAAE,IAAI;gBACZ,QAAQ,EAAE,MAAM;gBAChB,MAAM;gBACN,UAAU,KAAK,GAAG;gBAClB,SAAS;YACX,CAAC;QACD,gBAAgB,CAAC,OAAS;mBAAI;mBAAS;aAAoB;QAC3D,wBAAwB;QACxB,eAAe;IACjB;IAEA,MAAM,eAAe,OAAO,QAAuC;QACjE,IAAI,CAAC,gBAAgB;QACrB,iBAAiB;QAEjB,MAAM,eAAe,aAAa,IAAI,CAAC,CAAC,IAAM,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE;QACxE,MAAM,aAAa,eAAe,aAAa,IAAI,GAAG;QAEtD,IAAI;YACF,MAAM,sBAAsB;mBAAI;aAAa;YAC7C,MAAM,MAAM,MAAM,MAAM,eAAe;gBACrC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAClB,WAAW,SACP;oBAAE;oBAAgB;oBAAc,QAAQ;oBAAc,KAAK;gBAAK,IAChE;oBACE;oBACA;oBACA,QAAQ;oBACR,MAAM;wBAAE,MAAM,WAAW,YAAY,UAAU;oBAAS;oBACxD,KAAK;gBACP;YAER;YAEA,IAAI,IAAI,EAAE,EAAE;gBACV,IAAI,WAAW,QAAQ;oBACrB,gBAAgB,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,IAAM,CAAC,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE;oBACxE,IAAI,iBAAiB,gBAAgB,cAAc;oBAEnD,qEAAqE;oBACrE,IAAI;wBACF,MAAM,YAAY,OAAO,kBAAkB;wBAC3C,MAAM,cAAc,oBAAoB,MAAM,CAAC,CAAC,IAAM,CAAC,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE;wBACjF,MAAM,iBAAiB,YAAY,GAAG,CAAC,CAAC,IAAM,CAAC;gCAC7C,KAAK,OAAO,EAAE,GAAG,IAAI,EAAE,EAAE,IAAI;gCAC7B,MAAM,EAAE,IAAI;gCACZ,MAAM,EAAE,IAAI;gCACZ,QAAQ,EAAE,MAAM;4BAClB,CAAC;wBACD,MAAM,cAAc,oBAAoB,GAAG,CAAC,CAAC,IAAM,CAAC;gCAClD,KAAK,OAAO,EAAE,GAAG,IAAI,EAAE,EAAE,IAAI;4BAC/B,CAAC;wBACD,MAAM,OAAO,IAAA,6LAAE,EAAC,IAAA,4IAAgB,KAAI;4BAAE,YAAY;gCAAC;6BAAY;4BAAE,iBAAiB;wBAAM;wBACxF,KAAK,IAAI,CAAC,yBAAyB;4BACjC,QAAQ;4BACR,SAAS;4BACT;4BACA,QAAQ;4BACR,YAAY,YAAY,IAAI;4BAC5B;wBACF;wBACA,WAAW,IAAM,KAAK,UAAU,IAAI;oBACtC,EAAE,OAAM,CAAC;gBACX,OAAO,IAAI,WAAW,aAAa,WAAW,UAAU;oBACtD,MAAM,UAAqB,WAAW,YAAY,UAAU;oBAC5D,gBAAgB,CAAC,OACf,KAAK,GAAG,CAAC,CAAC,IAAO,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE,gBAAgB;gCAAE,GAAG,CAAC;gCAAE,MAAM;4BAAQ,IAAI;oBAEvF,eAAe,cAAc,YAAY;gBAC3C;gBACA;YACF,OAAO;gBACL,MAAM;oBAAE,MAAM;oBAAS,SAAS;oBAAqB,UAAU;gBAAK;YACtE;QACF,EAAE,OAAM;YACN,MAAM;gBAAE,MAAM;gBAAS,SAAS;gBAA8B,UAAU;YAAK;QAC/E,SAAU;YACR,iBAAiB;QACnB;IACF;IAEA,MAAM,mBAAmB;QACvB,IAAI,CAAC,gBAAgB;QACrB,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,eAAe;gBACrC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB,QAAQ;oBACR;oBACA,KAAK;gBACP;YACF;YACA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;YAC7B,MAAM,YAAY,YAAY,IAAI,IAAI;YACtC,MAAM,OAAO,GAAG,UAAU,YAAY,CAAC;YACvC,IAAI;gBACF,MAAM,oBAAoB;YAC5B,EAAE,OAAM,CAAC;YACT,IAAI;gBACF,MAAM,YAAY,OAAO;gBACzB,MAAM,cAAc,aAAa,MAAM,CAAC,CAAC,IAAM,CAAC,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE;gBAC1E,MAAM,iBAAiB,YAAY,GAAG,CAAC,CAAC,IAAM,CAAC;wBAC7C,KAAK,OAAO,EAAE,GAAG,IAAI,EAAE,EAAE,IAAI;wBAC7B,MAAM,EAAE,IAAI;wBACZ,MAAM,EAAE,IAAI;wBACZ,QAAQ,EAAE,MAAM;oBAClB,CAAC;gBACD,MAAM,cAAc,aAAa,GAAG,CAAC,CAAC,IAAM,CAAC;wBAAE,KAAK,OAAO,EAAE,GAAG,IAAI,EAAE,EAAE,IAAI;oBAAI,CAAC;gBACjF,MAAM,OAAO,IAAA,6LAAE,EAAC,IAAA,4IAAgB,KAAI;oBAAE,YAAY;wBAAC;qBAAY;oBAAE,iBAAiB;gBAAM;gBACxF,KAAK,IAAI,CAAC,yBAAyB;oBACjC,QAAQ;oBACR,SAAS;oBACT;oBACA,QAAQ;oBACR,YAAY,YAAY,IAAI;oBAC5B;gBACF;gBACA,WAAW,IAAM,KAAK,UAAU,IAAI;YACtC,EAAE,OAAM,CAAC;YACT,gBAAgB,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,IAAM,CAAC,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE;YACxE;YACA;QACF,EAAE,OAAM;YACN,MAAM;gBAAE,MAAM;gBAAS,SAAS;gBAAqB,UAAU;YAAK;QACtE;IACF;IACA,MAAM,aAAa,aAAa,MAAM,CAAC,CAAC,OAAS,IAAA,+IAAmB,EAAC,KAAK,IAAI,IAAI,IAAI;IAEtF,MAAM,iBAAiB,WAAW,MAAM,CAAC,CAAC;QACxC,IAAI,cAAc,OAAO,OAAO;QAChC,IAAI,cAAc,SAAS,OAAO,EAAE,IAAI,KAAK,WAAW,EAAE,IAAI,KAAK;QACnE,mEAAmE;QACnE,IAAI,cAAc,WAAW,OAAO;QACpC,IAAI,cAAc,WAAW,OAAO;QACpC,OAAO;IACT;IAEA,MAAM,oBAAoB,aAAa,GAAG,CAAC,CAAC,IAAM,YAAY,EAAE,GAAG,IAAI,EAAE,EAAE;IAC3E,MAAM,cAAc,OAAO,UAAkB;QAC3C,IAAI,CAAC,gBAAgB;QAErB,IAAI;YACF,cAAc;YACd,MAAM,MAAM,MAAM,MAAM,eAAe;gBACrC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB,QAAQ;oBACR;oBACA,cAAc;oBACd,MAAM;wBAAE;oBAAS;gBACnB;YACF;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;YAE7B,mCAAmC;YACnC,MAAM,IAAI,OAAO,YAAY,IAAI,IAAI;YACrC,gBAAgB,CAAC,OACf,KAAK,GAAG,CAAC,CAAC;oBACR,IAAI,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE,WAAW;wBACvC,MAAM,YAAY,QAAQ,GAAG,CAAC,YAAY,cAAc,QAAQ,GAAG,CAAC,OAAO,OAAO;wBAClF,MAAM,iBAAiB,WAAW,WAAW,CAAC,KAAK;wBACnD,MAAM,eAAe,AAAC,EAAsB,YAAY,IAAI,WAAW,QAAQ,EAAE,IAAI;wBACrF,MAAM,eAAe,KAAK,kBAAkB;wBAC5C,OAAO;4BAAE,GAAG,CAAC;4BAAE,MAAM,gBAAgB;4BAAc,UAAU;wBAAE;oBACjE;oBACA,OAAO;gBACT;YAGF,4CAA4C;YAC5C,IAAI;gBACF,MAAM,SAAS,IAAA,6LAAE,EAAC,IAAA,4IAAgB,KAAI;oBAAE,YAAY;wBAAC;qBAAY;oBAAE,iBAAiB;gBAAM;gBAC1F,OAAO,IAAI,CAAC,yBAAyB;oBACnC,QAAQ;oBACR,cAAc;oBACd,UAAU;gBACZ;gBACA,WAAW,IAAM,OAAO,UAAU,IAAI;YACxC,EAAE,OAAM,CAAC;YAET,iBAAiB;YACjB;YAEA,uBAAuB;YACvB,IAAI,mBAAmB;gBACrB,MAAM,YAAY,YAAY,IAAI,IAAI;gBACtC,MAAM,eAAe,aAAa,IAAI,CAAC,CAAC,IAAM,WAAW,EAAE,GAAG,IAAI,EAAE,EAAE,EAAE;gBACxE,MAAM,YAAY,QAAQ,GAAG,CAAC,YAAY,cAAc,QAAQ,GAAG,CAAC,OAAO,OAAO;gBAClF,MAAM,aAAa,WAAW,QAAQ,cAAc,QAAQ;gBAE5D,IAAI,MAAM;gBACV,IAAI,GAAG;oBACL,MAAM,GAAG,UAAU,sBAAsB,EAAE,WAAW,KAAK,EAAE,EAAE,EAAE,CAAC;gBACpE,OAAO;oBACL,MAAM,GAAG,UAAU,sBAAsB,EAAE,WAAW,CAAC,CAAC;gBAC1D;gBACA,kBAAkB;YACpB;QACF,EAAE,OAAM;YACN,MAAM;gBAAE,MAAM;gBAAS,SAAS;gBAA+B,UAAU;YAAK;QAChF;IACF;IAEA,MAAM,0BACJ,6LAAC;QACC,WAAW,GAAG,YAAY,qBAAqB,gBAAgB,wCAAwC,EACrG,YAAY,gBAAgB,cAC7B,yBAAyB,CAAC;;0BAE3B,6LAAC;gBAAI,WAAU;;kCAEb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDAAO,SAAS;gDAAS,WAAU;0DAClC,cAAA,6LAAC;oDAAI,WAAU;oDAAU,MAAK;oDAAO,QAAO;oDAAe,SAAQ;8DACjE,cAAA,6LAAC;wDAAK,eAAc;wDAAQ,gBAAe;wDAAQ,aAAa;wDAAG,GAAE;;;;;;;;;;;;;;;;0DAGzE,6LAAC;gDAAG,WAAU;0DAAoB;;;;;;;;;;;;kDAGpC,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDACC,SAAS,IAAM,wBAAwB;gDACvC,WAAU;gDACV,OAAM;0DAEN,cAAA,6LAAC,gKAAU;oDAAC,WAAU;;;;;;;;;;;0DAGxB,6LAAC;gDACC,SAAS,IAAM,cAAc,CAAC,IAAM,CAAC;gDACrC,WAAU;gDACV,OAAM;0DAEN,cAAA,6LAAC,6JAAQ;oDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;4BAIzB,4BACC,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC;oCAAI,WAAU;;sDACb,6LAAC,6JAAQ;4CAAC,WAAU;;;;;;sDACpB,6LAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;4CAC7C,aAAY;4CACZ,WAAU;;;;;;;;;;;;;;;;;;;;;;;kCAQpB,6LAAC;wBAAI,WAAU;;0CAEb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,SAAS,IAAM,aAAa;wCAC5B,WAAW,CAAC,gGAAgG,EAC1G,cAAc,QACV,kCACA,wDACJ;kDACH;;;;;;kDAGD,6LAAC;wCACC,SAAS,IAAM,aAAa;wCAC5B,WAAW,CAAC,gGAAgG,EAC1G,cAAc,UACV,kCACA,wDACJ;kDACH;;;;;;kDAGD,6LAAC;wCACC,SAAS,IAAM,aAAa;wCAC5B,WAAW,CAAC,gGAAgG,EAC1G,cAAc,YACV,kCACA,wDACJ;kDACH;;;;;;kDAGD,6LAAC;wCACC,SAAS,IAAM,aAAa;wCAC5B,WAAW,CAAC,gGAAgG,EAC1G,cAAc,YACV,kCACA,wDACJ;kDACH;;;;;;;;;;;;4BAKF,uCACC,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAG,WAAU;8DAAsC;;;;;;8DACpD,6LAAC;oDAAO,SAAS,IAAM,yBAAyB;oDAAO,WAAU;8DAC/D,cAAA,6LAAC,wJAAG;wDAAC,WAAU;;;;;;;;;;;;;;;;;sDAGnB,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAE,WAAU;;wDAA0B;sEACnB,6LAAC;sEAAG,sBAAsB,IAAI;;;;;;wDAAK;;;;;;;8DAEvD,6LAAC;oDACC,MAAK;oDACL,SAAS;oDACT,cAAc,sBAAsB,UAAU,IAAI,sBAAsB,IAAI;oDAC5E,WAAU;oDACV,aAAY;oDACZ,WAAW,CAAC;wDACV,IAAI,EAAE,GAAG,KAAK,SAAS;4DACrB,YAAY,sBAAsB,EAAE,EAAE,EAAE,aAAa,CAAC,KAAK;4DAC3D,yBAAyB;wDAC3B;oDACF;oDACA,IAAG;;;;;;8DAEL,6LAAC;oDAAI,WAAU;;sEACb,6LAAC;4DACC,SAAS,IAAM,yBAAyB;4DACxC,WAAU;sEACX;;;;;;sEAGD,6LAAC;4DACC,SAAS;gEACP,MAAM,MAAO,SAAS,cAAc,CAAC,mBAAwC;gEAC7E,YAAY,sBAAsB,EAAE,EAAE;gEACtC,yBAAyB;4DAC3B;4DACA,WAAU;sEACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0CAUX,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDAAG,WAAU;0DAA8D;;;;;;0DAC5E,6LAAC;gDAAK,WAAU;0DAAoC,eAAe,MAAM;;;;;;;;;;;;kDAG3E,6LAAC;wCAAI,WAAU;;4CACZ,eAAe,GAAG,CAAC,CAAC;gDACnB,MAAM,WAAW,YAAY,OAAO,GAAG,IAAI,OAAO,EAAE;gDACpD,MAAM,aAAwB,OAAO,IAAI;gDACzC,MAAM,OAAO,WAAW,UAAU;gDAClC,MAAM,YAAY,kBAAkB;gDAEpC,qBACE,6LAAC;oDAEC,WAAW,CAAC,gHAAgH,EAAE,YAAY,eAAe,IAAI;;sEAE7J,6LAAC;4DAAI,WAAU;;8EAEb,6LAAC;oEACC,WAAU;oEACV,SAAS,IAAM,kBAAkB;8EAEhC,OAAO,MAAM,iBACZ,6LAAC,2IAAK;wEACJ,KAAK,IAAA,uIAAW,EAAC,OAAO,MAAM;wEAC9B,KAAK,OAAO,IAAI;wEAChB,OAAO;wEACP,QAAQ;wEACR,WAAU;;;;;6FAGZ,6LAAC,2IAAK;wEACJ,KAAI;wEACJ,KAAK,OAAO,IAAI;wEAChB,OAAO;wEACP,QAAQ;wEACR,WAAU;;;;;;;;;;;8EAMhB,6LAAC;oEAAI,WAAU;;sFACb,6LAAC;4EAAI,WAAU;;8FACb,6LAAC;oFAAE,WAAU;8FAAuC,OAAO,IAAI;;;;;;gFAE9D,sBACC,6LAAC;oFAAK,WAAU;8FAA+E;;;;;;;;;;;;sFAMnG,6LAAC;4EAAI,WAAU;sFACb,cAAA,6LAAC,qJAAS;gFAAC,MAAM,OAAO,IAAI;;;;;;;;;;;wEAE7B,OAAO,OAAO,kBACb,6LAAC;4EAAI,WAAU;sFACZ,WAAW,OAAO,OAAO,EAAE,QAC1B,+BAEA;;oFACG;kGACD,6LAAC;wFAAK,WAAU;kGACb,CAAC;4FACA,MAAM,QAAQ,QAAQ,GAAG,CAAC,YAAY,OAAO,OAAO;4FACpD,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,iCAAiC,OAAO,OAAO;4FACxE,OAAO,OAAO,QAAQ;wFACxB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;wDASd,CAAC,2BACA,6LAAC;4DAAI,WAAU;;8EACb,6LAAC;oEACC,SAAS,IAAM,cAAc,eAAe,WAAW,OAAO;oEAC9D,WAAU;oEACV,OAAM;8EAEN,cAAA,6LAAC,wKAAkB;wEAAC,WAAU;;;;;;;;;;;gEAE/B,eAAe,0BACd;;sFACE,6LAAC;4EAAI,WAAU;4EAAqB,SAAS,IAAM,cAAc;;;;;;sFACjE,6LAAC;4EAAI,WAAU;;8FACb,6LAAC;oFACC,SAAS;wFACP,MAAM,kBAAkB,OAAO,OAAO,QAAQ,IAAI;wFAClD,yBAAyB;4FACvB,IAAI;4FACJ,MAAM,OAAO,IAAI;4FACjB,YAAY;wFACd;wFACA,cAAc;oFAChB;oFACA,WAAU;8FACX;;;;;;gFAoBA,CAAC,QAAQ,WAAW,6BACnB,6LAAC;oFACC,SAAS;wFACP,IAAA,sJAAY,EAAC;4FACX,OAAO;4FACP,SAAS,CAAC,SAAS,EAAE,OAAO,IAAI,CAAC,cAAc,CAAC;4FAChD,QAAQ;4FACR,MAAM,IAAM,aAAa,WAAW;wFACtC;wFACA,cAAc;oFAChB;oFACA,WAAU;8FACX;;;;;;gFAIF,CAAC,QAAQ,UAAU,6BAClB,6LAAC;oFACC,SAAS;wFACP,IAAA,sJAAY,EAAC;4FACX,OAAO;4FACP,SAAS,CAAC,mBAAmB,EAAE,OAAO,IAAI,CAAC,CAAC,CAAC;4FAC7C,QAAQ;4FACR,MAAM,IAAM,aAAa,UAAU;wFACrC;wFACA,cAAc;oFAChB;oFACA,WAAU;8FACX;;;;;;gFAIF,CAAC,QAAQ,QAAQ,6BAChB,6LAAC;oFACC,SAAS;wFACP,IAAA,sJAAY,EAAC;4FACX,OAAO;4FACP,SAAS,CAAC,IAAI,EAAE,OAAO,IAAI,CAAC,WAAW,CAAC;4FACxC,QAAQ;4FACR,MAAM,IAAM,aAAa,QAAQ;wFACnC;wFACA,cAAc;oFAChB;oFACA,WAAU;8FACX;;;;;;;;;;;;;;;;;;;;wDAWZ,2BACC,6LAAC;4DAAI,WAAU;sEACb,cAAA,6LAAC;gEAAI,WAAU;;;;;;;;;;;;mDArKd;;;;;4CA0KX;4CAEC,eAAe,MAAM,KAAK,mBACzB,6LAAC;gDAAI,WAAU;;kEACb,6LAAC,6JAAQ;wDAAC,WAAU;;;;;;kEACpB,6LAAC;wDAAE,WAAU;kEAAsB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAU9C,sCACC,6LAAC,iKAAgB;gBACf,MAAK;gBACL,gBAAgB;gBAChB,mBAAmB;gBACnB,aAAa;gBACb,UAAU;gBACV,SAAS,IAAM,wBAAwB;gBACvC,QAAQ;gBACR,gBAAgB;gBAChB,gBAAgB,IAAM,wBAAwB;;;;;;;;;;;;IAKtD,MAAM,SACJ,aAAa,OAAO,aAAa,cAAc,SAAS,cAAc,CAAC,6BAA6B;IACtG,OAAO,aAAa,uBAAS,IAAA,oLAAY,EAAC,WAAW,UAAU;AACjE;GAntBwB;;QA4BR,kJAAQ;QACP,kJAAS;;;KA7BF"}},
    {"offset": {"line": 4136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/PinMessageTitleModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { HiMapPin, HiXMark } from 'react-icons/hi2';\r\n\r\ninterface PinMessageTitleModalProps {\r\n  onClose: () => void;\r\n  onConfirm: (title: string) => void;\r\n}\r\n\r\nexport default function PinMessageTitleModal({\r\n  onClose,\r\n  onConfirm,\r\n}: PinMessageTitleModalProps) {\r\n  const [title, setTitle] = useState('');\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    onConfirm(title);\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n      <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\r\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-100\">\r\n          <h3 className=\"text-lg font-bold text-gray-800 flex items-center gap-2\">\r\n            <HiMapPin className=\"w-5 h-5 text-blue-600\" />\r\n            Ghim tin nhắn\r\n          </h3>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"cursor-pointer p-1.5 hover:bg-gray-100 rounded-full text-gray-500 transition-colors\"\r\n          >\r\n            <HiXMark className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"p-4\">\r\n          <p className=\"text-sm text-gray-600 mb-3\">\r\n            Bạn có thể đặt tiêu đề cho tin nhắn ghim này (tùy chọn):\r\n          </p>\r\n          <input\r\n            type=\"text\"\r\n            value={title}\r\n            onChange={(e) => setTitle(e.target.value)}\r\n            placeholder=\"Nhập tiêu đề...\"\r\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm\"\r\n            autoFocus\r\n          />\r\n          \r\n          <div className=\"flex justify-end gap-2 mt-5\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"cursor-pointer px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\"\r\n            >\r\n              Hủy\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"cursor-pointer px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors shadow-sm\"\r\n            >\r\n              Ghim\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;AAOe,SAAS,qBAAqB,EAC3C,OAAO,EACP,SAAS,EACiB;;IAC1B,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IAEnC,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,UAAU;IACZ;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;;8CACZ,6LAAC,8JAAQ;oCAAC,WAAU;;;;;;gCAA0B;;;;;;;sCAGhD,6LAAC;4BACC,SAAS;4BACT,WAAU;sCAEV,cAAA,6LAAC,6JAAO;gCAAC,WAAU;;;;;;;;;;;;;;;;;8BAIvB,6LAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACtC,6LAAC;4BAAE,WAAU;sCAA6B;;;;;;sCAG1C,6LAAC;4BACC,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;4BACxC,aAAY;4BACZ,WAAU;4BACV,SAAS;;;;;;sCAGX,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,MAAK;oCACL,SAAS;oCACT,WAAU;8CACX;;;;;;8CAGD,6LAAC;oCACC,MAAK;oCACL,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQb;GA3DwB;KAAA"}},
    {"offset": {"line": 4281, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/PinnedMessageListModal.tsx"],"sourcesContent":["// ui/base/PinnedMessageListModal.tsx\r\n\r\nimport React from 'react';\r\nimport { Message } from '../../types/Message';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl } from '@/utils/utils';\r\n\r\n// React Icons – chuẩn Zalo, đẹp, nhẹ\r\nimport { HiMapPin, HiXMark } from 'react-icons/hi2';\r\nimport { HiLink } from 'react-icons/hi';\r\n\r\ninterface Props {\r\n  messages: Message[];\r\n  onClose: () => void;\r\n  onJumpToMessage: (messageId: string) => void;\r\n  onGetSenderName: (sender: string | Message['sender']) => string;\r\n  onGetContentDisplay: (msg: Message) => string | React.ReactNode;\r\n  onUnpinMessage: (msg: Message) => void;\r\n  hasMore: boolean;\r\n  onLoadMore: () => void;\r\n  loadingMore?: boolean;\r\n}\r\n\r\nexport default function PinnedMessageListModal({\r\n  messages,\r\n  onClose,\r\n  onJumpToMessage,\r\n  onGetSenderName,\r\n  onGetContentDisplay,\r\n  onUnpinMessage,\r\n  hasMore,\r\n  onLoadMore,\r\n  loadingMore,\r\n}: Props) {\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n      {/* Modal */}\r\n      <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-md h-[82vh] max-h-[40rem] sm:max-h-[50rem] mx-4 flex flex-col overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-5 border-b border-gray-200 bg-gradient-to-r from-yellow-50 to-amber-50 sticky top-0 z-10\">\r\n          <h3 className=\"flex items-center gap-2.5 text-lg font-bold text-yellow-800\">\r\n            <HiMapPin className=\"w-6 h-6 text-yellow-600 rotate-45\" />\r\n            Tin nhắn đã ghim\r\n            <span className=\"ml-2 px-2.5 py-0.5 bg-yellow-200 text-yellow-800 text-xs font-bold rounded-full\">\r\n              {messages.length}\r\n            </span>\r\n          </h3>\r\n\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 cursor-pointer rounded-full hover:bg-white/80 transition-all hover:scale-110\"\r\n            title=\"Đóng\"\r\n          >\r\n            <HiXMark className=\"w-6 h-6 text-gray-600\" />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar\">\r\n          {messages.length === 0 ? (\r\n            <div className=\"text-center py-16 text-gray-400\">\r\n              <HiMapPin className=\"w-16 h-16 mx-auto mb-4 text-gray-300\" />\r\n              <p className=\"text-base\">Chưa có tin nhắn nào được ghim</p>\r\n            </div>\r\n          ) : (\r\n            messages.map((msg) => (\r\n              <div\r\n                key={msg._id}\r\n                onClick={() => {\r\n                  onJumpToMessage(msg._id);\r\n                  onClose();\r\n                }}\r\n                className=\"relative group p-4 bg-gradient-to-r from-yellow-50 to-white rounded-xl border border-yellow-200 hover:border-yellow-400 hover:shadow-md cursor-pointer transition-all duration-200\"\r\n              >\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <div className=\"flex items-center gap-2 flex-wrap\">\r\n                    <span className=\"font-semibold text-yellow-800 text-sm\">{onGetSenderName(msg.sender)}</span>\r\n                    <span\r\n                      className={`text-[0.6875rem] px-2 py-0.5 rounded-md font-semibold ${\r\n                        msg.type === 'poll'\r\n                          ? 'bg-yellow-100 text-yellow-800'\r\n                          : msg.type === 'reminder'\r\n                            ? 'bg-blue-100 text-blue-800'\r\n                            : msg.type === 'image'\r\n                              ? 'bg-pink-100 text-pink-800'\r\n                              : msg.type === 'video'\r\n                                ? 'bg-blue-100 text-blue-800'\r\n                                : msg.type === 'file'\r\n                                  ? 'bg-gray-100 text-gray-800'\r\n                                  : msg.type === 'sticker'\r\n                                    ? 'bg-indigo-100 text-indigo-800'\r\n                                    : 'bg-gray-100 text-gray-700'\r\n                      }`}\r\n                    >\r\n                      {msg.pinnedTitle ||\r\n                        (msg.type === 'poll'\r\n                          ? 'Bình chọn'\r\n                          : msg.type === 'reminder'\r\n                            ? 'Lịch hẹn'\r\n                            : msg.type === 'image'\r\n                              ? 'Ảnh'\r\n                              : msg.type === 'video'\r\n                                ? 'Video'\r\n                                : msg.type === 'file'\r\n                                  ? 'File'\r\n                                  : msg.type === 'sticker'\r\n                                    ? 'Sticker'\r\n                                    : 'Tin nhắn')}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-xs text-gray-500 whitespace-nowrap\">\r\n                      {new Date(msg.timestamp).toLocaleDateString('vi-VN', {\r\n                        day: 'numeric',\r\n                        month: 'short',\r\n                        year: 'numeric',\r\n                      })}\r\n                    </span>\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        onUnpinMessage(msg);\r\n                      }}\r\n                      className=\"px-2 py-1 text-[0.74rem] rounded-lg border border-red-300 text-red-700 hover:bg-red-50 cursor-pointer whitespace-nowrap\"\r\n                    >\r\n                      Bỏ ghim\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Nội dung / Preview */}\r\n                {msg.isRecalled ? (\r\n                  <div className=\"text-sm text-gray-500 italic\">đã thu hồi tin nhắn</div>\r\n                ) : (\r\n                  <>\r\n                    {msg.type === 'image' && msg.fileUrl ? (\r\n                      <div className=\"mt-1\">\r\n                        <div className=\"relative  overflow-hidden border border-gray-200 shadow-sm w-full max-w-[2rem]\">\r\n                          <Image\r\n                            src={getProxyUrl(msg.fileUrl)}\r\n                            alt=\"Ảnh\"\r\n                            width={320}\r\n                            height={240}\r\n                            className=\"w-full h-full object-cover\"\r\n                            unoptimized={String(msg.fileUrl).includes('mega.nz')}\r\n                          />\r\n                        </div>\r\n                        {msg.content && (\r\n                          <div className=\"mt-2 text-sm text-gray-700 line-clamp-3 leading-relaxed\">{msg.content}</div>\r\n                        )}\r\n                      </div>\r\n                    ) : msg.type === 'video' && msg.fileUrl ? (\r\n                      <div className=\"mt-1\">\r\n                        <div className=\"relative rounded-xl overflow-hidden border border-gray-200 shadow-sm w-full max-w-[6rem] bg-black\">\r\n                          <video\r\n                            src={getProxyUrl(msg.fileUrl)}\r\n                            className=\"w-full h-full object-cover\"\r\n                            muted\r\n                            playsInline\r\n                            preload=\"metadata\"\r\n                          />\r\n                          <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                            <div className=\"w-6 h-6 rounded-full bg-white/80 flex items-center justify-center\">\r\n                              <svg viewBox=\"0 0 24 24\" className=\"w-5 h-5 text-gray-800\">\r\n                                <path d=\"M8 5v14l11-7z\" fill=\"currentColor\" />\r\n                              </svg>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        {msg.content && (\r\n                          <div className=\"mt-2 text-sm text-gray-700 line-clamp-3 leading-relaxed\">{msg.content}</div>\r\n                        )}\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"text-sm text-gray-700 line-clamp-3 leading-relaxed\">\r\n                        {onGetContentDisplay(msg)}\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                )}\r\n\r\n                {/* Link preview cho tin nhắn text */}\r\n                {msg.type === 'text' &&\r\n                  !msg.isRecalled &&\r\n                  (() => {\r\n                    const linkMatch = (msg.content || '').match(/(https?:\\/\\/|www\\.)\\S+/i);\r\n                    if (!linkMatch) return null;\r\n                    const raw = linkMatch[0];\r\n                    const href = raw.startsWith('http') ? raw : `https://${raw}`;\r\n                    const hostname = (() => {\r\n                      try {\r\n                        return new URL(href).hostname.replace('www.', '');\r\n                      } catch {\r\n                        return 'Website';\r\n                      }\r\n                    })();\r\n                    return (\r\n                      <div className=\"mt-2 rounded-xl shadow-xl bg-white overflow-hidden\">\r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            window.open(href, '_blank');\r\n                          }}\r\n                          className=\"w-full text-left p-3 flex items-center gap-3 cursor-pointer hover:bg-gray-50\"\r\n                        >\r\n                          <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-sky-500 via-blue-500 to-blue-500 text-white\">\r\n                            <HiLink className=\"w-5 h-5\" />\r\n                          </div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"text-sm font-semibold text-purple-600 truncate\">{raw}</p>\r\n                            <p className=\"text-xs text-gray-500 mt-0.5\">{hostname}</p>\r\n                          </div>\r\n                        </button>\r\n                      </div>\r\n                    );\r\n                  })()}\r\n\r\n                {/* Hiệu ứng nhấn */}\r\n                <div className=\"absolute inset-0 rounded-xl ring-2 ring-yellow-400 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\" />\r\n              </div>\r\n            ))\r\n          )}\r\n          {hasMore && (\r\n            <div className=\"flex justify-center\">\r\n              <button\r\n                onClick={onLoadMore}\r\n                disabled={loadingMore}\r\n                className=\"px-3 py-1.5 text-xs rounded-lg border border-yellow-300 bg-yellow-50 text-yellow-800 hover:bg-yellow-100 cursor-pointer disabled:opacity-60\"\r\n              >\r\n                {loadingMore ? 'Đang tải...' : 'Xem thêm'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"p-3 text-center text-xs text-gray-400 border-t border-gray-100 bg-gray-50\">\r\n          Nhấn vào tin nhắn để nhảy đến vị trí gốc\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}