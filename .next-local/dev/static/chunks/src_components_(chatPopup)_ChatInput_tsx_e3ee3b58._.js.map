{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/ChatInput.tsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React, { ClipboardEvent, KeyboardEvent, RefObject, useEffect, useRef, useState, useMemo } from 'react';\r\nimport { createPortal } from 'react-dom';\r\n\r\n// React Icons hi2 ‚Äì ƒê·ªânh cao nh·∫•t 2025\r\nimport {\r\n  HiFaceSmile,\r\n  HiPaperClip,\r\n  HiPhoto,\r\n  HiMicrophone,\r\n  HiPaperAirplane,\r\n  HiSparkles,\r\n  HiFolder,\r\n  HiEllipsisHorizontal,\r\n  HiMapPin,\r\n  HiChartBar,\r\n  HiIdentification,\r\n  HiPencil,\r\n  HiHandThumbUp,\r\n  HiCalendar,\r\n  HiClock,\r\n  HiShieldCheck,\r\n  HiTrash,\r\n  HiCheck,\r\n} from 'react-icons/hi2';\r\nimport {\r\n  CiCircleMore,\r\n  CiCreditCard2,\r\n  CiEdit,\r\n  CiFaceSmile,\r\n  CiFileOn,\r\n  CiImageOn,\r\n  CiInstagram,\r\n  CiPen,\r\n} from 'react-icons/ci';\r\nimport { HiDocumentText, HiLightningBolt, HiSearch, HiX } from 'react-icons/hi';\r\nimport { IoIosAttach } from 'react-icons/io';\r\nimport Image from 'next/image';\r\nimport { useChatContext } from '@/context/ChatContext';\r\n\r\nimport UploadProgressBar from '@/components/(chatPopup)/UploadProgressBar';\r\nimport ICIcon1 from '@/components/svg/ICIcon1';\r\nimport ImageIconZalo from '@/components/svg/ICIconImageZalo';\r\nimport MicIcon from '@/components/svg/MicIcon';\r\nimport IconFile from '@/components/svg/IConFile';\r\nimport ICFolder from '@/components/svg/ICFolder';\r\nimport { AiTwotoneLike } from 'react-icons/ai';\r\nimport CreatePollModal from './components/CreatePollModal';\r\nimport CreateReminderModal from './components/CreateReminderModal';\r\nimport { createMessageApi } from '@/fetch/messages';\r\nimport { Socket } from 'socket.io-client';\r\nimport { GroupConversation, GroupRole } from '@/types/Group';\r\nimport { User } from '@/types/User';\r\nimport type { MessageCreate } from '@/types/Message';\r\nimport { useToast } from '@/components/base/toast';\r\nimport { ConfirmModal } from '../ui/ConfirmModal';\r\nimport { accentAwareIncludes, getProxyUrl, normalizeNoAccent } from '@/utils/utils';\r\n\r\ninterface ChatInputProps {\r\n  socket?: Socket | null;\r\n  showEmojiPicker: boolean;\r\n  onToggleEmojiPicker: () => void;\r\n  isListening: boolean;\r\n  onVoiceInput: () => void;\r\n  editableRef: RefObject<HTMLDivElement | null>;\r\n  onInputEditable: () => void;\r\n  onKeyDownEditable: (e: KeyboardEvent<HTMLDivElement>) => void;\r\n  onPasteEditable: (e: ClipboardEvent<HTMLDivElement>) => void;\r\n  onFocusEditable: () => void;\r\n  onSendMessage: () => void;\r\n  onSendMessageData?: (data: MessageCreate) => Promise<void>;\r\n  onSelectImage: (file: File) => void;\r\n  onSelectFile: (file: File) => void;\r\n  onAttachFromFolder: (att: { url: string; type: 'image' | 'video' | 'file'; fileName?: string }) => void;\r\n  attachments: { previewUrl: string; type: 'image' | 'video' | 'file'; fileName?: string }[];\r\n  onRemoveAttachment: (index: number) => void;\r\n  onClearAttachments: () => void;\r\n  isUploading?: boolean;\r\n  uploadingCount?: number;\r\n  overallUploadPercent?: number;\r\n}\r\n\r\nexport default function ChatInput({\r\n  socket,\r\n  onToggleEmojiPicker,\r\n  isListening,\r\n  onVoiceInput,\r\n  editableRef,\r\n  onInputEditable,\r\n  onKeyDownEditable,\r\n  onPasteEditable,\r\n  onFocusEditable,\r\n  onSendMessage,\r\n  onSendMessageData,\r\n  onSelectImage,\r\n  onSelectFile,\r\n  onAttachFromFolder,\r\n  attachments,\r\n  onRemoveAttachment,\r\n  onClearAttachments,\r\n  isUploading = false,\r\n  uploadingCount = 0,\r\n  overallUploadPercent = 0,\r\n}: ChatInputProps) {\r\n  const { currentUser, selectedChat, isGroup, allUsers } = useChatContext();\r\n  const showToast = useToast();\r\n\r\n  const myRole = useMemo(() => {\r\n    if (!isGroup) return 'MEMBER';\r\n    const group = selectedChat as GroupConversation;\r\n    if (!group.members || !Array.isArray(group.members)) return 'MEMBER';\r\n\r\n    const myId = String(currentUser._id || (currentUser as { id?: string })?.id || '');\r\n    const member = group.members.find((m) => {\r\n      const mId = typeof m === 'string' ? m : m._id || (m as { id?: string }).id;\r\n      return String(mId) === myId;\r\n    });\r\n\r\n    if (member && typeof member !== 'string') {\r\n      return (member.role || 'MEMBER') as GroupRole;\r\n    }\r\n    return 'MEMBER';\r\n  }, [isGroup, selectedChat, currentUser]);\r\n\r\n  const canClearHistory = !isGroup || (isGroup && myRole === 'OWNER');\r\n\r\n  const getId = (u: unknown): string => {\r\n    const obj = u as { _id?: unknown; id?: unknown };\r\n    if (obj && (obj._id != null || obj.id != null)) return String((obj._id ?? obj.id) as unknown);\r\n    return String(u ?? '');\r\n  };\r\n  const roomId = isGroup ? getId(selectedChat) : [getId(currentUser), getId(selectedChat)].sort().join('_');\r\n\r\n  const [showCreatePoll, setShowCreatePoll] = useState(false);\r\n  const [showCreateNote, setShowCreateNote] = useState(false);\r\n  const [createLoading, setCreateLoading] = useState(false);\r\n  const tagsContainerRef = useRef<HTMLDivElement | null>(null);\r\n  const tagsDragRef = useRef<{ active: boolean; startX: number; startScroll: number; pid?: number }>({\r\n    active: false,\r\n    startX: 0,\r\n    startScroll: 0,\r\n  });\r\n  const onTagsPointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\r\n    const el = tagsContainerRef.current;\r\n    if (!el) return;\r\n    tagsDragRef.current.active = true;\r\n    tagsDragRef.current.startX = e.clientX;\r\n    tagsDragRef.current.startScroll = el.scrollLeft;\r\n    tagsDragRef.current.pid = e.pointerId;\r\n    el.setPointerCapture(e.pointerId);\r\n  };\r\n  const onTagsPointerMove = (e: React.PointerEvent<HTMLDivElement>) => {\r\n    if (!tagsDragRef.current.active) return;\r\n    const el = tagsContainerRef.current;\r\n    if (!el) return;\r\n    const dx = e.clientX - tagsDragRef.current.startX;\r\n    el.scrollLeft = tagsDragRef.current.startScroll - dx;\r\n    e.preventDefault();\r\n  };\r\n  const onTagsPointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\r\n    const el = tagsContainerRef.current;\r\n    tagsDragRef.current.active = false;\r\n    if (el && typeof tagsDragRef.current.pid === 'number') {\r\n      try {\r\n        el.releasePointerCapture(tagsDragRef.current.pid);\r\n      } catch {}\r\n    }\r\n  };\r\n\r\n  const handleCreatePoll = async ({\r\n    question,\r\n    options,\r\n    pollAllowMultiple,\r\n    pollAllowAddOptions,\r\n    pollHideVoters,\r\n    pollHideResultsUntilVote,\r\n    pollEndAt,\r\n  }: {\r\n    question: string;\r\n    options: string[];\r\n    pollAllowMultiple?: boolean;\r\n    pollAllowAddOptions?: boolean;\r\n    pollHideVoters?: boolean;\r\n    pollHideResultsUntilVote?: boolean;\r\n    pollEndAt?: number | null;\r\n  }) => {\r\n    const q = question.trim();\r\n    if (!q) return;\r\n\r\n    try {\r\n      const createRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'poll',\r\n        content: q,\r\n        timestamp: Date.now(),\r\n        pollQuestion: q,\r\n        pollOptions: options,\r\n        pollVotes: {},\r\n        isPollLocked: false,\r\n        pollAllowMultiple,\r\n        pollAllowAddOptions,\r\n        pollHideVoters,\r\n        pollHideResultsUntilVote,\r\n        pollEndAt: pollEndAt ?? null,\r\n      });\r\n\r\n      if (createRes?.success) {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const sockBase = {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n        };\r\n\r\n        if (typeof createRes._id === 'string') {\r\n          socket?.emit('send_message', {\r\n            ...sockBase,\r\n            _id: createRes._id,\r\n            type: 'poll',\r\n            content: q,\r\n            timestamp: Date.now(),\r\n            pollQuestion: q,\r\n            pollOptions: options,\r\n            pollVotes: {},\r\n            isPollLocked: false,\r\n            pollAllowMultiple,\r\n            pollAllowAddOptions,\r\n            pollHideVoters,\r\n            pollHideResultsUntilVote,\r\n            pollEndAt: pollEndAt ?? null,\r\n          });\r\n\r\n          // Notify\r\n          const notify = await createMessageApi({\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            type: 'notify',\r\n            content: `${currentUser.name} t·∫°o cu·ªôc b√¨nh ch·ªçn m·ªõi: \"${q}\"`,\r\n            timestamp: Date.now(),\r\n            replyToMessageId: createRes._id,\r\n          });\r\n          if (notify?.success) {\r\n            socket?.emit('send_message', {\r\n              ...sockBase,\r\n              _id: notify._id,\r\n              type: 'notify',\r\n              content: `${currentUser.name} t·∫°o cu·ªôc b√¨nh ch·ªçn m·ªõi: \"${q}\"`,\r\n              timestamp: Date.now(),\r\n              replyToMessageId: createRes._id,\r\n            });\r\n          }\r\n        }\r\n        setShowCreatePoll(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to create poll:', error);\r\n    }\r\n  };\r\n\r\n  const handleCreateNote = async ({\r\n    content,\r\n    dateTime,\r\n    note,\r\n    repeat,\r\n  }: {\r\n    content: string;\r\n    dateTime: string;\r\n    note?: string;\r\n    repeat?: 'none' | 'daily' | 'weekly' | 'monthly';\r\n  }) => {\r\n    setCreateLoading(true);\r\n    const dt = Date.parse(dateTime);\r\n    if (!content.trim() || Number.isNaN(dt)) {\r\n      alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin h·ª£p l·ªá');\r\n      setCreateLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const createRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'reminder',\r\n        content: content.trim(),\r\n        timestamp: Date.now(),\r\n        reminderAt: dt,\r\n        reminderNote: note?.trim() || '',\r\n        reminderFired: false,\r\n        reminderRepeat: repeat || 'none',\r\n      });\r\n\r\n      if (createRes?.success) {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const sockBase = {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n        };\r\n\r\n        if (typeof createRes._id === 'string') {\r\n          socket?.emit('send_message', {\r\n            ...sockBase,\r\n            _id: createRes._id,\r\n            type: 'reminder',\r\n            content: content.trim(),\r\n            timestamp: Date.now(),\r\n            reminderAt: dt,\r\n            reminderNote: note?.trim() || '',\r\n            reminderFired: false,\r\n            reminderRepeat: repeat || 'none',\r\n          });\r\n\r\n          // Notify\r\n          const notify = await createMessageApi({\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            type: 'notify',\r\n            content: `${currentUser.name} t·∫°o l·ªãch h·∫πn m·ªõi: \"${content.trim()}\"`,\r\n            timestamp: Date.now(),\r\n            replyToMessageId: createRes._id,\r\n          });\r\n          if (notify?.success) {\r\n            socket?.emit('send_message', {\r\n              ...sockBase,\r\n              _id: notify._id,\r\n              type: 'notify',\r\n              content: `${currentUser.name} t·∫°o l·ªãch h·∫πn m·ªõi: \"${content.trim()}\"`,\r\n              timestamp: Date.now(),\r\n              replyToMessageId: createRes._id,\r\n            });\r\n          }\r\n        }\r\n        setShowCreateNote(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to create reminder:', error);\r\n    } finally {\r\n      setCreateLoading(false);\r\n    }\r\n  };\r\n\r\n  const [showFlashPicker, setShowFlashPicker] = useState(false);\r\n  const [flashFolders, setFlashFolders] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [selectedFlashFolder, setSelectedFlashFolder] = useState<{ id: string; name: string } | null>(null);\r\n  const [kvItems, setKvItems] = useState<Array<{ key: string; value: string }>>([]);\r\n  const [slashOpen, setSlashOpen] = useState(false);\r\n  const [slashQuery, setSlashQuery] = useState('');\r\n  const [slashSelectedIndex, setSlashSelectedIndex] = useState<number>(0);\r\n  const [showFolderDashboard, setShowFolderDashboard] = useState(false);\r\n  const [pendingSaveMessage, setPendingSaveMessage] = useState<{\r\n    roomId: string;\r\n    messageId: string;\r\n    content: string;\r\n    type: string;\r\n    fileUrl?: string;\r\n    fileName?: string;\r\n  } | null>(null);\r\n\r\n  const [showMobileActions, setShowMobileActions] = useState(false);\r\n  const mobileActionsRef = useRef<HTMLDivElement | null>(null);\r\n  const toggleMobileActionsBtnRef = useRef<HTMLButtonElement | null>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const pendingFocusRef = useRef(false);\r\n  const allowFocusRef = useRef(true);\r\n  const [hasContent, setHasContent] = useState(false);\r\n  const [showUpdatingPopup, setShowUpdatingPopup] = useState(false);\r\n  const [showConfirmClear, setShowConfirmClear] = useState(false);\r\n  const [showReportConfirm, setShowReportConfirm] = useState(false);\r\n  const [showContactCardModal, setShowContactCardModal] = useState(false);\r\n  const [contactCardSearch, setContactCardSearch] = useState('');\r\n  const [activeContactCategory, setActiveContactCategory] = useState<string>('all');\r\n  const [selectedContactCardIds, setSelectedContactCardIds] = useState<string[]>([]);\r\n  const contactCategoryBarRef = useRef<HTMLDivElement | null>(null);\r\n  const contactCategoryDragRef = useRef<{ active: boolean; startX: number; startScrollLeft: number; moved: boolean }>({\r\n    active: false,\r\n    startX: 0,\r\n    startScrollLeft: 0,\r\n    moved: false,\r\n  });\r\n\r\n  const myId = String(currentUser._id || '');\r\n  const [categoryTags, setCategoryTags] = useState<Array<{ id: string; label: string; color: string }>>([]);\r\n\r\n  useEffect(() => {\r\n    const loadCategoryTags = async () => {\r\n      if (!currentUser?._id) return;\r\n\r\n      if (Array.isArray(currentUser.categoryTags)) {\r\n        setCategoryTags(\r\n          currentUser.categoryTags.filter(\r\n            (x): x is { id: string; label: string; color: string } => !!x && typeof x.id === 'string',\r\n          ),\r\n        );\r\n      }\r\n\r\n      try {\r\n        const res = await fetch('/api/users', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'getById', _id: String(currentUser._id) }),\r\n        });\r\n        const data = await res.json();\r\n        const row = (data && data.row) || (Array.isArray(data?.data) ? data.data[0] : null);\r\n        if (row && Array.isArray(row.categoryTags)) {\r\n          setCategoryTags(\r\n            row.categoryTags.filter(\r\n              (x: unknown): x is { id: string; label: string; color: string } =>\r\n                !!x && typeof x === 'object' && typeof (x as { id?: unknown }).id === 'string',\r\n            ),\r\n          );\r\n        }\r\n      } catch {}\r\n    };\r\n\r\n    loadCategoryTags();\r\n\r\n    const handleUserCategoryTagsUpdated = (e: Event) => {\r\n      const ev = e as CustomEvent<{ userId: string; tags: { id: string; label: string; color: string }[] }>;\r\n      if (ev.detail && String(ev.detail.userId) === String(currentUser?._id)) {\r\n        setCategoryTags(Array.isArray(ev.detail.tags) ? ev.detail.tags : []);\r\n      }\r\n    };\r\n    window.addEventListener('userCategoryTagsUpdated', handleUserCategoryTagsUpdated as EventListener);\r\n    return () => window.removeEventListener('userCategoryTagsUpdated', handleUserCategoryTagsUpdated as EventListener);\r\n  }, [currentUser?._id, currentUser?.categoryTags]);\r\n\r\n  useEffect(() => {\r\n    if (activeContactCategory === 'all') return;\r\n    if (categoryTags.some((t) => t.id === activeContactCategory)) return;\r\n    setActiveContactCategory('all');\r\n  }, [activeContactCategory, categoryTags]);\r\n\r\n  const handleContactCategoryPointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\r\n    if (e.pointerType === 'mouse' && e.button !== 0) return;\r\n    const el = contactCategoryBarRef.current;\r\n    if (!el) return;\r\n    contactCategoryDragRef.current = {\r\n      active: true,\r\n      startX: e.clientX,\r\n      startScrollLeft: el.scrollLeft,\r\n      moved: false,\r\n    };\r\n    try {\r\n      el.setPointerCapture(e.pointerId);\r\n    } catch {}\r\n  };\r\n\r\n  const handleContactCategoryPointerMove = (e: React.PointerEvent<HTMLDivElement>) => {\r\n    const el = contactCategoryBarRef.current;\r\n    const drag = contactCategoryDragRef.current;\r\n    if (!el || !drag.active) return;\r\n    const dx = e.clientX - drag.startX;\r\n    if (!drag.moved && Math.abs(dx) > 4) {\r\n      contactCategoryDragRef.current = { ...drag, moved: true };\r\n    }\r\n    el.scrollLeft = drag.startScrollLeft - dx;\r\n  };\r\n\r\n  const handleContactCategoryPointerEnd = (e: React.PointerEvent<HTMLDivElement>) => {\r\n    const el = contactCategoryBarRef.current;\r\n    const drag = contactCategoryDragRef.current;\r\n    if (!drag.active) return;\r\n    contactCategoryDragRef.current = { ...drag, active: false };\r\n    try {\r\n      el?.releasePointerCapture(e.pointerId);\r\n    } catch {}\r\n  };\r\n\r\n  const handleContactCategoryClickCapture = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (!contactCategoryDragRef.current.moved) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    contactCategoryDragRef.current = { ...contactCategoryDragRef.current, moved: false };\r\n  };\r\n\r\n  const getContactDisplayName = (u: User): string => {\r\n    const nick = (u.nicknames && typeof u.nicknames === 'object' ? u.nicknames[myId] : '') as string | undefined;\r\n    return String(nick || u.name || u.username || 'Ng∆∞·ªùi d√πng').trim();\r\n  };\r\n\r\n  const getContactCategories = (u: User): string[] => {\r\n    const by =\r\n      (u as unknown as { categoriesBy?: Record<string, string[]> }).categoriesBy?.[myId] ||\r\n      ((u as unknown as { categories?: string[] }).categories as string[] | undefined) ||\r\n      [];\r\n    if (!Array.isArray(by)) return [];\r\n    return by.filter((x): x is string => typeof x === 'string' && x.length > 0);\r\n  };\r\n\r\n  const filteredContactUsers = useMemo(() => {\r\n    const term = String(contactCardSearch || '').trim();\r\n    const active = activeContactCategory;\r\n    const base = Array.isArray(allUsers) ? allUsers : [];\r\n\r\n    const filtered = base.filter((u) => {\r\n      if (!u || typeof u !== 'object') return false;\r\n      if ((u as unknown as { isHidden?: boolean }).isHidden) return false;\r\n      if (active !== 'all') {\r\n        const cats = getContactCategories(u);\r\n        if (!cats.includes(active)) return false;\r\n      }\r\n      if (!term) return true;\r\n      const displayName = getContactDisplayName(u);\r\n      const username = String(u.username || '');\r\n      return accentAwareIncludes(displayName, term) || accentAwareIncludes(username, term);\r\n    });\r\n\r\n    filtered.sort((a, b) => getContactDisplayName(a).localeCompare(getContactDisplayName(b), 'vi'));\r\n    return filtered;\r\n  }, [allUsers, contactCardSearch, activeContactCategory, myId]);\r\n\r\n  const groupedContactUsers = useMemo(() => {\r\n    const map = new Map<string, User[]>();\r\n    filteredContactUsers.forEach((u) => {\r\n      const name = getContactDisplayName(u);\r\n      const keyRaw = normalizeNoAccent(name || '').trim();\r\n      const ch = keyRaw ? keyRaw[0].toUpperCase() : '#';\r\n      const key = /[A-Z]/.test(ch) ? ch : '#';\r\n      const arr = map.get(key) || [];\r\n      arr.push(u);\r\n      map.set(key, arr);\r\n    });\r\n    const keys = Array.from(map.keys()).sort((a, b) => (a === '#' ? 1 : b === '#' ? -1 : a.localeCompare(b)));\r\n    return keys.map((k) => ({ key: k, users: map.get(k) || [] }));\r\n  }, [filteredContactUsers]);\r\n\r\n  // --- TAGS LOGIC ---\r\n  const TAG_COLORS: Record<string, string> = {\r\n    'bg-red-500': '#ef4444',\r\n    'bg-pink-500': '#ec4899',\r\n    'bg-orange-400': '#fb923c',\r\n    'bg-yellow-400': '#facc15',\r\n    'bg-green-500': '#22c55e',\r\n    'bg-teal-500': '#14b8a6',\r\n    'bg-blue-500': '#3b82f6',\r\n    'bg-purple-500': '#a855f7',\r\n  };\r\n\r\n  const [userTags, setUserTags] = useState<Array<{ id: string; label: string; color: string }>>([]);\r\n  const [selectedTagIds, setSelectedTagIds] = useState<string[]>([]);\r\n  const tagStorageKey = useMemo(() => {\r\n    if (!selectedChat?._id || !currentUser?._id) return '';\r\n    return `chatTags:${currentUser._id}:${selectedChat._id}`;\r\n  }, [selectedChat?._id, currentUser?._id]);\r\n\r\n  // Load User Tags\r\n  useEffect(() => {\r\n    const loadUserTags = async () => {\r\n      if (!currentUser?._id) return;\r\n      // 1. From currentUser prop if available (via context)\r\n      if (currentUser.userTags && Array.isArray(currentUser.userTags)) {\r\n        setUserTags(currentUser.userTags);\r\n      }\r\n\r\n      // 2. Or fetch fresh\r\n      try {\r\n        const res = await fetch('/api/users', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'getById', _id: String(currentUser._id) }),\r\n        });\r\n        const data = await res.json();\r\n        const row = (data && data.row) || (Array.isArray(data?.data) ? data.data[0] : null);\r\n        if (row && Array.isArray(row.userTags)) {\r\n          setUserTags(row.userTags);\r\n        }\r\n      } catch {}\r\n    };\r\n    loadUserTags();\r\n\r\n    const handleUserTagsUpdated = (e: Event) => {\r\n      const ev = e as CustomEvent<{ userId: string; tags: { id: string; label: string; color: string }[] }>;\r\n      if (ev.detail && String(ev.detail.userId) === String(currentUser?._id)) {\r\n        setUserTags(ev.detail.tags || []);\r\n      }\r\n    };\r\n    window.addEventListener('userTagsUpdated', handleUserTagsUpdated as EventListener);\r\n    return () => window.removeEventListener('userTagsUpdated', handleUserTagsUpdated as EventListener);\r\n  }, [currentUser?._id]);\r\n\r\n  // Load Selected Tags for Chat\r\n  useEffect(() => {\r\n    if (!tagStorageKey) return;\r\n\r\n    // 1. Try from selectedChat prop\r\n    const fromServer =\r\n      (selectedChat as unknown as { tags?: string[] }).tags ||\r\n      (selectedChat as unknown as { tagsBy?: Record<string, string[]> }).tagsBy?.[String(currentUser._id)] ||\r\n      [];\r\n\r\n    if (Array.isArray(fromServer) && fromServer.length > 0) {\r\n      setSelectedTagIds(fromServer.filter((x) => typeof x === 'string'));\r\n    } else {\r\n      // 2. Local storage\r\n      try {\r\n        const raw = localStorage.getItem(tagStorageKey);\r\n        if (raw) {\r\n          const arr = JSON.parse(raw);\r\n          if (Array.isArray(arr)) setSelectedTagIds(arr);\r\n        } else {\r\n          setSelectedTagIds([]);\r\n        }\r\n      } catch {\r\n        setSelectedTagIds([]);\r\n      }\r\n    }\r\n  }, [tagStorageKey, selectedChat]);\r\n\r\n  // Listen for chat tag updates (from ChatItem or Sidebar)\r\n  useEffect(() => {\r\n    const handler = (ev: Event) => {\r\n      try {\r\n        const anyEv = ev as unknown as { detail?: { userId?: string; roomId?: string; tags?: string[] } };\r\n        const detail = anyEv.detail || {};\r\n        if (String(detail.userId) !== String(currentUser._id)) return;\r\n        if (String(detail.roomId) !== String(selectedChat?._id)) return;\r\n        const arr = Array.isArray(detail.tags) ? detail.tags.filter((x: unknown) => typeof x === 'string') : [];\r\n        setSelectedTagIds(arr);\r\n      } catch {}\r\n    };\r\n    window.addEventListener('chatTagsUpdated', handler as EventListener);\r\n    return () => window.removeEventListener('chatTagsUpdated', handler as EventListener);\r\n  }, [currentUser._id, selectedChat?._id]);\r\n\r\n  const handleToggleTag = async (tagId: string) => {\r\n    if (!tagStorageKey) return;\r\n\r\n    const newTags = selectedTagIds.includes(tagId)\r\n      ? selectedTagIds.filter((id) => id !== tagId)\r\n      : [...selectedTagIds, tagId];\r\n\r\n    setSelectedTagIds(newTags);\r\n\r\n    // Update local storage\r\n    try {\r\n      localStorage.setItem(tagStorageKey, JSON.stringify(newTags));\r\n    } catch {}\r\n\r\n    // Dispatch event to update other components\r\n    window.dispatchEvent(\r\n      new CustomEvent('chatTagsUpdated', {\r\n        detail: {\r\n          userId: currentUser._id,\r\n          roomId: selectedChat?._id,\r\n          tags: newTags,\r\n        },\r\n      }),\r\n    );\r\n\r\n    // API Update\r\n    try {\r\n      const isGroupChat = isGroup;\r\n      const apiRoute = isGroupChat ? '/api/groups' : '/api/users';\r\n      const payload = isGroupChat\r\n        ? {\r\n            action: 'updateTags',\r\n            _id: String(currentUser._id),\r\n            conversationId: String(selectedChat?._id),\r\n            data: { tags: newTags },\r\n          }\r\n        : {\r\n            action: 'updateTags',\r\n            currentUserId: String(currentUser._id),\r\n            roomId: String(selectedChat?._id),\r\n            data: { tags: newTags },\r\n          };\r\n      await fetch(apiRoute, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n    } catch (e) {\r\n      console.error('Failed to update tags', e);\r\n    }\r\n  };\r\n\r\n  const handleShowUpdatingPopup = () => {\r\n    setShowUpdatingPopup(true);\r\n    window.setTimeout(() => setShowUpdatingPopup(false), 1500);\r\n  };\r\n\r\n  const checkContent = () => {\r\n    if (editableRef.current) {\r\n      const text = editableRef.current.innerText || '';\r\n      setHasContent(text.trim().length > 0);\r\n    } else {\r\n      setHasContent(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    checkContent();\r\n  }, []);\r\n\r\n  const handleSendWrapper = () => {\r\n    // if (isUploading) return; // üî• Cho ph√©p chat khi ƒëang upload\r\n    onSendMessage();\r\n    // Optimistically update state as parent usually clears input\r\n    setHasContent(false);\r\n    setTimeout(checkContent, 100); // Double check\r\n  };\r\n\r\n  const handleSendContactCard = async () => {\r\n    const ids = selectedContactCardIds.map((x) => String(x)).filter(Boolean);\r\n    if (ids.length === 0) return;\r\n    const base = Array.isArray(allUsers) ? allUsers : [];\r\n    const selectedUsers = ids.map((id) => base.find((u) => String(u._id) === String(id))).filter((u): u is User => !!u);\r\n    if (selectedUsers.length === 0) return;\r\n\r\n    try {\r\n      for (const selectedUser of selectedUsers) {\r\n        const payload: MessageCreate = {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'contact',\r\n          timestamp: Date.now(),\r\n          contactCard: {\r\n            _id: String(selectedUser._id),\r\n            name: getContactDisplayName(selectedUser),\r\n            username: selectedUser.username,\r\n            avatar: selectedUser.avatar,\r\n          },\r\n        };\r\n\r\n        if (onSendMessageData) {\r\n          await onSendMessageData(payload);\r\n        } else {\r\n          const createRes = await createMessageApi(payload);\r\n          if (createRes?.success) {\r\n            const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n            const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n            const sockBase = {\r\n              roomId,\r\n              sender: String(currentUser._id),\r\n              senderName: currentUser.name,\r\n              isGroup,\r\n              receiver,\r\n              members,\r\n            };\r\n\r\n            if (typeof createRes._id === 'string') {\r\n              socket?.emit('send_message', { ...sockBase, ...payload, _id: createRes._id });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } finally {\r\n      setShowContactCardModal(false);\r\n      setSelectedContactCardIds([]);\r\n      setContactCardSearch('');\r\n      setActiveContactCategory('all');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!showMobileActions) return;\r\n    const onDoc = (e: MouseEvent | TouchEvent) => {\r\n      const target = e.target as Node | null;\r\n      if (mobileActionsRef.current && target && mobileActionsRef.current.contains(target)) return;\r\n      if (toggleMobileActionsBtnRef.current && target && toggleMobileActionsBtnRef.current.contains(target)) return;\r\n      setShowMobileActions(false);\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n      } catch {}\r\n    };\r\n    document.addEventListener('mousedown', onDoc, true);\r\n    document.addEventListener('touchstart', onDoc, true);\r\n    return () => {\r\n      document.removeEventListener('mousedown', onDoc, true);\r\n      document.removeEventListener('touchstart', onDoc, true);\r\n    };\r\n  }, [showMobileActions]);\r\n\r\n  useEffect(() => {\r\n    if (!showMobileActions && pendingFocusRef.current) {\r\n      pendingFocusRef.current = false;\r\n      const el = editableRef.current;\r\n      if (el) {\r\n        try {\r\n          requestAnimationFrame(() => {\r\n            try {\r\n              el.focus();\r\n              const range = document.createRange();\r\n              range.selectNodeContents(el);\r\n              range.collapse(false);\r\n              const sel = window.getSelection();\r\n              sel?.removeAllRanges();\r\n              sel?.addRange(range);\r\n            } catch {}\r\n            setTimeout(() => {\r\n              try {\r\n                el.focus();\r\n              } catch {}\r\n            }, 120);\r\n          });\r\n        } catch {}\r\n      }\r\n    }\r\n  }, [showMobileActions]);\r\n\r\n  useEffect(() => {\r\n    const onVisibilityChange = () => {\r\n      if (document.hidden) {\r\n        allowFocusRef.current = false;\r\n        try {\r\n          editableRef.current?.blur?.();\r\n        } catch {}\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', onVisibilityChange);\r\n    return () => document.removeEventListener('visibilitychange', onVisibilityChange);\r\n  }, []);\r\n\r\n  const handleSelectFlashFolder = (f: { id: string; name: string }) => {\r\n    setSelectedFlashFolder(f);\r\n    try {\r\n      localStorage.setItem(`chatFlashActiveFolder:${roomId}`, JSON.stringify(f));\r\n    } catch {}\r\n    setShowFlashPicker(false);\r\n  };\r\n\r\n  const handleToggleMobileActions = () => {\r\n    if (showMobileActions) {\r\n      setShowMobileActions(false);\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n      } catch {}\r\n      return;\r\n    }\r\n\r\n    const el = editableRef.current;\r\n    const isFocused = document.activeElement === el;\r\n    const vv = (\r\n      window as unknown as {\r\n        visualViewport?: {\r\n          height: number;\r\n          addEventListener: (type: string, cb: EventListenerOrEventListenerObject) => void;\r\n          removeEventListener: (type: string, cb: EventListenerOrEventListenerObject) => void;\r\n        };\r\n        innerHeight: number;\r\n      }\r\n    ).visualViewport;\r\n\r\n    const hasKeyboard = isFocused || (vv && vv.height < window.innerHeight * 0.75);\r\n\r\n    if (hasKeyboard) {\r\n      try {\r\n        if (isFocused) el?.blur();\r\n      } catch {}\r\n\r\n      if (vv && typeof vv.addEventListener === 'function') {\r\n        const startH = vv.height;\r\n        let opened = false;\r\n        const open = () => {\r\n          if (opened) return;\r\n          opened = true;\r\n          setShowMobileActions(true);\r\n          try {\r\n            window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: true } }));\r\n          } catch {}\r\n        };\r\n        const onResize: EventListener = () => {\r\n          if (vv.height - startH > 40) {\r\n            try {\r\n              vv.removeEventListener('resize', onResize);\r\n            } catch {}\r\n            window.clearTimeout(timer as number);\r\n            open();\r\n          }\r\n        };\r\n        vv.addEventListener('resize', onResize);\r\n        const timer = window.setTimeout(() => {\r\n          try {\r\n            vv.removeEventListener('resize', onResize);\r\n          } catch {}\r\n          open();\r\n        }, 500);\r\n        return;\r\n      }\r\n\r\n      setTimeout(() => {\r\n        setShowMobileActions(true);\r\n        try {\r\n          window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: true } }));\r\n        } catch {}\r\n      }, 150);\r\n      return;\r\n    }\r\n\r\n    setShowMobileActions(true);\r\n    try {\r\n      window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: true } }));\r\n    } catch {}\r\n  };\r\n  const updateSlashState = () => {\r\n    const text = editableRef.current ? String(editableRef.current.innerText || '') : '';\r\n    const m = text.match(/\\/\\s*([\\w-]*)$/);\r\n    const q = m ? m[1] : '';\r\n    setSlashQuery(q);\r\n    const shouldOpen = /\\//.test(text);\r\n    setSlashOpen(shouldOpen);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleOutsideClick = (e: MouseEvent | TouchEvent) => {\r\n      if (document.activeElement !== editableRef.current) return;\r\n\r\n      const target = e.target as Node;\r\n      if (containerRef.current && containerRef.current.contains(target)) return;\r\n\r\n      try {\r\n        editableRef.current?.blur();\r\n      } catch {}\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleOutsideClick);\r\n    document.addEventListener('touchstart', handleOutsideClick);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleOutsideClick);\r\n      document.removeEventListener('touchstart', handleOutsideClick);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"relative w-full p-2 bg-gradient-to-t from-white via-white to-gray-50/50 md:bg-white md:border md:border-gray-200 md:rounded-xl md:px-1 md:py-2 md:pt-0\"\r\n    >\r\n      {attachments && attachments.length > 0 ? (\r\n        <div className=\"mb-2\">\r\n          <div className=\"flex items-center justify-between mb-1\">\r\n            <span className=\"text-xs text-gray-600\">\r\n              {attachments.length} {attachments.length === 1 ? 'ƒë√≠nh k√®m' : 'ƒë√≠nh k√®m'}\r\n            </span>\r\n            <button onClick={onClearAttachments} className=\"text-xs text-red-600 hover:underline cursor-pointer\">\r\n              X√≥a t·∫•t c·∫£\r\n            </button>\r\n          </div>\r\n          <div className=\"flex gap-2 overflow-x-auto no-scrollbar py-1\">\r\n            {attachments.map((att, idx) => (\r\n              <div key={idx} className=\"relative w-20 h-20 rounded-xl overflow-hidden border border-gray-200 bg-white\">\r\n                {att.type === 'image' ? (\r\n                  <Image src={att.previewUrl} alt=\"\" fill sizes=\"80px\" className=\"object-cover\" unoptimized priority />\r\n                ) : att.type === 'video' ? (\r\n                  <video src={att.previewUrl} className=\"w-full h-full object-cover\" muted playsInline />\r\n                ) : (\r\n                  <div className=\" rounded-xl bg-gray-50 hover:bg-gray-100 transition-all duration-200 group cursor-pointer border border-gray-200 hover:border-blue-300\">\r\n                    <div className=\"p-3 rounded-xl bg-gradient-to-br from-blue-500 text-white shadow-lg\">\r\n                      <HiDocumentText className=\"w-3 h-3\" />\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"text-sm font-semibold text-gray-800 truncate group-hover:text-blue-600 transition-colors\">\r\n                        {att.fileName || 'T·ªáp'}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 mt-1 font-medium uppercase tracking-wider\">\r\n                        .{att.fileName?.split('.').pop()}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                <button\r\n                  onClick={() => onRemoveAttachment(idx)}\r\n                  className=\"absolute top-1 right-1 p-1 rounded-full bg-black/50 text-white hover:bg-black/70 cursor-pointer\"\r\n                  aria-label=\"X√≥a\"\r\n                >\r\n                  <HiX className=\"w-3 h-3\" />\r\n                </button>\r\n                <button\r\n                  onClick={() => setShowReportConfirm(true)}\r\n                  className=\"group p-2 rounded-full cursor-pointer hover:bg-gray-100 transition-all duration-300 active:scale-90\"\r\n                  aria-label=\"B√°o x·∫•u\"\r\n                >\r\n                  <HiShieldCheck className=\"w-7 h-7 text-gray-500 group-hover:text-red-600 transition-colors\" />\r\n                </button>\r\n                {canClearHistory && (\r\n                  <button\r\n                    onClick={() => setShowConfirmClear(true)}\r\n                    className={`p-2 rounded-full cursor-pointer text-gray-700  ${\r\n                      isUploading ? 'opacity-50 pointer-events-none grayscale' : ''\r\n                    }`}\r\n                    aria-label=\"X√≥a l·ªãch s·ª≠\"\r\n                  >\r\n                    <HiTrash className=\"w-7 h-7 text-gray-500\" />\r\n                  </button>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n      <div className=\"hidden md:flex items-center mt-1 gap-2 mb-0  rounded-xl bg-white \">\r\n        <button\r\n          onClick={() => {\r\n            try {\r\n              editableRef.current?.blur?.();\r\n            } catch {}\r\n            setTimeout(() => onToggleEmojiPicker(), 100);\r\n          }}\r\n          className={`rounded-lg p-1 cursor-pointer transition-all duration-200 ${isListening ? 'text-red-500 bg-red-50' : 'text-gray-700 hover:bg-gray-100'}`}\r\n          aria-label=\"Ch·ªçn emoji\"\r\n        >\r\n          <CiFaceSmile className=\"w-6 h-6\" />\r\n        </button>\r\n        <label\r\n          className=\" rounded-lg cursor-pointer p-1 hover:bg-gray-100 transition-all duration-200 text-gray-700\"\r\n          aria-label=\"G·ª≠i ·∫£nh ho·∫∑c video\"\r\n        >\r\n          <CiImageOn className=\"w-6 h-6\" />\r\n          <input\r\n            type=\"file\"\r\n            accept=\"image/*,video/*\"\r\n            className=\"sr-only\"\r\n            onChange={(e) => {\r\n              const files = e.target.files ? Array.from(e.target.files) : [];\r\n              files.forEach((f) => onSelectImage(f));\r\n              e.target.value = '';\r\n            }}\r\n            multiple\r\n          />\r\n        </label>\r\n        <label\r\n          className=\" rounded-lg cursor-pointer p-1 hover:bg-gray-100 transition-all duration-200 text-gray-700\"\r\n          aria-label=\"G·ª≠i file\"\r\n        >\r\n          <CiFileOn className=\"w-6 h-6\" />\r\n          <input\r\n            type=\"file\"\r\n            className=\"sr-only\"\r\n            multiple\r\n            onChange={(e) => {\r\n              const files = e.target.files ? Array.from(e.target.files) : [];\r\n              files.forEach((f) => onSelectFile(f));\r\n              e.target.value = '';\r\n            }}\r\n          />\r\n        </label>\r\n        <button\r\n          onClick={() => setShowContactCardModal(true)}\r\n          className={`rounded-lg p-1 cursor-pointer transition-all duration-200 ${isListening ? 'text-red-500 bg-red-50' : 'text-gray-700 hover:bg-gray-100'}`}\r\n          aria-label=\"G·ª≠i danh thi·∫øp\"\r\n        >\r\n          <CiCreditCard2 className=\"w-6 h-6\" />\r\n        </button>\r\n        <button\r\n          onClick={handleShowUpdatingPopup}\r\n          className={`rounded-lg p-1 cursor-pointer transition-all duration-200 ${isListening ? 'text-red-500 bg-red-50' : 'text-gray-700 hover:bg-gray-100'}`}\r\n          aria-label=\"Ch·ªânh s·ª≠a Zalo\"\r\n        >\r\n          <CiEdit className=\"w-6 h-6\" />\r\n        </button>\r\n        <button\r\n          onClick={handleShowUpdatingPopup}\r\n          className={`rounded-lg p-1 cursor-pointer transition-all duration-200 ${isListening ? 'text-red-500 bg-red-50' : 'text-gray-700 hover:bg-gray-100'}`}\r\n          aria-label=\"G·ª≠i Zalo\"\r\n        >\r\n          <CiPen className=\"w-6 h-6\" />\r\n        </button>\r\n        <button\r\n          onClick={handleShowUpdatingPopup}\r\n          className={`rounded-lg p-1 cursor-pointer transition-all duration-200 ${isListening ? 'text-red-500 bg-red-50' : 'text-gray-700 hover:bg-gray-100'}`}\r\n          aria-label=\"Ch·ªçn Zalo\"\r\n        >\r\n          <CiCircleMore className=\"w-6 h-6\" />\r\n        </button>\r\n      </div>\r\n      {/* Tags List */}\r\n      {userTags.length > 0 && (\r\n        <div\r\n          ref={tagsContainerRef}\r\n          onPointerDown={onTagsPointerDown}\r\n          onPointerMove={onTagsPointerMove}\r\n          onPointerUp={onTagsPointerUp}\r\n          onPointerCancel={onTagsPointerUp}\r\n          className=\"flex items-center gap-2 overflow-x-auto custom-scrollbar w-full p-1 whitespace-nowrap overscroll-x-contain x-scroll-touch select-none cursor-grab active:cursor-grabbing\"\r\n        >\r\n          {userTags.map((tag) => {\r\n            const isSelected = selectedTagIds.includes(tag.id);\r\n            const colorHex = TAG_COLORS[tag.color] || '#9ca3af';\r\n            return (\r\n              <div\r\n                key={tag.id}\r\n                onClick={() => handleToggleTag(tag.id)}\r\n                className={`\r\n                  cursor-pointer flex-none px-2.5 py-1 rounded-[0.25rem] text-xs font-semibold border transition-all duration-200 shadow-sm active:scale-95\r\n                  ${isSelected ? 'shadow-md' : 'hover:shadow'}\r\n                `}\r\n                style={{\r\n                  backgroundColor: isSelected ? colorHex : 'white',\r\n                  borderColor: colorHex,\r\n                  color: isSelected ? '#ffffff' : colorHex,\r\n                }}\r\n              >\r\n                {tag.label}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n\r\n      {/* Input Area + Send Button */}\r\n      <div className=\"flex items-end gap-2\">\r\n        <button\r\n          onClick={() => {\r\n            try {\r\n              editableRef.current?.blur?.();\r\n            } catch {}\r\n            setTimeout(() => onToggleEmojiPicker(), 100);\r\n          }}\r\n          className=\"md:hidden group p-2 rounded-full cursor-pointer hover:bg-gray-100 transition-all duration-300 active:scale-90\"\r\n          aria-label=\"Ch·ªçn emoji\"\r\n        >\r\n          <HiFaceSmile className=\"w-7 h-7 text-gray-500 group-hover:text-yellow-500 transition-colors\" />\r\n        </button>\r\n        {/* Input contentEditable ‚Äì ƒê·∫πp nh∆∞ iMessage */}\r\n        <div className=\"relative flex-1 min-w-0\">\r\n          <div\r\n            ref={editableRef}\r\n            contentEditable\r\n            inputMode=\"text\"\r\n            role=\"textbox\"\r\n            aria-multiline=\"true\"\r\n            onClick={() => {\r\n              setShowMobileActions(false);\r\n              try {\r\n                window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n              } catch {}\r\n              // Keep caret at the click position by letting browser handle selection\r\n            }}\r\n            onInput={() => {\r\n              onInputEditable();\r\n              updateSlashState();\r\n              checkContent();\r\n            }}\r\n            onKeyDown={(e) => {\r\n              const text = editableRef.current ? String(editableRef.current.innerText || '') : '';\r\n              const suggestions = kvItems.filter((it) =>\r\n                it.key.toLowerCase().startsWith((slashQuery || '').toLowerCase()),\r\n              );\r\n\r\n              if (slashOpen && suggestions.length > 0) {\r\n                if (e.key === 'ArrowDown') {\r\n                  e.preventDefault();\r\n                  setSlashSelectedIndex((prev) => (prev + 1) % suggestions.length);\r\n                  return;\r\n                }\r\n                if (e.key === 'ArrowUp') {\r\n                  e.preventDefault();\r\n                  setSlashSelectedIndex((prev) => (prev - 1 + suggestions.length) % suggestions.length);\r\n                  return;\r\n                }\r\n                if (e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  const chosen = suggestions[Math.max(0, Math.min(slashSelectedIndex, suggestions.length - 1))];\r\n                  if (chosen && editableRef.current) {\r\n                    const replaced = text.replace(/\\/\\s*[\\w-]*$/, chosen.value);\r\n                    editableRef.current.innerText = replaced;\r\n                    try {\r\n                      const range = document.createRange();\r\n                      range.selectNodeContents(editableRef.current);\r\n                      range.collapse(false);\r\n                      const sel = window.getSelection();\r\n                      sel?.removeAllRanges();\r\n                      sel?.addRange(range);\r\n                    } catch {}\r\n                    setSlashOpen(false);\r\n                    setSlashSelectedIndex(0);\r\n                    onInputEditable();\r\n                    return;\r\n                  }\r\n                }\r\n                if (e.key === 'Escape') {\r\n                  e.preventDefault();\r\n                  setSlashOpen(false);\r\n                  setSlashSelectedIndex(0);\r\n                  return;\r\n                }\r\n              }\r\n              // if (e.key === 'Enter' && !e.shiftKey && isUploading) {\r\n              //   e.preventDefault();\r\n              //   return;\r\n              // }\r\n              onKeyDownEditable(e);\r\n              updateSlashState();\r\n              if (e.key === 'Enter' && !e.shiftKey) {\r\n                if (attachments && attachments.length > 0) return;\r\n                try {\r\n                  const el = editableRef.current;\r\n                  if (el) {\r\n                    el.focus();\r\n                    const range = document.createRange();\r\n                    range.selectNodeContents(el);\r\n                    range.collapse(false);\r\n                    const sel = window.getSelection();\r\n                    sel?.removeAllRanges();\r\n                    sel?.addRange(range);\r\n                  }\r\n                } catch {}\r\n              }\r\n            }}\r\n            onFocus={() => {\r\n              onFocusEditable();\r\n              updateSlashState();\r\n              setShowMobileActions(false);\r\n            }}\r\n            onPaste={(e) => {\r\n              onPasteEditable(e);\r\n              updateSlashState();\r\n            }}\r\n            style={{ overscrollBehavior: 'contain' }}\r\n            className=\"min-h-10 max-h-40 px-2 py-2 bg-white/90   focus:outline-none  transition-all duration-300 text-[0.875rem] md:text-[1rem] text-gray-800 overflow-auto custom-scrollbar w-full max-w-full break-words whitespace-pre-wrap\"\r\n            data-placeholder=\"Nh·∫≠p tin nh·∫Øn...\"\r\n          />\r\n\r\n          {/* Placeholder ƒë·∫πp h∆°n */}\r\n          <div className=\"pointer-events-none absolute inset-0 flex items-center px-2 py-4 text-gray-400 select-none text-[0.875rem] md:text-[1rem]\">\r\n            <span className=\"flex items-center gap-2\">Nh·∫≠p tin nh·∫Øn...</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-1\">\r\n          {hasContent || (attachments && attachments.length > 0) ? (\r\n            <>\r\n              <button\r\n                onMouseDown={(e) => e.preventDefault()}\r\n                onTouchStart={(e) => e.preventDefault()}\r\n                onClick={() => {\r\n                  handleSendWrapper();\r\n                  if (attachments && attachments.length > 0) return;\r\n                  if (!document.hidden && allowFocusRef.current) {\r\n                    allowFocusRef.current = true;\r\n                    try {\r\n                      requestAnimationFrame(() => {\r\n                        const el = editableRef.current;\r\n                        if (el) {\r\n                          el.focus();\r\n                          const range = document.createRange();\r\n                          range.selectNodeContents(el);\r\n                          range.collapse(false);\r\n                          const sel = window.getSelection();\r\n                          sel?.removeAllRanges();\r\n                          sel?.addRange(range);\r\n                        }\r\n                      });\r\n                    } catch {}\r\n                  }\r\n                }}\r\n                className={`lg:hidden p-2 rounded-full cursor-pointer text-blue-600 hover:bg-blue-50 transition-all duration-300 active:scale-90 group`}\r\n                aria-label=\"G·ª≠i tin nh·∫Øn\"\r\n              >\r\n                <HiPaperAirplane className=\"w-7 h-7 -rotate-12 group-hover:rotate-0 transition-transform duration-300\" />\r\n              </button>\r\n              <button\r\n                onMouseDown={(e) => e.preventDefault()}\r\n                onTouchStart={(e) => e.preventDefault()}\r\n                onClick={() => {\r\n                  handleSendWrapper();\r\n                  if (attachments && attachments.length > 0) return;\r\n                  if (!document.hidden && allowFocusRef.current) {\r\n                    allowFocusRef.current = true;\r\n                    try {\r\n                      requestAnimationFrame(() => {\r\n                        const el = editableRef.current;\r\n                        if (el) {\r\n                          el.focus();\r\n                          const range = document.createRange();\r\n                          range.selectNodeContents(el);\r\n                          range.collapse(false);\r\n                          const sel = window.getSelection();\r\n                          sel?.removeAllRanges();\r\n                          sel?.addRange(range);\r\n                        }\r\n                      });\r\n                    } catch {}\r\n                  }\r\n                }}\r\n                className={`hidden lg:block p-2 rounded-full cursor-pointer text-blue-600 hover:bg-blue-50 transition-all duration-300 active:scale-90 group`}\r\n                aria-label=\"G·ª≠i tin nh·∫Øn\"\r\n              >\r\n                <HiPaperAirplane className=\"w-7 h-7 -rotate-12 group-hover:rotate-0 transition-transform duration-300\" />\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <div className=\"hidden md:flex items-center gap-2\">\r\n                <button\r\n                  onClick={() => {\r\n                    try {\r\n                      editableRef.current?.blur?.();\r\n                    } catch {}\r\n                    setTimeout(() => onToggleEmojiPicker(), 100);\r\n                  }}\r\n                  className=\"group p-2 rounded-full cursor-pointer hover:bg-gray-100 transition-all duration-300 active:scale-90\"\r\n                  aria-label=\"Ch·ªçn emoji\"\r\n                >\r\n                  <CiFaceSmile className=\"w-7 h-7 text-gray-500 group-hover:text-yellow-500 transition-colors\" />\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    const el = editableRef.current;\r\n                    if (!el) return;\r\n                    el.innerText = 'üëç';\r\n                    onInputEditable();\r\n                    handleSendWrapper();\r\n                  }}\r\n                  className={`p-2 rounded-full cursor-pointer text-gray-700  ${\r\n                    isUploading ? 'opacity-50 pointer-events-none grayscale' : ''\r\n                  }`}\r\n                  aria-label=\"G·ª≠i like\"\r\n                >\r\n                  <Image src=\"/imgs/like.png\" width={24} height={24} alt=\"Like Zalo\" className=\"w-7 h-7\" />\r\n                </button>\r\n              </div>\r\n              <div className=\"md:hidden flex items-center gap-2\">\r\n                <button\r\n                  ref={toggleMobileActionsBtnRef}\r\n                  onClick={handleToggleMobileActions}\r\n                  className=\"block rounded-full cursor-pointer text-gray-500 hover:bg-gray-100 transition-all duration-300 active:scale-90\"\r\n                  aria-label=\"M·ªü th√™m h√†nh ƒë·ªông\"\r\n                >\r\n                  <ICIcon1 className=\"w-11 h-11\" />\r\n                </button>\r\n                <button\r\n                  onClick={onVoiceInput}\r\n                  className={` rounded-full cursor-pointer transition-all duration-300 active:scale-90 ${\r\n                    isListening ? 'text-red-500 animate-pulse bg-red-50' : 'text-gray-500 hover:bg-gray-100'\r\n                  }`}\r\n                  aria-label=\"Nh·∫≠p b·∫±ng gi·ªçng n√≥i\"\r\n                >\r\n                  <MicIcon className=\"w-11 h-11 text-black\" />\r\n                </button>\r\n                <label\r\n                  className=\" rounded-full cursor-pointer text-gray-500 hover:bg-gray-100 transition-all duration-300 active:scale-90\"\r\n                  aria-label=\"G·ª≠i ·∫£nh ho·∫∑c video\"\r\n                >\r\n                  <ImageIconZalo className=\"w-11 h-11\" />\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\"image/*,video/*\"\r\n                    className=\"sr-only\"\r\n                    onChange={(e) => {\r\n                      const files = e.target.files ? Array.from(e.target.files) : [];\r\n                      files.forEach((f) => onSelectImage(f));\r\n                      e.target.value = '';\r\n                    }}\r\n                    multiple\r\n                  />\r\n                </label>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {showMobileActions && (\r\n        <div\r\n          ref={mobileActionsRef}\r\n          className=\"lg:hidden w-full grid grid-cols-4 gap-2 items-center justify-between mx-auto mt-4\"\r\n        >\r\n          <label className=\"group relative cursor-pointer flex flex-col items-center\" aria-label=\"G·ª≠i ·∫£nh ho·∫∑c video\">\r\n            {/* Background tr√≤n bao quanh icon */}\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-blue-100 to-cyan-100 hover:from-blue-200 hover:to-cyan-200  shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiPhoto className=\"w-6 h-6 text-blue-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n              {/* T√πy ch·ªçn: th√™m hi·ªáu ·ª©ng n·ªïi nh·∫π cho icon */}\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n\r\n            {/* Ch·ªØ b√™n d∆∞·ªõi */}\r\n            <span className=\"text-sm font-medium text-gray-800\">·∫¢nh/Video</span>\r\n\r\n            <input\r\n              type=\"file\"\r\n              accept=\"image/*,video/*\"\r\n              className=\"sr-only\"\r\n              onChange={(e) => {\r\n                const files = e.target.files ? Array.from(e.target.files) : [];\r\n                files.forEach((f) => onSelectImage(f));\r\n                e.target.value = '';\r\n                setShowMobileActions(false);\r\n                try {\r\n                  window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n                } catch {}\r\n              }}\r\n              multiple\r\n            />\r\n          </label>\r\n          <label className=\"group relative cursor-pointer flex flex-col items-center\" aria-label=\"G·ª≠i file\">\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-green-100 to-emerald-100 hover:from-green-200 hover:to-emerald-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiPaperClip className=\"w-6 h-6 text-green-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200 rotate-12\" />\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">File</span>\r\n            <input\r\n              type=\"file\"\r\n              className=\"sr-only\"\r\n              multiple\r\n              onChange={(e) => {\r\n                const files = e.target.files ? Array.from(e.target.files) : [];\r\n                files.forEach((f) => onSelectFile(f));\r\n                e.target.value = '';\r\n                setShowMobileActions(false);\r\n                try {\r\n                  window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n                } catch {}\r\n              }}\r\n            />\r\n          </label>\r\n          {isGroup && (\r\n            <button\r\n              onClick={() => {\r\n                setShowCreatePoll(true);\r\n                setShowMobileActions(false);\r\n                try {\r\n                  window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n                } catch {}\r\n              }}\r\n              className=\"group relative cursor-pointer flex flex-col items-center\"\r\n              aria-label=\"B√¨nh ch·ªçn\"\r\n            >\r\n              <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-indigo-100 to-blue-100 hover:from-indigo-200 hover:to-blue-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n                <HiChartBar className=\"w-6 h-6 text-blue-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n                <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n              </div>\r\n              <span className=\"text-sm font-medium text-gray-800\">B√¨nh ch·ªçn</span>\r\n            </button>\r\n          )}\r\n\r\n          <button\r\n            onClick={() => {\r\n              setShowCreateNote(true);\r\n              setShowMobileActions(false);\r\n              try {\r\n                window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n              } catch {}\r\n            }}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"Nh·∫Øc h·∫πn\"\r\n          >\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-indigo-100 to-red-600 hover:from-indigo-200 hover:to-blue-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiClock className=\"w-6 h-6 text-white drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">Nh·∫Øc h·∫πn</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => {\r\n              onVoiceInput();\r\n              setShowMobileActions(false);\r\n              try {\r\n                window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n              } catch {}\r\n            }}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"Nh·∫≠p b·∫±ng gi·ªçng n√≥i\"\r\n          >\r\n            <div\r\n              className={`relative w-12 h-12 mb-3 rounded-full flex items-center justify-center transition-all duration-500 shadow-2xl ${\r\n                isListening\r\n                  ? 'bg-gradient-to-br from-red-500 to-pink-600 ring-4 ring-red-300/50 scale-110'\r\n                  : 'bg-gradient-to-br from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300'\r\n              }`}\r\n            >\r\n              <HiMicrophone\r\n                className={`w-6 h-6 ${\r\n                  isListening ? 'text-white' : 'text-gray-700'\r\n                } drop-shadow-md group-hover:scale-110 transition-transform duration-200`}\r\n              />\r\n              {isListening && <div className=\"absolute inset-0 rounded-full bg-red-500/30 animate-ping\" />}\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">Voice</span>\r\n          </button>\r\n          <button\r\n            onClick={() => {\r\n              showToast({ type: 'info', message: 'Ch·ª©c nƒÉng ƒëang ho√†n thi·ªán' });\r\n            }}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"Chat nhanh\"\r\n          >\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-violet-100 to-purple-100 hover:from-violet-200 hover:to-purple-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiLightningBolt className=\"w-6 h-6 text-yellow-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">Chat nhanh</span>\r\n          </button>\r\n          <button\r\n            onClick={() => {\r\n              showToast({ type: 'info', message: 'Ch·ª©c nƒÉng ƒëang ho√†n thi·ªán' });\r\n            }}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"B√°o x·∫•u\"\r\n          >\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-rose-100 to-pink-100 hover:from-rose-200 hover:to-pink-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiShieldCheck className=\"w-6 h-6 text-red-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">B√°o x·∫•u</span>\r\n          </button>\r\n          {canClearHistory && (\r\n            <button\r\n              onClick={() => {\r\n                showToast({ type: 'info', message: 'Ch·ª©c nƒÉng ƒëang ho√†n thi·ªán' });\r\n              }}\r\n              className=\"group relative cursor-pointer flex flex-col items-center\"\r\n              aria-label=\"X√≥a l·ªãch s·ª≠\"\r\n            >\r\n              <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-slate-100 to-gray-100 hover:from-slate-200 hover:to-gray-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n                <HiTrash className=\"w-6 h-6 text-gray-700 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n                <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n              </div>\r\n              <span className=\"text-sm font-medium text-gray-800\">X√≥a l·ªãch s·ª≠</span>\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={() => showToast({ type: 'info', message: 'Ch·ª©c nƒÉng ƒëang ho√†n thi·ªán' })}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"V·ªã tr√≠\"\r\n          >\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-rose-100 to-pink-100 hover:from-rose-200 hover:to-pink-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiMapPin className=\"w-6 h-6 text-rose-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">V·ªã tr√≠</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => {\r\n              setShowMobileActions(false);\r\n              try {\r\n                window.dispatchEvent(new CustomEvent('mobileActionsToggle', { detail: { open: false } }));\r\n              } catch {}\r\n              setShowContactCardModal(true);\r\n            }}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"Danh thi·∫øp\"\r\n          >\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-teal-100 to-cyan-100 hover:from-teal-200 hover:to-cyan-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiIdentification className=\"w-6 h-6 text-teal-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">Danh thi·∫øp</span>\r\n          </button>\r\n          <button\r\n            onClick={() => showToast({ type: 'info', message: 'Ch·ª©c nƒÉng ƒëang ho√†n thi·ªán' })}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"V·∫Ω h√¨nh\"\r\n          >\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-purple-100 to-fuchsia-100 hover:from-purple-200 hover:to-fuchsia-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <HiPencil className=\"w-6 h-6 text-purple-600 drop-shadow-md group-hover:scale-110 transition-transform duration-200\" />\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">V·∫Ω h√¨nh</span>\r\n          </button>\r\n          <button\r\n            onClick={() => showToast({ type: 'info', message: 'Ch·ª©c nƒÉng ƒëang ho√†n thi·ªán' })}\r\n            className=\"group relative cursor-pointer flex flex-col items-center\"\r\n            aria-label=\"V·∫Ω h√¨nh\"\r\n          >\r\n            <div className=\"relative w-12 h-12 mb-3 rounded-full bg-gradient-to-br from-slate-100 to-gray-100 hover:from-slate-200 hover:to-gray-200 shadow-2xl group-hover:shadow-3xl group-active:scale-95 transition-all duration-300 flex items-center justify-center\">\r\n              <span className=\"text-xs font-black text-gray-700 drop-shadow-md group-hover:scale-110 transition-transform duration-200\">\r\n                @GIF\r\n              </span>\r\n              <div className=\"absolute inset-0 rounded-full shadow-inner shadow-white/50\"></div>\r\n            </div>\r\n            <span className=\"text-sm font-medium text-gray-800\">@GIF</span>\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {showConfirmClear && (\r\n        <ConfirmModal\r\n          title=\"X√≥a l·ªãch s·ª≠\"\r\n          message=\"B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ tr√≤ chuy·ªán?\"\r\n          onCancel={() => setShowConfirmClear(false)}\r\n          onConfirm={async () => {\r\n            setShowConfirmClear(false);\r\n            try {\r\n              const res = await fetch('/api/messages', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ action: 'clearHistory', roomId }),\r\n              });\r\n              if (res.ok) {\r\n                showToast({ type: 'success', message: 'ƒê√£ x√≥a l·ªãch s·ª≠ tr√≤ chuy·ªán' });\r\n                try {\r\n                  window.dispatchEvent(new CustomEvent('chatHistoryCleared', { detail: { roomId } }));\r\n                } catch {}\r\n              } else {\r\n                showToast({ type: 'error', message: 'X√≥a l·ªãch s·ª≠ th·∫•t b·∫°i' });\r\n              }\r\n            } catch {\r\n              showToast({ type: 'error', message: 'L·ªói khi x√≥a l·ªãch s·ª≠' });\r\n            }\r\n          }}\r\n          confirmText=\"X√≥a\"\r\n          variant=\"danger\"\r\n        />\r\n      )}\r\n      {showReportConfirm && (\r\n        <ConfirmModal\r\n          title=\"B√°o x·∫•u\"\r\n          message=\"B·∫°n c√≥ mu·ªën b√°o c√°o cu·ªôc tr√≤ chuy·ªán n√†y?\"\r\n          onCancel={() => setShowReportConfirm(false)}\r\n          onConfirm={async () => {\r\n            setShowReportConfirm(false);\r\n            try {\r\n              await fetch('/api/messages', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                  action: 'create',\r\n                  data: {\r\n                    roomId,\r\n                    sender: currentUser._id,\r\n                    type: 'notify',\r\n                    content: 'B·∫°n ƒë√£ b√°o x·∫•u cu·ªôc tr√≤ chuy·ªán n√†y',\r\n                  },\r\n                }),\r\n              });\r\n              showToast({ type: 'success', message: 'ƒê√£ g·ª≠i b√°o x·∫•u' });\r\n            } catch {\r\n              showToast({ type: 'error', message: 'G·ª≠i b√°o x·∫•u th·∫•t b·∫°i' });\r\n            }\r\n          }}\r\n          confirmText=\"B√°o x·∫•u\"\r\n          variant=\"warning\"\r\n        />\r\n      )}\r\n      {showContactCardModal && (\r\n        <div\r\n          className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-sm px-0 md:px-4\"\r\n          onClick={() => {\r\n            setShowContactCardModal(false);\r\n            setSelectedContactCardIds([]);\r\n            setContactCardSearch('');\r\n            setActiveContactCategory('all');\r\n          }}\r\n        >\r\n          <div\r\n            className=\"w-full  md:max-w-[46rem] bg-white md:rounded-2xl shadow-2xl overflow-hidden h-full md:max-h-[90vh] flex flex-col\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"px-4 sm:px-6 py-4 border-b border-gray-100 flex items-center justify-between\">\r\n              <p className=\"text-lg font-bold text-gray-900\">G·ª≠i danh thi·∫øp</p>\r\n              <button\r\n                onClick={() => {\r\n                  setShowContactCardModal(false);\r\n                  setSelectedContactCardIds([]);\r\n                  setContactCardSearch('');\r\n                  setActiveContactCategory('all');\r\n                }}\r\n                className=\"p-2 rounded-full cursor-pointer hover:bg-gray-100 text-gray-600\"\r\n                aria-label=\"ƒê√≥ng\"\r\n              >\r\n                <HiX className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"px-4 sm:px-6 py-4 border-b border-gray-100\">\r\n              <div className=\"flex items-center gap-2 px-4 py-3 rounded-full border border-gray-200 bg-white\">\r\n                <HiSearch className=\"w-5 h-5 text-gray-400\" />\r\n                <input\r\n                  value={contactCardSearch}\r\n                  onChange={(e) => setContactCardSearch(e.target.value)}\r\n                  placeholder=\"T√¨m danh thi·∫øp theo t√™n\"\r\n                  className=\"w-full outline-none text-sm text-gray-800\"\r\n                />\r\n              </div>\r\n\r\n              <div\r\n                ref={contactCategoryBarRef}\r\n                onPointerDown={handleContactCategoryPointerDown}\r\n                onPointerMove={handleContactCategoryPointerMove}\r\n                onPointerUp={handleContactCategoryPointerEnd}\r\n                onPointerCancel={handleContactCategoryPointerEnd}\r\n                onLostPointerCapture={handleContactCategoryPointerEnd}\r\n                onClickCapture={handleContactCategoryClickCapture}\r\n                style={{ touchAction: 'pan-x', WebkitOverflowScrolling: 'touch' }}\r\n                className=\"mt-4 flex items-center gap-2 overflow-x-auto w-full whitespace-nowrap custom-scrollbar select-none\"\r\n              >\r\n                <button\r\n                  onClick={() => setActiveContactCategory('all')}\r\n                  className={`px-4 py-2 mb-2 rounded-full text-sm font-semibold cursor-pointer transition-colors ${\r\n                    activeContactCategory === 'all'\r\n                      ? 'bg-blue-600 text-white'\r\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                  }`}\r\n                >\r\n                  T·∫•t c·∫£\r\n                </button>\r\n                {categoryTags.map((t) => (\r\n                  <button\r\n                    key={t.id}\r\n                    onClick={() => setActiveContactCategory(t.id)}\r\n                    className={`px-4 py-2 mb-2 rounded-full text-sm font-semibold cursor-pointer transition-colors ${\r\n                      activeContactCategory === t.id\r\n                        ? 'bg-blue-600 text-white'\r\n                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n                    }`}\r\n                  >\r\n                    {t.label}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              {groupedContactUsers.length === 0 ? (\r\n                <div className=\"py-12 text-center text-sm text-gray-500\">Kh√¥ng t√¨m th·∫•y li√™n h·ªá ph√π h·ª£p</div>\r\n              ) : (\r\n                <div className=\"py-2\">\r\n                  {groupedContactUsers.map((g) => (\r\n                    <div key={g.key}>\r\n                      <div className=\"px-4 sm:px-6 py-2 text-sm font-bold text-gray-700\">{g.key}</div>\r\n                      <div className=\"space-y-1 px-2 sm:px-4 pb-2\">\r\n                        {g.users.map((u) => {\r\n                          const idStr = String(u._id || '');\r\n                          const isSelected = selectedContactCardIds.includes(idStr);\r\n                          const displayName = getContactDisplayName(u);\r\n                          const sub = String(u.username || '');\r\n                          return (\r\n                            <button\r\n                              key={String(u._id)}\r\n                              onClick={() => {\r\n                                if (!idStr) return;\r\n                                setSelectedContactCardIds((prev) =>\r\n                                  prev.includes(idStr) ? prev.filter((x) => x !== idStr) : [...prev, idStr],\r\n                                );\r\n                              }}\r\n                              className=\"w-full flex items-center gap-3 px-2 py-2 rounded-xl cursor-pointer hover:bg-gray-50 active:scale-[0.99] transition\"\r\n                            >\r\n                              <div\r\n                                className={`w-5 h-5 rounded-full border flex items-center justify-center ${\r\n                                  isSelected ? 'border-blue-600' : 'border-gray-300'\r\n                                }`}\r\n                              >\r\n                                {isSelected && <div className=\"w-3 h-3 rounded-full bg-blue-600\" />}\r\n                              </div>\r\n\r\n                              <div className=\"w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center shrink-0\">\r\n                                {u.avatar ? (\r\n                                  <Image\r\n                                    src={getProxyUrl(u.avatar)}\r\n                                    alt=\"\"\r\n                                    width={40}\r\n                                    height={40}\r\n                                    className=\"w-full h-full object-cover\"\r\n                                  />\r\n                                ) : (\r\n                                  <Image\r\n                                    src=\"/logo/avata.webp\"\r\n                                    alt=\"\"\r\n                                    width={40}\r\n                                    height={40}\r\n                                    className=\"w-full h-full object-cover\"\r\n                                  />\r\n                                )}\r\n                              </div>\r\n\r\n                              <div className=\"flex-1 min-w-0 text-left\">\r\n                                <p className=\"text-sm font-semibold text-gray-900 truncate\">{displayName}</p>\r\n                                {sub ? <p className=\"text-sm text-gray-500 truncate\">{sub}</p> : null}\r\n                              </div>\r\n                            </button>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"px-4 sm:px-6 py-4 border-t border-gray-100 flex items-center justify-end gap-3 bg-white\">\r\n              <button\r\n                onClick={() => {\r\n                  setShowContactCardModal(false);\r\n                  setSelectedContactCardIds([]);\r\n                  setContactCardSearch('');\r\n                  setActiveContactCategory('all');\r\n                }}\r\n                className=\"px-5 py-2 rounded-xl bg-gray-100 text-gray-800 font-semibold cursor-pointer hover:bg-gray-200 transition\"\r\n              >\r\n                H·ªßy\r\n              </button>\r\n              <button\r\n                onClick={handleSendContactCard}\r\n                disabled={selectedContactCardIds.length === 0}\r\n                className={`px-5 py-2 rounded-xl font-semibold transition ${\r\n                  selectedContactCardIds.length > 0\r\n                    ? 'bg-blue-600 text-white cursor-pointer hover:bg-blue-700'\r\n                    : 'bg-blue-200 text-white cursor-not-allowed'\r\n                }`}\r\n              >\r\n                {`G·ª≠i danh thi·∫øp${selectedContactCardIds.length > 0 ? ` (${selectedContactCardIds.length})` : ''}`}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Custom CSS cho placeholder */}\r\n      <style jsx>{`\r\n        [contenteditable]:empty ~ div > span {\r\n          opacity: 1;\r\n        }\r\n        [contenteditable]:not(:empty) ~ div > span,\r\n        [contenteditable]:focus ~ div > span {\r\n          opacity: 0;\r\n        }\r\n        [contenteditable]:focus ~ div > span {\r\n          transition: opacity 0.3s ease;\r\n        }\r\n      `}</style>\r\n\r\n      {slashOpen && kvItems.length > 0 && (\r\n        <div className=\"absolute left-4 bottom-20 z-40 w-64 bg-white rounded-xl shadow-xl border border-gray-200\">\r\n          <div className=\"px-3 py-2 border-b text-xs text-gray-500\">G·ª£i √Ω Chat nhanh</div>\r\n          <div className=\"max-h-48 overflow-y-auto\">\r\n            {kvItems\r\n              .filter((it) => it.key.toLowerCase().startsWith((slashQuery || '').toLowerCase()))\r\n              .map((it, idx) => (\r\n                <button\r\n                  key={it.key}\r\n                  onClick={() => {\r\n                    if (!editableRef.current) return;\r\n                    editableRef.current.focus();\r\n                    try {\r\n                      const text = String(editableRef.current.innerText || '');\r\n                      const replaced = text.replace(/\\/\\s*[\\w-]*$/, it.value);\r\n                      editableRef.current.innerText = replaced;\r\n                      const range = document.createRange();\r\n                      range.selectNodeContents(editableRef.current);\r\n                      range.collapse(false);\r\n                      const sel = window.getSelection();\r\n                      sel?.removeAllRanges();\r\n                      sel?.addRange(range);\r\n                      setSlashOpen(false);\r\n                      setSlashSelectedIndex(0);\r\n                      onInputEditable();\r\n                    } catch {}\r\n                  }}\r\n                  className={`w-full text-left px-3 py-2 text-sm flex items-center gap-2 ${idx === slashSelectedIndex ? 'bg-indigo-50' : 'hover:bg-gray-50'}`}\r\n                >\r\n                  <span className=\"text-indigo-600\">/{it.key}</span>\r\n                  <span className=\"text-gray-500 truncate\">{it.value}</span>\r\n                </button>\r\n              ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showFlashPicker && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4\">\r\n          <div className=\"bg-white w-full max-w-sm rounded-2xl shadow-xl border border-gray-200 overflow-hidden\">\r\n            <div className=\"px-4 py-3 bg-gray-50 border-b flex items-center justify-between\">\r\n              <p className=\"text-sm font-semibold text-gray-800\">Ch·ªçn th∆∞ m·ª•c ChatFlash</p>\r\n              <button\r\n                onClick={() => setShowFlashPicker(false)}\r\n                className=\"p-2 rounded-full cursor-pointer hover:bg-white/20\"\r\n              >\r\n                <HiX className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"p-3\">\r\n              {flashFolders.length === 0 ? (\r\n                <div className=\"text-center text-gray-500 py-8 text-sm\">Ch∆∞a c√≥ th∆∞ m·ª•c</div>\r\n              ) : (\r\n                <div className=\"space-y-2\">\r\n                  {flashFolders.map((f) => (\r\n                    <button\r\n                      key={f.id}\r\n                      onClick={() => handleSelectFlashFolder(f)}\r\n                      className=\"w-full text-left px-3 py-2 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-200 text-sm flex items-center gap-2\"\r\n                    >\r\n                      <HiFolder className=\"w-4 h-4 text-indigo-600\" />\r\n                      <span className=\"truncate\">{f.name}</span>\r\n                      {selectedFlashFolder?.id === f.id && (\r\n                        <span className=\"ml-auto text-xs text-indigo-600\">ƒêang ch·ªçn</span>\r\n                      )}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showUpdatingPopup && (\r\n        <div className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4\">\r\n          <div className=\"absolute inset-0 bg-black/40\" onClick={() => setShowUpdatingPopup(false)} />\r\n          <div className=\"relative bg-white rounded-2xl shadow-2xl w-full max-w-xs overflow-hidden\">\r\n            <div className=\"px-5 py-4 text-center space-y-2\">\r\n              <p className=\"text-base font-bold text-gray-900\">ƒêang c·∫≠p nh·∫≠t</p>\r\n              <p className=\"text-sm text-gray-500\">T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c c·∫≠p nh·∫≠t.</p>\r\n              <button\r\n                onClick={() => setShowUpdatingPopup(false)}\r\n                className=\"cursor-pointer mt-2 px-4 py-2 bg-gray-900 text-white text-sm font-semibold rounded-lg hover:bg-gray-800 transition\"\r\n              >\r\n                ƒê√≥ng\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showCreatePoll && (\r\n        <CreatePollModal isOpen={showCreatePoll} onClose={() => setShowCreatePoll(false)} onCreate={handleCreatePoll} />\r\n      )}\r\n\r\n      {showCreateNote && (\r\n        <CreateReminderModal\r\n          isOpen={showCreateNote}\r\n          onClose={() => setShowCreateNote(false)}\r\n          onCreate={handleCreateNote}\r\n          createLoading={createLoading}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}