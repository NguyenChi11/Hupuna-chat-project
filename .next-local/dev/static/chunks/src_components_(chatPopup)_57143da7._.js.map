{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/SearchResults.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl, buildAccentInsensitiveRegex } from '@/utils/utils';\r\nimport type { ChatItem as ChatItemType } from '@/types/Group';\r\nimport type { User } from '@/types/User';\r\n\r\n// React Icons – Bộ hiện đại nhất 2025\r\nimport {\r\n  HiUser,\r\n  HiUsers,\r\n  HiChatBubbleLeftRight,\r\n  HiDocumentText,\r\n  HiMagnifyingGlass,\r\n  HiChevronRight,\r\n  HiClock,\r\n  HiFolder,\r\n  HiGlobeAlt,\r\n} from 'react-icons/hi2';\r\n\r\ninterface Message {\r\n  _id: string;\r\n  content?: string;\r\n  type: 'text' | 'image' | 'file' | 'sticker' | 'video' | 'reminder';\r\n  fileName?: string;\r\n  timestamp: number;\r\n  sender: string;\r\n  senderName: string;\r\n  roomId: string;\r\n  roomName: string;\r\n  isGroupChat: boolean;\r\n  fileUrl?: string;\r\n}\r\n\r\ninterface MessageGroup {\r\n  roomId: string;\r\n  roomName: string;\r\n  avatar: string;\r\n  isGroupChat: boolean;\r\n  messages: Message[];\r\n}\r\ninterface FileGroup {\r\n  roomId: string;\r\n  avatar: string;\r\n  roomName: string;\r\n  isGroupChat: boolean;\r\n  files: Message[];\r\n}\r\n\r\ninterface SearchResultsProps {\r\n  activeTab: 'all' | 'contacts' | 'messages' | 'files';\r\n  setActiveTab: (tab: 'all' | 'contacts' | 'messages' | 'files') => void;\r\n  isSearching: boolean;\r\n  hasResults: boolean;\r\n  contacts: ChatItemType[];\r\n  groupedMessages: MessageGroup[];\r\n  groupedFiles: FileGroup[];\r\n  fileMessages: Message[];\r\n  searchTerm: string;\r\n  onSelectContact: (contact: ChatItemType) => void;\r\n  onNavigateToMessage: (message: Message) => void;\r\n  currentUserId?: string;\r\n  onOpenRoomResults?: (roomId: string, roomName: string, isGroupChat: boolean, avatar?: string) => void;\r\n}\r\n\r\n// === TABS SIÊU ĐẸP ===\r\nconst SearchTabs = ({\r\n  activeTab,\r\n  setActiveTab,\r\n  contactsCount,\r\n  messagesCount,\r\n}: {\r\n  activeTab: 'all' | 'contacts' | 'messages' | 'files';\r\n  setActiveTab: (tab: 'all' | 'contacts' | 'messages' | 'files') => void;\r\n  contactsCount: number;\r\n  messagesCount: number;\r\n}) => {\r\n  const tabs = [\r\n    {\r\n      key: 'all' as const,\r\n      label: 'Tất cả',\r\n      icon: HiMagnifyingGlass,\r\n      count: contactsCount + messagesCount,\r\n    },\r\n    { key: 'contacts' as const, label: 'Liên hệ', icon: HiUser, count: contactsCount },\r\n    { key: 'messages' as const, label: 'Tin nhắn', icon: HiChatBubbleLeftRight, count: messagesCount },\r\n  ];\r\n\r\n  const formatCount = (n: number) => (n >= 99 ? '99+' : String(n));\r\n  return (\r\n    <div className=\"flex flex-nowrap border-b border-gray-200 bg-white sticky top-0 z-5 -mx-4 px-4 \">\r\n      {tabs.map((tab) => {\r\n        const isActive = activeTab === tab.key;\r\n        return (\r\n          <button\r\n            key={tab.key}\r\n            onClick={() => setActiveTab(tab.key)}\r\n            className={`flex-shrink-0 flex cursor-pointer items-center justify-center gap-2 py-4 px-3 text-sm font-semibold transition-all relative ${\r\n              isActive ? 'text-[#0088ff]' : 'text-gray-600 hover:text-gray-900'\r\n            }`}\r\n          >\r\n            <span>{tab.label}</span>\r\n            {isActive && <div className=\"absolute bottom-0 left-3 right-3 h-0.5 bg-[#0088ff] rounded-full\" />}\r\n          </button>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\n// === HIGHLIGHT TEXT ĐẸP NHƯ ZALO 2025 ===\r\nconst HighlightText = ({ text, keyword }: { text: string; keyword: string }) => {\r\n  if (!keyword.trim() || !text) return <span className=\"text-gray-800\">{text}</span>;\r\n  const regex = buildAccentInsensitiveRegex(keyword);\r\n  const parts = text.split(regex);\r\n  return (\r\n    <span>\r\n      {parts.map((part, i) =>\r\n        regex.test(part) ? (\r\n          <span key={i} className=\" text-blue-600 md:text-blue-700 rounded \">\r\n            {part}\r\n          </span>\r\n        ) : (\r\n          <span key={i} className=\"text-gray-800\">\r\n            {part}\r\n          </span>\r\n        ),\r\n      )}\r\n    </span>\r\n  );\r\n};\r\n\r\n// === LOADING & EMPTY STATE ===\r\nconst LoadingState = () => (\r\n  <div className=\"flex flex-col items-center justify-center py-16 text-gray-500\">\r\n    <div className=\"w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4\" />\r\n    <p className=\"text-lg font-medium\">Đang tìm kiếm...</p>\r\n  </div>\r\n);\r\n\r\nconst EmptyState = () => (\r\n  <div className=\"flex flex-col items-center justify-center py-20 text-center text-gray-400\">\r\n    <div className=\"p-10 bg-gray-100 rounded-full mb-6\">\r\n      <HiMagnifyingGlass className=\"w-20 h-20 text-gray-300\" />\r\n    </div>\r\n    <p className=\"text-xl font-semibold text-gray-500\">Không tìm thấy kết quả</p>\r\n    <p className=\"text-sm mt-2\">Thử tìm với từ khóa khác nhé!</p>\r\n  </div>\r\n);\r\n\r\n// === FORMAT TIME ===\r\nconst formatTime = (timestamp: number) => {\r\n  const date = new Date(timestamp);\r\n  const now = new Date();\r\n  const diff = now.getTime() - date.getTime();\r\n  const days = Math.floor(diff / (1000 * 60 * 60 * 24));\r\n\r\n  if (days === 0) return date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });\r\n  if (days === 1) return 'Hôm qua';\r\n  if (days < 7) return `${days} ngày trước`;\r\n  return date.toLocaleDateString('vi-VN');\r\n};\r\n\r\n// === SECTIONS ===\r\nconst ContactsSection = ({\r\n  contacts,\r\n  searchTerm,\r\n  onSelectContact,\r\n  currentUserId,\r\n}: {\r\n  contacts: ChatItemType[];\r\n  searchTerm: string;\r\n  onSelectContact: (contact: ChatItemType) => void;\r\n  currentUserId?: string;\r\n}) => {\r\n  if (contacts.length === 0) return null;\r\n\r\n  return (\r\n    <section className=\"space-y-3 p-2 bg-white\">\r\n      <div className=\"flex items-center gap-3 px-2\">\r\n        <h4 className=\"text-sm font-bold text-gray-800\">Liên hệ ({contacts.length})</h4>\r\n      </div>\r\n\r\n      {contacts.map((contact) => {\r\n        const isGroup = Boolean((contact as ChatItemType & { isGroup?: boolean }).isGroup);\r\n        let displayName = String(contact.name || contact.username || 'Người dùng').trim();\r\n\r\n        if (!isGroup && currentUserId) {\r\n          const user = contact as User;\r\n          if (user.nicknames?.[currentUserId]) {\r\n            displayName = user.nicknames[currentUserId];\r\n          }\r\n        }\r\n\r\n        return (\r\n          <button\r\n            key={contact._id}\r\n            onClick={() => onSelectContact(contact)}\r\n            className=\"w-full cursor-pointer flex items-center gap-4 p-2 rounded-2xl hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 transition-all active:scale-98 group\"\r\n          >\r\n            <div className=\"relative\">\r\n              <div className=\"w-12 h-12 rounded-3xl overflow-hidden ring-2 ring-white shadow-xl\">\r\n                {contact.avatar ? (\r\n                  <Image\r\n                    src={getProxyUrl(contact.avatar as string)}\r\n                    width={56}\r\n                    height={56}\r\n                    alt=\"\"\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <Image\r\n                    src=\"/logo/avata.webp\"\r\n                    alt={displayName}\r\n                    width={64}\r\n                    height={64}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                )}\r\n              </div>\r\n              {isGroup && (\r\n                <div className=\"absolute -bottom-1 -right-1 p-1.5 bg-purple-600 rounded-full shadow-lg\">\r\n                  <HiUsers className=\"w-3 h-3 text-white\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex-1 text-left border-b border-gray-200 pb-1\">\r\n              <p className=\" text-gray-900\">\r\n                <HighlightText text={displayName} keyword={searchTerm} />\r\n              </p>\r\n              <p className=\"text-sm text-gray-500 flex items-center gap-2\">\r\n                {isGroup ? <HiUsers className=\"w-4 h-4\" /> : <HiUser className=\"w-4 h-4\" />}\r\n                {isGroup ? 'Nhóm chat' : 'Liên hệ cá nhân'}\r\n              </p>\r\n            </div>\r\n          </button>\r\n        );\r\n      })}\r\n    </section>\r\n  );\r\n};\r\n\r\nconst MessagesSection = ({\r\n  groupedMessages,\r\n  searchTerm,\r\n  onNavigateToMessage,\r\n  onClearSearch,\r\n  onOpenRoomResults,\r\n}: {\r\n  groupedMessages: MessageGroup[];\r\n  searchTerm: string;\r\n  onNavigateToMessage: (message: Message) => void;\r\n  onClearSearch: () => void;\r\n  onOpenRoomResults?: (roomId: string, roomName: string, isGroupChat: boolean, avatar?: string) => void;\r\n}) => {\r\n  if (groupedMessages.length === 0) return null;\r\n  const formatCount = (n: number) => (n >= 99 ? '99+' : String(n));\r\n\r\n  return (\r\n    <section className=\" bg-white px-2 md:px-0\">\r\n      <div className=\"flex items-center gap-3 px-2 py-2\">\r\n        <h4 className=\"text-sm font-bold text-gray-800\">\r\n          Tin nhắn ({formatCount(groupedMessages.reduce((a, g) => a + g.messages.length, 0))})\r\n        </h4>\r\n      </div>\r\n\r\n      {groupedMessages.map((group) => (\r\n        <div key={group.roomId} className=\"bg-white flex overflow-hidden border-y border-gray-100 py-1\">\r\n          <div className=\"p-2 flex  gap-4\">\r\n            <div className=\"relative\">\r\n              <div className=\"w-12 h-12 rounded-3xl overflow-hidden ring-2 ring-white shadow-xl\">\r\n                {group.avatar ? (\r\n                  <Image\r\n                    src={getProxyUrl(group.avatar as string)}\r\n                    width={56}\r\n                    height={56}\r\n                    alt=\"\"\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <Image\r\n                    src=\"/logo/avata.webp\"\r\n                    alt={group.roomName}\r\n                    width={64}\r\n                    height={64}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                )}\r\n              </div>\r\n              {group.isGroupChat && (\r\n                <div className=\"absolute -top-2 -right-1 p-1.5 bg-emerald-700 rounded-full\">\r\n                  <HiUsers className=\"w-3 h-3 text-white\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"w-full\">\r\n            <div className=\"divide-y divide-gray-200\">\r\n              {group.messages.slice(0, 1).map((msg) => (\r\n                <button\r\n                  key={msg._id}\r\n                  onClick={() => {\r\n                    onNavigateToMessage(msg);\r\n                    onClearSearch();\r\n                  }}\r\n                  className=\"w-full  cursor-pointer px-5 text-left hover:bg-gray-50 transition-all flex items-start gap-4 active:scale-99\"\r\n                >\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\" justify-between mb-2\">\r\n                      <div className=\"flex-1 min-w-0 \">\r\n                        <div className=\"flex  justify-between\">\r\n                          <div className=\"\">\r\n                            <p className=\" text-gray-900 text-lg w-[14rem] md:w-[10rem] truncate\">{group.roomName}</p>\r\n                            <div className=\"flex items-center justify-between gap-2\">\r\n                              <p className=\"text-sm text-gray-600\">{group.isGroupChat ? 'Nhóm' : 'Chat cá nhân'}</p>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <span className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n                            <HiClock className=\"w-3 h-3\" />\r\n                            {formatTime(msg.timestamp)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                      <span className=\"font-bold text-gray-800\">{msg.senderName}</span>\r\n                    </div>\r\n                    <p className=\"text-gray-700 line-clamp-2\">\r\n                      <HighlightText\r\n                        text={\r\n                          msg.type === 'file'\r\n                            ? msg.fileName || 'File'\r\n                            : msg.type === 'image'\r\n                              ? 'Hình ảnh'\r\n                              : msg.type === 'video'\r\n                                ? 'Video'\r\n                                : msg.type === 'sticker'\r\n                                  ? 'Sticker'\r\n                                  : msg.content || 'Tin nhắn'\r\n                        }\r\n                        keyword={searchTerm}\r\n                      />\r\n                    </p>\r\n                  </div>\r\n                </button>\r\n              ))}\r\n              <button\r\n                onClick={() => {\r\n                  if (onOpenRoomResults) {\r\n                    onOpenRoomResults(group.roomId, group.roomName, group.isGroupChat, group.avatar);\r\n                  } else {\r\n                    onNavigateToMessage(group.messages[0]);\r\n                  }\r\n                  onClearSearch();\r\n                }}\r\n                className=\"flex px-5 py-3 items-center gap-1 text-[1rem]  hover:text-blue-700 cursor-pointer\"\r\n              >\r\n                <span className=\"\">{formatCount(group.messages.length)} kết quả phù hợp</span>\r\n                <HiChevronRight className=\"w-4 h-4\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </section>\r\n  );\r\n};\r\n\r\n// === MAIN COMPONENT ===\r\nexport default function SearchResults({\r\n  activeTab,\r\n  setActiveTab,\r\n  isSearching,\r\n  hasResults,\r\n  contacts,\r\n  groupedMessages,\r\n  searchTerm,\r\n  onSelectContact,\r\n  onNavigateToMessage,\r\n  currentUserId,\r\n  onOpenRoomResults,\r\n}: SearchResultsProps) {\r\n  const handleClearSearch = () => {\r\n    // Gọi từ Sidebar\r\n  };\r\n\r\n  return (\r\n    <div className=\"pb-20\">\r\n      <SearchTabs\r\n        activeTab={activeTab}\r\n        setActiveTab={setActiveTab}\r\n        contactsCount={contacts.length}\r\n        messagesCount={groupedMessages.reduce((a, g) => a + g.messages.length, 0)}\r\n      />\r\n\r\n      {isSearching && <LoadingState />}\r\n      {!isSearching && !hasResults && <EmptyState />}\r\n      {!isSearching && hasResults && (\r\n        <div className=\"space-y-3  bg-gray-200\">\r\n          {(activeTab === 'all' || activeTab === 'contacts') && (\r\n            <ContactsSection\r\n              contacts={contacts}\r\n              searchTerm={searchTerm}\r\n              onSelectContact={onSelectContact}\r\n              currentUserId={currentUserId}\r\n            />\r\n          )}\r\n          {(activeTab === 'all' || activeTab === 'messages') && (\r\n            <MessagesSection\r\n              groupedMessages={groupedMessages}\r\n              searchTerm={searchTerm}\r\n              onNavigateToMessage={onNavigateToMessage}\r\n              onClearSearch={handleClearSearch}\r\n              onOpenRoomResults={onOpenRoomResults}\r\n            />\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 691, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/MessageFilter.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\n\r\n// React Icons – Bộ hiện đại nhất\r\nimport { HiChatBubbleLeftRight, HiEnvelopeOpen, HiEnvelope, HiEyeSlash, HiUsers, HiUserCircle } from 'react-icons/hi2';\r\n\r\nexport type FilterType = 'all' | 'unread' | 'read' | 'group' | 'personal' | 'hidden';\r\n\r\ninterface MessageFilterProps {\r\n  filterType: FilterType;\r\n  setFilterType: (filter: FilterType) => void;\r\n  counts: {\r\n    all: number;\r\n    unread: number;\r\n    read: number;\r\n    group: number;\r\n    personal: number;\r\n    hidden: number;\r\n  };\r\n}\r\n\r\nexport const FILTER_CONFIG: Record<FilterType, { label: string; icon: React.ElementType; color: string }> = {\r\n  all: { label: 'Tất cả', icon: HiChatBubbleLeftRight, color: 'indigo' },\r\n  group: { label: 'Nhóm', icon: HiUsers, color: 'purple' },\r\n  personal: { label: 'Cá nhân', icon: HiUserCircle, color: 'pink' },\r\n  unread: { label: 'Chưa đọc', icon: HiEnvelope, color: 'blue' },\r\n  read: { label: 'Đã đọc', icon: HiEnvelopeOpen, color: 'green' },\r\n  hidden: { label: 'Ẩn', icon: HiEyeSlash, color: 'gray' },\r\n};\r\n\r\nexport default function MessageFilter({ filterType, setFilterType, counts }: MessageFilterProps) {\r\n  const filters: FilterType[] =\r\n    counts.hidden > 0\r\n      ? ['all', 'group', 'personal', 'unread', 'read', 'hidden']\r\n      : ['all', 'group', 'personal', 'unread', 'read'];\r\n\r\n  return (\r\n    <div className=\" bg-gradient-to-b from-white via-white to-gray-50/50 border-b border-gray-200\">\r\n      <div className=\"flex items-center gap-3 overflow-x-auto custom-scrollbar pb-3 pt-1\">\r\n        {filters.map((filter) => {\r\n          const { label, icon: Icon, color } = FILTER_CONFIG[filter];\r\n          const isActive = filterType === filter;\r\n          const count = counts[filter];\r\n\r\n          // Màu gradient theo từng filter\r\n          const gradientFrom = {\r\n            indigo: 'from-indigo-500',\r\n            blue: 'from-blue-500',\r\n            green: 'from-emerald-500',\r\n            purple: 'from-purple-500',\r\n            pink: 'from-pink-500',\r\n            gray: 'from-gray-500',\r\n          }[color];\r\n\r\n          const gradientTo = {\r\n            indigo: 'to-purple-600',\r\n            blue: 'to-cyan-600',\r\n            green: 'to-teal-600',\r\n            purple: 'to-fuchsia-600',\r\n            pink: 'to-rose-600',\r\n            gray: 'to-slate-600',\r\n          }[color];\r\n\r\n          return (\r\n            <button\r\n              key={filter}\r\n              onClick={() => setFilterType(filter)}\r\n              className={`\r\n                relative flex cursor-pointer items-center gap-2 px-4 py-2.5 rounded-2xl font-bold text-sm\r\n                transition-all duration-300 transform hover:scale-105 active:scale-95\r\n                shadow-lg hover:shadow-2xl flex-shrink-0 min-w-fit\r\n                ${\r\n                  isActive\r\n                    ? `bg-gradient-to-r ${gradientFrom} ${gradientTo} text-white shadow-${color}-500/30`\r\n                    : 'bg-white/80 backdrop-blur-sm text-gray-700 hover:bg-gray-100 border border-gray-200'\r\n                }\r\n              `}\r\n            >\r\n              {/* Icon */}\r\n              <Icon className=\"w-5 h-5\" />\r\n\r\n              {/* Label */}\r\n              <span>{label}</span>\r\n\r\n              {/* Badge số lượng */}\r\n              {count > 0 && (\r\n                <span\r\n                  className={`\r\n                    min-w-[1.6rem] px-2 py-0.5 text-xs font-bold rounded-full\r\n                    ${isActive ? 'bg-white/30 text-white backdrop-blur-sm' : 'bg-gray-200 text-gray-700'}\r\n                  `}\r\n                >\r\n                  {count > 99 ? '99+' : count}\r\n                </span>\r\n              )}\r\n\r\n              {/* Active Indicator – thanh dưới đẹp như Zalo Premium */}\r\n              {isActive && (\r\n                <div className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 w-16 h-1.5 bg-white/40 rounded-full blur-md\" />\r\n              )}\r\n              {isActive && (\r\n                <div className=\"absolute -bottom-2 left-1/2 -translate-x-1/2 w-12 h-1 bg-white rounded-t-full shadow-lg\" />\r\n              )}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAIA,iCAAiC;AACjC;AALA;;;AAsBO,MAAM,gBAA+F;IAC1G,KAAK;QAAE,OAAO;QAAU,MAAM,2KAAqB;QAAE,OAAO;IAAS;IACrE,OAAO;QAAE,OAAO;QAAQ,MAAM,6JAAO;QAAE,OAAO;IAAS;IACvD,UAAU;QAAE,OAAO;QAAW,MAAM,kKAAY;QAAE,OAAO;IAAO;IAChE,QAAQ;QAAE,OAAO;QAAY,MAAM,gKAAU;QAAE,OAAO;IAAO;IAC7D,MAAM;QAAE,OAAO;QAAU,MAAM,oKAAc;QAAE,OAAO;IAAQ;IAC9D,QAAQ;QAAE,OAAO;QAAM,MAAM,gKAAU;QAAE,OAAO;IAAO;AACzD;AAEe,SAAS,cAAc,EAAE,UAAU,EAAE,aAAa,EAAE,MAAM,EAAsB;IAC7F,MAAM,UACJ,OAAO,MAAM,GAAG,IACZ;QAAC;QAAO;QAAS;QAAY;QAAU;QAAQ;KAAS,GACxD;QAAC;QAAO;QAAS;QAAY;QAAU;KAAO;IAEpD,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;sBACZ,QAAQ,GAAG,CAAC,CAAC;gBACZ,MAAM,EAAE,KAAK,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,GAAG,aAAa,CAAC,OAAO;gBAC1D,MAAM,WAAW,eAAe;gBAChC,MAAM,QAAQ,MAAM,CAAC,OAAO;gBAE5B,gCAAgC;gBAChC,MAAM,eAAe;oBACnB,QAAQ;oBACR,MAAM;oBACN,OAAO;oBACP,QAAQ;oBACR,MAAM;oBACN,MAAM;gBACR,CAAC,CAAC,MAAM;gBAER,MAAM,aAAa;oBACjB,QAAQ;oBACR,MAAM;oBACN,OAAO;oBACP,QAAQ;oBACR,MAAM;oBACN,MAAM;gBACR,CAAC,CAAC,MAAM;gBAER,qBACE,6LAAC;oBAEC,SAAS,IAAM,cAAc;oBAC7B,WAAW,CAAC;;;;gBAIV,EACE,WACI,CAAC,iBAAiB,EAAE,aAAa,CAAC,EAAE,WAAW,mBAAmB,EAAE,MAAM,OAAO,CAAC,GAClF,sFACL;cACH,CAAC;;sCAGD,6LAAC;4BAAK,WAAU;;;;;;sCAGhB,6LAAC;sCAAM;;;;;;wBAGN,QAAQ,mBACP,6LAAC;4BACC,WAAW,CAAC;;oBAEV,EAAE,WAAW,4CAA4C,4BAA4B;kBACvF,CAAC;sCAEA,QAAQ,KAAK,QAAQ;;;;;;wBAKzB,0BACC,6LAAC;4BAAI,WAAU;;;;;;wBAEhB,0BACC,6LAAC;4BAAI,WAAU;;;;;;;mBApCZ;;;;;YAwCX;;;;;;;;;;;AAIR;KA/EwB"}},
    {"offset": {"line": 851, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/MediaEditor.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React, { useState, useCallback, useEffect, useRef, useMemo } from 'react';\r\nimport Image from 'next/image';\r\nimport { Cropper, CropperRef } from 'react-advanced-cropper';\r\nimport { HiX, HiCheck } from 'react-icons/hi';\r\nimport { FaCropSimple, FaPen, FaFaceSmile } from 'react-icons/fa6';\r\nimport { IoSend } from 'react-icons/io5';\r\nimport { getProxyUrl } from '@/utils/utils';\r\n\r\ninterface MediaEditorProps {\r\n  mediaUrl: string;\r\n  mediaType?: 'image' | 'video';\r\n  chatName?: string;\r\n  onClose: () => void;\r\n  onSend?: (data: {\r\n    description: string;\r\n    isHD: boolean;\r\n    selected: boolean;\r\n    imageDataUrl?: string;\r\n    videoCropConfig?: {\r\n      crop: { x: number; y: number };\r\n      zoom: number;\r\n      rotation: number;\r\n      croppedAreaPixels: { x: number; y: number; width: number; height: number } | null;\r\n    } | null;\r\n  }) => void;\r\n}\r\n\r\nexport default function MediaEditor({ mediaUrl, mediaType = 'image', chatName, onClose, onSend }: MediaEditorProps) {\r\n  const [description, setDescription] = useState('');\r\n  const [isHD, setIsHD] = useState(false);\r\n  const [selected, setSelected] = useState(false);\r\n\r\n  // Crop state\r\n  const [currentMedia, setCurrentMedia] = useState(mediaUrl);\r\n  // For video, we store crop config instead of blob\r\n  const [videoCropConfig, setVideoCropConfig] = useState<{\r\n    crop: { x: number; y: number };\r\n    zoom: number;\r\n    rotation: number;\r\n    croppedAreaPixels: { x: number; y: number; width: number; height: number } | null;\r\n    baseWidth?: number;\r\n    baseHeight?: number;\r\n  } | null>(null);\r\n\r\n  const [isCropping, setIsCropping] = useState(false);\r\n  const [zoom, setZoom] = useState(1);\r\n  const [rotation, setRotation] = useState(0);\r\n\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const [brushColor, setBrushColor] = useState('#ff3b30');\r\n  const [brushSize, setBrushSize] = useState(6);\r\n  const [isPointerDown, setIsPointerDown] = useState(false);\r\n  const [strokes, setStrokes] = useState<{ color: string; size: number; points: { x: number; y: number }[] }[]>([]);\r\n  const [constrainToMedia, setConstrainToMedia] = useState(true);\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const videoRef = useRef<HTMLVideoElement | null>(null);\r\n  const cropperRef = useRef<CropperRef>(null);\r\n  const [videoMeta, setVideoMeta] = useState<{ width: number; height: number } | null>(null);\r\n  const [displayRect, setDisplayRect] = useState<{ x: number; y: number; width: number; height: number } | null>(null);\r\n  const [isTexting, setIsTexting] = useState(false);\r\n  const [textInput, setTextInput] = useState('');\r\n  const [textColor, setTextColor] = useState('#ffffff');\r\n  const [textSize, setTextSize] = useState(20);\r\n  const [textEntries, setTextEntries] = useState<\r\n    { id: string; text: string; x: number; y: number; color: string; size: number }[]\r\n  >([]);\r\n  const [draggingTextId, setDraggingTextId] = useState<string | null>(null);\r\n  const [dragOffset, setDragOffset] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\r\n  const [selectedTextId, setSelectedTextId] = useState<string | null>(null);\r\n  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });\r\n  const croppedVideoRef = useRef<HTMLVideoElement | null>(null);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!containerRef.current) return;\r\n    const updateSize = () => {\r\n      if (containerRef.current) {\r\n        setContainerSize({\r\n          width: containerRef.current.clientWidth,\r\n          height: containerRef.current.clientHeight,\r\n        });\r\n      }\r\n    };\r\n\r\n    const observer = new ResizeObserver(updateSize);\r\n    observer.observe(containerRef.current);\r\n    updateSize(); // Initial check\r\n\r\n    return () => observer.disconnect();\r\n  }, []);\r\n\r\n  const generateVideoPoster = useCallback(async (): Promise<string | null> => {\r\n    // Helper to capture from a video element\r\n    const capture = (video: HTMLVideoElement): string | null => {\r\n      try {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return null;\r\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n        return canvas.toDataURL('image/jpeg', 0.92);\r\n      } catch (e) {\r\n        console.warn('Failed to capture video frame (likely CORS):', e);\r\n        return null;\r\n      }\r\n    };\r\n\r\n    // Try using the existing video ref first\r\n    if (videoRef.current && videoRef.current.videoWidth && videoRef.current.videoHeight) {\r\n      const result = capture(videoRef.current);\r\n      if (result) return result;\r\n    }\r\n\r\n    // Fallback: create a new video element with crossOrigin\r\n    try {\r\n      const v = document.createElement('video');\r\n      v.crossOrigin = 'anonymous'; // Important for CORS\r\n      v.muted = true;\r\n      v.playsInline = true;\r\n\r\n      await new Promise<void>((resolve, reject) => {\r\n        v.addEventListener('loadeddata', () => resolve(), { once: true });\r\n        v.addEventListener('error', reject, { once: true });\r\n        v.src = getProxyUrl(currentMedia);\r\n        v.load();\r\n      });\r\n\r\n      // Ensure we have a frame (sometimes loadeddata is enough, but seek might be safer if black)\r\n      if (v.currentTime === 0) {\r\n        v.currentTime = 0.1;\r\n        await new Promise((r) => v.addEventListener('seeked', r, { once: true }));\r\n      }\r\n\r\n      return capture(v);\r\n    } catch (e) {\r\n      console.error('Failed to generate video poster fallback:', e);\r\n      return null;\r\n    }\r\n  }, [currentMedia]);\r\n\r\n  const ensureCanvasSize = useCallback(() => {\r\n    const c = canvasRef.current;\r\n    const container = containerRef.current;\r\n    if (!c || !container) return;\r\n    const w = container.clientWidth;\r\n    const h = container.clientHeight;\r\n    if (c.width !== w) c.width = w;\r\n    if (c.height !== h) c.height = h;\r\n  }, []);\r\n\r\n  const computeRect = useCallback((containerW: number, containerH: number, mediaW: number, mediaH: number) => {\r\n    const imgAspect = mediaW / mediaH;\r\n    const containerAspect = containerW / containerH;\r\n    if (imgAspect > containerAspect) {\r\n      const dw = containerW;\r\n      const dh = containerW / imgAspect;\r\n      const dy = (containerH - dh) / 2;\r\n      const rdw = Math.round(dw);\r\n      const rdh = Math.round(dh);\r\n      const rdy = Math.round(dy);\r\n      setDisplayRect({ x: 0, y: rdy, width: rdw, height: rdh });\r\n    } else {\r\n      const dh = containerH;\r\n      const dw = containerH * imgAspect;\r\n      const dx = (containerW - dw) / 2;\r\n      const rdh = Math.round(dh);\r\n      const rdw = Math.round(dw);\r\n      const rdx = Math.round(dx);\r\n      setDisplayRect({ x: rdx, y: 0, width: rdw, height: rdh });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!isCropping) return;\r\n    const ref = cropperRef.current;\r\n    if (!ref) return;\r\n    const state = ref.getState();\r\n    if (!state) return;\r\n    ref.setState({\r\n      ...state,\r\n      transforms: {\r\n        ...(state.transforms || {}),\r\n        rotate: rotation,\r\n      },\r\n    });\r\n  }, [zoom, rotation, isCropping]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n    if (mediaType === 'image') {\r\n      const im = new window.Image();\r\n      im.onload = () =>\r\n        computeRect(\r\n          container.clientWidth,\r\n          container.clientHeight,\r\n          im.naturalWidth || im.width,\r\n          im.naturalHeight || im.height,\r\n        );\r\n      im.src = getProxyUrl(currentMedia);\r\n    }\r\n  }, [computeRect, currentMedia, mediaType]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    const v = videoRef.current;\r\n    if (!container || !v || mediaType !== 'video') return;\r\n    if (v.videoWidth && v.videoHeight) {\r\n      computeRect(container.clientWidth, container.clientHeight, v.videoWidth, v.videoHeight);\r\n    }\r\n  }, [computeRect, mediaType]);\r\n\r\n  useEffect(() => {\r\n    if (mediaType !== 'video') return;\r\n    if (!videoCropConfig || !videoCropConfig.croppedAreaPixels) return;\r\n    const { width: cw, height: ch } = containerSize;\r\n    if (cw <= 0 || ch <= 0) return;\r\n    const { width: kw, height: kh } = videoCropConfig.croppedAreaPixels;\r\n    const rotate = videoCropConfig.rotation || 0;\r\n    if (rotate === 0) {\r\n      const scale = Math.min(cw / kw, ch / kh);\r\n      const dw = Math.round(kw * scale);\r\n      const dh = Math.round(kh * scale);\r\n      const dx = Math.round((cw - dw) / 2);\r\n      const dy = Math.round((ch - dh) / 2);\r\n      setDisplayRect({ x: dx, y: dy, width: dw, height: dh });\r\n    } else {\r\n      setDisplayRect({ x: 0, y: 0, width: cw, height: ch });\r\n    }\r\n  }, [mediaType, videoCropConfig, containerSize]);\r\n\r\n  const drawStrokeSegment = useCallback(\r\n    (ctx: CanvasRenderingContext2D, stroke: { color: string; size: number; points: { x: number; y: number }[] }) => {\r\n      if (stroke.points.length < 2) {\r\n        const p = stroke.points[0];\r\n        if (!p) return;\r\n        ctx.beginPath();\r\n        ctx.arc(p.x, p.y, stroke.size / 2, 0, Math.PI * 2);\r\n        ctx.fillStyle = stroke.color;\r\n        ctx.fill();\r\n        return;\r\n      }\r\n      ctx.strokeStyle = stroke.color;\r\n      ctx.lineWidth = stroke.size;\r\n      ctx.lineJoin = 'round';\r\n      ctx.lineCap = 'round';\r\n      ctx.beginPath();\r\n      const [p0, ...rest] = stroke.points;\r\n      ctx.moveTo(p0.x, p0.y);\r\n      for (const p of rest) ctx.lineTo(p.x, p.y);\r\n      ctx.stroke();\r\n    },\r\n    [],\r\n  );\r\n\r\n  const redrawOverlay = useCallback(() => {\r\n    const c = canvasRef.current;\r\n    if (!c) return;\r\n    const ctx = c.getContext('2d');\r\n    if (!ctx) return;\r\n    ctx.clearRect(0, 0, c.width, c.height);\r\n    if (displayRect && constrainToMedia) {\r\n      ctx.save();\r\n      ctx.beginPath();\r\n      ctx.rect(displayRect.x, displayRect.y, displayRect.width, displayRect.height);\r\n      ctx.clip();\r\n    }\r\n    for (const s of strokes) drawStrokeSegment(ctx, s);\r\n    if (displayRect && constrainToMedia) {\r\n      ctx.restore();\r\n    }\r\n  }, [strokes, drawStrokeSegment, displayRect, constrainToMedia]);\r\n\r\n  const [videoPoster, setVideoPoster] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    ensureCanvasSize();\r\n    redrawOverlay();\r\n  }, [ensureCanvasSize, redrawOverlay, isDrawing]);\r\n\r\n  useEffect(() => {\r\n    const handler = () => {\r\n      ensureCanvasSize();\r\n      redrawOverlay();\r\n    };\r\n    window.addEventListener('resize', handler);\r\n    return () => window.removeEventListener('resize', handler);\r\n  }, [ensureCanvasSize, redrawOverlay]);\r\n\r\n  const pointerPos = (e: React.MouseEvent | React.TouchEvent) => {\r\n    const c = canvasRef.current;\r\n    if (!c) return { x: 0, y: 0 };\r\n    const rect = c.getBoundingClientRect();\r\n    if ('touches' in e && e.touches.length) {\r\n      const t = e.touches[0];\r\n      return { x: t.clientX - rect.left, y: t.clientY - rect.top };\r\n    }\r\n    const me = e as React.MouseEvent;\r\n    return { x: me.clientX - rect.left, y: me.clientY - rect.top };\r\n  };\r\n\r\n  const startDraw = (e: React.MouseEvent | React.TouchEvent) => {\r\n    if (!isDrawing) return;\r\n    ensureCanvasSize();\r\n    setIsPointerDown(true);\r\n    const p = pointerPos(e);\r\n    if (displayRect && constrainToMedia) {\r\n      const outsideX = p.x < displayRect.x || p.x > displayRect.x + displayRect.width;\r\n      const outsideY = p.y < displayRect.y || p.y > displayRect.y + displayRect.height;\r\n      if (outsideX || outsideY) {\r\n        return;\r\n      }\r\n    }\r\n    let cp = p;\r\n    if (displayRect && constrainToMedia) {\r\n      const cx = Math.min(Math.max(p.x, displayRect.x), displayRect.x + displayRect.width);\r\n      const cy = Math.min(Math.max(p.y, displayRect.y), displayRect.y + displayRect.height);\r\n      cp = { x: cx, y: cy };\r\n    }\r\n    setStrokes((prev) => [...prev, { color: brushColor, size: brushSize, points: [cp] }]);\r\n  };\r\n\r\n  const moveDraw = (e: React.MouseEvent | React.TouchEvent) => {\r\n    if (!isDrawing || !isPointerDown) return;\r\n    const p = pointerPos(e);\r\n    let cp = p;\r\n    if (displayRect && constrainToMedia) {\r\n      const cx = Math.min(Math.max(p.x, displayRect.x), displayRect.x + displayRect.width);\r\n      const cy = Math.min(Math.max(p.y, displayRect.y), displayRect.y + displayRect.height);\r\n      cp = { x: cx, y: cy };\r\n    }\r\n    setStrokes((prev) => {\r\n      if (!prev.length) return prev;\r\n      const last = prev[prev.length - 1];\r\n      const updated = { ...last, points: [...last.points, cp] };\r\n      const next = [...prev.slice(0, -1), updated];\r\n      return next;\r\n    });\r\n    redrawOverlay();\r\n  };\r\n\r\n  const endDraw = () => {\r\n    if (!isDrawing) return;\r\n    setIsPointerDown(false);\r\n  };\r\n  const handleSaveCrop = async () => {\r\n    try {\r\n      if (!cropperRef.current) return;\r\n\r\n      if (mediaType === 'image') {\r\n        const canvas = cropperRef.current.getCanvas();\r\n        if (canvas) {\r\n          const dataUrl = canvas.toDataURL('image/jpeg', 0.92);\r\n          setCurrentMedia(dataUrl);\r\n          setIsCropping(false);\r\n          setRotation(0);\r\n          setZoom(1);\r\n        }\r\n      } else {\r\n        // Video\r\n        const state = cropperRef.current.getState();\r\n        const coordinates = cropperRef.current.getCoordinates();\r\n        if (state && coordinates) {\r\n          const baseW = containerRef.current?.clientWidth || coordinates.width;\r\n          const baseH = containerRef.current?.clientHeight || coordinates.height;\r\n          setVideoCropConfig({\r\n            crop: { x: coordinates.left, y: coordinates.top },\r\n            zoom: 1,\r\n            rotation: state.transforms.rotate || 0,\r\n            croppedAreaPixels: {\r\n              x: coordinates.left,\r\n              y: coordinates.top,\r\n              width: coordinates.width,\r\n              height: coordinates.height,\r\n            },\r\n            baseWidth: baseW,\r\n            baseHeight: baseH,\r\n          });\r\n          setIsCropping(false);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  };\r\n\r\n  const applyDrawing = async () => {\r\n    try {\r\n      const container = containerRef.current;\r\n      const c = canvasRef.current;\r\n      if (!container || !c || strokes.length === 0) {\r\n        setIsDrawing(false);\r\n        return;\r\n      }\r\n      if (mediaType === 'video') {\r\n        setIsDrawing(false);\r\n        return;\r\n      }\r\n      const img = await new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new window.Image();\r\n        im.crossOrigin = 'anonymous';\r\n        im.onload = () => resolve(im);\r\n        im.onerror = reject;\r\n        im.src = getProxyUrl(currentMedia);\r\n      });\r\n      const w = container.clientWidth;\r\n      const h = container.clientHeight;\r\n      const out = document.createElement('canvas');\r\n      out.width = w;\r\n      out.height = h;\r\n      const ctx = out.getContext('2d')!;\r\n      const imgAspect = img.width / img.height;\r\n      const containerAspect = w / h;\r\n      if (imgAspect > containerAspect) {\r\n        const dw = w;\r\n        const dh = w / imgAspect;\r\n        const dy = (h - dh) / 2;\r\n        ctx.drawImage(img, 0, dy, dw, dh);\r\n      } else {\r\n        const dh = h;\r\n        const dw = h * imgAspect;\r\n        const dx = (w - dw) / 2;\r\n        ctx.drawImage(img, dx, 0, dw, dh);\r\n      }\r\n      const overlay = c.getContext('2d')!;\r\n      const copy = overlay.getImageData(0, 0, c.width, c.height);\r\n      const tmp = document.createElement('canvas');\r\n      tmp.width = c.width;\r\n      tmp.height = c.height;\r\n      const tctx = tmp.getContext('2d')!;\r\n      tctx.putImageData(copy, 0, 0);\r\n      ctx.drawImage(tmp, 0, 0, w, h);\r\n      const dataUrl = out.toDataURL('image/jpeg', 0.92);\r\n      setCurrentMedia(dataUrl);\r\n      setIsDrawing(false);\r\n      setStrokes([]);\r\n      const ctxOverlay = c.getContext('2d');\r\n      if (ctxOverlay) ctxOverlay.clearRect(0, 0, c.width, c.height);\r\n    } catch (e) {\r\n      setIsDrawing(false);\r\n    }\r\n  };\r\n\r\n  const applyTextToImage = async () => {\r\n    try {\r\n      const container = containerRef.current;\r\n      if (!container || mediaType === 'video' || textEntries.length === 0) return;\r\n      const img = await new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new window.Image();\r\n        im.crossOrigin = 'anonymous';\r\n        im.onload = () => resolve(im);\r\n        im.onerror = reject;\r\n        im.src = getProxyUrl(currentMedia);\r\n      });\r\n      const w = container.clientWidth;\r\n      const h = container.clientHeight;\r\n      const imgAspect = img.width / img.height;\r\n      const containerAspect = w / h;\r\n      const draw = (() => {\r\n        if (imgAspect > containerAspect) {\r\n          const dw = w;\r\n          const dh = w / imgAspect;\r\n          const dx = 0;\r\n          const dy = (h - dh) / 2;\r\n          return { dx, dy, dw, dh };\r\n        } else {\r\n          const dh = h;\r\n          const dw = h * imgAspect;\r\n          const dx = (w - dw) / 2;\r\n          const dy = 0;\r\n          return { dx, dy, dw, dh };\r\n        }\r\n      })();\r\n\r\n      const out = document.createElement('canvas');\r\n      out.width = img.width;\r\n      out.height = img.height;\r\n      const ctx = out.getContext('2d')!;\r\n      ctx.drawImage(img, 0, 0, out.width, out.height);\r\n\r\n      const overlayCanvas = canvasRef.current;\r\n      if (overlayCanvas) {\r\n        const s = out.width / draw.dw;\r\n        ctx.drawImage(overlayCanvas, draw.dx, draw.dy, draw.dw, draw.dh, 0, 0, out.width, out.height);\r\n        ctx.textAlign = 'center';\r\n        ctx.textBaseline = 'middle';\r\n        for (const t of textEntries) {\r\n          const tx = (t.x - draw.dx) * s;\r\n          const ty = (t.y - draw.dy) * s;\r\n          const fontSize = t.size * s;\r\n          ctx.fillStyle = t.color;\r\n          ctx.font = `${fontSize}px sans-serif`;\r\n          ctx.fillText(t.text, tx, ty);\r\n        }\r\n      }\r\n\r\n      const dataUrl = out.toDataURL('image/jpeg', 0.92);\r\n      setCurrentMedia(dataUrl);\r\n      setTextEntries([]);\r\n      setSelectedTextId(null);\r\n    } catch {}\r\n  };\r\n\r\n  const handleRestore = () => {\r\n    setCurrentMedia(mediaUrl);\r\n    setVideoCropConfig(null);\r\n    setRotation(0);\r\n    setZoom(1);\r\n    setIsDrawing(false);\r\n    setStrokes([]);\r\n    setIsTexting(false);\r\n    setTextEntries([]);\r\n    setTextInput('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[10001] bg-black flex flex-col\">\r\n      {/* Top Bar */}\r\n      <div className=\"px-4 py-4 flex items-center justify-between text-white bg-black border-b border-white/10\">\r\n        {isCropping ? (\r\n          <div className=\"flex items-center justify-between w-full pointer-events-auto\">\r\n            <button onClick={() => setIsCropping(false)} className=\"cursor-pointer p-2 -ml-2\">\r\n              <HiX className=\"w-8 h-8\" />\r\n            </button>\r\n            <div className=\"text-lg font-semibold\">Cắt ảnh</div>\r\n            <button onClick={handleSaveCrop} className=\"p-2 -mr-2 text-blue-400\">\r\n              <HiCheck className=\"w-8 h-8\" />\r\n            </button>\r\n          </div>\r\n        ) : isDrawing ? (\r\n          <div className=\"flex items-center justify-between w-full pointer-events-auto\">\r\n            <button\r\n              onClick={() => {\r\n                setIsDrawing(false);\r\n                setStrokes([]);\r\n                const c = canvasRef.current;\r\n                const ctx = c?.getContext('2d');\r\n                if (c && ctx) ctx.clearRect(0, 0, c.width, c.height);\r\n              }}\r\n              className=\"cursor-pointer p-2 -ml-2\"\r\n            >\r\n              <HiX className=\"w-8 h-8\" />\r\n            </button>\r\n            <div className=\"text-lg font-semibold\">Vẽ</div>\r\n            <button onClick={applyDrawing} className=\"cursor-pointer p-2 -mr-2 text-blue-400\">\r\n              <HiCheck className=\"w-8 h-8\" />\r\n            </button>\r\n          </div>\r\n        ) : isTexting ? (\r\n          <div className=\"flex items-center justify-between w-full pointer-events-auto\">\r\n            <button\r\n              onClick={() => {\r\n                setIsTexting(false);\r\n                setTextInput('');\r\n              }}\r\n              className=\"cursor-pointer p-2 -ml-2\"\r\n            >\r\n              <HiX className=\"w-8 h-8\" />\r\n            </button>\r\n            <div className=\"text-lg font-semibold\">Văn bản</div>\r\n            <button\r\n              onClick={() => {\r\n                const container = containerRef.current;\r\n                if (!container || !textInput.trim() || !displayRect) {\r\n                  setIsTexting(false);\r\n                  setTextInput('');\r\n                  return;\r\n                }\r\n                const id = Math.random().toString(36).slice(2);\r\n                setTextEntries((prev) => [\r\n                  ...prev,\r\n                  {\r\n                    id,\r\n                    text: textInput.trim(),\r\n                    x: Math.round(displayRect.x + displayRect.width / 2),\r\n                    y: Math.round(displayRect.y + displayRect.height / 2),\r\n                    color: textColor,\r\n                    size: textSize,\r\n                  },\r\n                ]);\r\n                setIsTexting(false);\r\n                setTextInput('');\r\n              }}\r\n              className=\"cursor-pointer p-2 -mr-2 text-blue-400\"\r\n            >\r\n              <HiCheck className=\"w-8 h-8\" />\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex items-center justify-between w-full pointer-events-auto\">\r\n            <button onClick={onClose} className=\"cursor-pointer p-2 -ml-2\">\r\n              <HiX className=\"w-8 h-8\" />\r\n            </button>\r\n            <div className=\"flex items-center gap-6\">\r\n              {currentMedia !== mediaUrl || videoCropConfig ? (\r\n                <button\r\n                  onClick={handleRestore}\r\n                  className=\"cursor-pointer px-3 py-1 rounded-full bg-white/10 text-xs hover:bg-white/20\"\r\n                >\r\n                  Khôi phục\r\n                </button>\r\n              ) : null}\r\n              <button\r\n                className=\"cursor-pointer p-2\"\r\n                onClick={async () => {\r\n                  if (mediaType === 'video') {\r\n                    const poster = await generateVideoPoster();\r\n                    if (poster) setVideoPoster(poster);\r\n                  }\r\n                  setIsCropping(true);\r\n                }}\r\n              >\r\n                <FaCropSimple className=\"w-6 h-6\" />\r\n              </button>\r\n              <button className=\"cursor-pointer p-2\" onClick={() => setIsDrawing(true)}>\r\n                <FaPen className=\"w-6 h-6\" />\r\n              </button>\r\n              <button className=\"cursor-pointer p-2 font-serif text-xl font-bold\" onClick={() => setIsTexting(true)}>\r\n                Aa\r\n              </button>\r\n              {textEntries.length > 0 && mediaType === 'image' ? (\r\n                <button\r\n                  onClick={applyTextToImage}\r\n                  className=\"cursor-pointer px-3 py-1 rounded-full bg-white/10 text-xs hover:bg-white/20\"\r\n                >\r\n                  Áp dụng văn bản\r\n                </button>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Main Image Area */}\r\n      <div\r\n        className=\"flex-1 flex items-center justify-center bg-black overflow-hidden relative w-full h-full\"\r\n        ref={containerRef}\r\n      >\r\n        {isCropping ? (\r\n          <div className=\"relative w-full h-full\">\r\n            <Cropper\r\n              ref={cropperRef}\r\n              src={mediaType === 'video' ? videoPoster || '' : getProxyUrl(currentMedia)}\r\n              className=\"w-full h-full object-contain\"\r\n              stencilProps={{\r\n                aspectRatio: undefined,\r\n              }}\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className=\"relative w-full h-full flex items-center justify-center\">\r\n            {mediaType === 'image' ? (\r\n              <Image src={getProxyUrl(currentMedia)} alt=\"Editing\" fill className=\"object-contain\" priority />\r\n            ) : null}\r\n            {textEntries.map((t) => (\r\n              <div\r\n                key={t.id}\r\n                style={{\r\n                  position: 'absolute',\r\n                  left: t.x,\r\n                  top: t.y,\r\n                  transform: 'translate(-50%, -50%)',\r\n                  color: t.color,\r\n                  fontSize: `${t.size}px`,\r\n                  fontWeight: 700,\r\n                  cursor: 'grab',\r\n                  userSelect: 'none',\r\n                }}\r\n                onMouseDown={(e) => {\r\n                  setDraggingTextId(t.id);\r\n                  setDragOffset({ x: e.clientX - t.x, y: e.clientY - t.y });\r\n                  setSelectedTextId(t.id);\r\n                }}\r\n                onMouseMove={(e) => {\r\n                  if (draggingTextId !== t.id) return;\r\n                  const nx = e.clientX - dragOffset.x;\r\n                  const ny = e.clientY - dragOffset.y;\r\n                  const cx = displayRect\r\n                    ? Math.min(Math.max(nx, displayRect.x), displayRect.x + displayRect.width)\r\n                    : nx;\r\n                  const cy = displayRect\r\n                    ? Math.min(Math.max(ny, displayRect.y), displayRect.y + displayRect.height)\r\n                    : ny;\r\n                  setTextEntries((prev) => prev.map((it) => (it.id === t.id ? { ...it, x: cx, y: cy } : it)));\r\n                }}\r\n                onMouseUp={() => {\r\n                  if (draggingTextId === t.id) setDraggingTextId(null);\r\n                }}\r\n                onTouchStart={(e) => {\r\n                  const touch = e.touches[0];\r\n                  setDraggingTextId(t.id);\r\n                  setDragOffset({ x: touch.clientX - t.x, y: touch.clientY - t.y });\r\n                  setSelectedTextId(t.id);\r\n                }}\r\n                onTouchMove={(e) => {\r\n                  if (draggingTextId !== t.id) return;\r\n                  const touch = e.touches[0];\r\n                  const nx = touch.clientX - dragOffset.x;\r\n                  const ny = touch.clientY - dragOffset.y;\r\n                  const cx = displayRect\r\n                    ? Math.min(Math.max(nx, displayRect.x), displayRect.x + displayRect.width)\r\n                    : nx;\r\n                  const cy = displayRect\r\n                    ? Math.min(Math.max(ny, displayRect.y), displayRect.y + displayRect.height)\r\n                    : ny;\r\n                  setTextEntries((prev) => prev.map((it) => (it.id === t.id ? { ...it, x: cx, y: cy } : it)));\r\n                }}\r\n                onTouchEnd={() => {\r\n                  if (draggingTextId === t.id) setDraggingTextId(null);\r\n                }}\r\n              >\r\n                <span className=\"relative inline-block\">\r\n                  {t.text}\r\n                  {selectedTextId === t.id && (\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        setTextEntries((prev) => prev.filter((it) => it.id !== t.id));\r\n                        setSelectedTextId(null);\r\n                      }}\r\n                      className=\"absolute -top-3 -right-3 w-6 h-6 rounded-full bg-red-600 text-white flex items-center justify-center shadow\"\r\n                      title=\"Xóa\"\r\n                    >\r\n                      <HiX className=\"w-4 h-4\" />\r\n                    </button>\r\n                  )}\r\n                </span>\r\n              </div>\r\n            ))}\r\n\r\n            {mediaType === 'video' && videoCropConfig && videoCropConfig.croppedAreaPixels && (\r\n              <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                {(() => {\r\n                  const { x, y, width: kw, height: kh } = videoCropConfig.croppedAreaPixels!;\r\n                  const { width: cw, height: ch } = containerSize;\r\n                  const rotate = videoCropConfig.rotation || 0;\r\n\r\n                  // If not rotated, we can play the video cropped\r\n                  if (rotate === 0 && videoMeta && cw > 0 && ch > 0) {\r\n                    const scale = Math.min(cw / kw, ch / kh);\r\n                    const dw = kw * scale;\r\n                    const dh = kh * scale;\r\n                    const vw = videoMeta.width * scale;\r\n                    const vh = videoMeta.height * scale;\r\n\r\n                    return (\r\n                      <div\r\n                        style={{\r\n                          width: dw,\r\n                          height: dh,\r\n                          overflow: 'hidden',\r\n                          position: 'relative',\r\n                        }}\r\n                      >\r\n                        <video\r\n                          src={getProxyUrl(currentMedia)}\r\n                          autoPlay={!isMuted}\r\n                          loop\r\n                          muted={isMuted}\r\n                          playsInline\r\n                          webkit-playsinline=\"true\"\r\n                          onLoadedMetadata={(e) => {\r\n                            const v = e.currentTarget;\r\n                            if (!videoMeta || videoMeta.width !== v.videoWidth || videoMeta.height !== v.videoHeight) {\r\n                              setVideoMeta({ width: v.videoWidth, height: v.videoHeight });\r\n                            }\r\n                          }}\r\n                          ref={croppedVideoRef}\r\n                          style={{\r\n                            position: 'absolute',\r\n                            left: -x * scale,\r\n                            top: -y * scale,\r\n                            width: vw,\r\n                            height: vh,\r\n                            maxWidth: 'none',\r\n                            maxHeight: 'none',\r\n                          }}\r\n                        />\r\n                        <button\r\n                          onClick={() => {\r\n                            const v = croppedVideoRef.current;\r\n                            setIsMuted((prev) => {\r\n                              const next = !prev;\r\n                              if (v) {\r\n                                v.muted = next;\r\n                                if (!next) v.play().catch(() => {});\r\n                              }\r\n                              return next;\r\n                            });\r\n                          }}\r\n                          className=\"absolute bottom-4 left-4 px-3 py-1.5 rounded-full bg-black/60 text-white text-xs border border-white/20\"\r\n                          title={isMuted ? 'Bật âm thanh' : 'Tắt âm thanh'}\r\n                        >\r\n                          {isMuted ? 'Bật âm thanh' : 'Tắt âm thanh'}\r\n                        </button>\r\n                      </div>\r\n                    );\r\n                  }\r\n\r\n                  // Fallback to static poster for rotated video or missing meta\r\n                  return (\r\n                    <Cropper\r\n                      src={videoPoster || getProxyUrl(currentMedia)}\r\n                      defaultCoordinates={{\r\n                        left: videoCropConfig.croppedAreaPixels!.x,\r\n                        top: videoCropConfig.croppedAreaPixels!.y,\r\n                        width: videoCropConfig.croppedAreaPixels!.width,\r\n                        height: videoCropConfig.croppedAreaPixels!.height,\r\n                      }}\r\n                      stencilProps={{\r\n                        movable: false,\r\n                        resizable: false,\r\n                      }}\r\n                      className=\"w-full h-full object-contain pointer-events-none\"\r\n                      backgroundClassName=\"bg-black/95\"\r\n                    />\r\n                  );\r\n                })()}\r\n              </div>\r\n            )}\r\n            {mediaType === 'video' && !videoCropConfig && (\r\n              <div className=\"relative w-full h-full flex items-center justify-center\">\r\n                <video\r\n                  src={getProxyUrl(currentMedia)}\r\n                  crossOrigin=\"anonymous\"\r\n                  autoPlay\r\n                  loop\r\n                  muted={false}\r\n                  controls={false}\r\n                  ref={videoRef}\r\n                  onLoadedMetadata={() => {\r\n                    const container = containerRef.current;\r\n                    const v = videoRef.current;\r\n                    if (!container || !v) return;\r\n                    setVideoMeta({ width: v.videoWidth, height: v.videoHeight });\r\n                    computeRect(container.clientWidth, container.clientHeight, v.videoWidth, v.videoHeight);\r\n                    generateVideoPoster().then((p) => {\r\n                      if (p) setVideoPoster(p);\r\n                    });\r\n                  }}\r\n                  className=\"max-w-full max-h-full object-contain\"\r\n                />\r\n              </div>\r\n            )}\r\n            <canvas\r\n              ref={canvasRef}\r\n              className=\"absolute inset-0\"\r\n              style={{ pointerEvents: isDrawing ? 'auto' : 'none' }}\r\n              onMouseDown={startDraw}\r\n              onMouseMove={moveDraw}\r\n              onMouseUp={endDraw}\r\n              onMouseLeave={endDraw}\r\n              onTouchStart={startDraw}\r\n              onTouchMove={moveDraw}\r\n              onTouchEnd={endDraw}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Bottom Bar - Hide when cropping */}\r\n      {!isCropping && !isDrawing && !isTexting && (\r\n        <div className=\"px-4 py-4 pb-8 flex flex-col gap-4 border-t border-white/10 bg-black\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"flex-1 bg-gray-800/80 backdrop-blur-md rounded-full flex items-center px-4 py-2 border border-white/10\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder={`Nhập mô tả gửi ${chatName || '...'}`}\r\n                className=\"w-full bg-transparent text-white placeholder-gray-400 outline-none text-sm\"\r\n                value={description}\r\n                onChange={(e) => setDescription(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <button\r\n              onClick={() => setIsHD(!isHD)}\r\n              className={`cursor-pointer flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${\r\n                isHD ? 'bg-white text-black' : 'bg-white/10 text-white hover:bg-white/20'\r\n              }`}\r\n            >\r\n              HD\r\n              <span className=\"text-[10px] leading-none\">▼</span>\r\n            </button>\r\n\r\n            <div className=\"flex items-center gap-4\">\r\n              <button onClick={() => setSelected(!selected)} className=\"flex items-center gap-2 text-white text-sm\">\r\n                <div\r\n                  className={`cursor-pointer w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${\r\n                    selected ? 'bg-blue-500 border-blue-500' : 'border-white/60'\r\n                  }`}\r\n                >\r\n                  {selected && <div className=\"w-2.5 h-2.5 bg-white rounded-full\" />}\r\n                </div>\r\n                <span>Chọn</span>\r\n              </button>\r\n\r\n              <button\r\n                onClick={async () => {\r\n                  if (mediaType === 'image') {\r\n                    const hasStrokes = strokes.length > 0;\r\n                    const hasText = textEntries.length > 0;\r\n                    if (hasStrokes || hasText) {\r\n                      await applyTextToImage();\r\n                    }\r\n                  }\r\n                  onSend?.({\r\n                    description,\r\n                    isHD,\r\n                    selected,\r\n                    imageDataUrl: mediaType === 'image' ? currentMedia : undefined,\r\n                    videoCropConfig,\r\n                  });\r\n                  onClose();\r\n                }}\r\n                className=\"cursor-pointer w-10 h-10 bg-blue-500 hover:bg-blue-600 rounded-full flex items-center justify-center text-white transition-colors\"\r\n              >\r\n                <IoSend className=\"w-5 h-5 ml-0.5\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {isTexting && (\r\n        <div className=\"px-4 py-4 pb-8 flex flex-col gap-4 border-t border-white/10 bg-black\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"flex-1 bg-gray-800/80 backdrop-blur-md rounded-full flex items-center px-4 py-2 border border-white/10\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Nhập văn bản\"\r\n                className=\"w-full bg-transparent text-white placeholder-gray-400 outline-none text-sm\"\r\n                value={textInput}\r\n                onChange={(e) => setTextInput(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            {[\r\n              '#ffffff',\r\n              '#000000',\r\n              '#ff3b30',\r\n              '#ff9500',\r\n              '#ffcc00',\r\n              '#34c759',\r\n              '#5ac8fa',\r\n              '#007aff',\r\n              '#5856d6',\r\n              '#af52de',\r\n            ].map((c) => (\r\n              <button\r\n                key={c}\r\n                onClick={() => setTextColor(c)}\r\n                className={`w-8 h-8 rounded-full border ${textColor === c ? 'ring-2 ring-white' : 'border-white/30'}`}\r\n                style={{ backgroundColor: c }}\r\n              />\r\n            ))}\r\n          </div>\r\n          <div className=\"flex items-center gap-4 px-8\">\r\n            <span className=\"text-xs text-white\">Kích thước</span>\r\n            <input\r\n              type=\"range\"\r\n              min={12}\r\n              max={48}\r\n              step={1}\r\n              value={textSize}\r\n              onChange={(e) => setTextSize(Number(e.target.value))}\r\n              className=\"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer range-sm\"\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n      {isDrawing && (\r\n        <div className=\"px-4 py-4 pb-8 flex flex-col gap-4 border-t border-white/10 bg-black\">\r\n          <div className=\"flex items-center justify-center\">\r\n            <button\r\n              onClick={() => setConstrainToMedia((v) => !v)}\r\n              className={`px-3 py-1.5 rounded-full text-xs font-medium ${\r\n                constrainToMedia ? 'bg-white text-black' : 'bg-white/10 text-white'\r\n              }`}\r\n            >\r\n              {constrainToMedia ? 'Chỉ vẽ trong ảnh/video' : 'Vẽ toàn khung'}\r\n            </button>\r\n          </div>\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            {[\r\n              '#ff3b30',\r\n              '#ff9500',\r\n              '#ffcc00',\r\n              '#34c759',\r\n              '#30d158',\r\n              '#5ac8fa',\r\n              '#007aff',\r\n              '#5856d6',\r\n              '#af52de',\r\n              '#ffffff',\r\n              '#000000',\r\n            ].map((c) => (\r\n              <button\r\n                key={c}\r\n                onClick={() => setBrushColor(c)}\r\n                className={`w-8 h-8 rounded-full border ${brushColor === c ? 'ring-2 ring-white' : 'border-white/30'}`}\r\n                style={{ backgroundColor: c }}\r\n              />\r\n            ))}\r\n          </div>\r\n          <div className=\"flex items-center gap-4 px-8\">\r\n            <span className=\"text-xs text-white\">Độ đậm</span>\r\n            <input\r\n              type=\"range\"\r\n              min={2}\r\n              max={24}\r\n              step={1}\r\n              value={brushSize}\r\n              onChange={(e) => setBrushSize(Number(e.target.value))}\r\n              className=\"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer range-sm\"\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAGpD;AACA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;;AA6Be,SAAS,YAAY,EAAE,QAAQ,EAAE,YAAY,OAAO,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,EAAoB;;IAChH,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,aAAa;IACb,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IACjD,kDAAkD;IAClD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAO5C;IAEV,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAwE,EAAE;IAChH,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAC;IACzD,MAAM,YAAY,IAAA,uKAAM,EAA2B;IACnD,MAAM,eAAe,IAAA,uKAAM,EAAwB;IACnD,MAAM,WAAW,IAAA,uKAAM,EAA0B;IACjD,MAAM,aAAa,IAAA,uKAAM,EAAa;IACtC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAA2C;IACrF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAiE;IAC/G,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAE5C,EAAE;IACJ,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAgB;IACpE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAA2B;QAAE,GAAG;QAAG,GAAG;IAAE;IACpF,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAgB;IACpE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;QAAE,OAAO;QAAG,QAAQ;IAAE;IACzE,MAAM,kBAAkB,IAAA,uKAAM,EAA0B;IACxD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;iCAAC;YACR,IAAI,CAAC,aAAa,OAAO,EAAE;YAC3B,MAAM;oDAAa;oBACjB,IAAI,aAAa,OAAO,EAAE;wBACxB,iBAAiB;4BACf,OAAO,aAAa,OAAO,CAAC,WAAW;4BACvC,QAAQ,aAAa,OAAO,CAAC,YAAY;wBAC3C;oBACF;gBACF;;YAEA,MAAM,WAAW,IAAI,eAAe;YACpC,SAAS,OAAO,CAAC,aAAa,OAAO;YACrC,cAAc,gBAAgB;YAE9B;yCAAO,IAAM,SAAS,UAAU;;QAClC;gCAAG,EAAE;IAEL,MAAM,sBAAsB,IAAA,4KAAW;wDAAC;YACtC,yCAAyC;YACzC,MAAM;wEAAU,CAAC;oBACf,IAAI;wBACF,MAAM,SAAS,SAAS,aAAa,CAAC;wBACtC,OAAO,KAAK,GAAG,MAAM,UAAU;wBAC/B,OAAO,MAAM,GAAG,MAAM,WAAW;wBACjC,MAAM,MAAM,OAAO,UAAU,CAAC;wBAC9B,IAAI,CAAC,KAAK,OAAO;wBACjB,IAAI,SAAS,CAAC,OAAO,GAAG,GAAG,OAAO,KAAK,EAAE,OAAO,MAAM;wBACtD,OAAO,OAAO,SAAS,CAAC,cAAc;oBACxC,EAAE,OAAO,GAAG;wBACV,QAAQ,IAAI,CAAC,gDAAgD;wBAC7D,OAAO;oBACT;gBACF;;YAEA,yCAAyC;YACzC,IAAI,SAAS,OAAO,IAAI,SAAS,OAAO,CAAC,UAAU,IAAI,SAAS,OAAO,CAAC,WAAW,EAAE;gBACnF,MAAM,SAAS,QAAQ,SAAS,OAAO;gBACvC,IAAI,QAAQ,OAAO;YACrB;YAEA,wDAAwD;YACxD,IAAI;gBACF,MAAM,IAAI,SAAS,aAAa,CAAC;gBACjC,EAAE,WAAW,GAAG,aAAa,qBAAqB;gBAClD,EAAE,KAAK,GAAG;gBACV,EAAE,WAAW,GAAG;gBAEhB,MAAM,IAAI;oEAAc,CAAC,SAAS;wBAChC,EAAE,gBAAgB,CAAC;4EAAc,IAAM;2EAAW;4BAAE,MAAM;wBAAK;wBAC/D,EAAE,gBAAgB,CAAC,SAAS,QAAQ;4BAAE,MAAM;wBAAK;wBACjD,EAAE,GAAG,GAAG,IAAA,uIAAW,EAAC;wBACpB,EAAE,IAAI;oBACR;;gBAEA,4FAA4F;gBAC5F,IAAI,EAAE,WAAW,KAAK,GAAG;oBACvB,EAAE,WAAW,GAAG;oBAChB,MAAM,IAAI;wEAAQ,CAAC,IAAM,EAAE,gBAAgB,CAAC,UAAU,GAAG;gCAAE,MAAM;4BAAK;;gBACxE;gBAEA,OAAO,QAAQ;YACjB,EAAE,OAAO,GAAG;gBACV,QAAQ,KAAK,CAAC,6CAA6C;gBAC3D,OAAO;YACT;QACF;uDAAG;QAAC;KAAa;IAEjB,MAAM,mBAAmB,IAAA,4KAAW;qDAAC;YACnC,MAAM,IAAI,UAAU,OAAO;YAC3B,MAAM,YAAY,aAAa,OAAO;YACtC,IAAI,CAAC,KAAK,CAAC,WAAW;YACtB,MAAM,IAAI,UAAU,WAAW;YAC/B,MAAM,IAAI,UAAU,YAAY;YAChC,IAAI,EAAE,KAAK,KAAK,GAAG,EAAE,KAAK,GAAG;YAC7B,IAAI,EAAE,MAAM,KAAK,GAAG,EAAE,MAAM,GAAG;QACjC;oDAAG,EAAE;IAEL,MAAM,cAAc,IAAA,4KAAW;gDAAC,CAAC,YAAoB,YAAoB,QAAgB;YACvF,MAAM,YAAY,SAAS;YAC3B,MAAM,kBAAkB,aAAa;YACrC,IAAI,YAAY,iBAAiB;gBAC/B,MAAM,KAAK;gBACX,MAAM,KAAK,aAAa;gBACxB,MAAM,KAAK,CAAC,aAAa,EAAE,IAAI;gBAC/B,MAAM,MAAM,KAAK,KAAK,CAAC;gBACvB,MAAM,MAAM,KAAK,KAAK,CAAC;gBACvB,MAAM,MAAM,KAAK,KAAK,CAAC;gBACvB,eAAe;oBAAE,GAAG;oBAAG,GAAG;oBAAK,OAAO;oBAAK,QAAQ;gBAAI;YACzD,OAAO;gBACL,MAAM,KAAK;gBACX,MAAM,KAAK,aAAa;gBACxB,MAAM,KAAK,CAAC,aAAa,EAAE,IAAI;gBAC/B,MAAM,MAAM,KAAK,KAAK,CAAC;gBACvB,MAAM,MAAM,KAAK,KAAK,CAAC;gBACvB,MAAM,MAAM,KAAK,KAAK,CAAC;gBACvB,eAAe;oBAAE,GAAG;oBAAK,GAAG;oBAAG,OAAO;oBAAK,QAAQ;gBAAI;YACzD;QACF;+CAAG,EAAE;IAEL,IAAA,0KAAS;iCAAC;YACR,IAAI,CAAC,YAAY;YACjB,MAAM,MAAM,WAAW,OAAO;YAC9B,IAAI,CAAC,KAAK;YACV,MAAM,QAAQ,IAAI,QAAQ;YAC1B,IAAI,CAAC,OAAO;YACZ,IAAI,QAAQ,CAAC;gBACX,GAAG,KAAK;gBACR,YAAY;oBACV,GAAI,MAAM,UAAU,IAAI,CAAC,CAAC;oBAC1B,QAAQ;gBACV;YACF;QACF;gCAAG;QAAC;QAAM;QAAU;KAAW;IAE/B,IAAA,0KAAS;iCAAC;YACR,MAAM,YAAY,aAAa,OAAO;YACtC,IAAI,CAAC,WAAW;YAChB,IAAI,cAAc,SAAS;gBACzB,MAAM,KAAK,IAAI,OAAO,KAAK;gBAC3B,GAAG,MAAM;6CAAG,IACV,YACE,UAAU,WAAW,EACrB,UAAU,YAAY,EACtB,GAAG,YAAY,IAAI,GAAG,KAAK,EAC3B,GAAG,aAAa,IAAI,GAAG,MAAM;;gBAEjC,GAAG,GAAG,GAAG,IAAA,uIAAW,EAAC;YACvB;QACF;gCAAG;QAAC;QAAa;QAAc;KAAU;IAEzC,IAAA,0KAAS;iCAAC;YACR,MAAM,YAAY,aAAa,OAAO;YACtC,MAAM,IAAI,SAAS,OAAO;YAC1B,IAAI,CAAC,aAAa,CAAC,KAAK,cAAc,SAAS;YAC/C,IAAI,EAAE,UAAU,IAAI,EAAE,WAAW,EAAE;gBACjC,YAAY,UAAU,WAAW,EAAE,UAAU,YAAY,EAAE,EAAE,UAAU,EAAE,EAAE,WAAW;YACxF;QACF;gCAAG;QAAC;QAAa;KAAU;IAE3B,IAAA,0KAAS;iCAAC;YACR,IAAI,cAAc,SAAS;YAC3B,IAAI,CAAC,mBAAmB,CAAC,gBAAgB,iBAAiB,EAAE;YAC5D,MAAM,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG;YAClC,IAAI,MAAM,KAAK,MAAM,GAAG;YACxB,MAAM,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG,gBAAgB,iBAAiB;YACnE,MAAM,SAAS,gBAAgB,QAAQ,IAAI;YAC3C,IAAI,WAAW,GAAG;gBAChB,MAAM,QAAQ,KAAK,GAAG,CAAC,KAAK,IAAI,KAAK;gBACrC,MAAM,KAAK,KAAK,KAAK,CAAC,KAAK;gBAC3B,MAAM,KAAK,KAAK,KAAK,CAAC,KAAK;gBAC3B,MAAM,KAAK,KAAK,KAAK,CAAC,CAAC,KAAK,EAAE,IAAI;gBAClC,MAAM,KAAK,KAAK,KAAK,CAAC,CAAC,KAAK,EAAE,IAAI;gBAClC,eAAe;oBAAE,GAAG;oBAAI,GAAG;oBAAI,OAAO;oBAAI,QAAQ;gBAAG;YACvD,OAAO;gBACL,eAAe;oBAAE,GAAG;oBAAG,GAAG;oBAAG,OAAO;oBAAI,QAAQ;gBAAG;YACrD;QACF;gCAAG;QAAC;QAAW;QAAiB;KAAc;IAE9C,MAAM,oBAAoB,IAAA,4KAAW;sDACnC,CAAC,KAA+B;YAC9B,IAAI,OAAO,MAAM,CAAC,MAAM,GAAG,GAAG;gBAC5B,MAAM,IAAI,OAAO,MAAM,CAAC,EAAE;gBAC1B,IAAI,CAAC,GAAG;gBACR,IAAI,SAAS;gBACb,IAAI,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,OAAO,IAAI,GAAG,GAAG,GAAG,KAAK,EAAE,GAAG;gBAChD,IAAI,SAAS,GAAG,OAAO,KAAK;gBAC5B,IAAI,IAAI;gBACR;YACF;YACA,IAAI,WAAW,GAAG,OAAO,KAAK;YAC9B,IAAI,SAAS,GAAG,OAAO,IAAI;YAC3B,IAAI,QAAQ,GAAG;YACf,IAAI,OAAO,GAAG;YACd,IAAI,SAAS;YACb,MAAM,CAAC,IAAI,GAAG,KAAK,GAAG,OAAO,MAAM;YACnC,IAAI,MAAM,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC;YACrB,KAAK,MAAM,KAAK,KAAM,IAAI,MAAM,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;YACzC,IAAI,MAAM;QACZ;qDACA,EAAE;IAGJ,MAAM,gBAAgB,IAAA,4KAAW;kDAAC;YAChC,MAAM,IAAI,UAAU,OAAO;YAC3B,IAAI,CAAC,GAAG;YACR,MAAM,MAAM,EAAE,UAAU,CAAC;YACzB,IAAI,CAAC,KAAK;YACV,IAAI,SAAS,CAAC,GAAG,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM;YACrC,IAAI,eAAe,kBAAkB;gBACnC,IAAI,IAAI;gBACR,IAAI,SAAS;gBACb,IAAI,IAAI,CAAC,YAAY,CAAC,EAAE,YAAY,CAAC,EAAE,YAAY,KAAK,EAAE,YAAY,MAAM;gBAC5E,IAAI,IAAI;YACV;YACA,KAAK,MAAM,KAAK,QAAS,kBAAkB,KAAK;YAChD,IAAI,eAAe,kBAAkB;gBACnC,IAAI,OAAO;YACb;QACF;iDAAG;QAAC;QAAS;QAAmB;QAAa;KAAiB;IAE9D,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAgB;IAE9D,IAAA,0KAAS;iCAAC;YACR;YACA;QACF;gCAAG;QAAC;QAAkB;QAAe;KAAU;IAE/C,IAAA,0KAAS;iCAAC;YACR,MAAM;iDAAU;oBACd;oBACA;gBACF;;YACA,OAAO,gBAAgB,CAAC,UAAU;YAClC;yCAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;;QACpD;gCAAG;QAAC;QAAkB;KAAc;IAEpC,MAAM,aAAa,CAAC;QAClB,MAAM,IAAI,UAAU,OAAO;QAC3B,IAAI,CAAC,GAAG,OAAO;YAAE,GAAG;YAAG,GAAG;QAAE;QAC5B,MAAM,OAAO,EAAE,qBAAqB;QACpC,IAAI,aAAa,KAAK,EAAE,OAAO,CAAC,MAAM,EAAE;YACtC,MAAM,IAAI,EAAE,OAAO,CAAC,EAAE;YACtB,OAAO;gBAAE,GAAG,EAAE,OAAO,GAAG,KAAK,IAAI;gBAAE,GAAG,EAAE,OAAO,GAAG,KAAK,GAAG;YAAC;QAC7D;QACA,MAAM,KAAK;QACX,OAAO;YAAE,GAAG,GAAG,OAAO,GAAG,KAAK,IAAI;YAAE,GAAG,GAAG,OAAO,GAAG,KAAK,GAAG;QAAC;IAC/D;IAEA,MAAM,YAAY,CAAC;QACjB,IAAI,CAAC,WAAW;QAChB;QACA,iBAAiB;QACjB,MAAM,IAAI,WAAW;QACrB,IAAI,eAAe,kBAAkB;YACnC,MAAM,WAAW,EAAE,CAAC,GAAG,YAAY,CAAC,IAAI,EAAE,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,KAAK;YAC/E,MAAM,WAAW,EAAE,CAAC,GAAG,YAAY,CAAC,IAAI,EAAE,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,MAAM;YAChF,IAAI,YAAY,UAAU;gBACxB;YACF;QACF;QACA,IAAI,KAAK;QACT,IAAI,eAAe,kBAAkB;YACnC,MAAM,KAAK,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,KAAK;YACnF,MAAM,KAAK,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,MAAM;YACpF,KAAK;gBAAE,GAAG;gBAAI,GAAG;YAAG;QACtB;QACA,WAAW,CAAC,OAAS;mBAAI;gBAAM;oBAAE,OAAO;oBAAY,MAAM;oBAAW,QAAQ;wBAAC;qBAAG;gBAAC;aAAE;IACtF;IAEA,MAAM,WAAW,CAAC;QAChB,IAAI,CAAC,aAAa,CAAC,eAAe;QAClC,MAAM,IAAI,WAAW;QACrB,IAAI,KAAK;QACT,IAAI,eAAe,kBAAkB;YACnC,MAAM,KAAK,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,KAAK;YACnF,MAAM,KAAK,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,MAAM;YACpF,KAAK;gBAAE,GAAG;gBAAI,GAAG;YAAG;QACtB;QACA,WAAW,CAAC;YACV,IAAI,CAAC,KAAK,MAAM,EAAE,OAAO;YACzB,MAAM,OAAO,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE;YAClC,MAAM,UAAU;gBAAE,GAAG,IAAI;gBAAE,QAAQ;uBAAI,KAAK,MAAM;oBAAE;iBAAG;YAAC;YACxD,MAAM,OAAO;mBAAI,KAAK,KAAK,CAAC,GAAG,CAAC;gBAAI;aAAQ;YAC5C,OAAO;QACT;QACA;IACF;IAEA,MAAM,UAAU;QACd,IAAI,CAAC,WAAW;QAChB,iBAAiB;IACnB;IACA,MAAM,iBAAiB;QACrB,IAAI;YACF,IAAI,CAAC,WAAW,OAAO,EAAE;YAEzB,IAAI,cAAc,SAAS;gBACzB,MAAM,SAAS,WAAW,OAAO,CAAC,SAAS;gBAC3C,IAAI,QAAQ;oBACV,MAAM,UAAU,OAAO,SAAS,CAAC,cAAc;oBAC/C,gBAAgB;oBAChB,cAAc;oBACd,YAAY;oBACZ,QAAQ;gBACV;YACF,OAAO;gBACL,QAAQ;gBACR,MAAM,QAAQ,WAAW,OAAO,CAAC,QAAQ;gBACzC,MAAM,cAAc,WAAW,OAAO,CAAC,cAAc;gBACrD,IAAI,SAAS,aAAa;oBACxB,MAAM,QAAQ,aAAa,OAAO,EAAE,eAAe,YAAY,KAAK;oBACpE,MAAM,QAAQ,aAAa,OAAO,EAAE,gBAAgB,YAAY,MAAM;oBACtE,mBAAmB;wBACjB,MAAM;4BAAE,GAAG,YAAY,IAAI;4BAAE,GAAG,YAAY,GAAG;wBAAC;wBAChD,MAAM;wBACN,UAAU,MAAM,UAAU,CAAC,MAAM,IAAI;wBACrC,mBAAmB;4BACjB,GAAG,YAAY,IAAI;4BACnB,GAAG,YAAY,GAAG;4BAClB,OAAO,YAAY,KAAK;4BACxB,QAAQ,YAAY,MAAM;wBAC5B;wBACA,WAAW;wBACX,YAAY;oBACd;oBACA,cAAc;gBAChB;YACF;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC;QAChB;IACF;IAEA,MAAM,eAAe;QACnB,IAAI;YACF,MAAM,YAAY,aAAa,OAAO;YACtC,MAAM,IAAI,UAAU,OAAO;YAC3B,IAAI,CAAC,aAAa,CAAC,KAAK,QAAQ,MAAM,KAAK,GAAG;gBAC5C,aAAa;gBACb;YACF;YACA,IAAI,cAAc,SAAS;gBACzB,aAAa;gBACb;YACF;YACA,MAAM,MAAM,MAAM,IAAI,QAA0B,CAAC,SAAS;gBACxD,MAAM,KAAK,IAAI,OAAO,KAAK;gBAC3B,GAAG,WAAW,GAAG;gBACjB,GAAG,MAAM,GAAG,IAAM,QAAQ;gBAC1B,GAAG,OAAO,GAAG;gBACb,GAAG,GAAG,GAAG,IAAA,uIAAW,EAAC;YACvB;YACA,MAAM,IAAI,UAAU,WAAW;YAC/B,MAAM,IAAI,UAAU,YAAY;YAChC,MAAM,MAAM,SAAS,aAAa,CAAC;YACnC,IAAI,KAAK,GAAG;YACZ,IAAI,MAAM,GAAG;YACb,MAAM,MAAM,IAAI,UAAU,CAAC;YAC3B,MAAM,YAAY,IAAI,KAAK,GAAG,IAAI,MAAM;YACxC,MAAM,kBAAkB,IAAI;YAC5B,IAAI,YAAY,iBAAiB;gBAC/B,MAAM,KAAK;gBACX,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,CAAC,IAAI,EAAE,IAAI;gBACtB,IAAI,SAAS,CAAC,KAAK,GAAG,IAAI,IAAI;YAChC,OAAO;gBACL,MAAM,KAAK;gBACX,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,CAAC,IAAI,EAAE,IAAI;gBACtB,IAAI,SAAS,CAAC,KAAK,IAAI,GAAG,IAAI;YAChC;YACA,MAAM,UAAU,EAAE,UAAU,CAAC;YAC7B,MAAM,OAAO,QAAQ,YAAY,CAAC,GAAG,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM;YACzD,MAAM,MAAM,SAAS,aAAa,CAAC;YACnC,IAAI,KAAK,GAAG,EAAE,KAAK;YACnB,IAAI,MAAM,GAAG,EAAE,MAAM;YACrB,MAAM,OAAO,IAAI,UAAU,CAAC;YAC5B,KAAK,YAAY,CAAC,MAAM,GAAG;YAC3B,IAAI,SAAS,CAAC,KAAK,GAAG,GAAG,GAAG;YAC5B,MAAM,UAAU,IAAI,SAAS,CAAC,cAAc;YAC5C,gBAAgB;YAChB,aAAa;YACb,WAAW,EAAE;YACb,MAAM,aAAa,EAAE,UAAU,CAAC;YAChC,IAAI,YAAY,WAAW,SAAS,CAAC,GAAG,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM;QAC9D,EAAE,OAAO,GAAG;YACV,aAAa;QACf;IACF;IAEA,MAAM,mBAAmB;QACvB,IAAI;YACF,MAAM,YAAY,aAAa,OAAO;YACtC,IAAI,CAAC,aAAa,cAAc,WAAW,YAAY,MAAM,KAAK,GAAG;YACrE,MAAM,MAAM,MAAM,IAAI,QAA0B,CAAC,SAAS;gBACxD,MAAM,KAAK,IAAI,OAAO,KAAK;gBAC3B,GAAG,WAAW,GAAG;gBACjB,GAAG,MAAM,GAAG,IAAM,QAAQ;gBAC1B,GAAG,OAAO,GAAG;gBACb,GAAG,GAAG,GAAG,IAAA,uIAAW,EAAC;YACvB;YACA,MAAM,IAAI,UAAU,WAAW;YAC/B,MAAM,IAAI,UAAU,YAAY;YAChC,MAAM,YAAY,IAAI,KAAK,GAAG,IAAI,MAAM;YACxC,MAAM,kBAAkB,IAAI;YAC5B,MAAM,OAAO,CAAC;gBACZ,IAAI,YAAY,iBAAiB;oBAC/B,MAAM,KAAK;oBACX,MAAM,KAAK,IAAI;oBACf,MAAM,KAAK;oBACX,MAAM,KAAK,CAAC,IAAI,EAAE,IAAI;oBACtB,OAAO;wBAAE;wBAAI;wBAAI;wBAAI;oBAAG;gBAC1B,OAAO;oBACL,MAAM,KAAK;oBACX,MAAM,KAAK,IAAI;oBACf,MAAM,KAAK,CAAC,IAAI,EAAE,IAAI;oBACtB,MAAM,KAAK;oBACX,OAAO;wBAAE;wBAAI;wBAAI;wBAAI;oBAAG;gBAC1B;YACF,CAAC;YAED,MAAM,MAAM,SAAS,aAAa,CAAC;YACnC,IAAI,KAAK,GAAG,IAAI,KAAK;YACrB,IAAI,MAAM,GAAG,IAAI,MAAM;YACvB,MAAM,MAAM,IAAI,UAAU,CAAC;YAC3B,IAAI,SAAS,CAAC,KAAK,GAAG,GAAG,IAAI,KAAK,EAAE,IAAI,MAAM;YAE9C,MAAM,gBAAgB,UAAU,OAAO;YACvC,IAAI,eAAe;gBACjB,MAAM,IAAI,IAAI,KAAK,GAAG,KAAK,EAAE;gBAC7B,IAAI,SAAS,CAAC,eAAe,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,GAAG,GAAG,IAAI,KAAK,EAAE,IAAI,MAAM;gBAC5F,IAAI,SAAS,GAAG;gBAChB,IAAI,YAAY,GAAG;gBACnB,KAAK,MAAM,KAAK,YAAa;oBAC3B,MAAM,KAAK,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,IAAI;oBAC7B,MAAM,KAAK,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,IAAI;oBAC7B,MAAM,WAAW,EAAE,IAAI,GAAG;oBAC1B,IAAI,SAAS,GAAG,EAAE,KAAK;oBACvB,IAAI,IAAI,GAAG,GAAG,SAAS,aAAa,CAAC;oBACrC,IAAI,QAAQ,CAAC,EAAE,IAAI,EAAE,IAAI;gBAC3B;YACF;YAEA,MAAM,UAAU,IAAI,SAAS,CAAC,cAAc;YAC5C,gBAAgB;YAChB,eAAe,EAAE;YACjB,kBAAkB;QACpB,EAAE,OAAM,CAAC;IACX;IAEA,MAAM,gBAAgB;QACpB,gBAAgB;QAChB,mBAAmB;QACnB,YAAY;QACZ,QAAQ;QACR,aAAa;QACb,WAAW,EAAE;QACb,aAAa;QACb,eAAe,EAAE;QACjB,aAAa;IACf;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;0BACZ,2BACC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAO,SAAS,IAAM,cAAc;4BAAQ,WAAU;sCACrD,cAAA,6LAAC,wJAAG;gCAAC,WAAU;;;;;;;;;;;sCAEjB,6LAAC;4BAAI,WAAU;sCAAwB;;;;;;sCACvC,6LAAC;4BAAO,SAAS;4BAAgB,WAAU;sCACzC,cAAA,6LAAC,4JAAO;gCAAC,WAAU;;;;;;;;;;;;;;;;2BAGrB,0BACF,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,SAAS;gCACP,aAAa;gCACb,WAAW,EAAE;gCACb,MAAM,IAAI,UAAU,OAAO;gCAC3B,MAAM,MAAM,GAAG,WAAW;gCAC1B,IAAI,KAAK,KAAK,IAAI,SAAS,CAAC,GAAG,GAAG,EAAE,KAAK,EAAE,EAAE,MAAM;4BACrD;4BACA,WAAU;sCAEV,cAAA,6LAAC,wJAAG;gCAAC,WAAU;;;;;;;;;;;sCAEjB,6LAAC;4BAAI,WAAU;sCAAwB;;;;;;sCACvC,6LAAC;4BAAO,SAAS;4BAAc,WAAU;sCACvC,cAAA,6LAAC,4JAAO;gCAAC,WAAU;;;;;;;;;;;;;;;;2BAGrB,0BACF,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,SAAS;gCACP,aAAa;gCACb,aAAa;4BACf;4BACA,WAAU;sCAEV,cAAA,6LAAC,wJAAG;gCAAC,WAAU;;;;;;;;;;;sCAEjB,6LAAC;4BAAI,WAAU;sCAAwB;;;;;;sCACvC,6LAAC;4BACC,SAAS;gCACP,MAAM,YAAY,aAAa,OAAO;gCACtC,IAAI,CAAC,aAAa,CAAC,UAAU,IAAI,MAAM,CAAC,aAAa;oCACnD,aAAa;oCACb,aAAa;oCACb;gCACF;gCACA,MAAM,KAAK,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC;gCAC5C,eAAe,CAAC,OAAS;2CACpB;wCACH;4CACE;4CACA,MAAM,UAAU,IAAI;4CACpB,GAAG,KAAK,KAAK,CAAC,YAAY,CAAC,GAAG,YAAY,KAAK,GAAG;4CAClD,GAAG,KAAK,KAAK,CAAC,YAAY,CAAC,GAAG,YAAY,MAAM,GAAG;4CACnD,OAAO;4CACP,MAAM;wCACR;qCACD;gCACD,aAAa;gCACb,aAAa;4BACf;4BACA,WAAU;sCAEV,cAAA,6LAAC,4JAAO;gCAAC,WAAU;;;;;;;;;;;;;;;;yCAIvB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAO,SAAS;4BAAS,WAAU;sCAClC,cAAA,6LAAC,wJAAG;gCAAC,WAAU;;;;;;;;;;;sCAEjB,6LAAC;4BAAI,WAAU;;gCACZ,iBAAiB,YAAY,gCAC5B,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;2CAGC;8CACJ,6LAAC;oCACC,WAAU;oCACV,SAAS;wCACP,IAAI,cAAc,SAAS;4CACzB,MAAM,SAAS,MAAM;4CACrB,IAAI,QAAQ,eAAe;wCAC7B;wCACA,cAAc;oCAChB;8CAEA,cAAA,6LAAC,kKAAY;wCAAC,WAAU;;;;;;;;;;;8CAE1B,6LAAC;oCAAO,WAAU;oCAAqB,SAAS,IAAM,aAAa;8CACjE,cAAA,6LAAC,2JAAK;wCAAC,WAAU;;;;;;;;;;;8CAEnB,6LAAC;oCAAO,WAAU;oCAAkD,SAAS,IAAM,aAAa;8CAAO;;;;;;gCAGtG,YAAY,MAAM,GAAG,KAAK,cAAc,wBACvC,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;2CAGC;;;;;;;;;;;;;;;;;;0BAOZ,6LAAC;gBACC,WAAU;gBACV,KAAK;0BAEJ,2BACC,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,6MAAO;wBACN,KAAK;wBACL,KAAK,cAAc,UAAU,eAAe,KAAK,IAAA,uIAAW,EAAC;wBAC7D,WAAU;wBACV,cAAc;4BACZ,aAAa;wBACf;;;;;;;;;;yCAIJ,6LAAC;oBAAI,WAAU;;wBACZ,cAAc,wBACb,6LAAC,2IAAK;4BAAC,KAAK,IAAA,uIAAW,EAAC;4BAAe,KAAI;4BAAU,IAAI;4BAAC,WAAU;4BAAiB,QAAQ;;;;;mCAC3F;wBACH,YAAY,GAAG,CAAC,CAAC,kBAChB,6LAAC;gCAEC,OAAO;oCACL,UAAU;oCACV,MAAM,EAAE,CAAC;oCACT,KAAK,EAAE,CAAC;oCACR,WAAW;oCACX,OAAO,EAAE,KAAK;oCACd,UAAU,GAAG,EAAE,IAAI,CAAC,EAAE,CAAC;oCACvB,YAAY;oCACZ,QAAQ;oCACR,YAAY;gCACd;gCACA,aAAa,CAAC;oCACZ,kBAAkB,EAAE,EAAE;oCACtB,cAAc;wCAAE,GAAG,EAAE,OAAO,GAAG,EAAE,CAAC;wCAAE,GAAG,EAAE,OAAO,GAAG,EAAE,CAAC;oCAAC;oCACvD,kBAAkB,EAAE,EAAE;gCACxB;gCACA,aAAa,CAAC;oCACZ,IAAI,mBAAmB,EAAE,EAAE,EAAE;oCAC7B,MAAM,KAAK,EAAE,OAAO,GAAG,WAAW,CAAC;oCACnC,MAAM,KAAK,EAAE,OAAO,GAAG,WAAW,CAAC;oCACnC,MAAM,KAAK,cACP,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,IAAI,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,KAAK,IACvE;oCACJ,MAAM,KAAK,cACP,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,IAAI,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,MAAM,IACxE;oCACJ,eAAe,CAAC,OAAS,KAAK,GAAG,CAAC,CAAC,KAAQ,GAAG,EAAE,KAAK,EAAE,EAAE,GAAG;gDAAE,GAAG,EAAE;gDAAE,GAAG;gDAAI,GAAG;4CAAG,IAAI;gCACxF;gCACA,WAAW;oCACT,IAAI,mBAAmB,EAAE,EAAE,EAAE,kBAAkB;gCACjD;gCACA,cAAc,CAAC;oCACb,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;oCAC1B,kBAAkB,EAAE,EAAE;oCACtB,cAAc;wCAAE,GAAG,MAAM,OAAO,GAAG,EAAE,CAAC;wCAAE,GAAG,MAAM,OAAO,GAAG,EAAE,CAAC;oCAAC;oCAC/D,kBAAkB,EAAE,EAAE;gCACxB;gCACA,aAAa,CAAC;oCACZ,IAAI,mBAAmB,EAAE,EAAE,EAAE;oCAC7B,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;oCAC1B,MAAM,KAAK,MAAM,OAAO,GAAG,WAAW,CAAC;oCACvC,MAAM,KAAK,MAAM,OAAO,GAAG,WAAW,CAAC;oCACvC,MAAM,KAAK,cACP,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,IAAI,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,KAAK,IACvE;oCACJ,MAAM,KAAK,cACP,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,IAAI,YAAY,CAAC,GAAG,YAAY,CAAC,GAAG,YAAY,MAAM,IACxE;oCACJ,eAAe,CAAC,OAAS,KAAK,GAAG,CAAC,CAAC,KAAQ,GAAG,EAAE,KAAK,EAAE,EAAE,GAAG;gDAAE,GAAG,EAAE;gDAAE,GAAG;gDAAI,GAAG;4CAAG,IAAI;gCACxF;gCACA,YAAY;oCACV,IAAI,mBAAmB,EAAE,EAAE,EAAE,kBAAkB;gCACjD;0CAEA,cAAA,6LAAC;oCAAK,WAAU;;wCACb,EAAE,IAAI;wCACN,mBAAmB,EAAE,EAAE,kBACtB,6LAAC;4CACC,SAAS,CAAC;gDACR,EAAE,eAAe;gDACjB,eAAe,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,KAAO,GAAG,EAAE,KAAK,EAAE,EAAE;gDAC3D,kBAAkB;4CACpB;4CACA,WAAU;4CACV,OAAM;sDAEN,cAAA,6LAAC,wJAAG;gDAAC,WAAU;;;;;;;;;;;;;;;;;+BAnEhB,EAAE,EAAE;;;;;wBA0EZ,cAAc,WAAW,mBAAmB,gBAAgB,iBAAiB,kBAC5E,6LAAC;4BAAI,WAAU;sCACZ,CAAC;gCACA,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG,gBAAgB,iBAAiB;gCACzE,MAAM,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,EAAE,GAAG;gCAClC,MAAM,SAAS,gBAAgB,QAAQ,IAAI;gCAE3C,gDAAgD;gCAChD,IAAI,WAAW,KAAK,aAAa,KAAK,KAAK,KAAK,GAAG;oCACjD,MAAM,QAAQ,KAAK,GAAG,CAAC,KAAK,IAAI,KAAK;oCACrC,MAAM,KAAK,KAAK;oCAChB,MAAM,KAAK,KAAK;oCAChB,MAAM,KAAK,UAAU,KAAK,GAAG;oCAC7B,MAAM,KAAK,UAAU,MAAM,GAAG;oCAE9B,qBACE,6LAAC;wCACC,OAAO;4CACL,OAAO;4CACP,QAAQ;4CACR,UAAU;4CACV,UAAU;wCACZ;;0DAEA,6LAAC;gDACC,KAAK,IAAA,uIAAW,EAAC;gDACjB,UAAU,CAAC;gDACX,IAAI;gDACJ,OAAO;gDACP,WAAW;gDACX,sBAAmB;gDACnB,kBAAkB,CAAC;oDACjB,MAAM,IAAI,EAAE,aAAa;oDACzB,IAAI,CAAC,aAAa,UAAU,KAAK,KAAK,EAAE,UAAU,IAAI,UAAU,MAAM,KAAK,EAAE,WAAW,EAAE;wDACxF,aAAa;4DAAE,OAAO,EAAE,UAAU;4DAAE,QAAQ,EAAE,WAAW;wDAAC;oDAC5D;gDACF;gDACA,KAAK;gDACL,OAAO;oDACL,UAAU;oDACV,MAAM,CAAC,IAAI;oDACX,KAAK,CAAC,IAAI;oDACV,OAAO;oDACP,QAAQ;oDACR,UAAU;oDACV,WAAW;gDACb;;;;;;0DAEF,6LAAC;gDACC,SAAS;oDACP,MAAM,IAAI,gBAAgB,OAAO;oDACjC,WAAW,CAAC;wDACV,MAAM,OAAO,CAAC;wDACd,IAAI,GAAG;4DACL,EAAE,KAAK,GAAG;4DACV,IAAI,CAAC,MAAM,EAAE,IAAI,GAAG,KAAK,CAAC,KAAO;wDACnC;wDACA,OAAO;oDACT;gDACF;gDACA,WAAU;gDACV,OAAO,UAAU,iBAAiB;0DAEjC,UAAU,iBAAiB;;;;;;;;;;;;gCAIpC;gCAEA,8DAA8D;gCAC9D,qBACE,6LAAC,6MAAO;oCACN,KAAK,eAAe,IAAA,uIAAW,EAAC;oCAChC,oBAAoB;wCAClB,MAAM,gBAAgB,iBAAiB,CAAE,CAAC;wCAC1C,KAAK,gBAAgB,iBAAiB,CAAE,CAAC;wCACzC,OAAO,gBAAgB,iBAAiB,CAAE,KAAK;wCAC/C,QAAQ,gBAAgB,iBAAiB,CAAE,MAAM;oCACnD;oCACA,cAAc;wCACZ,SAAS;wCACT,WAAW;oCACb;oCACA,WAAU;oCACV,qBAAoB;;;;;;4BAG1B,CAAC;;;;;;wBAGJ,cAAc,WAAW,CAAC,iCACzB,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCACC,KAAK,IAAA,uIAAW,EAAC;gCACjB,aAAY;gCACZ,QAAQ;gCACR,IAAI;gCACJ,OAAO;gCACP,UAAU;gCACV,KAAK;gCACL,kBAAkB;oCAChB,MAAM,YAAY,aAAa,OAAO;oCACtC,MAAM,IAAI,SAAS,OAAO;oCAC1B,IAAI,CAAC,aAAa,CAAC,GAAG;oCACtB,aAAa;wCAAE,OAAO,EAAE,UAAU;wCAAE,QAAQ,EAAE,WAAW;oCAAC;oCAC1D,YAAY,UAAU,WAAW,EAAE,UAAU,YAAY,EAAE,EAAE,UAAU,EAAE,EAAE,WAAW;oCACtF,sBAAsB,IAAI,CAAC,CAAC;wCAC1B,IAAI,GAAG,eAAe;oCACxB;gCACF;gCACA,WAAU;;;;;;;;;;;sCAIhB,6LAAC;4BACC,KAAK;4BACL,WAAU;4BACV,OAAO;gCAAE,eAAe,YAAY,SAAS;4BAAO;4BACpD,aAAa;4BACb,aAAa;4BACb,WAAW;4BACX,cAAc;4BACd,cAAc;4BACd,aAAa;4BACb,YAAY;;;;;;;;;;;;;;;;;YAOnB,CAAC,cAAc,CAAC,aAAa,CAAC,2BAC7B,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCACC,MAAK;gCACL,aAAa,CAAC,eAAe,EAAE,YAAY,OAAO;gCAClD,WAAU;gCACV,OAAO;gCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;kCAKpD,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,SAAS,IAAM,QAAQ,CAAC;gCACxB,WAAW,CAAC,sGAAsG,EAChH,OAAO,wBAAwB,4CAC/B;;oCACH;kDAEC,6LAAC;wCAAK,WAAU;kDAA2B;;;;;;;;;;;;0CAG7C,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAO,SAAS,IAAM,YAAY,CAAC;wCAAW,WAAU;;0DACvD,6LAAC;gDACC,WAAW,CAAC,gGAAgG,EAC1G,WAAW,gCAAgC,mBAC3C;0DAED,0BAAY,6LAAC;oDAAI,WAAU;;;;;;;;;;;0DAE9B,6LAAC;0DAAK;;;;;;;;;;;;kDAGR,6LAAC;wCACC,SAAS;4CACP,IAAI,cAAc,SAAS;gDACzB,MAAM,aAAa,QAAQ,MAAM,GAAG;gDACpC,MAAM,UAAU,YAAY,MAAM,GAAG;gDACrC,IAAI,cAAc,SAAS;oDACzB,MAAM;gDACR;4CACF;4CACA,SAAS;gDACP;gDACA;gDACA;gDACA,cAAc,cAAc,UAAU,eAAe;gDACrD;4CACF;4CACA;wCACF;wCACA,WAAU;kDAEV,cAAA,6LAAC,4JAAM;4CAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAM3B,2BACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCACC,MAAK;gCACL,aAAY;gCACZ,WAAU;gCACV,OAAO;gCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;kCAIlD,6LAAC;wBAAI,WAAU;kCACZ;4BACC;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;yBACD,CAAC,GAAG,CAAC,CAAC,kBACL,6LAAC;gCAEC,SAAS,IAAM,aAAa;gCAC5B,WAAW,CAAC,4BAA4B,EAAE,cAAc,IAAI,sBAAsB,mBAAmB;gCACrG,OAAO;oCAAE,iBAAiB;gCAAE;+BAHvB;;;;;;;;;;kCAOX,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAAqB;;;;;;0CACrC,6LAAC;gCACC,MAAK;gCACL,KAAK;gCACL,KAAK;gCACL,MAAM;gCACN,OAAO;gCACP,UAAU,CAAC,IAAM,YAAY,OAAO,EAAE,MAAM,CAAC,KAAK;gCAClD,WAAU;;;;;;;;;;;;;;;;;;YAKjB,2BACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BACC,SAAS,IAAM,oBAAoB,CAAC,IAAM,CAAC;4BAC3C,WAAW,CAAC,6CAA6C,EACvD,mBAAmB,wBAAwB,0BAC3C;sCAED,mBAAmB,2BAA2B;;;;;;;;;;;kCAGnD,6LAAC;wBAAI,WAAU;kCACZ;4BACC;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;4BACA;yBACD,CAAC,GAAG,CAAC,CAAC,kBACL,6LAAC;gCAEC,SAAS,IAAM,cAAc;gCAC7B,WAAW,CAAC,4BAA4B,EAAE,eAAe,IAAI,sBAAsB,mBAAmB;gCACtG,OAAO;oCAAE,iBAAiB;gCAAE;+BAHvB;;;;;;;;;;kCAOX,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAAqB;;;;;;0CACrC,6LAAC;gCACC,MAAK;gCACL,KAAK;gCACL,KAAK;gCACL,MAAM;gCACN,OAAO;gCACP,UAAU,CAAC,IAAM,aAAa,OAAO,EAAE,MAAM,CAAC,KAAK;gCACnD,WAAU;;;;;;;;;;;;;;;;;;;;;;;;AAOxB;GAr+BwB;KAAA"}},
    {"offset": {"line": 2361, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/MediaPreviewModal.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport Image from 'next/image';\r\nimport {\r\n  HiX,\r\n  HiDownload,\r\n  HiPhotograph,\r\n  HiVideoCamera,\r\n  HiChevronUp,\r\n  HiChevronDown,\r\n  HiPlay,\r\n  HiExternalLink,\r\n  HiChevronLeft,\r\n  HiChevronRight,\r\n  HiCloud,\r\n  HiDotsVertical,\r\n  HiDotsHorizontal,\r\n  HiPencil,\r\n  HiShare,\r\n  HiDuplicate,\r\n  HiSave,\r\n} from 'react-icons/hi';\r\nimport { HiMagnifyingGlassPlus, HiMagnifyingGlassMinus } from 'react-icons/hi2';\r\nimport { FaReply, FaRegShareFromSquare, FaLink } from 'react-icons/fa6';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport { Message } from '@/types/Message';\r\nimport MediaEditor from './MediaEditor';\r\n\r\ninterface MediaPreviewModalProps {\r\n  media: { id?: string; url: string; type: 'image' | 'video' } | null;\r\n  chatName?: string;\r\n  isGroup?: boolean;\r\n  onClose: () => void;\r\n  roomId?: string;\r\n  onReply?: (messageId: string) => void;\r\n  onShare?: (url: string, messageId?: string) => void;\r\n  onShareMessage?: (message: Message) => void;\r\n  onJumpToMessage?: (messageId: string) => void;\r\n}\r\n\r\nexport default function MediaPreviewModal({\r\n  media,\r\n  chatName,\r\n  isGroup,\r\n  onClose,\r\n  roomId,\r\n  onReply,\r\n  onShare,\r\n  onShareMessage,\r\n  onJumpToMessage,\r\n}: MediaPreviewModalProps) {\r\n  const [groups, setGroups] = useState<\r\n    { dateLabel: string; items: { id: string; type: 'image' | 'video'; url: string; timestamp?: number }[] }[]\r\n  >([]);\r\n  const items = useMemo(() => groups.flatMap((g) => g.items), [groups]);\r\n  const [current, setCurrent] = useState<{ id?: string; url: string; type: 'image' | 'video' } | null>(media);\r\n  const listRef = useRef<HTMLDivElement | null>(null);\r\n  const itemRefs = useRef<Record<string, HTMLDivElement | null>>({});\r\n  const openedAtRef = useRef<number>(0);\r\n  const [zoom, setZoom] = useState<number>(1);\r\n  const [position, setPosition] = useState({ x: 0, y: 0 });\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const dragStartRef = useRef<{ x: number; y: number } | null>(null);\r\n  const [showThumbnails, setShowThumbnails] = useState(true);\r\n  const [isEditing, setIsEditing] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setCurrent(media);\r\n    if (media) openedAtRef.current = Date.now();\r\n    setZoom(1);\r\n    setPosition({ x: 0, y: 0 });\r\n  }, [media]);\r\n\r\n  const handleMouseDown = (e: React.MouseEvent) => {\r\n    if (zoom <= 1) return;\r\n    setIsDragging(true);\r\n    dragStartRef.current = { x: e.clientX - position.x, y: e.clientY - position.y };\r\n    e.preventDefault(); // Prevent text selection or image drag default\r\n  };\r\n\r\n  const handleMouseMove = (e: React.MouseEvent) => {\r\n    if (!isDragging || !dragStartRef.current || zoom <= 1) return;\r\n    setPosition({\r\n      x: e.clientX - dragStartRef.current.x,\r\n      y: e.clientY - dragStartRef.current.y,\r\n    });\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    setIsDragging(false);\r\n    dragStartRef.current = null;\r\n  };\r\n\r\n  const handleTouchStart = (e: React.TouchEvent) => {\r\n    if (zoom <= 1) return;\r\n    setIsDragging(true);\r\n    const touch = e.touches[0];\r\n    dragStartRef.current = { x: touch.clientX - position.x, y: touch.clientY - position.y };\r\n  };\r\n\r\n  const handleTouchMove = (e: React.TouchEvent) => {\r\n    if (!isDragging || !dragStartRef.current || zoom <= 1) return;\r\n    const touch = e.touches[0];\r\n    setPosition({\r\n      x: touch.clientX - dragStartRef.current.x,\r\n      y: touch.clientY - dragStartRef.current.y,\r\n    });\r\n  };\r\n\r\n  const handleTouchEnd = () => {\r\n    setIsDragging(false);\r\n    dragStartRef.current = null;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchAll = async () => {\r\n      if (!roomId) return;\r\n      try {\r\n        const res = await fetch('/api/messages', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'readAssets', roomId, assetType: 'media', limit: 5000 }),\r\n        });\r\n        const json = await res.json();\r\n        const gs = Array.isArray(json?.groups) ? json.groups : [];\r\n        setGroups(gs);\r\n      } catch {}\r\n    };\r\n    fetchAll();\r\n  }, [roomId]);\r\n\r\n  useEffect(() => {\r\n    setZoom(1);\r\n    setPosition({ x: 0, y: 0 });\r\n  }, [current?.url]);\r\n\r\n  useEffect(() => {\r\n    if (!current) return;\r\n    const el = itemRefs.current[current.url];\r\n    const list = listRef.current;\r\n    if (el && list) {\r\n      try {\r\n        const isMobile = window.innerWidth < 768; // Simple check for mobile/tablet layout\r\n        if (isMobile) {\r\n          // Horizontal scroll for mobile/bottom list\r\n          const targetLeft = el.offsetLeft - (list.clientWidth / 2 - el.clientWidth / 2);\r\n          list.scrollTo({ left: Math.max(0, targetLeft), behavior: 'smooth' });\r\n        } else {\r\n          // Vertical scroll for desktop/sidebar list\r\n          const targetTop = el.offsetTop - (list.clientHeight / 2 - el.clientHeight / 2);\r\n          list.scrollTo({ top: Math.max(0, targetTop), behavior: 'smooth' });\r\n        }\r\n      } catch {}\r\n    }\r\n  }, [current, items, showThumbnails]);\r\n\r\n  const [showMoreMenu, setShowMoreMenu] = useState(false);\r\n  const moreMenuRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (moreMenuRef.current && !moreMenuRef.current.contains(event.target as Node)) {\r\n        setShowMoreMenu(false);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  const handleDownload = async () => {\r\n    if (!current?.url) return;\r\n    try {\r\n      const res = await fetch(getProxyUrl(current.url, true));\r\n      const blob = await res.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.style.display = 'none';\r\n      a.href = url;\r\n      a.download = current.url.split('/').pop() || 'download';\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n      document.body.removeChild(a);\r\n    } catch (err) {\r\n      window.open(getProxyUrl(current.url, true), '_blank');\r\n    }\r\n    setShowMoreMenu(false);\r\n  };\r\n\r\n  const handleShareFunc = () => {\r\n    if (!current?.url) return;\r\n    const url = getProxyUrl(current.url, true);\r\n\r\n    if (onShareMessage && roomId) {\r\n      const msg: Message = {\r\n        _id: current.id || Date.now().toString(),\r\n        roomId: roomId,\r\n        sender: 'unknown',\r\n        type: current.type,\r\n        fileUrl: current.url,\r\n        timestamp: Date.now(),\r\n      };\r\n      onShareMessage(msg);\r\n      setShowMoreMenu(false);\r\n      return;\r\n    }\r\n\r\n    if (onShare) onShare(url, current?.id);\r\n    else if (navigator.share) {\r\n      navigator.share({ title: chatName || 'Media', url }).catch(() => {});\r\n    } else {\r\n      try {\r\n        navigator.clipboard.writeText(url);\r\n      } catch {}\r\n    }\r\n    setShowMoreMenu(false);\r\n  };\r\n\r\n  const handleCopyLink = () => {\r\n    if (!current?.url) return;\r\n    try {\r\n      navigator.clipboard.writeText(getProxyUrl(current.url, true));\r\n    } catch {}\r\n    setShowMoreMenu(false);\r\n  };\r\n\r\n  const handleEdit = () => {\r\n    setIsEditing(true);\r\n    setShowMoreMenu(false);\r\n  };\r\n\r\n  if (!current) return null;\r\n\r\n  if (isEditing && current) {\r\n    return (\r\n      <MediaEditor\r\n        mediaUrl={current.url}\r\n        mediaType={current.type}\r\n        chatName={chatName}\r\n        onClose={() => setIsEditing(false)}\r\n        onSend={(data) => {\r\n          try {\r\n            const detail = {\r\n              type: current.type,\r\n              imageDataUrl: data?.videoCropConfig ? undefined : (data?.imageDataUrl ?? undefined),\r\n              originalUrl: current.url,\r\n              videoCropConfig: data?.videoCropConfig ?? undefined,\r\n            };\r\n            const ev = new CustomEvent('sendEditedMedia', { detail });\r\n            window.dispatchEvent(ev);\r\n          } catch {}\r\n          setIsEditing(false);\r\n          onClose();\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 z-[10000] bg-black/95 flex items-center justify-center\"\r\n      onClick={(e) => {\r\n        if (e.target !== e.currentTarget) return;\r\n        const sinceOpen = Date.now() - openedAtRef.current;\r\n        if (sinceOpen < 200) return;\r\n        onClose();\r\n      }}\r\n    >\r\n      <div className=\"relative w-full max-w-6xl mx-auto\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"hidden md:block absolute top-0 left-0 right-0 z-20 px-4 sm:px-6 py-3 text-white text-center\">\r\n          <h3 className=\"text-lg sm:text-xl font-semibold truncate\">\r\n            {chatName || (isGroup ? 'Nhóm chat' : 'Cuộc trò chuyện')}\r\n          </h3>\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-center min-h-screen md:py-16 py-12 overflow-hidden\">\r\n          <div\r\n            className=\"relative max-w-full max-h-full overflow-hidden flex items-center justify-center\"\r\n            onMouseDown={handleMouseDown}\r\n            onMouseMove={handleMouseMove}\r\n            onMouseUp={handleMouseUp}\r\n            onMouseLeave={handleMouseUp}\r\n            onTouchStart={handleTouchStart}\r\n            onTouchMove={handleTouchMove}\r\n            onTouchEnd={handleTouchEnd}\r\n            style={{ cursor: zoom > 1 ? (isDragging ? 'grabbing' : 'grab') : 'default' }}\r\n          >\r\n            {current.type === 'image' ? (\r\n              <div\r\n                className=\"animate-in fade-in zoom-in-95 duration-300\"\r\n                style={{\r\n                  transform: `translate(${position.x}px, ${position.y}px) scale(${zoom})`,\r\n                  transformOrigin: 'center center',\r\n                  transition: isDragging ? 'none' : 'transform 0.2s',\r\n                }}\r\n              >\r\n                <Image\r\n                  src={getProxyUrl(current.url)}\r\n                  alt=\"Xem ảnh lớn\"\r\n                  width={1600}\r\n                  height={1200}\r\n                  className=\"max-h-[70vh] w-auto max-w-full object-contain rounded-md shadow-2xl select-none pointer-events-none\"\r\n                  priority\r\n                />\r\n              </div>\r\n            ) : (\r\n              <div\r\n                className=\"animate-in fade-in duration-300 rounded-md overflow-hidden shadow-2xl\"\r\n                style={{\r\n                  transform: `translate(${position.x}px, ${position.y}px) scale(${zoom})`,\r\n                  transformOrigin: 'center center',\r\n                  transition: isDragging ? 'none' : 'transform 0.2s',\r\n                }}\r\n              >\r\n                <video\r\n                  src={getProxyUrl(current.url)}\r\n                  controls={zoom <= 1} // Hide controls when zooming to prevent interaction conflict or just keep them\r\n                  autoPlay\r\n                  loop\r\n                  muted={false}\r\n                  className=\"max-h-[70vh] w-auto max-w-full rounded-md select-none\"\r\n                  playsInline\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {items.length > 0 && showThumbnails && (\r\n          <>\r\n            <div className=\"hidden md:flex absolute right-36 top-1/2 -translate-y-1/2 flex-col items-center gap-3 z-20\">\r\n              <button\r\n                className=\"p-2 cursor-pointer rounded-full bg-white/10 hover:bg-white/20 border border-white/20 text-white shadow-lg\"\r\n                onClick={() => {\r\n                  const el = listRef.current;\r\n                  if (el) el.scrollBy({ top: -300, behavior: 'smooth' });\r\n                }}\r\n              >\r\n                <HiChevronUp className=\"w-5 h-5\" />\r\n              </button>\r\n              <button\r\n                className=\"p-2 cursor-pointer rounded-full bg-white/10 hover:bg-white/20 border border-white/20 text-white shadow-lg\"\r\n                onClick={() => {\r\n                  const el = listRef.current;\r\n                  if (el) el.scrollBy({ top: 300, behavior: 'smooth' });\r\n                }}\r\n              >\r\n                <HiChevronDown className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"md:hidden absolute left-2 top-1/2 -translate-y-1/2 z-20\">\r\n              <button\r\n                className=\"p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 text-white shadow-lg backdrop-blur-sm\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  const currentIndex = items.findIndex((it) => it.url === current?.url);\r\n                  if (currentIndex > 0) {\r\n                    const prev = items[currentIndex - 1];\r\n                    setCurrent({ id: prev.id, url: prev.url, type: prev.type });\r\n                  }\r\n                }}\r\n                style={{ visibility: items.findIndex((it) => it.url === current?.url) > 0 ? 'visible' : 'hidden' }}\r\n              >\r\n                <HiChevronLeft className=\"w-8 h-8\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"md:hidden absolute right-2 top-1/2 -translate-y-1/2 z-20\">\r\n              <button\r\n                className=\"p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 text-white shadow-lg backdrop-blur-sm\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  const currentIndex = items.findIndex((it) => it.url === current?.url);\r\n                  if (currentIndex < items.length - 1) {\r\n                    const next = items[currentIndex + 1];\r\n                    setCurrent({ id: next.id, url: next.url, type: next.type });\r\n                  }\r\n                }}\r\n                style={{\r\n                  visibility:\r\n                    items.findIndex((it) => it.url === current?.url) < items.length - 1 ? 'visible' : 'hidden',\r\n                }}\r\n              >\r\n                <HiChevronRight className=\"w-8 h-8\" />\r\n              </button>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {/* Thumbnails moved to bottom bar */}\r\n\r\n        <div className=\"absolute left-0 right-0 top-0 z-20 px-4 sm:px-6 py-2 bg-black/40 backdrop-blur-sm border-t border-white/10 text-white flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-3 min-w-0\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"md:hidden p-2 rounded-full cursor-pointer bg-white/10 hover:bg-white/20 border border-white/20 transition-all active:scale-95\"\r\n              title=\"Đóng\"\r\n            >\r\n              <HiChevronLeft className=\"w-6 h-6\" />\r\n            </button>\r\n            <div className=\"text-sm font-medium truncate md:max-w-[40vw] max-w-[50vw] text-center md:text-left\">\r\n              {chatName || (isGroup ? 'Nhóm chat' : 'Cuộc trò chuyện')}\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-1.5 text-white/80\">\r\n            <button\r\n              className=\"cursor-pointer inline-flex p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 transition-all active:scale-95\"\r\n              onClick={(e) => {\r\n                e.preventDefault();\r\n                handleDownload();\r\n              }}\r\n              title=\"Tải xuống\"\r\n            >\r\n              <HiDownload className=\"w-5 h-5\" />\r\n            </button>\r\n\r\n            <div className=\"relative\" ref={moreMenuRef}>\r\n              <button\r\n                onClick={() => setShowMoreMenu(!showMoreMenu)}\r\n                className=\"p-2 rounded-full cursor-pointer bg-white/10 hover:bg-white/20 border border-white/20 transition-all active:scale-95\"\r\n                title=\"Thêm\"\r\n              >\r\n                <HiDotsHorizontal className=\"w-5 h-5\" />\r\n              </button>\r\n\r\n              {showMoreMenu && (\r\n                <div className=\"absolute right-0 top-full mt-2 w-48 bg-gray-900 border border-white/10 rounded-lg shadow-xl overflow-hidden z-50 flex flex-col py-1\">\r\n                  <button\r\n                    onClick={() => setZoom((z) => Math.min(2.5, +(z + 0.2).toFixed(2)))}\r\n                    className=\"cursor-pointer flex items-center gap-3 px-4 py-3 hover:bg-white/10 text-left text-sm text-white transition-colors\"\r\n                  >\r\n                    <HiMagnifyingGlassPlus className=\"w-5 h-5\" />\r\n                    <span>Phóng to</span>\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setZoom((z) => Math.max(0.5, +(z - 0.2).toFixed(2)))}\r\n                    className=\"cursor-pointer flex items-center gap-3 px-4 py-3 hover:bg-white/10 text-left text-sm text-white transition-colors\"\r\n                  >\r\n                    <HiMagnifyingGlassMinus className=\"w-5 h-5\" />\r\n                    <span>Thu nhỏ</span>\r\n                  </button>\r\n                  <button\r\n                    onClick={handleEdit}\r\n                    className=\"cursor-pointer flex items-center gap-3 px-4 py-3 hover:bg-white/10 text-left text-sm text-white transition-colors\"\r\n                  >\r\n                    <HiPencil className=\"w-5 h-5\" />\r\n                    <span>Chỉnh sửa ảnh</span>\r\n                  </button>\r\n                  <button\r\n                    onClick={handleDownload}\r\n                    className=\"cursor-pointer flex items-center gap-3 px-4 py-3 hover:bg-white/10 text-left text-sm text-white transition-colors\"\r\n                  >\r\n                    <HiSave className=\"w-5 h-5\" />\r\n                    <span>Lưu về máy</span>\r\n                  </button>\r\n                  <button\r\n                    onClick={handleShareFunc}\r\n                    className=\"cursor-pointer flex items-center gap-3 px-4 py-3 hover:bg-white/10 text-left text-sm text-white transition-colors\"\r\n                  >\r\n                    <HiShare className=\"w-5 h-5\" />\r\n                    <span>Chia sẻ</span>\r\n                  </button>\r\n                  <button\r\n                    onClick={handleCopyLink}\r\n                    className=\"cursor-pointer flex items-center gap-3 px-4 py-3 hover:bg-white/10 text-left text-sm text-white transition-colors\"\r\n                  >\r\n                    <HiDuplicate className=\"w-5 h-5\" />\r\n                    <span>Copy</span>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <button\r\n              onClick={onClose}\r\n              className=\"hidden md:inline-flex p-2 rounded-full cursor-pointer bg-white/10 hover:bg-white/20 border border-white/20 transition-all active:scale-95\"\r\n              title=\"Đóng\"\r\n            >\r\n              <HiX className=\"w-6 h-6\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div className=\"absolute left-0 right-0 bottom-0 z-20 flex flex-col items-center justify-end bg-black/60 backdrop-blur-sm border-t border-white/10 pb-2\">\r\n          {groups.length > 0 && showThumbnails && (\r\n            <div className=\"w-full overflow-x-auto no-scrollbar py-2\" ref={listRef}>\r\n              <div className=\"flex flex-row items-center justify-center gap-2 px-2 min-w-max mx-auto\">\r\n                {groups.map((g, gi) => (\r\n                  <div key={`${g.dateLabel}-${gi}`} className=\"flex flex-row gap-2\">\r\n                    {g.items.map((it) => (\r\n                      <div\r\n                        key={it.id}\r\n                        ref={(el) => {\r\n                          itemRefs.current[it.url] = el;\r\n                        }}\r\n                        className={`relative rounded-md overflow-hidden border ${\r\n                          current && current.url === it.url ? 'border-blue-400' : 'border-transparent'\r\n                        } cursor-pointer w-16 h-16 shrink-0`}\r\n                        onClick={() => setCurrent({ id: it.id, url: it.url, type: it.type })}\r\n                      >\r\n                        {it.type === 'image' ? (\r\n                          <Image\r\n                            src={getProxyUrl(it.url)}\r\n                            alt=\"thumb\"\r\n                            width={120}\r\n                            height={120}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        ) : (\r\n                          <video src={getProxyUrl(it.url)} className=\"w-full h-full object-cover\" preload=\"metadata\" />\r\n                        )}\r\n                        <div className=\"absolute inset-0 hover:bg-black/30 transition-opacity duration-300 flex items-center justify-center\">\r\n                          {it.type === 'video' && <HiPlay className=\"w-6 h-6 text-white drop-shadow-lg\" />}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div className=\"flex items-center justify-between w-full gap-4 px-5 sm:px-6 py-2 text-white\">\r\n            <div className=\"flex items-center justify-center gap-4\">\r\n              <button\r\n                className={`cursor-pointer p-3 md:p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 transition-all active:scale-95 ${\r\n                  showThumbnails ? 'bg-white/30' : ''\r\n                }`}\r\n                title=\"Hiện/Ẩn danh sách\"\r\n                onClick={() => setShowThumbnails(!showThumbnails)}\r\n              >\r\n                <HiPhotograph className=\"w-6 h-6 md:w-5 md:h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <button\r\n              className=\"cursor-pointer p-3 md:p-2 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 transition-all active:scale-95 \"\r\n              title=\"Chia sẻ\"\r\n              onClick={handleShareFunc}\r\n            >\r\n              <FaRegShareFromSquare className=\"w-6 h-6 md:w-4 md:h-4\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAGpD;AACA;AACA;AAmBA;AACA;AACA;AAEA;;;AA3BA;;;;;;;;AAyCe,SAAS,kBAAkB,EACxC,KAAK,EACL,QAAQ,EACR,OAAO,EACP,OAAO,EACP,MAAM,EACN,OAAO,EACP,OAAO,EACP,cAAc,EACd,eAAe,EACQ;;IACvB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAElC,EAAE;IACJ,MAAM,QAAQ,IAAA,wKAAO;4CAAC,IAAM,OAAO,OAAO;oDAAC,CAAC,IAAM,EAAE,KAAK;;2CAAG;QAAC;KAAO;IACpE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAA+D;IACrG,MAAM,UAAU,IAAA,uKAAM,EAAwB;IAC9C,MAAM,WAAW,IAAA,uKAAM,EAAwC,CAAC;IAChE,MAAM,cAAc,IAAA,uKAAM,EAAS;IACnC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAS;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;QAAE,GAAG;QAAG,GAAG;IAAE;IACtD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,eAAe,IAAA,uKAAM,EAAkC;IAC7D,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IACrD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,IAAA,0KAAS;uCAAC;YACR,WAAW;YACX,IAAI,OAAO,YAAY,OAAO,GAAG,KAAK,GAAG;YACzC,QAAQ;YACR,YAAY;gBAAE,GAAG;gBAAG,GAAG;YAAE;QAC3B;sCAAG;QAAC;KAAM;IAEV,MAAM,kBAAkB,CAAC;QACvB,IAAI,QAAQ,GAAG;QACf,cAAc;QACd,aAAa,OAAO,GAAG;YAAE,GAAG,EAAE,OAAO,GAAG,SAAS,CAAC;YAAE,GAAG,EAAE,OAAO,GAAG,SAAS,CAAC;QAAC;QAC9E,EAAE,cAAc,IAAI,+CAA+C;IACrE;IAEA,MAAM,kBAAkB,CAAC;QACvB,IAAI,CAAC,cAAc,CAAC,aAAa,OAAO,IAAI,QAAQ,GAAG;QACvD,YAAY;YACV,GAAG,EAAE,OAAO,GAAG,aAAa,OAAO,CAAC,CAAC;YACrC,GAAG,EAAE,OAAO,GAAG,aAAa,OAAO,CAAC,CAAC;QACvC;IACF;IAEA,MAAM,gBAAgB;QACpB,cAAc;QACd,aAAa,OAAO,GAAG;IACzB;IAEA,MAAM,mBAAmB,CAAC;QACxB,IAAI,QAAQ,GAAG;QACf,cAAc;QACd,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;QAC1B,aAAa,OAAO,GAAG;YAAE,GAAG,MAAM,OAAO,GAAG,SAAS,CAAC;YAAE,GAAG,MAAM,OAAO,GAAG,SAAS,CAAC;QAAC;IACxF;IAEA,MAAM,kBAAkB,CAAC;QACvB,IAAI,CAAC,cAAc,CAAC,aAAa,OAAO,IAAI,QAAQ,GAAG;QACvD,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;QAC1B,YAAY;YACV,GAAG,MAAM,OAAO,GAAG,aAAa,OAAO,CAAC,CAAC;YACzC,GAAG,MAAM,OAAO,GAAG,aAAa,OAAO,CAAC,CAAC;QAC3C;IACF;IAEA,MAAM,iBAAiB;QACrB,cAAc;QACd,aAAa,OAAO,GAAG;IACzB;IAEA,IAAA,0KAAS;uCAAC;YACR,MAAM;wDAAW;oBACf,IAAI,CAAC,QAAQ;oBACb,IAAI;wBACF,MAAM,MAAM,MAAM,MAAM,iBAAiB;4BACvC,QAAQ;4BACR,SAAS;gCAAE,gBAAgB;4BAAmB;4BAC9C,MAAM,KAAK,SAAS,CAAC;gCAAE,QAAQ;gCAAc;gCAAQ,WAAW;gCAAS,OAAO;4BAAK;wBACvF;wBACA,MAAM,OAAO,MAAM,IAAI,IAAI;wBAC3B,MAAM,KAAK,MAAM,OAAO,CAAC,MAAM,UAAU,KAAK,MAAM,GAAG,EAAE;wBACzD,UAAU;oBACZ,EAAE,OAAM,CAAC;gBACX;;YACA;QACF;sCAAG;QAAC;KAAO;IAEX,IAAA,0KAAS;uCAAC;YACR,QAAQ;YACR,YAAY;gBAAE,GAAG;gBAAG,GAAG;YAAE;QAC3B;sCAAG;QAAC,SAAS;KAAI;IAEjB,IAAA,0KAAS;uCAAC;YACR,IAAI,CAAC,SAAS;YACd,MAAM,KAAK,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC;YACxC,MAAM,OAAO,QAAQ,OAAO;YAC5B,IAAI,MAAM,MAAM;gBACd,IAAI;oBACF,MAAM,WAAW,OAAO,UAAU,GAAG,KAAK,wCAAwC;oBAClF,IAAI,UAAU;wBACZ,2CAA2C;wBAC3C,MAAM,aAAa,GAAG,UAAU,GAAG,CAAC,KAAK,WAAW,GAAG,IAAI,GAAG,WAAW,GAAG,CAAC;wBAC7E,KAAK,QAAQ,CAAC;4BAAE,MAAM,KAAK,GAAG,CAAC,GAAG;4BAAa,UAAU;wBAAS;oBACpE,OAAO;wBACL,2CAA2C;wBAC3C,MAAM,YAAY,GAAG,SAAS,GAAG,CAAC,KAAK,YAAY,GAAG,IAAI,GAAG,YAAY,GAAG,CAAC;wBAC7E,KAAK,QAAQ,CAAC;4BAAE,KAAK,KAAK,GAAG,CAAC,GAAG;4BAAY,UAAU;wBAAS;oBAClE;gBACF,EAAE,OAAM,CAAC;YACX;QACF;sCAAG;QAAC;QAAS;QAAO;KAAe;IAEnC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IACjD,MAAM,cAAc,IAAA,uKAAM,EAAiB;IAE3C,IAAA,0KAAS;uCAAC;YACR,MAAM;kEAAqB,CAAC;oBAC1B,IAAI,YAAY,OAAO,IAAI,CAAC,YAAY,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;wBAC9E,gBAAgB;oBAClB;gBACF;;YACA,SAAS,gBAAgB,CAAC,aAAa;YACvC;+CAAO;oBACL,SAAS,mBAAmB,CAAC,aAAa;gBAC5C;;QACF;sCAAG,EAAE;IAEL,MAAM,iBAAiB;QACrB,IAAI,CAAC,SAAS,KAAK;QACnB,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,IAAA,uIAAW,EAAC,QAAQ,GAAG,EAAE;YACjD,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,MAAM,MAAM,OAAO,GAAG,CAAC,eAAe,CAAC;YACvC,MAAM,IAAI,SAAS,aAAa,CAAC;YACjC,EAAE,KAAK,CAAC,OAAO,GAAG;YAClB,EAAE,IAAI,GAAG;YACT,EAAE,QAAQ,GAAG,QAAQ,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM;YAC7C,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,EAAE,KAAK;YACP,OAAO,GAAG,CAAC,eAAe,CAAC;YAC3B,SAAS,IAAI,CAAC,WAAW,CAAC;QAC5B,EAAE,OAAO,KAAK;YACZ,OAAO,IAAI,CAAC,IAAA,uIAAW,EAAC,QAAQ,GAAG,EAAE,OAAO;QAC9C;QACA,gBAAgB;IAClB;IAEA,MAAM,kBAAkB;QACtB,IAAI,CAAC,SAAS,KAAK;QACnB,MAAM,MAAM,IAAA,uIAAW,EAAC,QAAQ,GAAG,EAAE;QAErC,IAAI,kBAAkB,QAAQ;YAC5B,MAAM,MAAe;gBACnB,KAAK,QAAQ,EAAE,IAAI,KAAK,GAAG,GAAG,QAAQ;gBACtC,QAAQ;gBACR,QAAQ;gBACR,MAAM,QAAQ,IAAI;gBAClB,SAAS,QAAQ,GAAG;gBACpB,WAAW,KAAK,GAAG;YACrB;YACA,eAAe;YACf,gBAAgB;YAChB;QACF;QAEA,IAAI,SAAS,QAAQ,KAAK,SAAS;aAC9B,IAAI,UAAU,KAAK,EAAE;YACxB,UAAU,KAAK,CAAC;gBAAE,OAAO,YAAY;gBAAS;YAAI,GAAG,KAAK,CAAC,KAAO;QACpE,OAAO;YACL,IAAI;gBACF,UAAU,SAAS,CAAC,SAAS,CAAC;YAChC,EAAE,OAAM,CAAC;QACX;QACA,gBAAgB;IAClB;IAEA,MAAM,iBAAiB;QACrB,IAAI,CAAC,SAAS,KAAK;QACnB,IAAI;YACF,UAAU,SAAS,CAAC,SAAS,CAAC,IAAA,uIAAW,EAAC,QAAQ,GAAG,EAAE;QACzD,EAAE,OAAM,CAAC;QACT,gBAAgB;IAClB;IAEA,MAAM,aAAa;QACjB,aAAa;QACb,gBAAgB;IAClB;IAEA,IAAI,CAAC,SAAS,OAAO;IAErB,IAAI,aAAa,SAAS;QACxB,qBACE,6LAAC,gKAAW;YACV,UAAU,QAAQ,GAAG;YACrB,WAAW,QAAQ,IAAI;YACvB,UAAU;YACV,SAAS,IAAM,aAAa;YAC5B,QAAQ,CAAC;gBACP,IAAI;oBACF,MAAM,SAAS;wBACb,MAAM,QAAQ,IAAI;wBAClB,cAAc,MAAM,kBAAkB,YAAa,MAAM,gBAAgB;wBACzE,aAAa,QAAQ,GAAG;wBACxB,iBAAiB,MAAM,mBAAmB;oBAC5C;oBACA,MAAM,KAAK,IAAI,YAAY,mBAAmB;wBAAE;oBAAO;oBACvD,OAAO,aAAa,CAAC;gBACvB,EAAE,OAAM,CAAC;gBACT,aAAa;gBACb;YACF;;;;;;IAGN;IAEA,qBACE,6LAAC;QACC,WAAU;QACV,SAAS,CAAC;YACR,IAAI,EAAE,MAAM,KAAK,EAAE,aAAa,EAAE;YAClC,MAAM,YAAY,KAAK,GAAG,KAAK,YAAY,OAAO;YAClD,IAAI,YAAY,KAAK;YACrB;QACF;kBAEA,cAAA,6LAAC;YAAI,WAAU;YAAoC,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAClF,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAG,WAAU;kCACX,YAAY,CAAC,UAAU,cAAc,iBAAiB;;;;;;;;;;;8BAI3D,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBACC,WAAU;wBACV,aAAa;wBACb,aAAa;wBACb,WAAW;wBACX,cAAc;wBACd,cAAc;wBACd,aAAa;wBACb,YAAY;wBACZ,OAAO;4BAAE,QAAQ,OAAO,IAAK,aAAa,aAAa,SAAU;wBAAU;kCAE1E,QAAQ,IAAI,KAAK,wBAChB,6LAAC;4BACC,WAAU;4BACV,OAAO;gCACL,WAAW,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;gCACvE,iBAAiB;gCACjB,YAAY,aAAa,SAAS;4BACpC;sCAEA,cAAA,6LAAC,2IAAK;gCACJ,KAAK,IAAA,uIAAW,EAAC,QAAQ,GAAG;gCAC5B,KAAI;gCACJ,OAAO;gCACP,QAAQ;gCACR,WAAU;gCACV,QAAQ;;;;;;;;;;iDAIZ,6LAAC;4BACC,WAAU;4BACV,OAAO;gCACL,WAAW,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;gCACvE,iBAAiB;gCACjB,YAAY,aAAa,SAAS;4BACpC;sCAEA,cAAA,6LAAC;gCACC,KAAK,IAAA,uIAAW,EAAC,QAAQ,GAAG;gCAC5B,UAAU,QAAQ;gCAClB,QAAQ;gCACR,IAAI;gCACJ,OAAO;gCACP,WAAU;gCACV,WAAW;;;;;;;;;;;;;;;;;;;;;gBAOpB,MAAM,MAAM,GAAG,KAAK,gCACnB;;sCACE,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,WAAU;oCACV,SAAS;wCACP,MAAM,KAAK,QAAQ,OAAO;wCAC1B,IAAI,IAAI,GAAG,QAAQ,CAAC;4CAAE,KAAK,CAAC;4CAAK,UAAU;wCAAS;oCACtD;8CAEA,cAAA,6LAAC,gKAAW;wCAAC,WAAU;;;;;;;;;;;8CAEzB,6LAAC;oCACC,WAAU;oCACV,SAAS;wCACP,MAAM,KAAK,QAAQ,OAAO;wCAC1B,IAAI,IAAI,GAAG,QAAQ,CAAC;4CAAE,KAAK;4CAAK,UAAU;wCAAS;oCACrD;8CAEA,cAAA,6LAAC,kKAAa;wCAAC,WAAU;;;;;;;;;;;;;;;;;sCAI7B,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCACC,WAAU;gCACV,SAAS,CAAC;oCACR,EAAE,eAAe;oCACjB,MAAM,eAAe,MAAM,SAAS,CAAC,CAAC,KAAO,GAAG,GAAG,KAAK,SAAS;oCACjE,IAAI,eAAe,GAAG;wCACpB,MAAM,OAAO,KAAK,CAAC,eAAe,EAAE;wCACpC,WAAW;4CAAE,IAAI,KAAK,EAAE;4CAAE,KAAK,KAAK,GAAG;4CAAE,MAAM,KAAK,IAAI;wCAAC;oCAC3D;gCACF;gCACA,OAAO;oCAAE,YAAY,MAAM,SAAS,CAAC,CAAC,KAAO,GAAG,GAAG,KAAK,SAAS,OAAO,IAAI,YAAY;gCAAS;0CAEjG,cAAA,6LAAC,kKAAa;oCAAC,WAAU;;;;;;;;;;;;;;;;sCAG7B,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCACC,WAAU;gCACV,SAAS,CAAC;oCACR,EAAE,eAAe;oCACjB,MAAM,eAAe,MAAM,SAAS,CAAC,CAAC,KAAO,GAAG,GAAG,KAAK,SAAS;oCACjE,IAAI,eAAe,MAAM,MAAM,GAAG,GAAG;wCACnC,MAAM,OAAO,KAAK,CAAC,eAAe,EAAE;wCACpC,WAAW;4CAAE,IAAI,KAAK,EAAE;4CAAE,KAAK,KAAK,GAAG;4CAAE,MAAM,KAAK,IAAI;wCAAC;oCAC3D;gCACF;gCACA,OAAO;oCACL,YACE,MAAM,SAAS,CAAC,CAAC,KAAO,GAAG,GAAG,KAAK,SAAS,OAAO,MAAM,MAAM,GAAG,IAAI,YAAY;gCACtF;0CAEA,cAAA,6LAAC,mKAAc;oCAAC,WAAU;;;;;;;;;;;;;;;;;;8BAQlC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,SAAS;oCACT,WAAU;oCACV,OAAM;8CAEN,cAAA,6LAAC,kKAAa;wCAAC,WAAU;;;;;;;;;;;8CAE3B,6LAAC;oCAAI,WAAU;8CACZ,YAAY,CAAC,UAAU,cAAc,iBAAiB;;;;;;;;;;;;sCAG3D,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,WAAU;oCACV,SAAS,CAAC;wCACR,EAAE,cAAc;wCAChB;oCACF;oCACA,OAAM;8CAEN,cAAA,6LAAC,+JAAU;wCAAC,WAAU;;;;;;;;;;;8CAGxB,6LAAC;oCAAI,WAAU;oCAAW,KAAK;;sDAC7B,6LAAC;4CACC,SAAS,IAAM,gBAAgB,CAAC;4CAChC,WAAU;4CACV,OAAM;sDAEN,cAAA,6LAAC,qKAAgB;gDAAC,WAAU;;;;;;;;;;;wCAG7B,8BACC,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDACC,SAAS,IAAM,QAAQ,CAAC,IAAM,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,GAAG,EAAE,OAAO,CAAC;oDAC/D,WAAU;;sEAEV,6LAAC,2KAAqB;4DAAC,WAAU;;;;;;sEACjC,6LAAC;sEAAK;;;;;;;;;;;;8DAER,6LAAC;oDACC,SAAS,IAAM,QAAQ,CAAC,IAAM,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,GAAG,EAAE,OAAO,CAAC;oDAC/D,WAAU;;sEAEV,6LAAC,4KAAsB;4DAAC,WAAU;;;;;;sEAClC,6LAAC;sEAAK;;;;;;;;;;;;8DAER,6LAAC;oDACC,SAAS;oDACT,WAAU;;sEAEV,6LAAC,6JAAQ;4DAAC,WAAU;;;;;;sEACpB,6LAAC;sEAAK;;;;;;;;;;;;8DAER,6LAAC;oDACC,SAAS;oDACT,WAAU;;sEAEV,6LAAC,2JAAM;4DAAC,WAAU;;;;;;sEAClB,6LAAC;sEAAK;;;;;;;;;;;;8DAER,6LAAC;oDACC,SAAS;oDACT,WAAU;;sEAEV,6LAAC,4JAAO;4DAAC,WAAU;;;;;;sEACnB,6LAAC;sEAAK;;;;;;;;;;;;8DAER,6LAAC;oDACC,SAAS;oDACT,WAAU;;sEAEV,6LAAC,gKAAW;4DAAC,WAAU;;;;;;sEACvB,6LAAC;sEAAK;;;;;;;;;;;;;;;;;;;;;;;;8CAMd,6LAAC;oCACC,SAAS;oCACT,WAAU;oCACV,OAAM;8CAEN,cAAA,6LAAC,wJAAG;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;8BAIrB,6LAAC;oBAAI,WAAU;;wBACZ,OAAO,MAAM,GAAG,KAAK,gCACpB,6LAAC;4BAAI,WAAU;4BAA2C,KAAK;sCAC7D,cAAA,6LAAC;gCAAI,WAAU;0CACZ,OAAO,GAAG,CAAC,CAAC,GAAG,mBACd,6LAAC;wCAAiC,WAAU;kDACzC,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,mBACZ,6LAAC;gDAEC,KAAK,CAAC;oDACJ,SAAS,OAAO,CAAC,GAAG,GAAG,CAAC,GAAG;gDAC7B;gDACA,WAAW,CAAC,2CAA2C,EACrD,WAAW,QAAQ,GAAG,KAAK,GAAG,GAAG,GAAG,oBAAoB,qBACzD,kCAAkC,CAAC;gDACpC,SAAS,IAAM,WAAW;wDAAE,IAAI,GAAG,EAAE;wDAAE,KAAK,GAAG,GAAG;wDAAE,MAAM,GAAG,IAAI;oDAAC;;oDAEjE,GAAG,IAAI,KAAK,wBACX,6LAAC,2IAAK;wDACJ,KAAK,IAAA,uIAAW,EAAC,GAAG,GAAG;wDACvB,KAAI;wDACJ,OAAO;wDACP,QAAQ;wDACR,WAAU;;;;;6EAGZ,6LAAC;wDAAM,KAAK,IAAA,uIAAW,EAAC,GAAG,GAAG;wDAAG,WAAU;wDAA6B,SAAQ;;;;;;kEAElF,6LAAC;wDAAI,WAAU;kEACZ,GAAG,IAAI,KAAK,yBAAW,6LAAC,2JAAM;4DAAC,WAAU;;;;;;;;;;;;+CArBvC,GAAG,EAAE;;;;;uCAHN,GAAG,EAAE,SAAS,CAAC,CAAC,EAAE,IAAI;;;;;;;;;;;;;;;sCAiCxC,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC;wCACC,WAAW,CAAC,2HAA2H,EACrI,iBAAiB,gBAAgB,IACjC;wCACF,OAAM;wCACN,SAAS,IAAM,kBAAkB,CAAC;kDAElC,cAAA,6LAAC,iKAAY;4CAAC,WAAU;;;;;;;;;;;;;;;;8CAI5B,6LAAC;oCACC,WAAU;oCACV,OAAM;oCACN,SAAS;8CAET,cAAA,6LAAC,0KAAoB;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO9C;GA3fwB;KAAA"}},
    {"offset": {"line": 3281, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/ChatHeader.tsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl } from '../../utils/utils';\r\n\r\n// React Icons - chuẩn Zalo, đẹp, nhẹ\r\nimport {\r\n  HiArrowLeft,\r\n  HiMagnifyingGlass,\r\n  HiEllipsisVertical,\r\n  HiUserGroup,\r\n  HiPhone,\r\n  HiVideoCamera,\r\n  HiXMark,\r\n} from 'react-icons/hi2';\r\nimport { CiPhone, CiSearch, CiVideoOn } from 'react-icons/ci';\r\n\r\ninterface ChatHeaderProps {\r\n  chatName: string;\r\n  isGroup: boolean;\r\n  memberCount: number;\r\n  showPopup: boolean;\r\n  onTogglePopup: () => void;\r\n  onOpenMembers: () => void;\r\n  showSearchSidebar: boolean;\r\n  onToggleSearchSidebar: () => void;\r\n  avatar?: string;\r\n  onBackFromChat?: () => void;\r\n  presenceText?: string;\r\n  presenceOnline?: boolean;\r\n  onVoiceCall?: () => void;\r\n  onVideoCall?: () => void;\r\n  // Mobile inline search props\r\n  isMobile?: boolean;\r\n  isSearchActive?: boolean;\r\n  initialKeyword?: string | null;\r\n  onSearchTermChange?: (term: string) => void;\r\n  onSearchFocus?: () => void;\r\n  searchInputRef?: React.RefObject<HTMLInputElement | null>;\r\n  onCloseSearch?: () => void;\r\n}\r\n\r\nexport default function ChatHeader({\r\n  chatName,\r\n  isGroup,\r\n  memberCount,\r\n  showPopup,\r\n  onTogglePopup,\r\n  onOpenMembers,\r\n  showSearchSidebar,\r\n  onToggleSearchSidebar,\r\n  avatar,\r\n  onBackFromChat,\r\n  presenceText,\r\n  presenceOnline,\r\n  onVoiceCall,\r\n  onVideoCall,\r\n  isMobile = false,\r\n  isSearchActive = false,\r\n  initialKeyword = null,\r\n  onSearchTermChange,\r\n  onSearchFocus,\r\n  searchInputRef,\r\n}: ChatHeaderProps) {\r\n  const [imgError, setImgError] = useState(false);\r\n  const [localSearchTerm, setLocalSearchTerm] = useState('');\r\n  const hasAutoSearchedRef = useRef(false);\r\n  const lastInitialKeywordRef = useRef<string | null>(null);\r\n  const manualCloseRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    setImgError(false);\r\n  }, [avatar]);\r\n\r\n  useEffect(() => {\r\n    const kw = (initialKeyword || '').trim();\r\n    if (!kw) return;\r\n    setLocalSearchTerm(kw);\r\n    if (isMobile && isSearchActive) {\r\n      if (lastInitialKeywordRef.current === kw && hasAutoSearchedRef.current) return;\r\n      hasAutoSearchedRef.current = true;\r\n      lastInitialKeywordRef.current = kw;\r\n      setTimeout(() => {\r\n        searchInputRef?.current?.focus?.();\r\n      }, 100);\r\n      onSearchTermChange?.(kw);\r\n    }\r\n  }, [initialKeyword, isMobile, isSearchActive, onSearchTermChange]);\r\n\r\n  useEffect(() => {\r\n    if (!isMobile) return;\r\n    if (isSearchActive) return;\r\n    if (manualCloseRef.current) {\r\n      manualCloseRef.current = false;\r\n      hasAutoSearchedRef.current = false;\r\n      lastInitialKeywordRef.current = null;\r\n      // setLocalSearchTerm('');\r\n      // onSearchTermChange?.('');\r\n    }\r\n  }, [isSearchActive, isMobile, onSearchTermChange]);\r\n\r\n  // Mobile: Show inline search bar when active\r\n  if (isMobile && isSearchActive) {\r\n    return (\r\n      <div className=\"flex items-center gap-2 px-2 py-2 bg-white border-b border-gray-200 shadow-sm\">\r\n        {/* Back button */}\r\n        <button\r\n          onClick={() => {\r\n            if (isSearchActive) {\r\n              // Nếu đang tìm kiếm: Chỉ thoát chế độ tìm kiếm\r\n              manualCloseRef.current = true;\r\n              setLocalSearchTerm('');\r\n              onSearchTermChange?.('');\r\n              onToggleSearchSidebar?.();\r\n            } else {\r\n              // Nếu KHÔNG tìm kiếm: Gọi hàm quay lại danh sách chat\r\n              onBackFromChat?.();\r\n            }\r\n          }}\r\n          className=\"p-2 rounded-full hover:bg-gray-100 transition-colors cursor-pointer flex-shrink-0\"\r\n          title=\"Quay lại\"\r\n        >\r\n          <HiArrowLeft className=\"w-5 h-5 text-gray-700\" />\r\n        </button>\r\n\r\n        {/* Search icon */}\r\n        <CiSearch className=\"w-5 h-5 text-gray-500 flex-shrink-0\" />\r\n\r\n        {/* Search input */}\r\n        <div className=\"flex-1 relative\">\r\n          <input\r\n            ref={searchInputRef}\r\n            type=\"text\"\r\n            value={localSearchTerm}\r\n            onChange={(e) => {\r\n              setLocalSearchTerm(e.target.value);\r\n              onSearchTermChange?.(e.target.value);\r\n            }}\r\n            onFocus={onSearchFocus}\r\n            placeholder=\"Tìm kiếm...\"\r\n            className=\"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base\"\r\n            autoFocus\r\n          />\r\n          {localSearchTerm && (\r\n            <button\r\n              onClick={() => {\r\n                setLocalSearchTerm('');\r\n                onSearchTermChange?.('');\r\n              }}\r\n              className=\"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-gray-200 transition-colors cursor-pointer\"\r\n            >\r\n              <HiXMark className=\"w-4 h-4 text-gray-500\" />\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Desktop/Normal header\r\n  return (\r\n    <div className=\"flex items-center cursor-pointer justify-between px-2 bg-blue-400  md:bg-white border-b border-gray-200 shadow-sm\">\r\n      {/* Left: Back + Avatar + Tên */}\r\n      <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n        {/* Nút Back (mobile only) */}\r\n        {onBackFromChat && (\r\n          <button\r\n            onClick={onBackFromChat}\r\n            className=\"p-2 rounded-full   transition-colors lg:hidden cursor-pointer\"\r\n            title=\"Quay lại\"\r\n          >\r\n            <HiArrowLeft className=\"w-5 h-5 text-white md:text-gray-600\" />\r\n          </button>\r\n        )}\r\n\r\n        {/* Avatar */}\r\n        <div className=\"relative flex-shrink-0\">\r\n          <div\r\n            className={`\r\n            w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-md overflow-hidden ring-2 ring-white\r\n            ${isGroup ? 'bg-gradient-to-br from-blue-500 to-indigo-600' : 'bg-gradient-to-br from-gray-400 to-gray-600'}\r\n          `}\r\n          >\r\n            {avatar && !imgError ? (\r\n              <Image\r\n                src={getProxyUrl(avatar)}\r\n                alt={chatName}\r\n                width={40}\r\n                height={40}\r\n                className=\"w-full h-full object-cover\"\r\n                onError={() => setImgError(true)}\r\n              />\r\n            ) : (\r\n              <Image\r\n                src=\"/logo/avata.webp\"\r\n                alt={chatName}\r\n                width={40}\r\n                height={40}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            )}\r\n          </div>\r\n\r\n          {!isGroup && (\r\n            <div\r\n              className={`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white shadow-sm ${\r\n                presenceOnline ? 'bg-green-500' : 'bg-gray-400'\r\n              }`}\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {/* Tên + info */}\r\n        <button\r\n          onClick={onOpenMembers}\r\n          className=\" cursor-pointer text-left md:hover:bg-gray-50 rounded-xl px-3 py-2 -ml-2 transition-colors\"\r\n        >\r\n          <h1 className=\"font-semibold text-white md:text-gray-900 truncate w-[150px] md:w-full md:max-w-[300px] text-base\">{chatName}</h1>\r\n          <p className=\"text-xs text-white md:text-gray-500 flex items-center gap-1 mt-0.5\">\r\n            {isGroup ? (\r\n              <>\r\n                <HiUserGroup className=\"w-3.5 h-3.5\" />\r\n                {memberCount} thành viên\r\n              </>\r\n            ) : (\r\n              <>{presenceText || 'Đang hoạt động'}</>\r\n            )}\r\n          </p>\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-1\">\r\n        <>\r\n          {typeof onVoiceCall === 'function' && !isGroup && (\r\n            <button\r\n              onClick={onVoiceCall}\r\n              className=\"p-2 rounded-full cursor-pointer transition-all duration-200 hover:bg-gray-600 md:hover:bg-gray-100 text-white md:text-gray-600\"\r\n              title=\"Gọi thoại\"\r\n            >\r\n              <CiPhone className=\"w-5 h-5\" />\r\n            </button>\r\n          )}\r\n          {typeof onVideoCall === 'function' && (\r\n            <button\r\n              onClick={onVideoCall}\r\n              className=\"p-2 rounded-full cursor-pointer transition-all duration-200 hover:bg-gray-600 md:hover:bg-gray-100 text-white md:text-gray-600\"\r\n              title=\"Gọi video\"\r\n            >\r\n              <CiVideoOn className=\"w-5 h-5\" />\r\n            </button>\r\n          )}\r\n        </>\r\n\r\n        {/* Nút tìm kiếm - Mobile: Toggle inline search, Desktop: Toggle sidebar */}\r\n        <button\r\n          onClick={() => {\r\n            if (isMobile) {\r\n              // Mobile: Toggle inline search\r\n              if (onToggleSearchSidebar) onToggleSearchSidebar();\r\n            } else {\r\n              // Desktop: Toggle sidebar\r\n              if (showPopup) onTogglePopup();\r\n              if (onToggleSearchSidebar) onToggleSearchSidebar();\r\n            }\r\n          }}\r\n          className={`\r\n            p-2 rounded-full text-white md:text-gray-600 cursor-pointer transition-all duration-200\r\n            ${showSearchSidebar || isSearchActive ? 'bg-blue-100 text-blue-600 shadow-sm' : 'hover:bg-gray-600 md:hover:bg-gray-100 text-gray-600'}\r\n          `}\r\n          title=\"Tìm kiếm tin nhắn\"\r\n        >\r\n          <CiSearch className=\"w-5 h-5\" />\r\n        </button>\r\n\r\n        {/* Nút More */}\r\n        <button\r\n          onClick={() => {\r\n            if (showSearchSidebar) onToggleSearchSidebar();\r\n            onTogglePopup();\r\n          }}\r\n          className={`\r\n            p-2 rounded-full text-white md:text-gray-600 cursor-pointer transition-all duration-200 relative\r\n            ${showPopup ? 'bg-blue-100 text-blue-600 shadow-sm' : 'hover:bg-gray-600 md:hover:bg-gray-100 text-gray-600'}\r\n          `}\r\n          title=\"Thông tin trò chuyện\"\r\n        >\r\n          <HiEllipsisVertical className=\"w-4 h-4\" />\r\n          {/* Chấm tròn khi popup đang mở */}\r\n          {showPopup && <div className=\"absolute top-0 right-0 w-2 h-2 bg-blue-600 rounded-full\" />}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3683, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/PinnedMessagesSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport Image from 'next/image';\r\n\r\nimport PinnedMessageListModal from '../base/PinnedMessageListModal';\r\n\r\nimport type { Message } from '@/types/Message';\r\nimport type { User } from '@/types/User';\r\nimport {\r\n  HiChatBubbleLeftRight,\r\n  HiOutlineDocumentText,\r\n  HiChevronDown,\r\n  HiChevronUp,\r\n  HiEllipsisVertical,\r\n  HiTrash,\r\n  HiMagnifyingGlass,\r\n} from 'react-icons/hi2';\r\nimport { getProxyUrl, normalizeNoAccent, hasDiacritics, accentAwareIncludes } from '@/utils/utils';\r\n\r\ninterface PinnedMessagesSectionProps {\r\n  allPinnedMessages: Message[];\r\n  showPinnedList: boolean;\r\n  onOpenPinnedList: () => void;\r\n  onClosePinnedList: () => void;\r\n  onJumpToMessage: (messageId: string) => void;\r\n  getSenderName: (sender: User | string) => string;\r\n  onUnpinMessage: (msg: Message) => void;\r\n  onLoadMorePinned: () => void;\r\n  pinnedHasMore: boolean;\r\n  pinnedLoading?: boolean;\r\n  isSidebarOpen?: boolean;\r\n}\r\n\r\nexport default function PinnedMessagesSection({\r\n  allPinnedMessages,\r\n  showPinnedList,\r\n  onOpenPinnedList,\r\n  onClosePinnedList,\r\n  onJumpToMessage,\r\n  getSenderName,\r\n  onUnpinMessage,\r\n  onLoadMorePinned,\r\n  pinnedHasMore,\r\n  pinnedLoading,\r\n  isSidebarOpen,\r\n}: PinnedMessagesSectionProps) {\r\n  const isEmpty = allPinnedMessages.length === 0 && !showPinnedList;\r\n  const isVideoFile = (name?: string) => /\\.(mp4|webm|mov|mkv|avi)$/i.test(String(name || ''));\r\n  const isImageFile = (name?: string) => /\\.(jpg|jpeg|png|gif|webp|bmp|svg|avif)$/i.test(String(name || ''));\r\n  const renderPreview = (msg: Message) => {\r\n    const url = String(msg.fileUrl || msg.previewUrl || '');\r\n    const isVid = msg.type === 'video' || isVideoFile(msg.fileName) || isVideoFile(url);\r\n    const isImg = msg.type === 'image' || isImageFile(msg.fileName) || isImageFile(url);\r\n    if (isImg) {\r\n      return <Image src={getProxyUrl(url)} alt=\"Ảnh\" width={64} height={64} className=\"w-16 h-16 object-cover\" />;\r\n    }\r\n    if (isVid) {\r\n      return (\r\n        <div className=\"relative w-16 h-16 bg-black\">\r\n          <video src={getProxyUrl(url)} className=\"w-full h-full object-cover\" muted playsInline preload=\"metadata\" />\r\n          <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n            <div className=\"w-6 h-6 rounded-full bg-white/80 flex items-center justify-center\">\r\n              <svg viewBox=\"0 0 24 24\" className=\"w-4 h-4 text-gray-800\">\r\n                <path d=\"M8 5v14l11-7z\" fill=\"currentColor\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    const label =\r\n      msg.pinnedTitle ||\r\n      (msg.type === 'file'\r\n        ? msg.fileName || 'File'\r\n        : msg.type === 'sticker'\r\n          ? 'Sticker'\r\n          : msg.type === 'poll'\r\n            ? 'Bình chọn'\r\n            : msg.type === 'reminder'\r\n              ? 'Lịch hẹn'\r\n              : msg.content || 'Tin nhắn');\r\n    return <div className=\"w-24 max-w-[12rem] px-2 py-2 text-xs text-gray-700 line-clamp-2\">{label}</div>;\r\n  };\r\n  const renderMiniPreview = (msg: Message) => {\r\n    const url = String(msg.fileUrl || msg.previewUrl || '');\r\n    const isVid = msg.type === 'video' || isVideoFile(msg.fileName) || isVideoFile(url);\r\n    const isImg = msg.type === 'image' || isImageFile(msg.fileName) || isImageFile(url);\r\n    if (isImg) {\r\n      return (\r\n        <Image src={getProxyUrl(url)} alt=\"Ảnh\" width={40} height={40} className=\"w-10 h-10 rounded-lg object-cover\" />\r\n      );\r\n    }\r\n    if (isVid) {\r\n      return (\r\n        <div className=\"relative w-10 h-10 rounded-lg overflow-hidden bg-black\">\r\n          <video src={getProxyUrl(url)} className=\"w-full h-full object-cover\" muted playsInline preload=\"metadata\" />\r\n          <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n            <div className=\"w-5 h-5 rounded-full bg-white/80 flex items-center justify-center\">\r\n              <svg viewBox=\"0 0 24 24\" className=\"w-3.5 h-3.5 text-gray-800\">\r\n                <path d=\"M8 5v14l11-7z\" fill=\"currentColor\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n  const getPinnedLabel = (msg: Message) => {\r\n    if (msg.pinnedTitle && msg.pinnedTitle.trim()) return msg.pinnedTitle.trim();\r\n    const content = msg.content?.trim();\r\n    if (msg.type === 'image') return '[Hình ảnh]';\r\n    if (msg.type === 'video') return '[Video]';\r\n    if (msg.type === 'file') return '[Tệp]';\r\n    if (msg.type === 'sticker') return '[Sticker]';\r\n    if (msg.type === 'poll') return '[Bình chọn]';\r\n    if (msg.type === 'reminder') return '[Lịch hẹn]';\r\n    return content || '[Tin nhắn]';\r\n  };\r\n\r\n  const firstMsg = allPinnedMessages[0];\r\n  const typeLabel = firstMsg ? getPinnedLabel(firstMsg) : '';\r\n  const senderName = firstMsg ? getSenderName(firstMsg.sender) : '';\r\n  const extraCount = allPinnedMessages.length > 1 ? allPinnedMessages.length - 1 : 0;\r\n  const [openDropdown, setOpenDropdown] = useState(false);\r\n  const [openOptions, setOpenOptions] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  const filteredPinnedMessages = allPinnedMessages.filter((msg) => {\r\n    const rawContent = String(msg.content || '');\r\n    const rawTitle = String(msg.pinnedTitle || '');\r\n    return accentAwareIncludes(rawContent, searchQuery) || accentAwareIncludes(rawTitle, searchQuery);\r\n  });\r\n  const [optionsPosition, setOptionsPosition] = useState<{ top: number; left: number }>({ top: 0, left: 0 });\r\n  const dropdownRef = useRef<HTMLDivElement | null>(null);\r\n  const optionsRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (isSidebarOpen) {\r\n      setOpenDropdown(false);\r\n      setOpenOptions(null);\r\n    }\r\n  }, [isSidebarOpen]);\r\n\r\n  const handleOpenOptions = (e: React.MouseEvent, id: string) => {\r\n    e.stopPropagation();\r\n    const buttonRect = (e.currentTarget as HTMLElement).getBoundingClientRect();\r\n    // Tính toán vị trí hiển thị menu (ưu tiên hiển thị bên trái nút bấm để không bị tràn màn hình)\r\n    setOptionsPosition({\r\n      top: buttonRect.bottom + window.scrollY + 5,\r\n      left: buttonRect.right + window.scrollX - 128, // 128px là width của menu (w-32)\r\n    });\r\n    setOpenOptions(openOptions === id ? null : id);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handler = (e: MouseEvent) => {\r\n      const target = e.target as Node;\r\n      if (openDropdown && dropdownRef.current && !dropdownRef.current.contains(target)) {\r\n        // Kiểm tra xem click có phải vào nút option hay menu option không\r\n        // Nếu click vào menu option đang mở thì không đóng dropdown danh sách ghim\r\n        if (openOptions && optionsRef.current && optionsRef.current.contains(target)) {\r\n          return;\r\n        }\r\n        // Nếu click ra ngoài dropdown danh sách ghim và không phải click vào menu option\r\n        setOpenDropdown(false);\r\n      }\r\n      if (openOptions && optionsRef.current && !optionsRef.current.contains(target)) {\r\n        setOpenOptions(null);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handler);\r\n    return () => document.removeEventListener('mousedown', handler);\r\n  }, [openDropdown, openOptions]);\r\n\r\n  if (isEmpty) return null;\r\n\r\n  return (\r\n    <>\r\n      {allPinnedMessages.length > 0 && (\r\n        <div className=\"relative group flex items-center justify-between gap-2 px-2 py-1 bg-white border border-gray-200 rounded-[0.5rem] shadow-sm hover:shadow-md hover:border-gray-300 select-none m-2 sm:m-3\">\r\n          <div\r\n            className=\"flex items-center gap-3 flex-1 min-w-0 cursor-pointer hover:bg-gray-50 rounded-lg p-1 transition-colors\"\r\n            onClick={() => firstMsg && onJumpToMessage(firstMsg._id)}\r\n          >\r\n            <div className=\"flex items-center justify-center w-7 h-7 rounded-full bg-blue-100 text-blue-600 border border-blue-200\">\r\n              <HiChatBubbleLeftRight className=\"w-4 h-4\" />\r\n            </div>\r\n            <div className=\"flex flex-col min-w-0 items-start\">\r\n              <div className=\"text-[0.875rem] md:text-[1rem] font-semibold text-gray-900 truncate\">{typeLabel}</div>\r\n              <div className=\"text-[0.875rem] md:text-[1rem] text-gray-600 truncate w-[10rem] md:w-[20rem]\">\r\n                {senderName ? `Tin nhắn của ${senderName}` : 'Tin nhắn đã ghim'}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            {!isSidebarOpen && firstMsg && renderMiniPreview(firstMsg)}\r\n\r\n            {!isSidebarOpen && (\r\n              <div className=\"relative\">\r\n                <button\r\n                  className=\"cursor-pointer p-1.5 rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600\"\r\n                  onClick={(e) => handleOpenOptions(e, 'main-pinned')}\r\n                >\r\n                  <HiEllipsisVertical className=\"w-5 h-5\" />\r\n                </button>\r\n\r\n                {openOptions === 'main-pinned' &&\r\n                  typeof document !== 'undefined' &&\r\n                  createPortal(\r\n                    <div\r\n                      ref={optionsRef}\r\n                      style={{ top: optionsPosition.top, left: optionsPosition.left }}\r\n                      className=\"fixed z-[9999] w-32 bg-white rounded-lg shadow-lg border border-gray-100 py-1\"\r\n                    >\r\n                      <button\r\n                        className=\"w-full flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          if (firstMsg) onUnpinMessage(firstMsg);\r\n                          setOpenOptions(null);\r\n                        }}\r\n                      >\r\n                        <HiTrash className=\"w-4 h-4\" />\r\n                        Bỏ ghim\r\n                      </button>\r\n                    </div>,\r\n                    document.body,\r\n                  )}\r\n              </div>\r\n            )}\r\n\r\n            {!isSidebarOpen && <div className=\"h-10 w-px bg-gray-200\" />}\r\n            <div\r\n              className=\"px-3 py-1.5 rounded-full border border-gray-300 bg-gray-50 text-gray-800 flex items-center gap-1.5 cursor-pointer\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                if (extraCount > 0) setOpenDropdown((v) => !v);\r\n              }}\r\n            >\r\n              <span className=\"text-sm font-semibold\">{extraCount > 0 ? `+${extraCount}` : '+0'}</span>\r\n              <HiChevronDown className=\"w-4 h-4\" />\r\n            </div>\r\n            {openDropdown && (\r\n              <div\r\n                className=\"fixed inset-0 z-40 bg-black/30\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  setOpenDropdown(false);\r\n                }}\r\n              />\r\n            )}\r\n            {openDropdown && (\r\n              <div\r\n                ref={dropdownRef}\r\n                className=\"absolute left-3 right-3 top-full mt-2 bg-white border border-gray-200 rounded-2xl shadow-xl z-50\"\r\n              >\r\n                <div className=\"px-4 py-3 border-b border-gray-200 flex flex-col gap-3\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"text-sm font-semibold text-gray-900\">\r\n                      Danh sách ghim ({allPinnedMessages.length})\r\n                    </div>\r\n                    <button\r\n                      className=\"text-sm font-medium text-blue-700 hover:text-blue-800 flex items-center gap-1 cursor-pointer\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        setOpenDropdown(false);\r\n                      }}\r\n                    >\r\n                      Thu gọn\r\n                      <HiChevronUp className=\"w-4 h-4\" />\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"relative\">\r\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                      <HiMagnifyingGlass className=\"h-4 w-4 text-gray-400\" />\r\n                    </div>\r\n                    <input\r\n                      type=\"text\"\r\n                      className=\"block w-full pl-9 pr-3 py-1.5 border border-gray-300 rounded-lg text-sm bg-gray-50 placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n                      placeholder=\"Tìm kiếm ghim...\"\r\n                      value={searchQuery}\r\n                      onChange={(e) => setSearchQuery(e.target.value)}\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"max-h-[20rem] custom-scrollbar overflow-auto divide-y divide-gray-100\">\r\n                  {filteredPinnedMessages.length === 0 && (\r\n                    <div className=\"px-4 py-8 text-center text-sm text-gray-500\">Không tìm thấy tin nhắn ghim nào</div>\r\n                  )}\r\n                  {filteredPinnedMessages.map((msg) => {\r\n                    let label = getPinnedLabel(msg);\r\n                    // Nếu là tin nhắn text và không có tiêu đề riêng, đặt label là [Tin nhắn]\r\n                    // để dòng nội dung (msg.content) được hiển thị ở dòng dưới\r\n                    if (!msg.pinnedTitle && msg.type === 'text' && msg.content) {\r\n                      label = '[Tin nhắn]';\r\n                    }\r\n\r\n                    const name = getSenderName(msg.sender);\r\n                    return (\r\n                      <div\r\n                        key={String(msg._id)}\r\n                        className=\"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer rounded-2xl\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          setOpenDropdown(false);\r\n                          onJumpToMessage(String(msg._id));\r\n                        }}\r\n                      >\r\n                        <div className=\"flex items-center justify-center w-7 h-7 rounded-full bg-blue-100 text-blue-600 border border-blue-200 shrink-0\">\r\n                          <HiChatBubbleLeftRight className=\"w-4 h-4\" />\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"text-sm font-semibold text-gray-900 truncate\">{label}</div>\r\n                          {msg.content && msg.content !== label && (\r\n                            <div className=\"text-sm text-gray-700 truncate\">{msg.content}</div>\r\n                          )}\r\n                          <div className=\"text-xs text-gray-500 truncate\">\r\n                            {name ? `Tin nhắn của ${name}` : 'Tin nhắn'}\r\n                          </div>\r\n                        </div>\r\n                        {renderMiniPreview(msg)}\r\n\r\n                        <div className=\"relative\">\r\n                          <button\r\n                            className=\"cursor-pointer p-1.5 rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600\"\r\n                            onClick={(e) => handleOpenOptions(e, String(msg._id))}\r\n                          >\r\n                            <HiEllipsisVertical className=\"w-5 h-5\" />\r\n                          </button>\r\n\r\n                          {openOptions === String(msg._id) &&\r\n                            typeof document !== 'undefined' &&\r\n                            createPortal(\r\n                              <div\r\n                                ref={optionsRef}\r\n                                style={{ top: optionsPosition.top, left: optionsPosition.left }}\r\n                                className=\"fixed z-[9999] w-32 bg-white rounded-lg shadow-lg border border-gray-100 py-1\"\r\n                              >\r\n                                <button\r\n                                  className=\"w-full flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50\"\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    onUnpinMessage(msg);\r\n                                    setOpenOptions(null);\r\n                                  }}\r\n                                >\r\n                                  <HiTrash className=\"w-4 h-4\" />\r\n                                  Bỏ ghim\r\n                                </button>\r\n                              </div>,\r\n                              document.body,\r\n                            )}\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showPinnedList && (\r\n        <PinnedMessageListModal\r\n          messages={allPinnedMessages}\r\n          onClose={onClosePinnedList}\r\n          onJumpToMessage={onJumpToMessage}\r\n          onGetSenderName={getSenderName}\r\n          hasMore={pinnedHasMore}\r\n          onLoadMore={onLoadMorePinned}\r\n          loadingMore={pinnedLoading}\r\n          onGetContentDisplay={(msg) => {\r\n            if (msg.type === 'poll') return `Bình chọn: ${msg.pollQuestion || msg.content || ''}`;\r\n            if (msg.type === 'reminder') return `Lịch hẹn: ${msg.content || ''}`;\r\n            if (msg.type === 'image') return 'Ảnh';\r\n            if (msg.type === 'video') return 'Video';\r\n            if (msg.type === 'file')\r\n              return (\r\n                <a\r\n                  href={getProxyUrl(msg.fileUrl, true)}\r\n                  download={msg.fileName || 'download'}\r\n                  target=\"_blank\"\r\n                  rel=\"noreferrer\"\r\n                  className=\"flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-2xl max-w-[70vw] sm:max-w-[18rem] shadow-sm hover:bg-gray-50\"\r\n                >\r\n                  <div className=\"p-2 bg-blue-600 rounded-xl\">\r\n                    <HiOutlineDocumentText className=\"w-6 h-6 text-white\" />\r\n                  </div>\r\n\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"text-sm font-semibold text-gray-800 truncate\">{msg.fileName || 'Tệp đính kèm'}</p>\r\n                    <p className=\"text-xs text-gray-500 truncate\">Nhấn để tải xuống</p>\r\n                  </div>\r\n                </a>\r\n              );\r\n            if (msg.type === 'sticker') return 'Sticker';\r\n            return msg.content?.trim() || '[Tin nhắn]';\r\n          }}\r\n          onUnpinMessage={onUnpinMessage}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4440, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/EmojiFB.tsx"],"sourcesContent":["'use client';\r\n\r\nimport Image from 'next/image';\r\nimport { getEmojiUrl } from '@/utils/getFbEmojiUrl';\r\n\r\nexport default function EmojiFB({ unicode, size = 32 }: { unicode: string; size?: number }) {\r\n  return <Image src={getEmojiUrl(unicode)} alt=\"emoji\" width={size} height={size} unoptimized />;\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,EAAsC;IACxF,qBAAO,6LAAC,2IAAK;QAAC,KAAK,IAAA,+IAAW,EAAC;QAAU,KAAI;QAAQ,OAAO;QAAM,QAAQ;QAAM,WAAW;;;;;;AAC7F;KAFwB"}},
    {"offset": {"line": 4474, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/EmojiStickerPicker.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport EmojiFB from '@/components/(chatPopup)/EmojiFB';\r\nimport { FB_EMOJIS } from '@/data/fbEmojis';\r\nimport Image from 'next/image';\r\n\r\ninterface EmojiStickerPickerProps {\r\n  showEmojiPicker: boolean;\r\n  pickerTab: 'emoji' | 'sticker';\r\n  setPickerTab: (tab: 'emoji' | 'sticker') => void;\r\n  onEmojiClick: (unicode: string) => void;\r\n  stickers: string[];\r\n  onSelectSticker: (url: string) => void;\r\n}\r\n\r\nexport default function EmojiStickerPicker({\r\n  showEmojiPicker,\r\n  pickerTab,\r\n  setPickerTab,\r\n  onEmojiClick,\r\n  stickers,\r\n  onSelectSticker,\r\n}: EmojiStickerPickerProps) {\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const [pickerHeight, setPickerHeight] = useState(300);\r\n\r\n  // Resize để Emoji FB responsive\r\n  useEffect(() => {\r\n    if (!containerRef.current) return;\r\n\r\n    const resizeObserver = new ResizeObserver((entries) => {\r\n      const h = entries[0].contentRect.height;\r\n      if (h > 50) {\r\n        setPickerHeight(h - 10);\r\n      }\r\n    });\r\n    resizeObserver.observe(containerRef.current);\r\n\r\n    return () => resizeObserver.disconnect();\r\n  }, []);\r\n\r\n  if (!showEmojiPicker) return null;\r\n\r\n  return (\r\n    <div className=\"absolute bottom-full left-0 right-0 sm:right-auto mb-2 bg-white shadow-xl border border-gray-200 rounded-xl z-50 w-full sm:w-80 lg:w-[28rem] xl:w-[32rem] max-w-[90vw] flex flex-col overflow-hidden\">\r\n      {/* Tabs */}\r\n      <div className=\"flex border-b\">\r\n        <button\r\n          className={`flex-1 p-2 sm:p-3 cursor-pointer text-xs sm:text-sm font-medium ${pickerTab === 'emoji' ? 'bg-gray-100 text-blue-600' : 'hover:bg-gray-50'}`}\r\n          onClick={() => setPickerTab('emoji')}\r\n        >\r\n          Emoji\r\n        </button>\r\n\r\n        {/* <button\r\n          className={`flex-1 p-2 sm:p-3 cursor-pointer text-xs sm:text-sm font-medium ${pickerTab === 'sticker' ? 'bg-gray-100 text-blue-600' : 'hover:bg-gray-50'}`}\r\n          onClick={() => setPickerTab('sticker')}\r\n        >\r\n          <Image width={14} height={14} src={IconSticker.src} alt=\"Sticker\" className=\"inline mr-1 w-[14px] h-[14px]\" />\r\n          Sticker\r\n        </button> */}\r\n      </div>\r\n\r\n      {/* Emoji / Sticker Content */}\r\n      <div ref={containerRef} className=\"flex-1 overflow-y-auto custom-scrollbar min-h-[18rem] max-h-[70vh] p-2\">\r\n        {pickerTab === 'emoji' ? (\r\n          <div style={{ height: pickerHeight }} className=\"grid grid-cols-8 sm:grid-cols-10 md:grid-cols-12 gap-2\">\r\n            {FB_EMOJIS.map((unicode) => (\r\n              <div\r\n                key={unicode}\r\n                onClick={() => onEmojiClick(unicode)}\r\n                className=\"cursor-pointer flex items-center justify-center rounded hover:bg-gray-100\"\r\n              >\r\n                <EmojiFB unicode={unicode} size={36} />\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2\">\r\n            {stickers.map((url, idx) => (\r\n              <Image\r\n                key={idx}\r\n                width={40}\r\n                height={40}\r\n                src={url}\r\n                className=\"w-full h-16 object-contain cursor-pointer hover:bg-gray-100 rounded p-1\"\r\n                onClick={() => onSelectSticker(url)}\r\n                alt=\"sticker\"\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAgBe,SAAS,mBAAmB,EACzC,eAAe,EACf,SAAS,EACT,YAAY,EACZ,YAAY,EACZ,QAAQ,EACR,eAAe,EACS;;IACxB,MAAM,eAAe,IAAA,uKAAM,EAAwB;IACnD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IAEjD,gCAAgC;IAChC,IAAA,0KAAS;wCAAC;YACR,IAAI,CAAC,aAAa,OAAO,EAAE;YAE3B,MAAM,iBAAiB,IAAI;gDAAe,CAAC;oBACzC,MAAM,IAAI,OAAO,CAAC,EAAE,CAAC,WAAW,CAAC,MAAM;oBACvC,IAAI,IAAI,IAAI;wBACV,gBAAgB,IAAI;oBACtB;gBACF;;YACA,eAAe,OAAO,CAAC,aAAa,OAAO;YAE3C;gDAAO,IAAM,eAAe,UAAU;;QACxC;uCAAG,EAAE;IAEL,IAAI,CAAC,iBAAiB,OAAO;IAE7B,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBACC,WAAW,CAAC,gEAAgE,EAAE,cAAc,UAAU,8BAA8B,oBAAoB;oBACxJ,SAAS,IAAM,aAAa;8BAC7B;;;;;;;;;;;0BAcH,6LAAC;gBAAI,KAAK;gBAAc,WAAU;0BAC/B,cAAc,wBACb,6LAAC;oBAAI,OAAO;wBAAE,QAAQ;oBAAa;oBAAG,WAAU;8BAC7C,uIAAS,CAAC,GAAG,CAAC,CAAC,wBACd,6LAAC;4BAEC,SAAS,IAAM,aAAa;4BAC5B,WAAU;sCAEV,cAAA,6LAAC,4JAAO;gCAAC,SAAS;gCAAS,MAAM;;;;;;2BAJ5B;;;;;;;;;yCASX,6LAAC;oBAAI,WAAU;8BACZ,SAAS,GAAG,CAAC,CAAC,KAAK,oBAClB,6LAAC,2IAAK;4BAEJ,OAAO;4BACP,QAAQ;4BACR,KAAK;4BACL,WAAU;4BACV,SAAS,IAAM,gBAAgB;4BAC/B,KAAI;2BANC;;;;;;;;;;;;;;;;;;;;;AAcrB;GAhFwB;KAAA"}},
    {"offset": {"line": 4602, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/ReplyBanner.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport Image from 'next/image';\r\n\r\nimport type { Message } from '@/types/Message';\r\nimport type { User } from '@/types/User';\r\nimport { getProxyUrl, isVideoFile } from '@/utils/utils';\r\n\r\ninterface ReplyBannerProps {\r\n  replyingTo: Message | null;\r\n  getSenderName: (sender: User | string) => string;\r\n  onCancel: () => void;\r\n}\r\n\r\nexport default function ReplyBanner({ replyingTo, getSenderName, onCancel }: ReplyBannerProps) {\r\n  if (!replyingTo) return null;\r\n\r\n  const url = String(replyingTo.fileUrl || replyingTo.previewUrl || '');\r\n  const isVid = replyingTo.type === 'video' || isVideoFile(replyingTo.fileName) || isVideoFile(url);\r\n  const isImg =\r\n    replyingTo.type === 'image' ||\r\n    /\\.(jpg|jpeg|png|gif|webp|bmp|svg|avif)$/i.test(String(replyingTo.fileName || url || ''));\r\n\r\n  const contentLabel = replyingTo.isRecalled\r\n    ? 'đã thu hồi tin nhắn'\r\n    : replyingTo.type === 'file'\r\n      ? replyingTo.fileName || '[File]'\r\n      : replyingTo.type === 'image'\r\n        ? '[Ảnh]'\r\n        : replyingTo.type === 'video'\r\n          ? '[Video]'\r\n          : replyingTo.type === 'sticker'\r\n            ? '[Sticker]'\r\n            : replyingTo.type === 'reminder'\r\n              ? replyingTo.content || '[Nhắc nhở]'\r\n              : replyingTo.content || 'Tin nhắn';\r\n\r\n  return (\r\n    <div className=\" bottom-full left-0 right-0 p-3 bg-gray-200 rounded-t-xl flex justify-between items-center text-sm text-gray-700\">\r\n      <div className=\"border-l-2 border-blue-400 pl-2 max-w-[15rem] sm:max-w-[80rem] overflow-hidden \">\r\n        <div className=\"text-sm  text-black \">\r\n          Trả lời {getSenderName(replyingTo.sender)}\r\n        </div>\r\n        <div className=\"flex items-center gap-2 mt-1\">\r\n          {!replyingTo.isRecalled &&\r\n            (isImg || isVid) &&\r\n            (isImg ? (\r\n              <Image\r\n                src={getProxyUrl(url)}\r\n                alt=\"Ảnh\"\r\n                width={40}\r\n                height={40}\r\n                className=\"w-10 h-10 rounded-md object-cover border border-blue-200\"\r\n              />\r\n            ) : (\r\n              <div className=\"relative w-10 h-10 bg-black rounded-md overflow-hidden border border-blue-200\">\r\n                <video\r\n                  src={getProxyUrl(url)}\r\n                  className=\"w-full h-full object-cover\"\r\n                  muted\r\n                  playsInline\r\n                  preload=\"metadata\"\r\n                />\r\n                <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                  <div className=\"w-5 h-5 rounded-full bg-white/80 flex items-center justify-center\">\r\n                    <svg viewBox=\"0 0 24 24\" className=\"w-3.5 h-3.5 text-gray-800\">\r\n                      <path d=\"M8 5v14l11-7z\" fill=\"currentColor\" />\r\n                    </svg>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          <p className=\"text-xs text-gray-700 w-full\">{contentLabel}</p>\r\n        </div>\r\n      </div>\r\n      <button onClick={onCancel} className=\"cursor-pointer text-gray-500 hover:text-gray-700 p-1\">\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          fill=\"none\"\r\n          viewBox=\"0 0 24 24\"\r\n          strokeWidth={1.5}\r\n          stroke=\"currentColor\"\r\n          className=\"w-5 h-5\"\r\n        >\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AAIA;AAPA;;;;AAee,SAAS,YAAY,EAAE,UAAU,EAAE,aAAa,EAAE,QAAQ,EAAoB;IAC3F,IAAI,CAAC,YAAY,OAAO;IAExB,MAAM,MAAM,OAAO,WAAW,OAAO,IAAI,WAAW,UAAU,IAAI;IAClE,MAAM,QAAQ,WAAW,IAAI,KAAK,WAAW,IAAA,uIAAW,EAAC,WAAW,QAAQ,KAAK,IAAA,uIAAW,EAAC;IAC7F,MAAM,QACJ,WAAW,IAAI,KAAK,WACpB,2CAA2C,IAAI,CAAC,OAAO,WAAW,QAAQ,IAAI,OAAO;IAEvF,MAAM,eAAe,WAAW,UAAU,GACtC,wBACA,WAAW,IAAI,KAAK,SAClB,WAAW,QAAQ,IAAI,WACvB,WAAW,IAAI,KAAK,UAClB,UACA,WAAW,IAAI,KAAK,UAClB,YACA,WAAW,IAAI,KAAK,YAClB,cACA,WAAW,IAAI,KAAK,aAClB,WAAW,OAAO,IAAI,eACtB,WAAW,OAAO,IAAI;IAEpC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;4BAAuB;4BAC3B,cAAc,WAAW,MAAM;;;;;;;kCAE1C,6LAAC;wBAAI,WAAU;;4BACZ,CAAC,WAAW,UAAU,IACrB,CAAC,SAAS,KAAK,KACf,CAAC,sBACC,6LAAC,2IAAK;gCACJ,KAAK,IAAA,uIAAW,EAAC;gCACjB,KAAI;gCACJ,OAAO;gCACP,QAAQ;gCACR,WAAU;;;;;qDAGZ,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,KAAK,IAAA,uIAAW,EAAC;wCACjB,WAAU;wCACV,KAAK;wCACL,WAAW;wCACX,SAAQ;;;;;;kDAEV,6LAAC;wCAAI,WAAU;kDACb,cAAA,6LAAC;4CAAI,WAAU;sDACb,cAAA,6LAAC;gDAAI,SAAQ;gDAAY,WAAU;0DACjC,cAAA,6LAAC;oDAAK,GAAE;oDAAgB,MAAK;;;;;;;;;;;;;;;;;;;;;;;;;;oCAKtC;0CACH,6LAAC;gCAAE,WAAU;0CAAgC;;;;;;;;;;;;;;;;;;0BAGjD,6LAAC;gBAAO,SAAS;gBAAU,WAAU;0BACnC,cAAA,6LAAC;oBACC,OAAM;oBACN,MAAK;oBACL,SAAQ;oBACR,aAAa;oBACb,QAAO;oBACP,WAAU;8BAEV,cAAA,6LAAC;wBAAK,eAAc;wBAAQ,gBAAe;wBAAQ,GAAE;;;;;;;;;;;;;;;;;;;;;;AAK/D;KA3EwB"}},
    {"offset": {"line": 4765, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/MentionMenu.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { RefObject, useEffect, useRef } from 'react';\r\n\r\nimport type { User } from '@/types/User';\r\nimport type { MemberInfo } from '@/types/Group';\r\nimport { getProxyUrl } from '../../utils/utils';\r\nimport Image from 'next/image';\r\n\r\ninterface MentionMenuProps {\r\n  showMentionMenu: boolean;\r\n  mentionSuggestions: (User | MemberInfo)[];\r\n  selectedMentionIndex: number;\r\n  mentionMenuRef: RefObject<HTMLDivElement | null>;\r\n  onSelectMention: (user: User | MemberInfo) => void;\r\n}\r\n\r\nexport default function MentionMenu({\r\n  showMentionMenu,\r\n  mentionSuggestions,\r\n  selectedMentionIndex,\r\n  mentionMenuRef,\r\n  onSelectMention,\r\n}: MentionMenuProps) {\r\n  const itemRefs = useRef<(HTMLDivElement | null)[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (selectedMentionIndex >= 0 && itemRefs.current[selectedMentionIndex]) {\r\n      itemRefs.current[selectedMentionIndex]?.scrollIntoView({\r\n        block: 'nearest',\r\n      });\r\n    }\r\n  }, [selectedMentionIndex]);\r\n\r\n  if (!showMentionMenu || mentionSuggestions.length === 0) return null;\r\n\r\n  return (\r\n    <div\r\n      ref={mentionMenuRef}\r\n      onMouseDown={(e) => e.preventDefault()}\r\n      className=\"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-2xl border border-gray-200 max-h-60 overflow-hidden z-50\"\r\n    >\r\n      <div className=\"p-2 border-b bg-gray-50\">\r\n        <p className=\"text-xs text-gray-600 font-medium\">Chọn người để đề cập</p>\r\n      </div>\r\n      <div className=\"max-h-48 overflow-y-auto custom-scrollbar\">\r\n        {mentionSuggestions.map((user, index) => {\r\n          const member = user as MemberInfo;\r\n          const userId: string = member.id ?? user._id;\r\n          const userName = user.name || 'User';\r\n          const userAvatar = user.avatar;\r\n\r\n          return (\r\n            <div\r\n              role=\"button\"\r\n              key={userId}\r\n              ref={(el) => {\r\n                itemRefs.current[index] = el;\r\n              }}\r\n              onClick={() => onSelectMention(user)}\r\n              className={`w-full flex cursor-pointer items-center gap-3 p-3 hover:bg-blue-50 transition-colors ${\r\n                index === selectedMentionIndex ? 'bg-blue-100' : ''\r\n              }`}\r\n            >\r\n              {userAvatar ? (\r\n                <Image\r\n                  width={40}\r\n                  height={40}\r\n                  src={getProxyUrl(userAvatar)}\r\n                  alt={userName}\r\n                  className=\"w-5 h-5 sm:w-10 sm:h-10 rounded-full object-cover\"\r\n                />\r\n              ) : (\r\n                <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 text-white flex items-center justify-center font-semibold\">\r\n                  {userName.charAt(0).toUpperCase()}\r\n                </div>\r\n              )}\r\n              <div className=\"text-left flex-1\">\r\n                <p className=\"font-medium text-gray-800 text-sm\">{userName}</p>\r\n                <p className=\"text-xs text-gray-500\">@{userName.toLowerCase().replace(/\\s+/g, '')}</p>\r\n              </div>\r\n              {index === selectedMentionIndex && (\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  viewBox=\"0 0 20 20\"\r\n                  fill=\"currentColor\"\r\n                  className=\"w-5 h-5 text-blue-500\"\r\n                >\r\n                  <path\r\n                    fillRule=\"evenodd\"\r\n                    d=\"M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z\"\r\n                    clipRule=\"evenodd\"\r\n                  />\r\n                </svg>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAIA;AACA;;;AAPA;;;;AAiBe,SAAS,YAAY,EAClC,eAAe,EACf,kBAAkB,EAClB,oBAAoB,EACpB,cAAc,EACd,eAAe,EACE;;IACjB,MAAM,WAAW,IAAA,uKAAM,EAA4B,EAAE;IAErD,IAAA,0KAAS;iCAAC;YACR,IAAI,wBAAwB,KAAK,SAAS,OAAO,CAAC,qBAAqB,EAAE;gBACvE,SAAS,OAAO,CAAC,qBAAqB,EAAE,eAAe;oBACrD,OAAO;gBACT;YACF;QACF;gCAAG;QAAC;KAAqB;IAEzB,IAAI,CAAC,mBAAmB,mBAAmB,MAAM,KAAK,GAAG,OAAO;IAEhE,qBACE,6LAAC;QACC,KAAK;QACL,aAAa,CAAC,IAAM,EAAE,cAAc;QACpC,WAAU;;0BAEV,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAE,WAAU;8BAAoC;;;;;;;;;;;0BAEnD,6LAAC;gBAAI,WAAU;0BACZ,mBAAmB,GAAG,CAAC,CAAC,MAAM;oBAC7B,MAAM,SAAS;oBACf,MAAM,SAAiB,OAAO,EAAE,IAAI,KAAK,GAAG;oBAC5C,MAAM,WAAW,KAAK,IAAI,IAAI;oBAC9B,MAAM,aAAa,KAAK,MAAM;oBAE9B,qBACE,6LAAC;wBACC,MAAK;wBAEL,KAAK,CAAC;4BACJ,SAAS,OAAO,CAAC,MAAM,GAAG;wBAC5B;wBACA,SAAS,IAAM,gBAAgB;wBAC/B,WAAW,CAAC,qFAAqF,EAC/F,UAAU,uBAAuB,gBAAgB,IACjD;;4BAED,2BACC,6LAAC,2IAAK;gCACJ,OAAO;gCACP,QAAQ;gCACR,KAAK,IAAA,uIAAW,EAAC;gCACjB,KAAK;gCACL,WAAU;;;;;qDAGZ,6LAAC;gCAAI,WAAU;0CACZ,SAAS,MAAM,CAAC,GAAG,WAAW;;;;;;0CAGnC,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDAAqC;;;;;;kDAClD,6LAAC;wCAAE,WAAU;;4CAAwB;4CAAE,SAAS,WAAW,GAAG,OAAO,CAAC,QAAQ;;;;;;;;;;;;;4BAE/E,UAAU,sCACT,6LAAC;gCACC,OAAM;gCACN,SAAQ;gCACR,MAAK;gCACL,WAAU;0CAEV,cAAA,6LAAC;oCACC,UAAS;oCACT,GAAE;oCACF,UAAS;;;;;;;;;;;;uBApCV;;;;;gBA0CX;;;;;;;;;;;;AAIR;GApFwB;KAAA"}},
    {"offset": {"line": 4924, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/MessageContextMenu.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React from 'react';\r\nimport { Message } from '@/types/Message';\r\nimport { HiOutlineDownload, HiOutlineTrash, HiPencil } from 'react-icons/hi';\r\nimport ICReply from '../svg/ICReply';\r\nimport ICShareMessage from '../svg/ICShareMessage';\r\nimport ICCopy from '../svg/ICCopy';\r\nimport ICPin from '../svg/ICPin';\r\nimport {\r\n  FaCopy,\r\n  FaDownload,\r\n  FaPaperclip,\r\n  FaRegPenToSquare,\r\n  FaRegShareFromSquare,\r\n  FaRepeat,\r\n  FaReply,\r\n  FaTrashCan,\r\n} from 'react-icons/fa6';\r\nimport { FaShare } from 'react-icons/fa';\r\n\r\nconst getId = (u: Message['sender'] | string | undefined | null): string => {\r\n  if (!u) return '';\r\n  if (typeof u === 'string') return u;\r\n  if (typeof u === 'object' && u !== null && '_id' in u && (u as { _id?: unknown })._id != null)\r\n    return String((u as { _id: unknown })._id);\r\n  if (typeof u === 'object' && u !== null && 'id' in u && (u as { id?: unknown }).id != null)\r\n    return String((u as unknown as { id: unknown }).id);\r\n  return '';\r\n};\r\n\r\nexport interface ContextMenuState {\r\n  visible: boolean;\r\n  x: number;\r\n  y: number;\r\n  message: Message;\r\n  placement?: 'above' | 'below';\r\n  focusTop?: number;\r\n  focusHeight?: number;\r\n}\r\n\r\ninterface MenuItemProps {\r\n  children: React.ReactNode;\r\n  onClick: (e: React.MouseEvent<HTMLElement | HTMLAnchorElement>) => void;\r\n  isRed?: boolean;\r\n  isAnchor?: boolean;\r\n  href?: string;\r\n  download?: string;\r\n}\r\n\r\nconst MenuItem: React.FC<MenuItemProps> = ({\r\n  children,\r\n  onClick,\r\n  isRed = false,\r\n  isAnchor = false,\r\n  href = '#',\r\n  download = '',\r\n}) => {\r\n  const className = `cursor-pointer w-full text-left px-3 py-1 mb-1 hover:bg-gray-100 flex items-center gap-3 ${isRed ? 'text-red-500' : 'text-gray-700'}`;\r\n\r\n  if (isAnchor) {\r\n    return (\r\n      <a href={href} download={download} onClick={onClick} target=\"_blank\" rel=\"noreferrer\" className={className}>\r\n        {children}\r\n      </a>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <button onClick={onClick} className={className} type=\"button\">\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\ninterface MessageContextMenuProps {\r\n  contextMenu: ContextMenuState | null;\r\n  currentUserId: string;\r\n  onClose: () => void;\r\n  onPinMessage: (msg: Message) => void;\r\n  onRecallMessage: (messageId: string) => void;\r\n  setEditingMessageId?: (id: string | null) => void;\r\n  setEditContent?: (content: string) => void;\r\n  closeContextMenu?: () => void;\r\n  onReplyMessage?: (msg: Message) => void;\r\n  onShareMessage: (message: Message) => void;\r\n}\r\n\r\nconst MessageContextMenu: React.FC<MessageContextMenuProps> = ({\r\n  contextMenu,\r\n  currentUserId,\r\n  onClose,\r\n  onPinMessage,\r\n  onRecallMessage,\r\n  setEditingMessageId,\r\n  setEditContent,\r\n  closeContextMenu,\r\n  onReplyMessage,\r\n  onShareMessage,\r\n}) => {\r\n  if (!contextMenu || !contextMenu.visible) return null;\r\n\r\n  const { x, y, message: msg, placement } = contextMenu;\r\n  const isMe = getId(msg.sender) === currentUserId;\r\n  const isText = msg.type === 'text';\r\n  const isRecalled = msg.isRecalled;\r\n  const canCopy = isText && !isRecalled;\r\n  const canDownload = (msg.type === 'image' || msg.type === 'file' || msg.type === 'sticker') && msg.fileUrl;\r\n  const canRecall = isMe && !isRecalled;\r\n  const isCurrentlyPinned = msg.isPinned === true;\r\n  const canEdit = isMe && isText && !isRecalled;\r\n  const style = {\r\n    top: y,\r\n    left: x,\r\n  };\r\n\r\n  const copyTextToClipboard = async (text: string): Promise<boolean> => {\r\n    try {\r\n      if (navigator.clipboard && (window as unknown as { isSecureContext?: boolean }).isSecureContext) {\r\n        await navigator.clipboard.writeText(text);\r\n        return true;\r\n      }\r\n    } catch {}\r\n    try {\r\n      const ta = document.createElement('textarea');\r\n      ta.value = text;\r\n      ta.setAttribute('readonly', '');\r\n      ta.style.position = 'fixed';\r\n      ta.style.top = '0';\r\n      ta.style.left = '0';\r\n      ta.style.opacity = '0';\r\n      document.body.appendChild(ta);\r\n      ta.focus();\r\n      ta.select();\r\n      const ok = document.execCommand('copy');\r\n      document.body.removeChild(ta);\r\n      if (ok) return true;\r\n    } catch {}\r\n    try {\r\n      const ta2 = document.createElement('input');\r\n      ta2.value = text;\r\n      ta2.style.position = 'fixed';\r\n      ta2.style.top = '0';\r\n      ta2.style.left = '0';\r\n      ta2.style.opacity = '0';\r\n      document.body.appendChild(ta2);\r\n      ta2.focus();\r\n      ta2.select();\r\n      const ok2 = document.execCommand('copy');\r\n      document.body.removeChild(ta2);\r\n      if (ok2) return true;\r\n    } catch {}\r\n    return false;\r\n  };\r\n\r\n  const animClass =\r\n    placement === 'above'\r\n      ? 'animate-in fade-in slide-in-from-bottom-2 duration-200'\r\n      : 'animate-in fade-in slide-in-from-top-2 duration-200';\r\n\r\n  return (\r\n    <div\r\n      data-context-menu=\"true\"\r\n      className={`fixed z-[9999] bg-white space-y-2 rounded-lg shadow-2xl border border-gray-200 py-1 w-[200px] text-sm ${animClass}`}\r\n      style={style}\r\n      onContextMenu={(e) => e.preventDefault()}\r\n    >\r\n      {!isRecalled && onReplyMessage && (\r\n        <MenuItem\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            onReplyMessage(msg);\r\n            onClose();\r\n          }}\r\n        >\r\n          <span className=\"flex items-center gap-4\">\r\n            <FaRepeat size={24} className=\"w-5 h-5\" />\r\n            <p className=\"text-[1rem]\">Trả lời</p>\r\n          </span>\r\n        </MenuItem>\r\n      )}\r\n      {!isRecalled && (\r\n        <MenuItem\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            onShareMessage(msg);\r\n            onClose();\r\n          }}\r\n        >\r\n          <span className=\"flex gap-4 items-center\">\r\n            <FaRegShareFromSquare className=\"w-5 h-5\" />\r\n            <p className=\"text-[1rem]\">Chia sẻ</p>\r\n          </span>\r\n        </MenuItem>\r\n      )}\r\n\r\n      {canCopy && (\r\n        <MenuItem\r\n          onClick={async (e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            const ok = await copyTextToClipboard(msg.content || '');\r\n            if (!ok) {\r\n              alert('Sao chép thất bại!');\r\n            }\r\n            onClose();\r\n          }}\r\n        >\r\n          <span className=\"flex gap-4 items-center\">\r\n            <FaCopy className=\"w-5 h-5 \" />\r\n            <span className=\"text-[1rem] \">Sao chép</span>\r\n          </span>\r\n        </MenuItem>\r\n      )}\r\n      {!isRecalled && (\r\n        <MenuItem\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            onPinMessage(msg);\r\n            onClose();\r\n          }}\r\n        >\r\n          {isCurrentlyPinned ? (\r\n            <p className=\"text-red-500 flex gap-4 items-center\">\r\n              <FaPaperclip className={`text-red-600 w-5 h-5 `} />\r\n              <span className=\"text-[1rem]\">Bỏ ghim tin nhắn</span>\r\n            </p>\r\n          ) : (\r\n            <p className=\"flex gap-4 items-center \">\r\n              <FaPaperclip className=\"w-5 h-5\" />\r\n              <span className=\"text-[1rem]\">Ghim tin nhắn</span>\r\n            </p>\r\n          )}\r\n        </MenuItem>\r\n      )}\r\n\r\n      {canEdit && (\r\n        <MenuItem\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            if (setEditingMessageId && setEditContent && closeContextMenu) {\r\n              setEditingMessageId(msg._id);\r\n              setEditContent(msg.content || '');\r\n              closeContextMenu();\r\n            }\r\n          }}\r\n        >\r\n          <span className=\"flex gap-4 items-center\">\r\n            <FaRegPenToSquare className=\"w-5 h-5\" />\r\n            <span className=\"text-[1rem]\">Chỉnh sửa</span>\r\n          </span>\r\n        </MenuItem>\r\n      )}\r\n\r\n      {canDownload && (\r\n        <MenuItem\r\n          isAnchor={true}\r\n          href={msg.fileUrl}\r\n          download={msg.fileName || 'file_chat'}\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setTimeout(() => onClose(), 100);\r\n          }}\r\n        >\r\n          <span className=\"flex gap-4 items-center\">\r\n            <FaDownload className=\"w-5 h-5\" />\r\n            <span className=\"text-[1rem]\">Tải xuống</span>\r\n          </span>\r\n        </MenuItem>\r\n      )}\r\n\r\n      {canRecall && (\r\n        <MenuItem\r\n          isRed={true}\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            onRecallMessage(msg._id);\r\n            onClose();\r\n          }}\r\n        >\r\n          <span className=\"flex gap-4 items-center\">\r\n            <FaTrashCan className=\"w-5 h-5\" />\r\n            <span className=\"text-[1rem]\">Thu hồi</span>\r\n          </span>\r\n        </MenuItem>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MessageContextMenu;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5331, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/SearchMessageModal.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n/* eslint-disable react-hooks/exhaustive-deps */\r\n'use client';\r\nimport React, { useState, useCallback, useEffect, useRef, useMemo } from 'react';\r\nimport { Message } from '@/types/Message';\r\nimport { User } from '@/types/User';\r\nimport Image from 'next/image';\r\nimport ArrowRightICon from '@/public/icons/arrow-right-icon.svg'; // Reuse existing icon\r\nimport { getProxyUrl, normalizeNoAccent, buildAccentInsensitiveRegex, hasDiacritics, accentAwareIncludes } from '@/utils/utils';\r\nimport MediaPreviewModal from '@/components/(chatPopup)/MediaPreviewModal';\r\nimport { IoReload } from 'react-icons/io5';\r\nimport { HiPlay } from 'react-icons/hi2';\r\n\r\ninterface SearchSidebarProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  roomId: string;\r\n  onJumpToMessage: (messageId: string) => void;\r\n  getSenderName: (sender: User | string) => string;\r\n  initialKeyword?: string | null;\r\n  onKeywordClear?: () => void;\r\n  initialSelectedMessageId?: string | null;\r\n}\r\n\r\nconst SearchSidebar: React.FC<SearchSidebarProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  roomId,\r\n  onJumpToMessage,\r\n  getSenderName,\r\n  initialKeyword,\r\n  onKeywordClear,\r\n  initialSelectedMessageId,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [searchResults, setSearchResults] = useState<Message[]>([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const [currentResultIndex, setCurrentResultIndex] = useState<number>(-1);\r\n  const inputRef = useRef<HTMLInputElement | null>(null);\r\n  const hasAutoSearchedRef = useRef(false);\r\n  const lastInitialKeywordRef = useRef<string | null>(null);\r\n  const initialSelectedIdRef = useRef<string | null>(null);\r\n  const [senderFilter, setSenderFilter] = useState<string>('');\r\n  const [startDate, setStartDate] = useState<string>('');\r\n  const [endDate, setEndDate] = useState<string>('');\r\n  const [previewMedia, setPreviewMedia] = useState<{ url: string; type: 'image' | 'video' } | null>(null);\r\n\r\n  const fetchSearchResults = useCallback(\r\n    async (query: string) => {\r\n      if (!query.trim() || !roomId) {\r\n        setSearchResults([]);\r\n        return;\r\n      }\r\n      setIsSearching(true);\r\n\r\n      try {\r\n        const buildTsRange = (): Record<string, number> | undefined => {\r\n          let fromMs: number | undefined;\r\n          let toMs: number | undefined;\r\n          if (startDate) {\r\n            const d = new Date(`${startDate}T00:00:00`);\r\n            if (!Number.isNaN(d.getTime())) fromMs = d.getTime();\r\n          }\r\n          if (endDate) {\r\n            const d = new Date(`${endDate}T23:59:59`);\r\n            if (!Number.isNaN(d.getTime())) toMs = d.getTime();\r\n          }\r\n          if (fromMs !== undefined || toMs !== undefined) {\r\n            const range: Record<string, number> = {};\r\n            if (fromMs !== undefined) range.$gte = fromMs;\r\n            if (toMs !== undefined) range.$lte = toMs;\r\n            return range;\r\n          }\r\n          return undefined;\r\n        };\r\n        const tsRange = buildTsRange();\r\n        const res = await fetch('/api/messages', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            action: 'read',\r\n            filters: {\r\n              roomId,\r\n              searchQuery: query.trim(),\r\n              isRecalled: { $ne: true },\r\n              isDeleted: { $ne: true },\r\n              type: { $ne: 'notify' },\r\n              ...(tsRange ? { timestamp: tsRange } : {}),\r\n            },\r\n            limit: 500,\r\n            sort: { field: 'timestamp', order: 'desc' },\r\n          }),\r\n        });\r\n        const data = await res.json();\r\n        const raw: Message[] = Array.isArray(data?.data) ? (data.data as Message[]) : [];\r\n        const filtered = raw.filter((m) => {\r\n          const text =\r\n            m.type === 'file'\r\n              ? String(m.fileName || '')\r\n              : m.type === 'sticker'\r\n                ? ''\r\n                : String(m.content || '');\r\n          return accentAwareIncludes(text, query);\r\n        });\r\n        const results: Message[] = filtered.slice().sort((a: Message, b: Message) => Number(b.timestamp) - Number(a.timestamp));\r\n        setSearchResults(results);\r\n        setCurrentResultIndex((prev) => {\r\n          if (results.length === 0) return -1;\r\n          return prev;\r\n        });\r\n      } catch (error) {\r\n        console.error('Fetch search results error:', error);\r\n        setSearchResults([]);\r\n      } finally {\r\n        setIsSearching(false);\r\n      }\r\n    },\r\n    [roomId, onJumpToMessage],\r\n  );\r\n  useEffect(() => {\r\n    const kw = (initialKeyword || '').trim();\r\n    if (!isOpen || !kw) return;\r\n    if (lastInitialKeywordRef.current === kw && hasAutoSearchedRef.current) return;\r\n    setSearchTerm(kw);\r\n    hasAutoSearchedRef.current = true;\r\n    lastInitialKeywordRef.current = kw;\r\n    initialSelectedIdRef.current = initialSelectedMessageId || null;\r\n    setTimeout(() => {\r\n      inputRef.current?.focus();\r\n    }, 100);\r\n    fetchSearchResults(kw);\r\n  }, [initialKeyword, initialSelectedMessageId, isOpen, fetchSearchResults]);\r\n\r\n  // Reset when sidebar closes\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      hasAutoSearchedRef.current = false;\r\n      lastInitialKeywordRef.current = null;\r\n      initialSelectedIdRef.current = null;\r\n      setCurrentResultIndex(-1);\r\n      if (onKeywordClear) {\r\n        onKeywordClear();\r\n      }\r\n    }\r\n  }, [isOpen, onKeywordClear]);\r\n\r\n  useEffect(() => {\r\n    if (initialKeyword && searchTerm === initialKeyword && hasAutoSearchedRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (!searchTerm.trim()) {\r\n      setSearchResults([]);\r\n      setCurrentResultIndex(-1);\r\n      return;\r\n    }\r\n\r\n    const handler = setTimeout(() => {\r\n      fetchSearchResults(searchTerm);\r\n    }, 500);\r\n\r\n    return () => {\r\n      clearTimeout(handler);\r\n    };\r\n  }, [searchTerm, fetchSearchResults, initialKeyword]);\r\n  const senderOptions = useMemo(() => {\r\n    const ids = new Set<string>();\r\n    const arr: { id: string; name: string }[] = [];\r\n    searchResults.forEach((m) => {\r\n      const id = typeof m.sender === 'object' && m.sender ? String((m.sender as User)._id) : String(m.sender || '');\r\n      if (id && !ids.has(id)) {\r\n        ids.add(id);\r\n        const name = getSenderName(m.sender);\r\n        arr.push({ id, name });\r\n      }\r\n    });\r\n    return arr.sort((a, b) => a.name.localeCompare(b.name));\r\n  }, [searchResults, getSenderName]);\r\n\r\n  const filteredResults = useMemo(() => {\r\n    const startTs = startDate ? new Date(startDate + 'T00:00:00').getTime() : null;\r\n    const endTs = endDate ? new Date(endDate + 'T23:59:59').getTime() : null;\r\n    return searchResults.filter((m) => {\r\n      const sid = typeof m.sender === 'object' && m.sender ? String((m.sender as User)._id) : String(m.sender || '');\r\n      const passSender = senderFilter ? sid === senderFilter : true;\r\n      const ts = Number(m.timestamp || 0);\r\n      const passStart = startTs ? ts >= startTs : true;\r\n      const passEnd = endTs ? ts <= endTs : true;\r\n      return passSender && passStart && passEnd;\r\n    });\r\n  }, [searchResults, senderFilter, startDate, endDate]);\r\n\r\n  const sortedResults = useMemo(\r\n    () => filteredResults.slice().sort((a, b) => Number(b.timestamp) - Number(a.timestamp)),\r\n    [filteredResults],\r\n  );\r\n  const mediaResults = useMemo(\r\n    () =>\r\n      sortedResults\r\n        .filter((m) => (m.type === 'image' || m.type === 'video') && m.fileUrl)\r\n        .map((m) => ({ url: String(m.fileUrl), type: m.type as 'image' | 'video' })),\r\n    [sortedResults],\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (sortedResults.length === 0) {\r\n      setCurrentResultIndex(-1);\r\n    }\r\n  }, [sortedResults.length]);\r\n\r\n  if (!isOpen || (typeof window !== 'undefined' && window.innerWidth < 1024)) return null;\r\n\r\n  const handleJump = (messageId: string, index?: number) => {\r\n    if (index !== undefined) {\r\n      setCurrentResultIndex(index);\r\n    }\r\n    onJumpToMessage(messageId);\r\n    const isMobile = typeof window !== 'undefined' ? window.innerWidth < 1024 : false;\r\n    if (isMobile) {\r\n      setTimeout(() => {\r\n        onClose();\r\n      }, 300);\r\n    } else {\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 900);\r\n    }\r\n  };\r\n\r\n  const handlePrevious = () => {\r\n    if (sortedResults.length === 0) return;\r\n    const newIndex = currentResultIndex <= 0 ? sortedResults.length - 1 : currentResultIndex - 1;\r\n    setCurrentResultIndex(newIndex);\r\n    handleJump(sortedResults[newIndex]._id, newIndex);\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (sortedResults.length === 0) return;\r\n    const newIndex = currentResultIndex >= sortedResults.length - 1 ? 0 : currentResultIndex + 1;\r\n    setCurrentResultIndex(newIndex);\r\n    handleJump(sortedResults[newIndex]._id, newIndex);\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === 'Enter') {\r\n      fetchSearchResults(searchTerm);\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      handlePrevious();\r\n    } else if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      handleNext();\r\n    }\r\n  };\r\n\r\n  // Highlight keyword function\r\n  const highlightKeyword = (text: string, keyword: string) => {\r\n    if (!keyword.trim() || !text) return text;\r\n    const regex = buildAccentInsensitiveRegex(keyword);\r\n    const parts = text.split(regex);\r\n    return (\r\n      <>\r\n        {parts.map((part, i) =>\r\n          regex.test(part) ? (\r\n            <mark key={i} className=\" text-blue-900 px-0.5 rounded font-medium\">\r\n              {part}\r\n            </mark>\r\n          ) : (\r\n            <span key={i}>{part}</span>\r\n          ),\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    // Sử dụng cơ chế fixed/static tương tự ChatInfoPopup\r\n    <div\r\n      className={\r\n        `bg-white shadow-lg w-full sm:w-[21.875rem] flex flex-col h-full overflow-y-auto relative transition-transform duration-300 transform\r\n        ${isOpen ? 'translate-x-0' : 'translate-x-full'}` // Thêm hiệu ứng slide\r\n      }\r\n    >\r\n      {/* Header */}\r\n      <div className=\"p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50\">\r\n        <h2 className=\"text-xl font-bold text-black\">Tìm kiếm tin nhắn</h2>\r\n        {/* Nút đóng (Sử dụng icon ArrowRight để trông như đóng tab) */}\r\n        <button onClick={onClose} className=\"cursor-pointer p-2 hover:bg-gray-200 rounded-full\" title=\"Đóng tìm kiếm\">\r\n          <Image\r\n            src={ArrowRightICon}\r\n            alt=\"Close\"\r\n            width={24}\r\n            height={24}\r\n            className=\"w-6 h-6 rotate-180\" // Xoay ngược để chỉ mũi tên sang trái\r\n          />\r\n        </button>\r\n      </div>\r\n\r\n      {/* Input Tìm kiếm */}\r\n      <div className=\"p-4 border-b border-gray-100 bg-white\">\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Nhập từ khóa tìm kiếm...\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            onKeyDown={handleKeyDown}\r\n            className=\"flex-1 border-b outline-none p-2  text-sm \"\r\n            ref={inputRef}\r\n            autoFocus\r\n          />\r\n          <button\r\n            onClick={() => fetchSearchResults(searchTerm)}\r\n            className=\"cursor-pointer bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 disabled:bg-blue-300 transition-colors shrink-0\"\r\n            disabled={isSearching || !searchTerm.trim()}\r\n          >\r\n            {isSearching ? (\r\n              <svg\r\n                className=\"animate-spin h-5 w-5 text-white\"\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                <path\r\n                  className=\"opacity-75\"\r\n                  fill=\"currentColor\"\r\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n                ></path>\r\n              </svg>\r\n            ) : (\r\n              'Tìm'\r\n            )}\r\n          </button>\r\n        </div>\r\n        <div className=\"mt-3 space-y-2 items-center gap-2 \">\r\n          <select\r\n            value={senderFilter}\r\n            onChange={(e) => setSenderFilter(e.target.value)}\r\n            className=\" cursor-pointer text-[1rem] border border-gray-300 rounded-lg px-2 py-1 text-sm flex-1\"\r\n          >\r\n            <option value=\"\">Tất cả</option>\r\n            {senderOptions.map((opt) => (\r\n              <option className=\"cursor-pointer \" key={opt.id} value={opt.id}>\r\n                {opt.name || opt.id}\r\n              </option>\r\n            ))}\r\n          </select>\r\n          <div className=\"flex items-center gap-1\">\r\n            <input\r\n              type=\"date\"\r\n              value={startDate}\r\n              onChange={(e) => setStartDate(e.target.value)}\r\n              onInput={(e) => setStartDate((e.target as HTMLInputElement).value)}\r\n              className=\"border border-gray-300 rounded-lg px-1 py-1 text-sm cursor-pointer\"\r\n            />\r\n            <span className=\"text-gray-500 text-xs\"> → </span>\r\n            <input\r\n              type=\"date\"\r\n              value={endDate}\r\n              onChange={(e) => setEndDate(e.target.value)}\r\n              onInput={(e) => setEndDate((e.target as HTMLInputElement).value)}\r\n              className=\"border border-gray-300 rounded-lg px-1 py-1 text-sm cursor-pointer\"\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                setStartDate('');\r\n                setEndDate('');\r\n              }}\r\n              className=\"ml-1 px-2 py-1 text-xs rounded border border-gray-300 bg-white hover:bg-gray-100 cursor-pointer\"\r\n            >\r\n              <IoReload className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Kết quả Tìm kiếm */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50\">\r\n        {isSearching && <p className=\"text-center text-blue-500 text-sm\">Đang tìm kiếm...</p>}\r\n\r\n        {!isSearching && searchTerm.trim() && searchResults.length === 0 && (\r\n          <p className=\"text-center text-gray-500 text-sm\">Không tìm thấy tin nhắn nào khớp với: **{searchTerm}**</p>\r\n        )}\r\n\r\n        {!isSearching && !searchTerm.trim() && (\r\n          <p className=\"text-center text-gray-400 text-sm\">Nhập từ khóa để tìm kiếm trong hội thoại này.</p>\r\n        )}\r\n\r\n        {sortedResults.map((msg: Message, index: number) => {\r\n          const isRecalled = msg.isRecalled === true;\r\n\r\n          const contentDisplay =\r\n            msg.type === 'file'\r\n              ? msg.fileName || 'File'\r\n              : msg.type === 'sticker'\r\n                ? '[Sticker]'\r\n                : String(msg.content || '');\r\n          const isCurrentResult = index === currentResultIndex;\r\n\r\n          // Lấy tên người gửi (sender được khai báo là string ID trong Message)\r\n          const senderName = getSenderName(msg.sender);\r\n          const d = new Date(msg.timestamp);\r\n          const today = new Date();\r\n          const yesterday = new Date();\r\n          yesterday.setDate(today.getDate() - 1);\r\n          const sameDate = (a: Date, b: Date) =>\r\n            a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate();\r\n          const dateLabel = sameDate(d, today)\r\n            ? 'Hôm nay'\r\n            : sameDate(d, yesterday)\r\n              ? 'Hôm qua'\r\n              : d.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n          const timeLabel = d.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });\r\n\r\n          return (\r\n            <div\r\n              key={msg._id}\r\n              className={`p-3 rounded-lg shadow-sm hover:bg-gray-100 cursor-pointer transition-colors border ${\r\n                isCurrentResult ? 'bg-blue-50 border-blue-300' : 'bg-white border-gray-200'\r\n              }`}\r\n              onClick={() => handleJump(msg._id, index)}\r\n            >\r\n              <p className=\"text-xs text-blue-600 font-semibold\">\r\n                {senderName} • {dateLabel} • {timeLabel}\r\n              </p>\r\n              <div className=\"flex-1 min-w-0\">\r\n                <div className=\"flex items-center justify-between gap-2\"></div>\r\n                {msg.type === 'image' && msg.fileUrl ? (\r\n                  <div className=\"mt-1\">\r\n                    <Image\r\n                      src={getProxyUrl(String(msg.fileUrl))}\r\n                      alt=\"\"\r\n                      width={320}\r\n                      height={240}\r\n                      className=\"w-10 h-18 rounded-lg object-cover\"\r\n                    />\r\n                  </div>\r\n                ) : msg.type === 'video' && msg.fileUrl ? (\r\n                  <div className=\"relative rounded-2xl overflow-hidden cursor-pointer shadow-lg max-w-[8vw] sm:max-w-[6rem] aspect-video bg-black\">\r\n                    <video\r\n                      src={getProxyUrl(String(msg.fileUrl))}\r\n                      className=\"w-full h-full object-cover\"\r\n                      muted\r\n                      playsInline\r\n                      loop\r\n                    />\r\n                    <div className=\"absolute inset-0 flex items-center justify-center opacity-100\">\r\n                      <div className=\"w-4 h-4 bg-white/80 rounded-full flex items-center justify-center shadow\">\r\n                        <HiPlay className=\"w-3 h-3 text-blue-600 \" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <p className={`text-sm mt-1 line-clamp-2 ${isRecalled ? 'italic text-gray-500' : 'text-gray-800'}`}>\r\n                    {highlightKeyword(contentDisplay, searchTerm)}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Navigation bar - chỉ hiển thị khi có kết quả (mobile only) */}\r\n      {searchResults.length > 0 && typeof window !== 'undefined' && window.innerWidth < 1024 && (\r\n        <div className=\"flex items-center justify-between px-4 py-2 bg-gray-100 border-t border-gray-200\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              onClick={handlePrevious}\r\n              className=\"p-1.5 rounded cursor-pointer hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n              title=\"Kết quả trước\"\r\n            >\r\n              <svg className=\"w-5 h-5 text-gray-700\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n              </svg>\r\n            </button>\r\n            <span className=\"text-xs text-gray-600 font-medium min-w-[80px] text-center\">\r\n              {currentResultIndex >= 0 && currentResultIndex < sortedResults.length\r\n                ? `Kết quả ${currentResultIndex + 1}/${sortedResults.length}`\r\n                : `0/${sortedResults.length}`}\r\n            </span>\r\n            <button\r\n              onClick={handleNext}\r\n              className=\"p-1.5 rounded cursor-pointer hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n              title=\"Kết quả tiếp theo\"\r\n            >\r\n              <svg className=\"w-5 h-5 text-gray-700\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {previewMedia && (\r\n        <MediaPreviewModal\r\n          media={previewMedia}\r\n          chatName={undefined}\r\n          isGroup={undefined}\r\n          onClose={() => setPreviewMedia(null)}\r\n          roomId={roomId}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SearchSidebar;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/ShareMessageModal.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n'use client';\r\n\r\nimport React, { useState, useMemo, useRef, useEffect } from 'react';\r\nimport { IoClose, IoSearch, IoSend, IoCheckmark } from 'react-icons/io5';\r\nimport { HiUsers, HiUser, HiOutlineDocumentText } from 'react-icons/hi2';\r\nimport { User } from '@/types/User';\r\nimport { GroupConversation } from '@/types/Group';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl, normalizeNoAccent, hasDiacritics, accentAwareIncludes } from '@/utils/utils';\r\nimport { Message } from '@/types/Message';\r\nimport { HiPlay, HiX, HiXCircle } from 'react-icons/hi';\r\n\r\n// Mock types\r\n\r\ninterface ShareMessageModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  message: Message;\r\n  currentUser: User;\r\n  allUsers: User[];\r\n  groups: GroupConversation[];\r\n  onShare: (targetRoomIds: string[], message: Message, attachedText?: string) => Promise<void>;\r\n}\r\n\r\ntype ShareTarget = {\r\n  id: string;\r\n  name: string;\r\n  avatar?: string;\r\n  isGroup: boolean;\r\n  type: 'user' | 'group';\r\n};\r\n\r\nexport default function ShareMessageModal({\r\n  isOpen,\r\n  onClose,\r\n  message,\r\n  currentUser,\r\n  allUsers,\r\n  groups = [],\r\n  onShare,\r\n}: ShareMessageModalProps) {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedTargets, setSelectedTargets] = useState<Set<string>>(new Set());\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const [attachedText, setAttachedText] = useState('');\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const viewportRef = useRef<HTMLDivElement>(null);\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const scrollToBottom = () => {\r\n    const el = containerRef.current;\r\n    if (!el) return;\r\n    try {\r\n      el.scrollTop = el.scrollHeight;\r\n    } catch {}\r\n    try {\r\n      inputRef.current?.scrollIntoView({ block: 'end' });\r\n    } catch {}\r\n  };\r\n\r\n  useEffect(() => {\r\n    setIsMobile(typeof window !== 'undefined' ? window.innerWidth < 1024 : false);\r\n  }, []);\r\n  useEffect(() => {\r\n    if (!isOpen || !isMobile) return;\r\n    const root = document.documentElement;\r\n    const applyViewport = () => {\r\n      const vv = window.visualViewport;\r\n      if (!vv) return;\r\n      root.style.setProperty('--vvh', `${vv.height}px`);\r\n      root.style.setProperty('--vvw', `${vv.width}px`);\r\n      root.style.setProperty('--vvTop', `${vv.offsetTop || 0}px`);\r\n      root.style.setProperty('--vvLeft', `${vv.offsetLeft || 0}px`);\r\n      if (viewportRef.current) {\r\n        viewportRef.current.style.height = `${vv.height}px`;\r\n      }\r\n      scrollToBottom();\r\n    };\r\n    const vv = window.visualViewport;\r\n    if (vv) {\r\n      vv.addEventListener('resize', applyViewport);\r\n      vv.addEventListener('scroll', applyViewport);\r\n      applyViewport();\r\n    }\r\n    document.body.classList.add('vv-body-lock');\r\n    return () => {\r\n      if (vv) {\r\n        vv.removeEventListener('resize', applyViewport);\r\n        vv.removeEventListener('scroll', applyViewport);\r\n      }\r\n      document.body.classList.remove('vv-body-lock');\r\n      root.style.removeProperty('--vvh');\r\n      root.style.removeProperty('--vvw');\r\n      root.style.removeProperty('--vvTop');\r\n      root.style.removeProperty('--vvLeft');\r\n    };\r\n  }, [isOpen, isMobile]);\r\n  // Scroll input vào view khi focus\r\n  const handleInputFocus = () => {\r\n    setTimeout(() => {\r\n      scrollToBottom();\r\n      inputRef.current?.scrollIntoView({\r\n        behavior: 'smooth',\r\n        block: 'center',\r\n      });\r\n    }, 300); // Đợi bàn phím xuất hiện\r\n  };\r\n  const shareTargets: ShareTarget[] = useMemo(() => {\r\n    const userTargets: ShareTarget[] = allUsers\r\n      .filter((u) => u._id !== currentUser._id)\r\n      .map((u) => ({\r\n        id: String(u._id),\r\n        name: u.name || 'Người dùng',\r\n        avatar: u.avatar,\r\n        isGroup: false,\r\n        type: 'user' as const,\r\n      }));\r\n\r\n    const groupTargets: ShareTarget[] = groups.map((g) => ({\r\n      id: String(g._id),\r\n      name: g.name || 'Nhóm',\r\n      avatar: g.avatar,\r\n      isGroup: true,\r\n      type: 'group' as const,\r\n    }));\r\n\r\n    return [...groupTargets, ...userTargets];\r\n  }, [allUsers, groups, currentUser._id]);\r\n\r\n  const filteredTargets = useMemo(() => {\r\n    if (!searchTerm.trim()) return shareTargets;\r\n    return shareTargets.filter((t) => accentAwareIncludes(t.name || '', searchTerm));\r\n  }, [shareTargets, searchTerm]);\r\n\r\n  const toggleSelect = (targetId: string) => {\r\n    setSelectedTargets((prev) => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(targetId)) {\r\n        newSet.delete(targetId);\r\n      } else {\r\n        newSet.add(targetId);\r\n      }\r\n      return newSet;\r\n    });\r\n  };\r\n\r\n  const handleShare = async () => {\r\n    if (selectedTargets.size === 0) return;\r\n\r\n    setIsSharing(true);\r\n    try {\r\n      const targetRoomIds = Array.from(selectedTargets).map((targetId) => {\r\n        const target = shareTargets.find((t) => t.id === targetId);\r\n        if (target?.isGroup) {\r\n          return targetId;\r\n        } else {\r\n          const ids = [currentUser._id, targetId].sort();\r\n          return `${ids[0]}_${ids[1]}`;\r\n        }\r\n      });\r\n\r\n      await onShare(targetRoomIds, message, attachedText);\r\n\r\n      setSelectedTargets(new Set());\r\n      setSearchTerm('');\r\n      setAttachedText('');\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Share error:', error);\r\n    } finally {\r\n      setIsSharing(false);\r\n    }\r\n  };\r\n\r\n  const renderMessagePreview = () => {\r\n    const batchItems =\r\n      (\r\n        message as unknown as {\r\n          batchItems?: Array<{\r\n            id: string;\r\n            type: 'image' | 'video' | 'file' | 'text';\r\n            fileUrl?: string;\r\n            fileName?: string;\r\n            content?: string;\r\n          }>;\r\n        }\r\n      ).batchItems || [];\r\n    if (Array.isArray(batchItems) && batchItems.length > 1) {\r\n      const items = batchItems.slice(0, 6);\r\n      return (\r\n        <div>\r\n          <p className=\"text-xs text-gray-500 mb-2\">{batchItems.length} mục sẽ được chia sẻ</p>\r\n          <div className=\"grid grid-cols-10 gap-1\">\r\n            {items.map((it, idx) => {\r\n              const url = getProxyUrl(String(it.fileUrl || ''));\r\n              if (it.type === 'image') {\r\n                return (\r\n                  <div\r\n                    key={`share-preview-img-${idx}`}\r\n                    className=\"relative w-full max-w-[5rem] aspect-square bg-gray-50 rounded-lg overflow-hidden border border-gray-100\"\r\n                  >\r\n                    {url ? (\r\n                      <Image src={url} alt=\"Ảnh\" width={200} height={200} className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                      <div className=\"w-full h-full bg-gray-100\" />\r\n                    )}\r\n                  </div>\r\n                );\r\n              }\r\n              if (it.type === 'video') {\r\n                return (\r\n                  <div\r\n                    key={`share-preview-vid-${idx}`}\r\n                    className=\"relative w-full max-w-[5rem] aspect-square bg-black rounded-lg overflow-hidden border border-gray-100\"\r\n                  >\r\n                    {url ? (\r\n                      <video src={url} preload=\"metadata\" className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                      <div className=\"w-full h-full bg-gray-900\" />\r\n                    )}\r\n                    <div className=\"absolute inset-0 flex items-center justify-center opacity-100\">\r\n                      <div className=\" rounded-full flex items-center justify-center shadow\">\r\n                        <HiPlay className=\"w-3 h-3 text-blue-600 ml-1\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              }\r\n              return (\r\n                <div\r\n                  key={`share-preview-other-${idx}`}\r\n                  className=\"flex items-center justify-center w-full aspect-square rounded-lg border border-gray-200 bg-white\"\r\n                >\r\n                  <HiOutlineDocumentText className=\"w-6 h-6 text-gray-500\" />\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    if (message.type === 'text') {\r\n      const text = (message.content || '').slice(0, 120) + ((message.content || '').length > 120 ? '...' : '');\r\n      return <p className=\"text-sm text-gray-700 leading-relaxed\">{text}</p>;\r\n    }\r\n\r\n    const mediaUrl = getProxyUrl(message.fileUrl || message.previewUrl);\r\n\r\n    if (message.type === 'image' && mediaUrl) {\r\n      return (\r\n        <div className=\"w-full max-w-[5rem]\">\r\n          <Image\r\n            src={mediaUrl}\r\n            alt=\"Ảnh chia sẻ\"\r\n            width={300}\r\n            height={200}\r\n            className=\"w-full max-h-20 object-contain rounded-xl border border-gray-100\"\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (message.type === 'video' && mediaUrl) {\r\n      return (\r\n        <div className=\"w-full max-w-[7rem]\">\r\n          <video\r\n            src={mediaUrl}\r\n            controls\r\n            preload=\"metadata\"\r\n            className=\"w-full max-h-20 rounded-xl border border-gray-100 bg-black\"\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (message.type === 'file') {\r\n      return (\r\n        <a\r\n          href={getProxyUrl(message.fileUrl)}\r\n          target=\"_blank\"\r\n          rel=\"noreferrer\"\r\n          className=\"flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-2xl max-w-[70vw] sm:max-w-[18rem] shadow-sm hover:bg-gray-50\"\r\n        >\r\n          <div className=\"p-2 bg-blue-600 rounded-xl\">\r\n            <HiOutlineDocumentText className=\"w-6 h-6 text-white\" />\r\n          </div>\r\n\r\n          <div className=\"flex-1 min-w-0\">\r\n            <p className=\"text-sm font-semibold text-gray-800 truncate\">{message.fileName || 'Tệp đính kèm'}</p>\r\n            <p className=\"text-xs text-gray-500 truncate\">Nhấn để tải xuống</p>\r\n          </div>\r\n        </a>\r\n      );\r\n    }\r\n\r\n    if (message.type === 'sticker') {\r\n      return <p className=\"text-sm text-gray-700\">😊 Sticker</p>;\r\n    }\r\n    return <p className=\"text-sm text-gray-700\">Tin nhắn</p>;\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      ref={viewportRef}\r\n      className={`fixed inset-0 z-[10001] flex items-center justify-center bg-black/60 backdrop-blur-sm p-0 sm:p-4 animate-in fade-in duration-200 ${isMobile ? 'vv-fixed' : ''}`}\r\n    >\r\n      <div\r\n        ref={containerRef}\r\n        className=\"w-full h-full sm:w-full sm:h-auto sm:max-w-lg bg-white shadow-2xl flex flex-col sm:max-h-[90vh] overflow-hidden animate-in zoom-in-95 duration-200 md:rounded-xl\"\r\n      >\r\n        {/* Header - Modern gradient */}\r\n        <div className=\"relative p-1 bg-gray-200 text-black \">\r\n          <div className=\"flex items-center px-2 gap-3\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"top-4 right-4 hover:cursor-pointer  hover:bg-white/20 rounded-full transition-all duration-200 hover:rotate-90\"\r\n            >\r\n              <HiX className=\"w-6 h-6\" />\r\n            </button>\r\n            <div>\r\n              <h3 className=\"text-[1rem] \">Chia sẻ</h3>\r\n              <p className=\"text-black text-sm mt-0.5\">Đã chọn: {selectedTargets.size}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"py-1.5 px-3 bg-white border-b border-gray-300 pb-3\">\r\n          <div className=\"relative \">\r\n            <IoSearch className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Tìm kiếm người dùng hoặc nhóm...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-12 pr-4 py-2 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50 focus:bg-white\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Main content scrollable (mobile fullscreen) */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          {/* Message Preview - Enhanced */}\r\n\r\n          {/* Search - Modern design */}\r\n          <div className=\"px-3 py-1.5 bg-white\">\r\n            {selectedTargets.size > 0 && (\r\n              <div className=\"mt-3 flex items-center gap-2 text-sm\">\r\n                <div className=\"flex items-center gap-1.5 text-blue-600 font-medium\">\r\n                  <IoCheckmark className=\"w-5 h-5\" />\r\n                  <span>{selectedTargets.size} đã chọn</span>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Target List - Improved styling */}\r\n          <div className=\"px-3 pb-2\">\r\n            {filteredTargets.length === 0 ? (\r\n              <div className=\"p-12 text-center\">\r\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                  <IoSearch className=\"w-8 h-8 text-gray-400\" />\r\n                </div>\r\n                <p className=\"text-gray-500 font-medium\">Không tìm thấy kết quả</p>\r\n                <p className=\"text-gray-400 text-sm mt-1\">Thử tìm kiếm với từ khóa khác</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"divide-y divide-gray-100\">\r\n                {filteredTargets.map((target) => {\r\n                  const isSelected = selectedTargets.has(target.id);\r\n                  return (\r\n                    <button\r\n                      key={target.id}\r\n                      onClick={() => toggleSelect(target.id)}\r\n                      className={`w-full  p-2 mb-2 flex items-center gap-4 transition-all hover:cursor-pointer duration-200 hover:bg-gray-50  border-transparent`}\r\n                    >\r\n                      <div className=\"relative flex-shrink-0 flex items-center gap-5\">\r\n                        <div\r\n                          className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${isSelected ? 'bg-blue-500 border-blue-500' : 'border-gray-300 bg-white'}`}\r\n                        >\r\n                          {isSelected && <IoCheckmark className=\"w-5 h-5 text-white\" />}\r\n                        </div>\r\n                        <div className={`w-10 h-10 rounded-full overflow-hidden transition-all duration-200`}>\r\n                          {target.avatar ? (\r\n                            <Image\r\n                              src={getProxyUrl(target.avatar)}\r\n                              alt=\"\"\r\n                              width={36}\r\n                              height={36}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          ) : (\r\n                            <Image\r\n                              src=\"/logo/avata.webp\"\r\n                              alt={target.name}\r\n                              width={64}\r\n                              height={64}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex-1 text-left min-w-0\">\r\n                        <p className=\"font-semibold text-gray-800 truncate\">{target.name}</p>\r\n                        <div className=\"flex items-center gap-1.5 mt-0.5\">\r\n                          {target.isGroup ? (\r\n                            <>\r\n                              <HiUsers className=\"w-4 h-4 text-purple-500\" />\r\n                              <span className=\"text-xs text-purple-600 font-medium\">Nhóm</span>\r\n                            </>\r\n                          ) : (\r\n                            <>\r\n                              <HiUser className=\"w-4 h-4 text-gray-400\" />\r\n                              <span className=\"text-xs text-gray-500\">Người dùng</span>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </button>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer - Modern actions */}\r\n        {/* Footer - Hiển thị các target đã chọn */}\r\n        <div className=\"py-2 px-4 bg-gradient-to-br from-gray-50 to-white border-t border-gray-200 rounded-none sm:rounded-b-2xl\">\r\n          {selectedTargets.size === 0 ? (\r\n            <p className=\"text-center text-gray-400 text-sm\">Chưa chọn người nhận nào</p>\r\n          ) : (\r\n            <>\r\n              <div className=\"mb-3\">\r\n                <p className=\"text-sm font-semibold text-gray-700\">Đã chọn ({selectedTargets.size})</p>\r\n              </div>\r\n\r\n              {/* Danh sách cuộn ngang các người đã chọn */}\r\n              <div className=\"flex gap-3 overflow-x-auto  scrollbar-thin scrollbar-thumb-gray-300\">\r\n                {Array.from(selectedTargets).map((targetId) => {\r\n                  const target = shareTargets.find((t) => t.id === targetId);\r\n                  if (!target) return null;\r\n\r\n                  return (\r\n                    <div key={targetId} className=\"flex-shrink-0 flex flex-col items-center gap-2 group\">\r\n                      <div className=\"relative flex-shrink-0\">\r\n                        {/* Avatar */}\r\n                        <div className=\"w-14 h-14 rounded-full overflow-hidden border-4 border-white shadow-lg\">\r\n                          {target.avatar ? (\r\n                            <Image\r\n                              src={getProxyUrl(target.avatar)}\r\n                              alt={target.name}\r\n                              width={56}\r\n                              height={56}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          ) : (\r\n                            <Image\r\n                              src=\"/logo/avata.webp\"\r\n                              alt={target.name}\r\n                              width={56}\r\n                              height={56}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* Nút xóa - Dấu X đỏ ở góc trên phải */}\r\n                        <button\r\n                          onClick={(e) => {\r\n                            e.stopPropagation(); // Ngăn click lan ra toggleSelect toàn bộ item\r\n                            toggleSelect(targetId);\r\n                          }}\r\n                          className=\"absolute -top-[2px] cursor-pointer -right-1 w-5 h-5 bg-gray-400 hover:bg-red-600 rounded-full flex items-center justify-center shadow-lg border-2 border-white transition-all duration-200 opacity-100 hover:scale-110\"\r\n                          aria-label=\"Xóa khỏi danh sách chia sẻ\"\r\n                        >\r\n                          <IoClose className=\"w-4 h-4 text-white\" />\r\n                        </button>\r\n\r\n                        {/* Icon nhóm ở góc dưới phải (nếu là group) */}\r\n                        {target.isGroup && (\r\n                          <div className=\"absolute -bottom-[2px] -right-2 w-6 h-6 bg-purple-600 rounded-full flex items-center justify-center border-3 border-white shadow-md\">\r\n                            <HiUsers className=\"w-4.5 h-4.5 text-white\" />\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      <p className=\"text-xs font-medium text-gray-700 max-w-[64px] truncate text-center mt-1\">\r\n                        {target.name}\r\n                      </p>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n\r\n        <div\r\n          className=\"px-2 pb-3 mb-2 bg-white border-t border-gray-200\"\r\n          style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}\r\n        >\r\n          <div className=\"py-2 bg-gradient-to-br from-gray-50 to-blue-50/30\">\r\n            <p className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2\">Nội dung chia sẻ</p>\r\n            <div className=\"bg-white p-2 rounded-xl border border-gray-200 shadow-sm  whitespace-pre-wrap break-words\">\r\n              {renderMessagePreview()}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              ref={inputRef}\r\n              type=\"text\"\r\n              placeholder=\"Nhập tin nhắn đính kèm (tùy chọn)\"\r\n              value={attachedText}\r\n              onChange={(e) => setAttachedText(e.target.value)}\r\n              onFocus={handleInputFocus}\r\n              className=\"w-full px-3 py-2 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all duration-200 bg-gray-50 focus:bg-white\"\r\n            />\r\n            <button\r\n              onClick={handleShare}\r\n              disabled={selectedTargets.size === 0 || isSharing}\r\n              className=\"flex-1 px-4 py-4 hover:cursor-pointer bg-blue-400 text-white font-semibold rounded-full hover:from-blue-600 hover:to-purple-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40 hover:-translate-y-0.5 flex items-center justify-center gap-2\"\r\n            >\r\n              {isSharing ? (\r\n                <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n              ) : (\r\n                <IoSend className=\"w-4 h-4\" />\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7134, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/MessageMobileContextMenu.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Message } from '@/types/Message';\r\nimport { RiReplyLine } from 'react-icons/ri';\r\nimport { HiOutlineDownload, HiFolder } from 'react-icons/hi';\r\nimport type { ContextMenuState } from './MessageContextMenu';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport ICReply from '../svg/ICReply';\r\nimport ICShareMessage from '../svg/ICShareMessage';\r\nimport ICCopy from '../svg/ICCopy';\r\nimport ICPin from '../svg/ICPin';\r\nimport ICTrashCan from '../svg/ICTrashCan';\r\nimport ICTrash from '../svg/ICTrash';\r\nimport ICFolder from '../svg/ICFolder';\r\nimport ICDownload from '../svg/ICDownload';\r\nimport ICFolder2 from '../svg/ICFolder2';\r\nimport { HiPlay } from 'react-icons/hi2';\r\nimport { HiPencil } from 'react-icons/hi';\r\nimport {\r\n  FaCopy,\r\n  FaDownload,\r\n  FaFolderOpen,\r\n  FaPaperclip,\r\n  FaRegPenToSquare,\r\n  FaRegShareFromSquare,\r\n  FaRepeat,\r\n  FaTrashCan,\r\n} from 'react-icons/fa6';\r\n\r\ninterface MessageMobileContextMenuProps {\r\n  contextMenu: ContextMenuState | null;\r\n  currentUserId: string;\r\n  onClose: () => void;\r\n  onPinMessage: (msg: Message) => void;\r\n  onRecallMessage: (messageId: string) => void;\r\n  onReplyMessage?: (msg: Message) => void;\r\n  onShareMessage: (message: Message) => void;\r\n  onToggleReaction?: (msg: Message, emoji: string) => void;\r\n  setEditingMessageId?: (id: string | null) => void;\r\n  setEditContent?: (content: string) => void;\r\n  closeContextMenu?: () => void;\r\n  iconSize?: number;\r\n  reactionSize?: number;\r\n}\r\n\r\nexport default function MessageMobileContextMenu({\r\n  contextMenu,\r\n  currentUserId,\r\n  onClose,\r\n  onPinMessage,\r\n  onRecallMessage,\r\n  onReplyMessage,\r\n  onShareMessage,\r\n  onToggleReaction,\r\n  setEditingMessageId,\r\n  setEditContent,\r\n  closeContextMenu,\r\n  iconSize = 35,\r\n  reactionSize = 35,\r\n}: MessageMobileContextMenuProps) {\r\n  const startYRef = useRef<number | null>(null);\r\n  const movedRef = useRef(false);\r\n  const focusTop = contextMenu?.focusTop ?? undefined;\r\n  const focusHeight = contextMenu?.focusHeight ?? undefined;\r\n\r\n  const isVisible = !!contextMenu?.visible;\r\n  const msg = contextMenu?.message as Message | undefined;\r\n  const x = contextMenu?.x ?? 0;\r\n  const y = contextMenu?.y ?? 0;\r\n  const placement = contextMenu?.placement ?? 'below';\r\n\r\n  const getSenderId = (u: Message['sender'] | string | null | undefined): string => {\r\n    try {\r\n      if (!u) return '';\r\n      if (typeof u === 'string') return String(u);\r\n      const obj = u as Record<string, unknown>;\r\n      const idA = obj && (obj['_id'] as unknown);\r\n      const idB = obj && (obj['id'] as unknown);\r\n      if (idA != null) return String(idA);\r\n      if (idB != null) return String(idB);\r\n    } catch {}\r\n    return '';\r\n  };\r\n\r\n  const isMe = useMemo(() => {\r\n    const id = getSenderId(msg?.sender);\r\n    return id === String(currentUserId);\r\n  }, [msg, currentUserId]);\r\n\r\n  const isText = msg?.type === 'text';\r\n  const isRecalled = !!msg?.isRecalled;\r\n  const canCopy = isText && !isRecalled;\r\n  const canDownload =\r\n    !!msg?.fileUrl &&\r\n    (msg?.type === 'image' || msg?.type === 'file' || msg?.type === 'sticker' || msg?.type === 'video');\r\n  const canRecall = isMe && !isRecalled;\r\n  const isPinned = !!msg?.isPinned;\r\n  const canEdit = isMe && isText && !isRecalled;\r\n  const [imageDims, setImageDims] = useState<{ w: number; h: number } | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!isVisible) return;\r\n    const prev = document.body.style.overflow;\r\n    document.body.style.overflow = 'hidden';\r\n    const prevent = (e: TouchEvent) => {\r\n      e.preventDefault();\r\n    };\r\n    document.addEventListener('touchmove', prevent, { passive: false });\r\n    return () => {\r\n      document.body.style.overflow = prev;\r\n      document.removeEventListener('touchmove', prevent as EventListener);\r\n    };\r\n  }, [isVisible]);\r\n\r\n  useEffect(() => {\r\n    setImageDims(null);\r\n  }, [msg?.fileUrl, msg?.type]);\r\n\r\n  useEffect(() => {\r\n    if (!isVisible) return;\r\n    if (msg?.type !== 'image' || !msg?.fileUrl) return;\r\n    try {\r\n      const img = document.createElement('img');\r\n      img.src = getProxyUrl(msg.fileUrl);\r\n      img.decoding = 'async';\r\n      img.onload = () => {\r\n        const natW = img.naturalWidth || 0;\r\n        const natH = img.naturalHeight || 0;\r\n        if (natW > 0 && natH > 0) {\r\n          const viewportW = typeof window !== 'undefined' ? window.innerWidth : 600;\r\n          const viewportH = typeof window !== 'undefined' ? window.innerHeight : 800;\r\n          const targetH = typeof focusHeight === 'number' ? focusHeight : Math.floor(viewportH * 0.78);\r\n          const idealW = Math.floor((natW * targetH) / natH);\r\n          const maxW = Math.floor(viewportW * 0.88);\r\n          const minW = 120;\r\n          const w = Math.max(minW, Math.min(idealW, maxW));\r\n          setImageDims({ w, h: targetH });\r\n        }\r\n      };\r\n    } catch {}\r\n  }, [isVisible, msg?.type, msg?.fileUrl, focusHeight]);\r\n\r\n  const handleCopy = async () => {\r\n    const text = msg?.content || '';\r\n    if (!text) return;\r\n    try {\r\n      const anyWindow = window as unknown as { isSecureContext?: boolean };\r\n      if (navigator.clipboard && anyWindow.isSecureContext) {\r\n        await navigator.clipboard.writeText(text);\r\n        onClose();\r\n        return;\r\n      }\r\n    } catch {}\r\n    try {\r\n      const ta = document.createElement('textarea');\r\n      ta.value = text;\r\n      ta.setAttribute('readonly', '');\r\n      ta.style.position = 'fixed';\r\n      ta.style.top = '0';\r\n      ta.style.left = '0';\r\n      ta.style.opacity = '0';\r\n      document.body.appendChild(ta);\r\n      ta.focus();\r\n      ta.select();\r\n      const ok = document.execCommand('copy');\r\n      document.body.removeChild(ta);\r\n      if (ok) onClose();\r\n    } catch {}\r\n  };\r\n\r\n  if (!isVisible || !msg) return null;\r\n\r\n  const panelStyle: React.CSSProperties = {\r\n    top: y,\r\n    left: '50%',\r\n    transform: 'translateX(-50%)',\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999]\" onContextMenu={(e) => e.preventDefault()}>\r\n      <div\r\n        className=\"absolute inset-0 bg-black/40 backdrop-blur-sm\"\r\n        onClick={onClose}\r\n        onTouchStart={(e) => {\r\n          const t = e.touches[0];\r\n          startYRef.current = t.clientY;\r\n          movedRef.current = false;\r\n        }}\r\n        onTouchMove={(e) => {\r\n          const t = e.touches[0];\r\n          const s = startYRef.current ?? t.clientY;\r\n          if (Math.abs(t.clientY - s) > 8) movedRef.current = true;\r\n        }}\r\n        onTouchEnd={(e) => {\r\n          const t = e.changedTouches[0];\r\n          const s = startYRef.current ?? t.clientY;\r\n          const dy = t.clientY - s;\r\n          if (dy > 60) onClose();\r\n        }}\r\n      />\r\n      {/* Preview bubble fixed at center top */}\r\n      {msg.type === 'text' && typeof focusTop === 'number' && (\r\n        <div\r\n          className=\"fixed left-1/2 -translate-x-1/2 z-[10000] w-[88vw] max-w-[22rem] px-2 animate-in fade-in zoom-in-95 duration-200\"\r\n          style={{ top: focusTop }}\r\n        >\r\n          <div\r\n            className={`mx-auto rounded-2xl shadow-2xl border ${\r\n              isMe ? 'bg-[#E5F1FF] border-blue-200' : 'bg-white border-gray-200'\r\n            } px-4 py-3 text-[1rem] text-black relative`}\r\n            style={{ maxHeight: focusHeight ? `${focusHeight}px` : '32vh', overflow: 'hidden' }}\r\n          >\r\n            <div className=\"whitespace-pre-wrap break-words\">{msg.content || ''}</div>\r\n            <div className=\"absolute left-0 right-0 bottom-0 h-8 pointer-events-none bg-gradient-to-t from-white/90 to-transparent\" />\r\n          </div>\r\n        </div>\r\n      )}\r\n      {msg.type === 'image' &&\r\n        msg.fileUrl &&\r\n        typeof focusTop === 'number' &&\r\n        (() => {\r\n          const viewportW = typeof window !== 'undefined' ? window.innerWidth : 600;\r\n          const fallbackW = Math.floor(viewportW * 0.88);\r\n          const panelW = imageDims?.w ?? fallbackW;\r\n          const panelStyleWidth: React.CSSProperties = { width: panelW };\r\n          return (\r\n            <div\r\n              className=\"fixed left-1/2 -translate-x-1/2 z-[10000] px-2 animate-in fade-in zoom-in-95 duration-200\"\r\n              style={{ top: focusTop, ...panelStyleWidth }}\r\n            >\r\n              <div\r\n                className=\"mx-auto rounded-2xl shadow-2xl border bg-white border-gray-200 p-2 relative\"\r\n                style={{ height: focusHeight ? `${focusHeight}px` : '78vh' }}\r\n              >\r\n                <div className=\"relative w-full h-full\">\r\n                  <Image src={getProxyUrl(msg.fileUrl)} alt={msg.fileName || 'Ảnh'} fill className=\"object-contain\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })()}\r\n      {msg.type === 'video' && msg.fileUrl && typeof focusTop === 'number' && (\r\n        <div\r\n          className=\"fixed left-1/2 -translate-x-1/2 z-[10000] w-[88vw] max-w-[22rem] px-2 animate-in fade-in zoom-in-95 duration-200\"\r\n          style={{ top: focusTop }}\r\n        >\r\n          <div\r\n            className=\"mx-auto rounded-2xl shadow-2xl border bg-white border-gray-200 p-2 relative\"\r\n            style={{ maxHeight: focusHeight ? `${focusHeight}px` : '34vh', overflow: 'hidden' }}\r\n          >\r\n            <div className=\"relative w-full\">\r\n              <video\r\n                src={getProxyUrl(msg.fileUrl)}\r\n                className=\"w-full h-auto object-contain bg-black rounded-xl\"\r\n                style={{ maxHeight: '100%' }}\r\n                playsInline\r\n                preload=\"metadata\"\r\n              />\r\n              <div className=\"absolute inset-0 flex items-center justify-center opacity-100\">\r\n                <div className=\"w-12 h-12 bg-white/80 rounded-full flex items-center justify-center shadow\">\r\n                  <HiPlay className=\"w-7 h-7 text-blue-600 ml-1\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {msg.type === 'file' && msg.fileUrl && typeof focusTop === 'number' && (\r\n        <div\r\n          className=\"fixed left-1/2 -translate-x-1/2 z-[10000] w-[92vw] max-w-[24rem] px-2\"\r\n          style={{ top: focusTop }}\r\n        >\r\n          <div\r\n            className=\"mx-auto rounded-2xl shadow-2xl border bg-white border-gray-200 p-3 relative\"\r\n            style={{ maxHeight: '38vh', overflow: 'hidden' }}\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 bg-blue-600 rounded-xl\">\r\n                <HiOutlineDownload className=\"w-5 h-5 text-white\" />\r\n              </div>\r\n              <div className=\"flex-1 min-w-0\">\r\n                <p className=\"text-sm font-semibold text-gray-800 truncate\">{msg.fileName || 'Tệp đính kèm'}</p>\r\n                <p className=\"text-xs text-gray-500 truncate\">Giữ để mở thêm hành động</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <div\r\n        className={`absolute z-[10001] ${placement === 'above' ? 'bottom-auto' : 'top-auto'} ${placement === 'above' ? '' : ''}`}\r\n        data-context-menu=\"true\"\r\n        style={panelStyle}\r\n        onMouseDown={(e) => {\r\n          e.stopPropagation();\r\n        }}\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n        }}\r\n        onTouchStart={(e) => {\r\n          e.stopPropagation();\r\n        }}\r\n      >\r\n        {!isRecalled && typeof onToggleReaction === 'function' && (\r\n          <div\r\n            className=\"bottom-full bg-white rounded-xl p-2 mb-2 \"\r\n            onMouseDown={(e) => e.stopPropagation()}\r\n            onClick={(e) => e.stopPropagation()}\r\n            onTouchStart={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"flex items-center justify-between gap-2\">\r\n              {['👍', '❤️', '😂', '😮', '😢', '😡'].map((em) => (\r\n                <button\r\n                  key={em}\r\n                  onClick={() => {\r\n                    onToggleReaction?.(msg, em);\r\n                    onClose();\r\n                  }}\r\n                  aria-label={`Biểu cảm ${em}`}\r\n                  title={`Biểu cảm ${em}`}\r\n                >\r\n                  <span className=\"leading-none\" style={{ fontSize: reactionSize }}>\r\n                    {em}\r\n                  </span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div className=\"w-[92vw] max-w-[24rem] mx-auto bg-white rounded-2xl shadow-2xl border border-gray-200 p-1 animate-in fade-in zoom-in-95 duration-200\">\r\n          <div className=\"grid grid-cols-4 gap-1\">\r\n            {onReplyMessage && !isRecalled && (\r\n              <button\r\n                onClick={() => {\r\n                  onReplyMessage(msg);\r\n                  onClose();\r\n                }}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl  hover:bg-blue-50 active:scale-95 transition-all\"\r\n                aria-label=\"Trả lời tin nhắn\"\r\n                title=\"Trả lời tin nhắn\"\r\n              >\r\n                <FaRepeat size={24} color=\"#2563eb\" className=\"w-7 h-7\" />\r\n                <span className=\"text-[0.75rem] text-gray-800\">Trả lời</span>\r\n              </button>\r\n            )}\r\n\r\n            {!isRecalled && (\r\n              <button\r\n                onClick={() => {\r\n                  onShareMessage(msg);\r\n                  onClose();\r\n                }}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl  hover:bg-indigo-50 active:scale-95 transition-all\"\r\n                aria-label=\"Chia sẻ tin nhắn\"\r\n                title=\"Chia sẻ tin nhắn\"\r\n              >\r\n                <FaRegShareFromSquare className=\"w-7 h-7 text-blue-500\" />\r\n                <span className=\"text-[0.75rem] text-gray-800\">Chia sẻ</span>\r\n              </button>\r\n            )}\r\n            {canEdit && (\r\n              <button\r\n                onClick={() => {\r\n                  if (setEditingMessageId && setEditContent) {\r\n                    setEditingMessageId(String(msg._id));\r\n                    setEditContent(String(msg.content || ''));\r\n                  }\r\n                  (closeContextMenu || onClose)();\r\n                }}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl hover:bg-purple-50 active:scale-95 transition-all\"\r\n                aria-label=\"Chỉnh sửa tin nhắn\"\r\n                title=\"Chỉnh sửa tin nhắn\"\r\n              >\r\n                <FaRegPenToSquare className=\"w-7 h-7  \" />\r\n                <span className=\"text-[0.75rem] text-gray-800\">Chỉnh sửa</span>\r\n              </button>\r\n            )}\r\n\r\n            {canCopy && (\r\n              <button\r\n                onClick={handleCopy}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl hover:bg-green-50 active:scale-95 transition-all\"\r\n                aria-label=\"Sao chép nội dung\"\r\n                title=\"Sao chép nội dung\"\r\n              >\r\n                <FaCopy className=\"w-7 h-7 text-blue-500\" />\r\n                {/* <HiOutlineClipboardCopy className=\"text-green-600\" style={{ width: iconSize, height: iconSize }} /> */}\r\n                <span className=\"text-[0.75rem] text-gray-800\">Sao chép</span>\r\n              </button>\r\n            )}\r\n            {/* thư mục */}\r\n\r\n            {!isRecalled && (\r\n              <button\r\n                onClick={() => {\r\n                  onPinMessage(msg);\r\n                  onClose();\r\n                }}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl  hover:bg-amber-50 active:scale-95 transition-all\"\r\n                aria-label={isPinned ? 'Bỏ ghim' : 'Ghim'}\r\n                title={isPinned ? 'Bỏ ghim' : 'Ghim'}\r\n              >\r\n                <FaPaperclip className={`${isPinned ? 'text-amber-600' : 'text-red-600'}`} size={24} />\r\n                <span className=\"text-[0.75rem] text-gray-800\">{isPinned ? 'Bỏ ghim' : 'Ghim'}</span>\r\n              </button>\r\n            )}\r\n\r\n            {canDownload && (\r\n              <a\r\n                href={msg?.fileUrl}\r\n                download={msg?.fileName || 'file_chat'}\r\n                onClick={() => setTimeout(onClose, 100)}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl  hover:bg-teal-50 active:scale-95 transition-all\"\r\n                aria-label=\"Tải xuống\"\r\n                title=\"Tải xuống\"\r\n              >\r\n                <FaDownload className=\"w-7 h-7 text-blue-500 hover:text-blue-500 cursor-pointer\" />\r\n\r\n                <span className=\"text-[0.75rem] text-gray-800\">Tải xuống</span>\r\n              </a>\r\n            )}\r\n\r\n            {!isRecalled && (\r\n              <button\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl  hover:bg-orange-50 active:scale-95 transition-all\"\r\n                aria-label=\"Lưu vào thư mục\"\r\n                title=\"Lưu vào thư mục\"\r\n              >\r\n                <FaFolderOpen className=\"w-7 h-7 text-orange-300 hover:text-orange-500 cursor-pointer\" />\r\n\r\n                <span className=\"text-[0.75rem] text-gray-800\">Thư mục</span>\r\n              </button>\r\n            )}\r\n\r\n            {canRecall && (\r\n              <button\r\n                onClick={() => {\r\n                  onRecallMessage(String(msg?._id));\r\n                  onClose();\r\n                }}\r\n                className=\"flex flex-col items-center justify-center gap-1 p-1 rounded-xl  hover:bg-red-50 active:scale-95 transition-all\"\r\n                aria-label=\"Thu hồi tin nhắn\"\r\n                title=\"Thu hồi tin nhắn\"\r\n              >\r\n                <FaTrashCan className=\"w-7 h-7 text-red-600\" />\r\n                <span className=\"text-[0.75rem] text-gray-800\">Thu hồi</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AACpD;AAGA;AAEA;AACA;AAUA;AAEA;;;;;;;;;AA2Be,SAAS,yBAAyB,EAC/C,WAAW,EACX,aAAa,EACb,OAAO,EACP,YAAY,EACZ,eAAe,EACf,cAAc,EACd,cAAc,EACd,gBAAgB,EAChB,mBAAmB,EACnB,cAAc,EACd,gBAAgB,EAChB,WAAW,EAAE,EACb,eAAe,EAAE,EACa;;IAC9B,MAAM,YAAY,IAAA,uKAAM,EAAgB;IACxC,MAAM,WAAW,IAAA,uKAAM,EAAC;IACxB,MAAM,WAAW,aAAa,YAAY;IAC1C,MAAM,cAAc,aAAa,eAAe;IAEhD,MAAM,YAAY,CAAC,CAAC,aAAa;IACjC,MAAM,MAAM,aAAa;IACzB,MAAM,IAAI,aAAa,KAAK;IAC5B,MAAM,IAAI,aAAa,KAAK;IAC5B,MAAM,YAAY,aAAa,aAAa;IAE5C,MAAM,cAAc,CAAC;QACnB,IAAI;YACF,IAAI,CAAC,GAAG,OAAO;YACf,IAAI,OAAO,MAAM,UAAU,OAAO,OAAO;YACzC,MAAM,MAAM;YACZ,MAAM,MAAM,OAAQ,GAAG,CAAC,MAAM;YAC9B,MAAM,MAAM,OAAQ,GAAG,CAAC,KAAK;YAC7B,IAAI,OAAO,MAAM,OAAO,OAAO;YAC/B,IAAI,OAAO,MAAM,OAAO,OAAO;QACjC,EAAE,OAAM,CAAC;QACT,OAAO;IACT;IAEA,MAAM,OAAO,IAAA,wKAAO;kDAAC;YACnB,MAAM,KAAK,YAAY,KAAK;YAC5B,OAAO,OAAO,OAAO;QACvB;iDAAG;QAAC;QAAK;KAAc;IAEvB,MAAM,SAAS,KAAK,SAAS;IAC7B,MAAM,aAAa,CAAC,CAAC,KAAK;IAC1B,MAAM,UAAU,UAAU,CAAC;IAC3B,MAAM,cACJ,CAAC,CAAC,KAAK,WACP,CAAC,KAAK,SAAS,WAAW,KAAK,SAAS,UAAU,KAAK,SAAS,aAAa,KAAK,SAAS,OAAO;IACpG,MAAM,YAAY,QAAQ,CAAC;IAC3B,MAAM,WAAW,CAAC,CAAC,KAAK;IACxB,MAAM,UAAU,QAAQ,UAAU,CAAC;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAkC;IAE5E,IAAA,0KAAS;8CAAC;YACR,IAAI,CAAC,WAAW;YAChB,MAAM,OAAO,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;YACzC,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;YAC/B,MAAM;8DAAU,CAAC;oBACf,EAAE,cAAc;gBAClB;;YACA,SAAS,gBAAgB,CAAC,aAAa,SAAS;gBAAE,SAAS;YAAM;YACjE;sDAAO;oBACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;oBAC/B,SAAS,mBAAmB,CAAC,aAAa;gBAC5C;;QACF;6CAAG;QAAC;KAAU;IAEd,IAAA,0KAAS;8CAAC;YACR,aAAa;QACf;6CAAG;QAAC,KAAK;QAAS,KAAK;KAAK;IAE5B,IAAA,0KAAS;8CAAC;YACR,IAAI,CAAC,WAAW;YAChB,IAAI,KAAK,SAAS,WAAW,CAAC,KAAK,SAAS;YAC5C,IAAI;gBACF,MAAM,MAAM,SAAS,aAAa,CAAC;gBACnC,IAAI,GAAG,GAAG,IAAA,uIAAW,EAAC,IAAI,OAAO;gBACjC,IAAI,QAAQ,GAAG;gBACf,IAAI,MAAM;0DAAG;wBACX,MAAM,OAAO,IAAI,YAAY,IAAI;wBACjC,MAAM,OAAO,IAAI,aAAa,IAAI;wBAClC,IAAI,OAAO,KAAK,OAAO,GAAG;4BACxB,MAAM,YAAY,uCAAgC,OAAO,UAAU,GAAG;4BACtE,MAAM,YAAY,uCAAgC,OAAO,WAAW,GAAG;4BACvE,MAAM,UAAU,OAAO,gBAAgB,WAAW,cAAc,KAAK,KAAK,CAAC,YAAY;4BACvF,MAAM,SAAS,KAAK,KAAK,CAAC,AAAC,OAAO,UAAW;4BAC7C,MAAM,OAAO,KAAK,KAAK,CAAC,YAAY;4BACpC,MAAM,OAAO;4BACb,MAAM,IAAI,KAAK,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,QAAQ;4BAC1C,aAAa;gCAAE;gCAAG,GAAG;4BAAQ;wBAC/B;oBACF;;YACF,EAAE,OAAM,CAAC;QACX;6CAAG;QAAC;QAAW,KAAK;QAAM,KAAK;QAAS;KAAY;IAEpD,MAAM,aAAa;QACjB,MAAM,OAAO,KAAK,WAAW;QAC7B,IAAI,CAAC,MAAM;QACX,IAAI;YACF,MAAM,YAAY;YAClB,IAAI,UAAU,SAAS,IAAI,UAAU,eAAe,EAAE;gBACpD,MAAM,UAAU,SAAS,CAAC,SAAS,CAAC;gBACpC;gBACA;YACF;QACF,EAAE,OAAM,CAAC;QACT,IAAI;YACF,MAAM,KAAK,SAAS,aAAa,CAAC;YAClC,GAAG,KAAK,GAAG;YACX,GAAG,YAAY,CAAC,YAAY;YAC5B,GAAG,KAAK,CAAC,QAAQ,GAAG;YACpB,GAAG,KAAK,CAAC,GAAG,GAAG;YACf,GAAG,KAAK,CAAC,IAAI,GAAG;YAChB,GAAG,KAAK,CAAC,OAAO,GAAG;YACnB,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,GAAG,KAAK;YACR,GAAG,MAAM;YACT,MAAM,KAAK,SAAS,WAAW,CAAC;YAChC,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,IAAI,IAAI;QACV,EAAE,OAAM,CAAC;IACX;IAEA,IAAI,CAAC,aAAa,CAAC,KAAK,OAAO;IAE/B,MAAM,aAAkC;QACtC,KAAK;QACL,MAAM;QACN,WAAW;IACb;IAEA,qBACE,6LAAC;QAAI,WAAU;QAAyB,eAAe,CAAC,IAAM,EAAE,cAAc;;0BAC5E,6LAAC;gBACC,WAAU;gBACV,SAAS;gBACT,cAAc,CAAC;oBACb,MAAM,IAAI,EAAE,OAAO,CAAC,EAAE;oBACtB,UAAU,OAAO,GAAG,EAAE,OAAO;oBAC7B,SAAS,OAAO,GAAG;gBACrB;gBACA,aAAa,CAAC;oBACZ,MAAM,IAAI,EAAE,OAAO,CAAC,EAAE;oBACtB,MAAM,IAAI,UAAU,OAAO,IAAI,EAAE,OAAO;oBACxC,IAAI,KAAK,GAAG,CAAC,EAAE,OAAO,GAAG,KAAK,GAAG,SAAS,OAAO,GAAG;gBACtD;gBACA,YAAY,CAAC;oBACX,MAAM,IAAI,EAAE,cAAc,CAAC,EAAE;oBAC7B,MAAM,IAAI,UAAU,OAAO,IAAI,EAAE,OAAO;oBACxC,MAAM,KAAK,EAAE,OAAO,GAAG;oBACvB,IAAI,KAAK,IAAI;gBACf;;;;;;YAGD,IAAI,IAAI,KAAK,UAAU,OAAO,aAAa,0BAC1C,6LAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,KAAK;gBAAS;0BAEvB,cAAA,6LAAC;oBACC,WAAW,CAAC,sCAAsC,EAChD,OAAO,iCAAiC,2BACzC,0CAA0C,CAAC;oBAC5C,OAAO;wBAAE,WAAW,cAAc,GAAG,YAAY,EAAE,CAAC,GAAG;wBAAQ,UAAU;oBAAS;;sCAElF,6LAAC;4BAAI,WAAU;sCAAmC,IAAI,OAAO,IAAI;;;;;;sCACjE,6LAAC;4BAAI,WAAU;;;;;;;;;;;;;;;;;YAIpB,IAAI,IAAI,KAAK,WACZ,IAAI,OAAO,IACX,OAAO,aAAa,YACpB,CAAC;gBACC,MAAM,YAAY,uCAAgC,OAAO,UAAU,GAAG;gBACtE,MAAM,YAAY,KAAK,KAAK,CAAC,YAAY;gBACzC,MAAM,SAAS,WAAW,KAAK;gBAC/B,MAAM,kBAAuC;oBAAE,OAAO;gBAAO;gBAC7D,qBACE,6LAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,KAAK;wBAAU,GAAG,eAAe;oBAAC;8BAE3C,cAAA,6LAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,QAAQ,cAAc,GAAG,YAAY,EAAE,CAAC,GAAG;wBAAO;kCAE3D,cAAA,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,2IAAK;gCAAC,KAAK,IAAA,uIAAW,EAAC,IAAI,OAAO;gCAAG,KAAK,IAAI,QAAQ,IAAI;gCAAO,IAAI;gCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;YAK3F,CAAC;YACF,IAAI,IAAI,KAAK,WAAW,IAAI,OAAO,IAAI,OAAO,aAAa,0BAC1D,6LAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,KAAK;gBAAS;0BAEvB,cAAA,6LAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,WAAW,cAAc,GAAG,YAAY,EAAE,CAAC,GAAG;wBAAQ,UAAU;oBAAS;8BAElF,cAAA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,KAAK,IAAA,uIAAW,EAAC,IAAI,OAAO;gCAC5B,WAAU;gCACV,OAAO;oCAAE,WAAW;gCAAO;gCAC3B,WAAW;gCACX,SAAQ;;;;;;0CAEV,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC,4JAAM;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAO7B,IAAI,IAAI,KAAK,UAAU,IAAI,OAAO,IAAI,OAAO,aAAa,0BACzD,6LAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,KAAK;gBAAS;0BAEvB,cAAA,6LAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,WAAW;wBAAQ,UAAU;oBAAS;8BAE/C,cAAA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,sKAAiB;oCAAC,WAAU;;;;;;;;;;;0CAE/B,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAE,WAAU;kDAAgD,IAAI,QAAQ,IAAI;;;;;;kDAC7E,6LAAC;wCAAE,WAAU;kDAAiC;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAMxD,6LAAC;gBACC,WAAW,CAAC,mBAAmB,EAAE,cAAc,UAAU,gBAAgB,WAAW,CAAC,EAAE,cAAc,UAAU,KAAK,IAAI;gBACxH,qBAAkB;gBAClB,OAAO;gBACP,aAAa,CAAC;oBACZ,EAAE,eAAe;gBACnB;gBACA,SAAS,CAAC;oBACR,EAAE,eAAe;gBACnB;gBACA,cAAc,CAAC;oBACb,EAAE,eAAe;gBACnB;;oBAEC,CAAC,cAAc,OAAO,qBAAqB,4BAC1C,6LAAC;wBACC,WAAU;wBACV,aAAa,CAAC,IAAM,EAAE,eAAe;wBACrC,SAAS,CAAC,IAAM,EAAE,eAAe;wBACjC,cAAc,CAAC,IAAM,EAAE,eAAe;kCAEtC,cAAA,6LAAC;4BAAI,WAAU;sCACZ;gCAAC;gCAAM;gCAAM;gCAAM;gCAAM;gCAAM;6BAAK,CAAC,GAAG,CAAC,CAAC,mBACzC,6LAAC;oCAEC,SAAS;wCACP,mBAAmB,KAAK;wCACxB;oCACF;oCACA,cAAY,CAAC,SAAS,EAAE,IAAI;oCAC5B,OAAO,CAAC,SAAS,EAAE,IAAI;8CAEvB,cAAA,6LAAC;wCAAK,WAAU;wCAAe,OAAO;4CAAE,UAAU;wCAAa;kDAC5D;;;;;;mCATE;;;;;;;;;;;;;;;kCAgBf,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;;gCACZ,kBAAkB,CAAC,4BAClB,6LAAC;oCACC,SAAS;wCACP,eAAe;wCACf;oCACF;oCACA,WAAU;oCACV,cAAW;oCACX,OAAM;;sDAEN,6LAAC,8JAAQ;4CAAC,MAAM;4CAAI,OAAM;4CAAU,WAAU;;;;;;sDAC9C,6LAAC;4CAAK,WAAU;sDAA+B;;;;;;;;;;;;gCAIlD,CAAC,4BACA,6LAAC;oCACC,SAAS;wCACP,eAAe;wCACf;oCACF;oCACA,WAAU;oCACV,cAAW;oCACX,OAAM;;sDAEN,6LAAC,0KAAoB;4CAAC,WAAU;;;;;;sDAChC,6LAAC;4CAAK,WAAU;sDAA+B;;;;;;;;;;;;gCAGlD,yBACC,6LAAC;oCACC,SAAS;wCACP,IAAI,uBAAuB,gBAAgB;4CACzC,oBAAoB,OAAO,IAAI,GAAG;4CAClC,eAAe,OAAO,IAAI,OAAO,IAAI;wCACvC;wCACA,CAAC,oBAAoB,OAAO;oCAC9B;oCACA,WAAU;oCACV,cAAW;oCACX,OAAM;;sDAEN,6LAAC,sKAAgB;4CAAC,WAAU;;;;;;sDAC5B,6LAAC;4CAAK,WAAU;sDAA+B;;;;;;;;;;;;gCAIlD,yBACC,6LAAC;oCACC,SAAS;oCACT,WAAU;oCACV,cAAW;oCACX,OAAM;;sDAEN,6LAAC,4JAAM;4CAAC,WAAU;;;;;;sDAElB,6LAAC;4CAAK,WAAU;sDAA+B;;;;;;;;;;;;gCAKlD,CAAC,4BACA,6LAAC;oCACC,SAAS;wCACP,aAAa;wCACb;oCACF;oCACA,WAAU;oCACV,cAAY,WAAW,YAAY;oCACnC,OAAO,WAAW,YAAY;;sDAE9B,6LAAC,iKAAW;4CAAC,WAAW,GAAG,WAAW,mBAAmB,gBAAgB;4CAAE,MAAM;;;;;;sDACjF,6LAAC;4CAAK,WAAU;sDAAgC,WAAW,YAAY;;;;;;;;;;;;gCAI1E,6BACC,6LAAC;oCACC,MAAM,KAAK;oCACX,UAAU,KAAK,YAAY;oCAC3B,SAAS,IAAM,WAAW,SAAS;oCACnC,WAAU;oCACV,cAAW;oCACX,OAAM;;sDAEN,6LAAC,gKAAU;4CAAC,WAAU;;;;;;sDAEtB,6LAAC;4CAAK,WAAU;sDAA+B;;;;;;;;;;;;gCAIlD,CAAC,4BACA,6LAAC;oCACC,WAAU;oCACV,cAAW;oCACX,OAAM;;sDAEN,6LAAC,kKAAY;4CAAC,WAAU;;;;;;sDAExB,6LAAC;4CAAK,WAAU;sDAA+B;;;;;;;;;;;;gCAIlD,2BACC,6LAAC;oCACC,SAAS;wCACP,gBAAgB,OAAO,KAAK;wCAC5B;oCACF;oCACA,WAAU;oCACV,cAAW;oCACX,OAAM;;sDAEN,6LAAC,gKAAU;4CAAC,WAAU;;;;;;sDACtB,6LAAC;4CAAK,WAAU;sDAA+B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ/D;GAvZwB;KAAA"}}]
}