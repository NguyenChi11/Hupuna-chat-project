{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/utils/cookie.ts"],"sourcesContent":["// utils/cookieHelper.ts\r\n\r\ntype CookieOptions = {\r\n  path?: string;\r\n  domain?: string;\r\n  maxAge?: number;\r\n  expires?: Date;\r\n  secure?: boolean;\r\n  sameSite?: 'lax' | 'strict' | 'none';\r\n};\r\n\r\nfunction setCookie(key: string, value: string, options: CookieOptions = {}) {\r\n  if (typeof document === 'undefined') return;\r\n  const parts: string[] = [`${encodeURIComponent(key)}=${encodeURIComponent(value)}`];\r\n  const path = options.path ?? '/';\r\n  if (path) parts.push(`Path=${path}`);\r\n  if (options.domain) parts.push(`Domain=${options.domain}`);\r\n  if (typeof options.maxAge === 'number') parts.push(`Max-Age=${Math.max(0, options.maxAge)}`);\r\n  else if (options.expires) parts.push(`Expires=${options.expires.toUTCString()}`);\r\n  if (options.secure) parts.push('Secure');\r\n  if (options.sameSite) parts.push(`SameSite=${options.sameSite}`);\r\n  document.cookie = parts.join('; ');\r\n}\r\n\r\nfunction getCookie(key: string): string | null {\r\n  if (typeof document === 'undefined') return null;\r\n  const name = `${encodeURIComponent(key)}=`;\r\n  const cookies = document.cookie ? document.cookie.split('; ') : [];\r\n  for (const c of cookies) {\r\n    if (c.startsWith(name)) return decodeURIComponent(c.slice(name.length));\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction deleteCookie(key: string, options: CookieOptions = {}) {\r\n  setCookie(key, '', { ...options, maxAge: 0 });\r\n}\r\n\r\nconst COOKIE_OPTIONS = {\r\n  path: '/',\r\n  maxAge: 60 * 60 * 24 * 30, // 30 ngày\r\n};\r\n\r\n// Generic base\r\nexport const cookieBase = {\r\n  set<T>(key: string, value: T): void {\r\n    setCookie(key, JSON.stringify(value), COOKIE_OPTIONS);\r\n  },\r\n\r\n  get<T>(key: string): T | null {\r\n    const cookie = getCookie(key);\r\n    if (!cookie) return null;\r\n    try {\r\n      return JSON.parse(cookie as string) as T;\r\n    } catch {\r\n      return null;\r\n    }\r\n  },\r\n\r\n  remove(key: string): void {\r\n    deleteCookie(key, { path: '/' });\r\n  },\r\n};\r\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;AAWxB,SAAS,UAAU,GAAW,EAAE,KAAa,EAAE,UAAyB,CAAC,CAAC;IACxE,IAAI,OAAO,aAAa,aAAa;IACrC,MAAM,QAAkB;QAAC,GAAG,mBAAmB,KAAK,CAAC,EAAE,mBAAmB,QAAQ;KAAC;IACnF,MAAM,OAAO,QAAQ,IAAI,IAAI;IAC7B,IAAI,MAAM,MAAM,IAAI,CAAC,CAAC,KAAK,EAAE,MAAM;IACnC,IAAI,QAAQ,MAAM,EAAE,MAAM,IAAI,CAAC,CAAC,OAAO,EAAE,QAAQ,MAAM,EAAE;IACzD,IAAI,OAAO,QAAQ,MAAM,KAAK,UAAU,MAAM,IAAI,CAAC,CAAC,QAAQ,EAAE,KAAK,GAAG,CAAC,GAAG,QAAQ,MAAM,GAAG;SACtF,IAAI,QAAQ,OAAO,EAAE,MAAM,IAAI,CAAC,CAAC,QAAQ,EAAE,QAAQ,OAAO,CAAC,WAAW,IAAI;IAC/E,IAAI,QAAQ,MAAM,EAAE,MAAM,IAAI,CAAC;IAC/B,IAAI,QAAQ,QAAQ,EAAE,MAAM,IAAI,CAAC,CAAC,SAAS,EAAE,QAAQ,QAAQ,EAAE;IAC/D,SAAS,MAAM,GAAG,MAAM,IAAI,CAAC;AAC/B;AAEA,SAAS,UAAU,GAAW;IAC5B,IAAI,OAAO,aAAa,aAAa,OAAO;IAC5C,MAAM,OAAO,GAAG,mBAAmB,KAAK,CAAC,CAAC;IAC1C,MAAM,UAAU,SAAS,MAAM,GAAG,SAAS,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE;IAClE,KAAK,MAAM,KAAK,QAAS;QACvB,IAAI,EAAE,UAAU,CAAC,OAAO,OAAO,mBAAmB,EAAE,KAAK,CAAC,KAAK,MAAM;IACvE;IACA,OAAO;AACT;AAEA,SAAS,aAAa,GAAW,EAAE,UAAyB,CAAC,CAAC;IAC5D,UAAU,KAAK,IAAI;QAAE,GAAG,OAAO;QAAE,QAAQ;IAAE;AAC7C;AAEA,MAAM,iBAAiB;IACrB,MAAM;IACN,QAAQ,KAAK,KAAK,KAAK;AACzB;AAGO,MAAM,aAAa;IACxB,KAAO,GAAW,EAAE,KAAQ;QAC1B,UAAU,KAAK,KAAK,SAAS,CAAC,QAAQ;IACxC;IAEA,KAAO,GAAW;QAChB,MAAM,SAAS,UAAU;QACzB,IAAI,CAAC,QAAQ,OAAO;QACpB,IAAI;YACF,OAAO,KAAK,KAAK,CAAC;QACpB,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,QAAO,GAAW;QAChB,aAAa,KAAK;YAAE,MAAM;QAAI;IAChC;AACF"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/utils/utils.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nexport const getProxyUrl = (url?: string, download?: boolean) => {\r\n  if (!url) return '';\r\n\r\n  // Các link khác (S3, Firebase, External, PocketBase...) -> Giữ nguyên\r\n  return url;\r\n};\r\n\r\n// 2. Helper check video (đặt ngoài component)\r\nexport const isVideoFile = (fileName?: string) => {\r\n  if (!fileName) return false;\r\n  const videoExtensions = ['mp4', 'mov', 'avi', 'mkv', 'webm', 'flv'];\r\n  const ext = fileName.split('.').pop()?.toLowerCase();\r\n  return videoExtensions.includes(ext || '');\r\n};\r\n\r\nexport const isLink = (str: string | undefined): boolean => {\r\n  const pattern = new RegExp(\r\n    '^(https?:\\\\/\\\\/)?' + // protocol\r\n      '(' + // Bắt đầu nhóm Hostname\r\n      'localhost|' + // ✅ THÊM DÒNG NÀY: Chấp nhận localhost\r\n      '((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,})|' + // domain name (google.com)\r\n      '((\\\\d{1,3}\\\\.){3}\\\\d{1,3})' + // OR ip (127.0.0.1)\r\n      ')' + // Kết thúc nhóm Hostname\r\n      '(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*' + // port and path\r\n      '(\\\\?[;&a-z\\\\d%_.~+=-]*)?' + // query string\r\n      '(\\\\#[-a-z\\\\d_]*)?$', // fragment locator\r\n    'i',\r\n  );\r\n  return !!pattern.test(str || '');\r\n};\r\n\r\nexport const resolveSocketUrl = (): string => {\r\n  const envUrl = (process.env.NEXT_PUBLIC_SOCKET_URL || '').trim();\r\n  const envPort = (process.env.NEXT_PUBLIC_SOCKET_PORT || '').trim();\r\n\r\n  if (typeof window === 'undefined') return envUrl || '';\r\n\r\n  const host = window.location.hostname;\r\n  const protocol = window.location.protocol;\r\n  const isSecure = protocol === 'https:';\r\n\r\n  // 1. Ưu tiên URL từ biến môi trường\r\n  if (envUrl) {\r\n    let finalUrl = envUrl;\r\n    // Nếu URL chứa localhost/127.0.0.1 -> thay bằng hostname hiện tại\r\n    if (finalUrl.includes('localhost') || finalUrl.includes('127.0.0.1')) {\r\n      finalUrl = finalUrl.replace('localhost', host).replace('127.0.0.1', host);\r\n    }\r\n\r\n    // Nếu đã có protocol\r\n    if (finalUrl.match(/^(ws|wss|http|https):\\/\\//)) {\r\n      // Nếu đang ở HTTPS, bắt buộc dùng WSS/HTTPS để tránh Mixed Content\r\n      if (isSecure) {\r\n        return finalUrl.replace(/^http:/, 'https:').replace(/^ws:/, 'wss:');\r\n      }\r\n      return finalUrl;\r\n    }\r\n\r\n    // Nếu chưa có protocol\r\n    const proto = isSecure ? 'https:' : 'http:';\r\n    return `${proto}//${finalUrl}`;\r\n  } else if (process.env.NODE_ENV === 'production') {\r\n    console.warn('⚠️ WARNING: NEXT_PUBLIC_SOCKET_URL is not defined. Socket connection may fail if the fallback logic is incorrect for your deployment.');\r\n  }\r\n\r\n  // 2. Logic fallback (tự động đoán)\r\n  const port = envPort || '3002';\r\n\r\n  // Localhost / Dev -> Luôn dùng http + port\r\n  if (host === 'localhost' || host === '127.0.0.1') {\r\n    return `http://${host}:${port}`;\r\n  }\r\n\r\n  // Production (HTTPS)\r\n  if (isSecure) {\r\n    // Nếu không set port cụ thể trong ENV, ta giả định dùng port 443 (qua Nginx proxy)\r\n    // để tránh lỗi Mixed Content (wss://...:3002 yêu cầu SSL trên port 3002)\r\n    if (!envPort) {\r\n      return `https://${host}`;\r\n    }\r\n    // Nếu có set port, dùng port đó với https (wss)\r\n    return `https://${host}:${port}`;\r\n  }\r\n\r\n  // Production (HTTP) hoặc IP LAN\r\n  return `${protocol}//${host}:${port}`;\r\n};\r\n\r\nexport const normalizeNoAccent = (str: string): string => {\r\n  return str\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/đ/g, 'd')\r\n    .replace(/Đ/g, 'D')\r\n    .toLowerCase();\r\n};\r\n\r\nconst normalizeNoAccentKeepDHook = (str: string): string => {\r\n  return String(str || '')\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .normalize('NFC')\r\n    .toLowerCase();\r\n};\r\n\r\nexport const buildAccentInsensitiveRegex = (term: string): RegExp => {\r\n  const escape = (ch: string) => ch.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n  const parts: string[] = [];\r\n  for (const ch of term) {\r\n    if (/\\s/.test(ch)) {\r\n      parts.push('\\\\s+');\r\n    } else if (/[A-Za-z]/.test(ch)) {\r\n      if (ch.toLowerCase() === 'd') {\r\n        parts.push('(?:[dđ][\\\\u0300-\\\\u036f]*)');\r\n      } else {\r\n        parts.push(`(?:${escape(ch)}[\\\\u0300-\\\\u036f]*)`);\r\n      }\r\n    } else {\r\n      parts.push(escape(ch));\r\n    }\r\n  }\r\n  const pattern = parts.join('');\r\n  return new RegExp(`(${pattern})`, 'giu');\r\n};\r\n\r\nexport const hasDiacritics = (str: string): boolean => {\r\n  const s = String(str || '');\r\n  const sNFD = s.normalize('NFD');\r\n  if (/[\\u0300-\\u036f]/.test(sNFD)) return true;\r\n  return /[đĐ]/.test(s);\r\n};\r\n\r\nexport const computeMatchScore = (text: string, term: string): number => {\r\n  const escape = (v: string) => v.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n  const txt = String(text || '').toLowerCase();\r\n  const q = String(term || '').toLowerCase();\r\n  const nTxt = normalizeNoAccent(txt);\r\n  const nQ = normalizeNoAccent(q);\r\n  if (!nTxt.includes(nQ)) return -Infinity;\r\n\r\n  const qHasDia = hasDiacritics(q);\r\n  const exactIdx = txt.indexOf(q);\r\n  const normIdx = nTxt.indexOf(nQ);\r\n  const wordExact = new RegExp(`(^|\\\\b)${escape(q)}`, 'i').test(txt);\r\n  const wordNorm = new RegExp(`(^|\\\\b)${escape(nQ)}`, 'i').test(nTxt);\r\n\r\n  let score = 0;\r\n  if (exactIdx >= 0) {\r\n    score += 50;\r\n    if (qHasDia) score += 30;\r\n    if (exactIdx === 0) score += 20;\r\n    if (wordExact) score += 10;\r\n    score += Math.max(0, 10 - exactIdx);\r\n  } else {\r\n    score += 20;\r\n    if (normIdx === 0) score += 10;\r\n    if (wordNorm) score += 5;\r\n    score += Math.max(0, 5 - normIdx);\r\n  }\r\n  const lengthBoost = Math.min(10, Math.floor((nQ.length / Math.max(1, nTxt.length)) * 10));\r\n  score += lengthBoost;\r\n  return score;\r\n};\r\n\r\nconst hasToneMarks = (str: string): boolean => {\r\n  const s = String(str || '').normalize('NFD');\r\n  return /[\\u0300\\u0301\\u0303\\u0309\\u0323]/.test(s);\r\n};\r\n\r\nconst stripToneMarks = (str: string): string => {\r\n  return String(str || '')\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300\\u0301\\u0303\\u0309\\u0323]/g, '')\r\n    .normalize('NFC')\r\n    .toLowerCase();\r\n};\r\n\r\nconst stripBaseMarks = (str: string): string => {\r\n  return String(str || '')\r\n    .normalize('NFD')\r\n    .replace(/[\\u0302\\u0306\\u031B]/g, '')\r\n    .normalize('NFC')\r\n    .toLowerCase();\r\n};\r\n\r\nexport const accentAwareIncludes = (text: string, keyword: string): boolean => {\r\n  const t = String(text || '');\r\n  const k = String(keyword || '');\r\n  if (!k.trim()) return true;\r\n  const tNFC = t.normalize('NFC');\r\n  const kNFC = k.normalize('NFC');\r\n  const kHasDia = hasDiacritics(kNFC);\r\n  if (kHasDia) {\r\n    if (hasToneMarks(kNFC)) {\r\n      const tBase = stripBaseMarks(tNFC);\r\n      const kBase = stripBaseMarks(kNFC);\r\n      return tBase.includes(kBase);\r\n    }\r\n    const tNoTone = stripToneMarks(tNFC);\r\n    const kNoTone = stripToneMarks(kNFC);\r\n    const tNoAccent = normalizeNoAccentKeepDHook(tNoTone);\r\n    const kNoAccent = normalizeNoAccentKeepDHook(kNoTone);\r\n    return tNoAccent.includes(kNoAccent);\r\n  }\r\n  const tNo = normalizeNoAccentKeepDHook(tNFC);\r\n  const kNo = normalizeNoAccentKeepDHook(kNFC);\r\n  return tNo.includes(kNo);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/CropImageModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Cropper, CropperRef, CircleStencil, RectangleStencil, ImageRestriction } from 'react-advanced-cropper';\r\nimport 'react-advanced-cropper/dist/style.css';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  src: string | null;\r\n  onClose: () => void;\r\n  onConfirm: (file: File) => void;\r\n  aspectRatio?: number;\r\n  circle?: boolean;\r\n  fileName?: string;\r\n  outputType?: 'image/jpeg' | 'image/png' | 'image/webp';\r\n  quality?: number;\r\n};\r\n\r\nexport default function CropImageModal({\r\n  open,\r\n  src,\r\n  onClose,\r\n  onConfirm,\r\n  aspectRatio = 1,\r\n  circle = false,\r\n  fileName = 'cropped.jpg',\r\n  outputType = 'image/jpeg',\r\n  quality = 0.92,\r\n}: Props) {\r\n  const cropperRef = useRef<CropperRef>(null);\r\n  const [ready, setReady] = useState(false);\r\n\r\n  const stencil = useMemo(() => (circle ? CircleStencil : RectangleStencil), [circle]);\r\n\r\n  useEffect(() => {\r\n    if (!open) setReady(false);\r\n  }, [open]);\r\n\r\n  const handleZoom = (delta: number) => {\r\n    try {\r\n      const factor = 1 + delta;\r\n      cropperRef.current?.zoomImage(factor, { transitions: true });\r\n    } catch {}\r\n  };\r\n\r\n  const handleConfirm = async () => {\r\n    const canvas = cropperRef.current?.getCanvas();\r\n    if (!canvas) return;\r\n    canvas.toBlob(\r\n      (blob: Blob | null) => {\r\n        if (!blob) return;\r\n        const ext = outputType === 'image/png' ? 'png' : outputType === 'image/webp' ? 'webp' : 'jpg';\r\n        const safeName = fileName?.trim() ? fileName : `cropped.${ext}`;\r\n        const file = new File([blob], safeName, { type: outputType });\r\n        onConfirm(file);\r\n      },\r\n      outputType,\r\n      quality,\r\n    );\r\n  };\r\n\r\n  if (!open) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[1000] bg-black/70 backdrop-blur-sm flex items-center justify-center\">\r\n      <div className=\"bg-white rounded-xl shadow-2xl w-[90vw] max-w-[800px]\">\r\n        <div className=\"px-4 py-3 border-b flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-semibold\">Điều chỉnh ảnh</h3>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-colors\"\r\n            aria-label=\"Close\"\r\n          >\r\n            <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-4\">\r\n          <div className=\"relative w-full h-[50vh] min-h-[320px] bg-gray-50 rounded-lg overflow-hidden\">\r\n            {src ? (\r\n              <Cropper\r\n                ref={cropperRef}\r\n                src={src}\r\n                className=\"w-full h-full\"\r\n                stencilComponent={stencil}\r\n                stencilProps={{ aspectRatio, movable: true, resizable: true }}\r\n                imageRestriction={ImageRestriction.fitArea}\r\n                onReady={() => setReady(true)}\r\n                defaultSize={({ imageSize }) => ({\r\n                  width: Math.min(imageSize.width, 800),\r\n                  height: Math.min(imageSize.height, 600),\r\n                })}\r\n              />\r\n            ) : (\r\n              <div className=\"w-full h-full flex items-center justify-center text-gray-500\">Không có ảnh</div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"mt-4 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => handleZoom(-0.1)}\r\n                className=\"px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 text-gray-700\"\r\n              >\r\n                Thu nhỏ\r\n              </button>\r\n              <button\r\n                onClick={() => handleZoom(0.1)}\r\n                className=\"px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 text-gray-700\"\r\n              >\r\n                Phóng to\r\n              </button>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button onClick={onClose} className=\"px-4 py-2 rounded bg-gray-100 hover:bg-gray-200 text-gray-700\">\r\n                Hủy\r\n              </button>\r\n              <button\r\n                onClick={handleConfirm}\r\n                disabled={!ready}\r\n                className=\"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60\"\r\n              >\r\n                Lưu\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;;;AAHA;;;;AAkBe,SAAS,eAAe,EACrC,IAAI,EACJ,GAAG,EACH,OAAO,EACP,SAAS,EACT,cAAc,CAAC,EACf,SAAS,KAAK,EACd,WAAW,aAAa,EACxB,aAAa,YAAY,EACzB,UAAU,IAAI,EACR;;IACN,MAAM,aAAa,IAAA,uKAAM,EAAa;IACtC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IAEnC,MAAM,UAAU,IAAA,wKAAO;2CAAC,IAAO,SAAS,mNAAa,GAAG,sNAAgB;0CAAG;QAAC;KAAO;IAEnF,IAAA,0KAAS;oCAAC;YACR,IAAI,CAAC,MAAM,SAAS;QACtB;mCAAG;QAAC;KAAK;IAET,MAAM,aAAa,CAAC;QAClB,IAAI;YACF,MAAM,SAAS,IAAI;YACnB,WAAW,OAAO,EAAE,UAAU,QAAQ;gBAAE,aAAa;YAAK;QAC5D,EAAE,OAAM,CAAC;IACX;IAEA,MAAM,gBAAgB;QACpB,MAAM,SAAS,WAAW,OAAO,EAAE;QACnC,IAAI,CAAC,QAAQ;QACb,OAAO,MAAM,CACX,CAAC;YACC,IAAI,CAAC,MAAM;YACX,MAAM,MAAM,eAAe,cAAc,QAAQ,eAAe,eAAe,SAAS;YACxF,MAAM,WAAW,UAAU,SAAS,WAAW,CAAC,QAAQ,EAAE,KAAK;YAC/D,MAAM,OAAO,IAAI,KAAK;gBAAC;aAAK,EAAE,UAAU;gBAAE,MAAM;YAAW;YAC3D,UAAU;QACZ,GACA,YACA;IAEJ;IAEA,IAAI,CAAC,MAAM,OAAO;IAElB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAwB;;;;;;sCACtC,6LAAC;4BACC,SAAS;4BACT,WAAU;4BACV,cAAW;sCAEX,cAAA,6LAAC;gCAAI,WAAU;gCAAU,SAAQ;gCAAY,MAAK;gCAAO,QAAO;0CAC9D,cAAA,6LAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa;oCAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;8BAK3E,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;sCACZ,oBACC,6LAAC,6MAAO;gCACN,KAAK;gCACL,KAAK;gCACL,WAAU;gCACV,kBAAkB;gCAClB,cAAc;oCAAE;oCAAa,SAAS;oCAAM,WAAW;gCAAK;gCAC5D,kBAAkB,4KAAgB,CAAC,OAAO;gCAC1C,SAAS,IAAM,SAAS;gCACxB,aAAa,CAAC,EAAE,SAAS,EAAE,GAAK,CAAC;wCAC/B,OAAO,KAAK,GAAG,CAAC,UAAU,KAAK,EAAE;wCACjC,QAAQ,KAAK,GAAG,CAAC,UAAU,MAAM,EAAE;oCACrC,CAAC;;;;;qDAGH,6LAAC;gCAAI,WAAU;0CAA+D;;;;;;;;;;;sCAIlF,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CACC,SAAS,IAAM,WAAW,CAAC;4CAC3B,WAAU;sDACX;;;;;;sDAGD,6LAAC;4CACC,SAAS,IAAM,WAAW;4CAC1B,WAAU;sDACX;;;;;;;;;;;;8CAIH,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAO,SAAS;4CAAS,WAAU;sDAAgE;;;;;;sDAGpG,6LAAC;4CACC,SAAS;4CACT,UAAU,CAAC;4CACX,WAAU;sDACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASf;GAlHwB;KAAA"}},
    {"offset": {"line": 502, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28profile%29/popup-profile/ProfileView.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { HiMail, HiOfficeBuilding, HiStatusOnline } from 'react-icons/hi';\r\nimport { HiPencil, HiLockClosed, HiPhone, HiMapPin, HiCalendar, HiBriefcase, HiIdentification } from 'react-icons/hi2';\r\n\r\ninterface Option {\r\n  value: string;\r\n  label: string;\r\n}\r\n\r\ninterface Props {\r\n  user: {\r\n    department?: string | number;\r\n    status?: string | number;\r\n    phone?: string;\r\n    gender?: string;\r\n    birthday?: string;\r\n    email?: string;\r\n    address?: string;\r\n    title?: string;\r\n  };\r\n  displayName: string;\r\n  displayId: string;\r\n  departmentOptions: Option[];\r\n  statusOptions: Option[];\r\n  onEdit: () => void;\r\n  onChangePassword: () => void;\r\n}\r\n\r\nexport default function ProfileView({\r\n  user,\r\n  displayName,\r\n  displayId,\r\n  departmentOptions,\r\n  statusOptions,\r\n  onEdit,\r\n  onChangePassword,\r\n}: Props) {\r\n  return (\r\n    <div className=\"w-full space-y-6\">\r\n      {/* Tên và ID */}\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-xl font-bold text-gray-900\">{displayName}</h3>\r\n        <p className=\"text-sm text-gray-500\">ID: {displayId}</p>\r\n      </div>\r\n\r\n      {/* Thông tin chi tiết */}\r\n      <div className=\"space-y-4\">\r\n        {/* Phòng ban */}\r\n        {user.department !== undefined && (\r\n          <InfoRow\r\n            icon={<HiOfficeBuilding className=\"w-5 h-5 text-gray-400\" />}\r\n            label=\"Phòng ban\"\r\n            value={departmentOptions.find((o) => o.value === String(user.department))?.label || '—'}\r\n          />\r\n        )}\r\n\r\n        {/* Trạng thái */}\r\n        {user.status !== undefined && (\r\n          <InfoRow\r\n            icon={<HiStatusOnline className=\"w-5 h-5 text-gray-400\" />}\r\n            label=\"Trạng thái\"\r\n            value={statusOptions.find((o) => o.value === String(user.status))?.label || '—'}\r\n          />\r\n        )}\r\n\r\n        <InfoRow icon={<HiPhone className=\"w-5 h-5 text-gray-400\" />} label=\"Số điện thoại\" value={user.phone} />\r\n        <InfoRow icon={<HiIdentification className=\"w-5 h-5 text-gray-400\" />} label=\"Giới tính\" value={user.gender} />\r\n        <InfoRow icon={<HiCalendar className=\"w-5 h-5 text-gray-400\" />} label=\"Ngày sinh\" value={user.birthday} />\r\n        <InfoRow icon={<HiMail className=\"w-5 h-5 text-gray-400\" />} label=\"Email\" value={user.email} />\r\n        <InfoRow icon={<HiMapPin className=\"w-5 h-5 text-gray-400\" />} label=\"Địa chỉ\" value={user.address} />\r\n        <InfoRow icon={<HiBriefcase className=\"w-5 h-5 text-gray-400\" />} label=\"Chức vụ\" value={user.title} />\r\n      </div>\r\n\r\n      {/* Nút hành động */}\r\n      <div className=\"space-y-3 pt-2\">\r\n        <button\r\n          onClick={onEdit}\r\n          className=\"cursor-pointer w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg flex items-center justify-center gap-2 transition-colors\"\r\n        >\r\n          <HiPencil className=\"w-4 h-4\" />\r\n          Cập nhật thông tin\r\n        </button>\r\n\r\n        <button\r\n          onClick={onChangePassword}\r\n          className=\"cursor-pointer w-full py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg flex items-center justify-center gap-2 transition-colors\"\r\n        >\r\n          <HiLockClosed className=\"w-4 h-4\" />\r\n          Đổi mật khẩu\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Component nhỏ gọn, đẹp cho từng dòng thông tin\r\nfunction InfoRow({\r\n  icon,\r\n  label,\r\n  value,\r\n  bold = false,\r\n}: {\r\n  icon: React.ReactNode;\r\n  label: string;\r\n  value?: string | number | null;\r\n  bold?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"flex items-start gap-4\">\r\n      <div className=\"mt-0.5\">{icon}</div>\r\n      <div className=\"flex-1\">\r\n        <p className=\"text-xs font-medium text-gray-500\">{label}</p>\r\n        <p className={`text-sm ${bold ? 'font-bold text-gray-900' : 'font-medium text-gray-800'} mt-0.5`}>\r\n          {value ? String(value) : <span className=\"text-gray-400\">Chưa cập nhật</span>}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AA6Be,SAAS,YAAY,EAClC,IAAI,EACJ,WAAW,EACX,SAAS,EACT,iBAAiB,EACjB,aAAa,EACb,MAAM,EACN,gBAAgB,EACV;IACN,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,6LAAC;wBAAE,WAAU;;4BAAwB;4BAAK;;;;;;;;;;;;;0BAI5C,6LAAC;gBAAI,WAAU;;oBAEZ,KAAK,UAAU,KAAK,2BACnB,6LAAC;wBACC,oBAAM,6LAAC,qKAAgB;4BAAC,WAAU;;;;;;wBAClC,OAAM;wBACN,OAAO,kBAAkB,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,KAAK,OAAO,KAAK,UAAU,IAAI,SAAS;;;;;;oBAKvF,KAAK,MAAM,KAAK,2BACf,6LAAC;wBACC,oBAAM,6LAAC,mKAAc;4BAAC,WAAU;;;;;;wBAChC,OAAM;wBACN,OAAO,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,KAAK,OAAO,KAAK,MAAM,IAAI,SAAS;;;;;;kCAIhF,6LAAC;wBAAQ,oBAAM,6LAAC,6JAAO;4BAAC,WAAU;;;;;;wBAA4B,OAAM;wBAAgB,OAAO,KAAK,KAAK;;;;;;kCACrG,6LAAC;wBAAQ,oBAAM,6LAAC,sKAAgB;4BAAC,WAAU;;;;;;wBAA4B,OAAM;wBAAY,OAAO,KAAK,MAAM;;;;;;kCAC3G,6LAAC;wBAAQ,oBAAM,6LAAC,gKAAU;4BAAC,WAAU;;;;;;wBAA4B,OAAM;wBAAY,OAAO,KAAK,QAAQ;;;;;;kCACvG,6LAAC;wBAAQ,oBAAM,6LAAC,2JAAM;4BAAC,WAAU;;;;;;wBAA4B,OAAM;wBAAQ,OAAO,KAAK,KAAK;;;;;;kCAC5F,6LAAC;wBAAQ,oBAAM,6LAAC,8JAAQ;4BAAC,WAAU;;;;;;wBAA4B,OAAM;wBAAU,OAAO,KAAK,OAAO;;;;;;kCAClG,6LAAC;wBAAQ,oBAAM,6LAAC,iKAAW;4BAAC,WAAU;;;;;;wBAA4B,OAAM;wBAAU,OAAO,KAAK,KAAK;;;;;;;;;;;;0BAIrG,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,SAAS;wBACT,WAAU;;0CAEV,6LAAC,8JAAQ;gCAAC,WAAU;;;;;;4BAAY;;;;;;;kCAIlC,6LAAC;wBACC,SAAS;wBACT,WAAU;;0CAEV,6LAAC,kKAAY;gCAAC,WAAU;;;;;;4BAAY;;;;;;;;;;;;;;;;;;;AAM9C;KAjEwB;AAmExB,iDAAiD;AACjD,SAAS,QAAQ,EACf,IAAI,EACJ,KAAK,EACL,KAAK,EACL,OAAO,KAAK,EAMb;IACC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;0BAAU;;;;;;0BACzB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAE,WAAU;kCAAqC;;;;;;kCAClD,6LAAC;wBAAE,WAAW,CAAC,QAAQ,EAAE,OAAO,4BAA4B,4BAA4B,OAAO,CAAC;kCAC7F,QAAQ,OAAO,uBAAS,6LAAC;4BAAK,WAAU;sCAAgB;;;;;;;;;;;;;;;;;;;;;;;AAKnE;MAtBS"}},
    {"offset": {"line": 790, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/ui/Field.tsx"],"sourcesContent":["export function Field({\r\n  label,\r\n  children,\r\n  icon,\r\n  required,\r\n}: {\r\n  label: string;\r\n  children: React.ReactNode;\r\n  icon?: React.ReactNode;\r\n  required?: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-2 mr-3\">\r\n      <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n        {icon && <span className=\"text-indigo-600\">{icon}</span>}\r\n        {label}\r\n        {required && <span className=\"text-red-500 ml-1\">*</span>}\r\n      </label>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,MAAM,EACpB,KAAK,EACL,QAAQ,EACR,IAAI,EACJ,QAAQ,EAMT;IACC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAM,WAAU;;oBACd,sBAAQ,6LAAC;wBAAK,WAAU;kCAAmB;;;;;;oBAC3C;oBACA,0BAAY,6LAAC;wBAAK,WAAU;kCAAoB;;;;;;;;;;;;YAElD;;;;;;;AAGP;KArBgB"}},
    {"offset": {"line": 844, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/ui/Dropdown.tsx"],"sourcesContent":["import { HiCheck, HiChevronDown } from 'react-icons/hi2';\r\n\r\nexport function Dropdown({\r\n  label,\r\n  icon,\r\n  items,\r\n  open,\r\n  onToggle,\r\n  onSelect,\r\n  value,\r\n  placeholder = 'Chọn một mục',\r\n  className = '',\r\n}: {\r\n  label?: string;\r\n  icon?: React.ReactNode;\r\n  items: { value: string; label: string }[];\r\n  open: boolean;\r\n  onToggle: () => void;\r\n  onSelect: (v: string) => void;\r\n  value: string;\r\n  placeholder?: string;\r\n  className?: string;\r\n}) {\r\n  const selectedLabel = items.find((i) => i.value === value)?.label || '';\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      {/* Label nếu có */}\r\n      {label && (\r\n        <label className=\" text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2\">\r\n          {icon}\r\n          {label}\r\n        </label>\r\n      )}\r\n\r\n      {/* Trigger Button */}\r\n      <button\r\n        type=\"button\"\r\n        onClick={onToggle}\r\n        className={`\r\n          w-full pl-4 pr-5 py-1.5 rounded-2xl border-2 border-gray-200 \r\n          bg-white text-left text-lg font-medium transition-all\r\n          flex items-center justify-between\r\n          focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100\r\n          hover:border-gray-300\r\n          ${open ? 'border-indigo-500 ring-4 ring-indigo-100' : ''}\r\n          ${className}\r\n        `}\r\n      >\r\n        <span className={selectedLabel ? 'text-gray-900' : 'text-gray-400'}>{selectedLabel || placeholder}</span>\r\n        <HiChevronDown\r\n          className={`w-6 h-6 text-gray-500 transition-transform duration-200 ${open ? 'rotate-180' : ''}`}\r\n        />\r\n      </button>\r\n\r\n      {/* Icon bên trái */}\r\n      {icon && <div className=\"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none z-10\">{icon}</div>}\r\n\r\n      {/* Dropdown Menu */}\r\n      {open && (\r\n        <div className=\"absolute z-30 w-full mt-2 bg-white rounded-2xl shadow-2xl border-2 border-gray-200 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200\">\r\n          <div className=\"max-h-64 overflow-y-auto custom-scrollbar\">\r\n            {items.map((item) => (\r\n              <button\r\n                key={item.value}\r\n                onClick={() => {\r\n                  onSelect(item.value);\r\n                  onToggle();\r\n                }}\r\n                className={`\r\n                  w-full px-5 py-4 text-left text-lg font-medium flex items-center justify-between\r\n                  transition-all duration-150 hover:bg-indigo-50\r\n                  ${value === item.value ? 'bg-indigo-50 text-indigo-700' : 'text-gray-800'}\r\n                `}\r\n              >\r\n                <span>{item.label}</span>\r\n                {value === item.value && <HiCheck className=\"w-6 h-6 text-indigo-600\" />}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAEO,SAAS,SAAS,EACvB,KAAK,EACL,IAAI,EACJ,KAAK,EACL,IAAI,EACJ,QAAQ,EACR,QAAQ,EACR,KAAK,EACL,cAAc,cAAc,EAC5B,YAAY,EAAE,EAWf;IACC,MAAM,gBAAgB,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,KAAK,QAAQ,SAAS;IAErE,qBACE,6LAAC;QAAI,WAAU;;YAEZ,uBACC,6LAAC;gBAAM,WAAU;;oBACd;oBACA;;;;;;;0BAKL,6LAAC;gBACC,MAAK;gBACL,SAAS;gBACT,WAAW,CAAC;;;;;;UAMV,EAAE,OAAO,6CAA6C,GAAG;UACzD,EAAE,UAAU;QACd,CAAC;;kCAED,6LAAC;wBAAK,WAAW,gBAAgB,kBAAkB;kCAAkB,iBAAiB;;;;;;kCACtF,6LAAC,mKAAa;wBACZ,WAAW,CAAC,wDAAwD,EAAE,OAAO,eAAe,IAAI;;;;;;;;;;;;YAKnG,sBAAQ,6LAAC;gBAAI,WAAU;0BAAqE;;;;;;YAG5F,sBACC,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;8BACZ,MAAM,GAAG,CAAC,CAAC,qBACV,6LAAC;4BAEC,SAAS;gCACP,SAAS,KAAK,KAAK;gCACnB;4BACF;4BACA,WAAW,CAAC;;;kBAGV,EAAE,UAAU,KAAK,KAAK,GAAG,iCAAiC,gBAAgB;gBAC5E,CAAC;;8CAED,6LAAC;8CAAM,KAAK,KAAK;;;;;;gCAChB,UAAU,KAAK,KAAK,kBAAI,6LAAC,6JAAO;oCAAC,WAAU;;;;;;;2BAZvC,KAAK,KAAK;;;;;;;;;;;;;;;;;;;;;AAoB/B;KAlFgB"}},
    {"offset": {"line": 972, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28profile%29/popup-profile/EditInfoView.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { HiUser, HiCalendar, HiMapPin, HiBriefcase, HiIdentification } from 'react-icons/hi2';\r\nimport { useState } from 'react';\r\nimport { Field } from '@/components/ui/Field';\r\nimport { Dropdown } from '@/components/ui/Dropdown';\r\nimport { HiMail, HiOfficeBuilding, HiPhone, HiStatusOnline } from 'react-icons/hi';\r\n\r\nexport default function EditInfoView({\r\n  form,\r\n  setForm,\r\n  onSubmit,\r\n  onCancel,\r\n  departmentOptions,\r\n  statusOptions,\r\n  loading,\r\n}: {\r\n  form: Record<string, string | number | boolean | undefined>;\r\n  setForm: (value: Record<string, string | number | boolean | undefined>) => void;\r\n  onSubmit: () => void;\r\n  onCancel: () => void;\r\n  departmentOptions: { value: string; label: string }[];\r\n  statusOptions: { value: string; label: string }[];\r\n  loading: boolean;\r\n}) {\r\n  const [openDept, setOpenDept] = useState(false);\r\n  const [openStatus, setOpenStatus] = useState(false);\r\n  const [openGender, setOpenGender] = useState(false);\r\n\r\n  const genderOptions = [\r\n    { value: 'Nam', label: 'Nam' },\r\n    { value: 'Nữ', label: 'Nữ' },\r\n    { value: 'Khác', label: 'Khác' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"w-full space-y-5\">\r\n      {/* Form Grid */}\r\n      <div className=\"flex flex-col gap-4\">\r\n        {/* Tên hiển thị */}\r\n        <Field icon={<HiUser className=\"w-5 h-5 text-indigo-600\" />} label=\"Tên hiển thị\" required>\r\n          <input\r\n            type=\"text\"\r\n            value={String(form.name ?? '')}\r\n            onChange={(e) => setForm({ ...form, name: e.target.value })}\r\n            placeholder=\"Ví dụ: Nguyễn Văn A\"\r\n            className=\"w-full pl-3 pr-4 py-2 rounded-lg border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 text-sm font-medium transition-all bg-white\"\r\n          />\r\n        </Field>\r\n\r\n        {/* Số điện thoại */}\r\n        <Field icon={<HiPhone className=\"w-5 h-5 text-blue-600\" />} label=\"Số điện thoại\">\r\n          <input\r\n            type=\"tel\"\r\n            value={String(form.phone ?? '')}\r\n            onChange={(e) => setForm({ ...form, phone: e.target.value })}\r\n            placeholder=\"0123456789\"\r\n            className=\"w-full pl-3 pr-4 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 text-sm font-medium transition-all bg-white\"\r\n          />\r\n        </Field>\r\n\r\n        {/* Giới tính */}\r\n        <Field icon={<HiIdentification className=\"w-5 h-5 text-purple-600\" />} label=\"Giới tính\">\r\n          <Dropdown\r\n            items={genderOptions}\r\n            value={String(form.gender ?? '')}\r\n            placeholder=\"Chọn giới tính\"\r\n            open={openGender}\r\n            onToggle={() => {\r\n              setOpenGender(!openGender);\r\n              setOpenDept(false);\r\n              setOpenStatus(false);\r\n            }}\r\n            onSelect={(v) => {\r\n              setForm({ ...form, gender: v });\r\n              setOpenGender(false);\r\n            }}\r\n            className=\"h-[2.5rem] rounded-lg border border-gray-200 focus-within:border-purple-500 focus-within:ring-2 focus-within:ring-purple-100 text-sm\"\r\n          />\r\n        </Field>\r\n\r\n        {/* Ngày sinh */}\r\n        <Field icon={<HiCalendar className=\"w-5 h-5 text-emerald-600\" />} label=\"Ngày sinh\">\r\n          <input\r\n            type=\"date\"\r\n            value={form.birthday ? String(form.birthday) : ''}\r\n            onChange={(e) => setForm({ ...form, birthday: e.target.value })}\r\n            className=\"w-full pl-3 pr-4 py-2 rounded-lg border border-gray-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100 text-sm font-medium transition-all bg-white\"\r\n          />\r\n        </Field>\r\n\r\n        {/* Email */}\r\n        <Field icon={<HiMail className=\"w-5 h-5 text-orange-600\" />} label=\"Email\">\r\n          <input\r\n            type=\"email\"\r\n            value={String(form.email ?? '')}\r\n            onChange={(e) => setForm({ ...form, email: e.target.value })}\r\n            placeholder=\"you@example.com\"\r\n            className=\"w-full pl-3 pr-4 py-2 rounded-lg border border-gray-200 focus:border-orange-500 focus:ring-2 focus:ring-orange-100 text-sm font-medium transition-all bg-white\"\r\n          />\r\n        </Field>\r\n\r\n        {/* Chức vụ */}\r\n        <Field icon={<HiBriefcase className=\"w-5 h-5 text-teal-600\" />} label=\"Chức vụ\">\r\n          <input\r\n            type=\"text\"\r\n            value={String(form.title ?? '')}\r\n            onChange={(e) => setForm({ ...form, title: e.target.value })}\r\n            placeholder=\"Ví dụ: Nhân viên kinh doanh\"\r\n            className=\"w-full pl-3 pr-4 py-2 rounded-lg border border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-100 text-sm font-medium transition-all bg-white\"\r\n          />\r\n        </Field>\r\n\r\n        {/* Địa chỉ */}\r\n        <div>\r\n          <Field icon={<HiMapPin className=\"w-5 h-5 text-rose-600\" />} label=\"Địa chỉ\">\r\n            <input\r\n              type=\"text\"\r\n              value={String(form.address ?? '')}\r\n              onChange={(e) => setForm({ ...form, address: e.target.value })}\r\n              placeholder=\"Số nhà, đường, phường/xã...\"\r\n              className=\"w-full pl-3 pr-4 py-2 rounded-lg border border-gray-200 focus:border-rose-500 focus:ring-2 focus:ring-rose-100 text-sm font-medium transition-all bg-white\"\r\n            />\r\n          </Field>\r\n        </div>\r\n\r\n        {/* Phòng ban */}\r\n        <div>\r\n          <Field icon={<HiOfficeBuilding className=\"w-5 h-5 text-blue-600\" />} label=\"Phòng ban\">\r\n            <Dropdown\r\n              items={departmentOptions}\r\n              value={String(form.department ?? '')}\r\n              placeholder=\"Chọn phòng ban\"\r\n              open={openDept}\r\n              onToggle={() => {\r\n                setOpenDept(!openDept);\r\n                setOpenStatus(false);\r\n                setOpenGender(false);\r\n              }}\r\n              onSelect={(v) => {\r\n                setForm({ ...form, department: v });\r\n                setOpenDept(false);\r\n              }}\r\n              className=\"h-[2.5rem] rounded-lg border border-gray-200 focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-100 text-sm\"\r\n            />\r\n          </Field>\r\n        </div>\r\n\r\n        {/* Trạng thái */}\r\n        <div>\r\n          <Field icon={<HiStatusOnline className=\"w-5 h-5 text-green-600\" />} label=\"Trạng thái làm việc\">\r\n            <Dropdown\r\n              items={statusOptions}\r\n              value={String(form.status ?? '')}\r\n              placeholder=\"Chọn trạng thái\"\r\n              open={openStatus}\r\n              onToggle={() => {\r\n                setOpenStatus(!openStatus);\r\n                setOpenDept(false);\r\n                setOpenGender(false);\r\n              }}\r\n              onSelect={(v) => {\r\n                setForm({ ...form, status: v });\r\n                setOpenStatus(false);\r\n              }}\r\n              className=\"h-[2.5rem] rounded-lg border border-gray-200 focus-within:border-green-500 focus-within:ring-2 focus-within:ring-green-100 text-sm\"\r\n            />\r\n          </Field>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Buttons */}\r\n      <div className=\"flex gap-3 pt-2\">\r\n        <button\r\n          onClick={onSubmit}\r\n          disabled={loading}\r\n          className=\"cursor-pointer flex-1 py-2.5 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium text-sm shadow-md hover:shadow-lg transition-all active:scale-98 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n        >\r\n          {loading ? (\r\n            'Đang lưu...'\r\n          ) : (\r\n            <>\r\n              Lưu thay đổi\r\n              <HiUser className=\"w-4 h-4\" />\r\n            </>\r\n          )}\r\n        </button>\r\n\r\n        <button\r\n          onClick={onCancel}\r\n          className=\"cursor-pointer flex-1 py-2.5 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 text-gray-700 font-medium text-sm transition-all active:scale-98\"\r\n        >\r\n          Hủy bỏ\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1375, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28profile%29/popup-profile/ChangePasswordView.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { HiLockClosed, HiEye, HiEyeSlash } from 'react-icons/hi2';\r\nimport { useState } from 'react';\r\n\r\ninterface ChangePasswordForm {\r\n  currentPassword: string;\r\n  newPassword: string;\r\n  confirmPassword: string;\r\n}\r\n\r\ninterface ChangePasswordViewProps {\r\n  form: ChangePasswordForm;\r\n  setForm: React.Dispatch<React.SetStateAction<ChangePasswordForm>>;\r\n  onSubmit: () => void;\r\n  onCancel: () => void;\r\n  loading: boolean;\r\n}\r\n\r\nexport default function ChangePasswordView({ form, setForm, onSubmit, onCancel, loading }: ChangePasswordViewProps) {\r\n  const [showPassword, setShowPassword] = useState({\r\n    current: false,\r\n    new: false,\r\n    confirm: false,\r\n  });\r\n\r\n  const toggleShow = (field: 'current' | 'new' | 'confirm') => {\r\n    setShowPassword((prev) => ({ ...prev, [field]: !prev[field] }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full space-y-6\">\r\n      <div className=\"space-y-4\">\r\n        <Field label=\"Mật khẩu hiện tại\">\r\n          <div className=\"relative\">\r\n            <input\r\n              type={showPassword.current ? 'text' : 'password'}\r\n              value={form.currentPassword}\r\n              onChange={(e) => setForm({ ...form, currentPassword: e.target.value })}\r\n              placeholder=\"Nhập mật khẩu hiện tại\"\r\n              className=\"w-full pl-10 pr-10 py-2.5 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 text-sm font-medium transition-all bg-white\"\r\n            />\r\n            <HiLockClosed className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => toggleShow('current')}\r\n              className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-md hover:bg-gray-100 transition\"\r\n            >\r\n              {showPassword.current ? (\r\n                <HiEyeSlash className=\"w-4 h-4 text-gray-500\" />\r\n              ) : (\r\n                <HiEye className=\"w-4 h-4 text-gray-500\" />\r\n              )}\r\n            </button>\r\n          </div>\r\n        </Field>\r\n\r\n        <Field label=\"Mật khẩu mới\">\r\n          <div className=\"relative\">\r\n            <input\r\n              type={showPassword.new ? 'text' : 'password'}\r\n              value={form.newPassword}\r\n              onChange={(e) => setForm({ ...form, newPassword: e.target.value })}\r\n              placeholder=\"Tạo mật khẩu mạnh\"\r\n              className=\"w-full pl-10 pr-10 py-2.5 rounded-lg border border-gray-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100 text-sm font-medium transition-all bg-white\"\r\n            />\r\n            <HiLockClosed className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => toggleShow('new')}\r\n              className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-md hover:bg-gray-100 transition\"\r\n            >\r\n              {showPassword.new ? (\r\n                <HiEyeSlash className=\"w-4 h-4 text-gray-500\" />\r\n              ) : (\r\n                <HiEye className=\"w-4 h-4 text-gray-500\" />\r\n              )}\r\n            </button>\r\n          </div>\r\n        </Field>\r\n\r\n        <Field label=\"Xác nhận mật khẩu\">\r\n          <div className=\"relative\">\r\n            <input\r\n              type={showPassword.confirm ? 'text' : 'password'}\r\n              value={form.confirmPassword}\r\n              onChange={(e) => setForm({ ...form, confirmPassword: e.target.value })}\r\n              placeholder=\"Nhập lại mật khẩu mới\"\r\n              className=\"w-full pl-10 pr-10 py-2.5 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 text-sm font-medium transition-all bg-white\"\r\n            />\r\n            <HiLockClosed className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => toggleShow('confirm')}\r\n              className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-md hover:bg-gray-100 transition\"\r\n            >\r\n              {showPassword.confirm ? (\r\n                <HiEyeSlash className=\"w-4 h-4 text-gray-500\" />\r\n              ) : (\r\n                <HiEye className=\"w-4 h-4 text-gray-500\" />\r\n              )}\r\n            </button>\r\n          </div>\r\n        </Field>\r\n      </div>\r\n\r\n      <div className=\"flex gap-3 pt-2\">\r\n        <button\r\n          onClick={onSubmit}\r\n          disabled={loading}\r\n          className=\"cursor-pointer flex-1 py-2.5 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium text-sm shadow-md hover:shadow-lg transition-all active:scale-98 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n        >\r\n          {loading ? (\r\n            'Đang đổi...'\r\n          ) : (\r\n            <>\r\n              Đổi mật khẩu\r\n              <HiLockClosed className=\"w-4 h-4\" />\r\n            </>\r\n          )}\r\n        </button>\r\n\r\n        <button\r\n          onClick={onCancel}\r\n          className=\"cursor-pointer flex-1 py-2.5 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 text-gray-700 font-medium text-sm transition-all active:scale-98\"\r\n        >\r\n          Hủy bỏ\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Giữ nguyên hoàn toàn cấu trúc Field\r\nfunction Field({ label, children }: { label: string; children: React.ReactNode }) {\r\n  return (\r\n    <div>\r\n      <p className=\"text-xs font-semibold text-gray-700 mb-1.5 flex items-center gap-1.5\">\r\n        <HiLockClosed className=\"w-3.5 h-3.5 text-blue-500\" />\r\n        {label}\r\n      </p>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAmBe,SAAS,mBAAmB,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAA2B;;IAChH,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;QAC/C,SAAS;QACT,KAAK;QACL,SAAS;IACX;IAEA,MAAM,aAAa,CAAC;QAClB,gBAAgB,CAAC,OAAS,CAAC;gBAAE,GAAG,IAAI;gBAAE,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM;YAAC,CAAC;IAC/D;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAM,OAAM;kCACX,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,MAAM,aAAa,OAAO,GAAG,SAAS;oCACtC,OAAO,KAAK,eAAe;oCAC3B,UAAU,CAAC,IAAM,QAAQ;4CAAE,GAAG,IAAI;4CAAE,iBAAiB,EAAE,MAAM,CAAC,KAAK;wCAAC;oCACpE,aAAY;oCACZ,WAAU;;;;;;8CAEZ,6LAAC,kKAAY;oCAAC,WAAU;;;;;;8CACxB,6LAAC;oCACC,MAAK;oCACL,SAAS,IAAM,WAAW;oCAC1B,WAAU;8CAET,aAAa,OAAO,iBACnB,6LAAC,gKAAU;wCAAC,WAAU;;;;;6DAEtB,6LAAC,2JAAK;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;kCAMzB,6LAAC;wBAAM,OAAM;kCACX,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,MAAM,aAAa,GAAG,GAAG,SAAS;oCAClC,OAAO,KAAK,WAAW;oCACvB,UAAU,CAAC,IAAM,QAAQ;4CAAE,GAAG,IAAI;4CAAE,aAAa,EAAE,MAAM,CAAC,KAAK;wCAAC;oCAChE,aAAY;oCACZ,WAAU;;;;;;8CAEZ,6LAAC,kKAAY;oCAAC,WAAU;;;;;;8CACxB,6LAAC;oCACC,MAAK;oCACL,SAAS,IAAM,WAAW;oCAC1B,WAAU;8CAET,aAAa,GAAG,iBACf,6LAAC,gKAAU;wCAAC,WAAU;;;;;6DAEtB,6LAAC,2JAAK;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;kCAMzB,6LAAC;wBAAM,OAAM;kCACX,cAAA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,MAAM,aAAa,OAAO,GAAG,SAAS;oCACtC,OAAO,KAAK,eAAe;oCAC3B,UAAU,CAAC,IAAM,QAAQ;4CAAE,GAAG,IAAI;4CAAE,iBAAiB,EAAE,MAAM,CAAC,KAAK;wCAAC;oCACpE,aAAY;oCACZ,WAAU;;;;;;8CAEZ,6LAAC,kKAAY;oCAAC,WAAU;;;;;;8CACxB,6LAAC;oCACC,MAAK;oCACL,SAAS,IAAM,WAAW;oCAC1B,WAAU;8CAET,aAAa,OAAO,iBACnB,6LAAC,gKAAU;wCAAC,WAAU;;;;;6DAEtB,6LAAC,2JAAK;wCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAO3B,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,SAAS;wBACT,UAAU;wBACV,WAAU;kCAET,UACC,8BAEA;;gCAAE;8CAEA,6LAAC,kKAAY;oCAAC,WAAU;;;;;;;;;;;;;kCAK9B,6LAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;;;;;;;AAMT;GAhHwB;KAAA;AAkHxB,sCAAsC;AACtC,SAAS,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAgD;IAC9E,qBACE,6LAAC;;0BACC,6LAAC;gBAAE,WAAU;;kCACX,6LAAC,kKAAY;wBAAC,WAAU;;;;;;oBACvB;;;;;;;YAEF;;;;;;;AAGP;MAVS"}},
    {"offset": {"line": 1677, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28profile%29/popup-profile/Header.tsx"],"sourcesContent":["'use client';\r\n\r\nimport Image from 'next/image';\r\nimport { HiCamera } from 'react-icons/hi';\r\nimport { getProxyUrl } from '@/utils/utils';\r\n\r\nexport default function Header({\r\n  displayName,\r\n  backgroundUrl,\r\n  avatarUrl,\r\n  isUploading,\r\n  avatarFailed,\r\n  setAvatarFailed,\r\n  onSelectFile,\r\n  isUploadingBackground,\r\n  onSelectBackgroundFile,\r\n}: {\r\n  displayName: string;\r\n  backgroundUrl?: string;\r\n  avatarUrl?: string;\r\n  isUploading: boolean;\r\n  avatarFailed: boolean;\r\n  setAvatarFailed: (failed: boolean) => void;\r\n  onSelectFile: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  isUploadingBackground?: boolean;\r\n  onSelectBackgroundFile?: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n}) {\r\n  return (\r\n    <div className=\"h-32 relative mb-16\">\r\n      {backgroundUrl ? (\r\n        <Image src={getProxyUrl(backgroundUrl)} alt=\"bg\" fill className=\"object-cover\" />\r\n      ) : (\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-sky-500 to-blue-600\" />\r\n      )}\r\n\r\n      {isUploadingBackground && (\r\n        <div className=\"absolute inset-0 bg-black/40 flex items-center justify-center text-white\">\r\n          <div className=\"flex items-center gap-3 px-3 py-2 rounded bg-black/50\">\r\n            <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n            <span className=\"text-sm\">Đang tải...</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Change Background Button */}\r\n      <label className=\"absolute top-4 left-4 p-2 bg-black/20 hover:bg-black/40 rounded-full cursor-pointer group transition-colors\">\r\n        <HiCamera className=\"text-white w-5 h-5\" />\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          className=\"sr-only\"\r\n          onChange={onSelectBackgroundFile}\r\n          disabled={Boolean(isUploadingBackground)}\r\n        />\r\n      </label>\r\n\r\n      <div className=\"absolute left-1/2 -bottom-14 -translate-x-1/2 w-28 h-28 p-1 bg-white rounded-full overflow-hidden shadow-md\">\r\n        <label className=\"group cursor-pointer relative block w-full h-full rounded-full overflow-hidden\">\r\n          {!avatarFailed && avatarUrl ? (\r\n            <Image\r\n              src={getProxyUrl(avatarUrl)}\r\n              width={128}\r\n              height={128}\r\n              className=\"w-full h-full object-cover\"\r\n              alt={displayName}\r\n              onError={() => setAvatarFailed(true)}\r\n            />\r\n          ) : (\r\n            <div className=\"w-full h-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-4xl font-bold\">\r\n              {displayName[0]?.toUpperCase()}\r\n            </div>\r\n          )}\r\n\r\n          <div\r\n            className={`absolute inset-0 bg-black/30 flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity`}\r\n          >\r\n            <HiCamera className=\"w-8 h-8\" />\r\n          </div>\r\n\r\n          {isUploading && (\r\n            <div className=\"absolute inset-0 flex items-center justify-center bg-black/40 text-white\">\r\n              <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n            </div>\r\n          )}\r\n\r\n          <input type=\"file\" accept=\"image/*\" className=\"sr-only\" onChange={onSelectFile} disabled={isUploading} />\r\n        </label>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,OAAO,EAC7B,WAAW,EACX,aAAa,EACb,SAAS,EACT,WAAW,EACX,YAAY,EACZ,eAAe,EACf,YAAY,EACZ,qBAAqB,EACrB,sBAAsB,EAWvB;IACC,qBACE,6LAAC;QAAI,WAAU;;YACZ,8BACC,6LAAC,2IAAK;gBAAC,KAAK,IAAA,uIAAW,EAAC;gBAAgB,KAAI;gBAAK,IAAI;gBAAC,WAAU;;;;;qCAEhE,6LAAC;gBAAI,WAAU;;;;;;YAGhB,uCACC,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;;;;;sCACf,6LAAC;4BAAK,WAAU;sCAAU;;;;;;;;;;;;;;;;;0BAMhC,6LAAC;gBAAM,WAAU;;kCACf,6LAAC,6JAAQ;wBAAC,WAAU;;;;;;kCACpB,6LAAC;wBACC,MAAK;wBACL,QAAO;wBACP,WAAU;wBACV,UAAU;wBACV,UAAU,QAAQ;;;;;;;;;;;;0BAItB,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAM,WAAU;;wBACd,CAAC,gBAAgB,0BAChB,6LAAC,2IAAK;4BACJ,KAAK,IAAA,uIAAW,EAAC;4BACjB,OAAO;4BACP,QAAQ;4BACR,WAAU;4BACV,KAAK;4BACL,SAAS,IAAM,gBAAgB;;;;;iDAGjC,6LAAC;4BAAI,WAAU;sCACZ,WAAW,CAAC,EAAE,EAAE;;;;;;sCAIrB,6LAAC;4BACC,WAAW,CAAC,6HAA6H,CAAC;sCAE1I,cAAA,6LAAC,6JAAQ;gCAAC,WAAU;;;;;;;;;;;wBAGrB,6BACC,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAI,WAAU;;;;;;;;;;;sCAInB,6LAAC;4BAAM,MAAK;4BAAO,QAAO;4BAAU,WAAU;4BAAU,UAAU;4BAAc,UAAU;;;;;;;;;;;;;;;;;;;;;;;AAKpG;KApFwB"}},
    {"offset": {"line": 1859, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/hooks/useUploadAvatar.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { User } from '@/types/User';\r\nimport { useToast } from '@/components/base/toast';\r\n\r\nexport function useUploadAvatar(user: User, onAvatarUpdated?: (u: string) => void) {\r\n  const toast = useToast();\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [avatarFailed, setAvatarFailed] = useState(false);\r\n\r\n  const upload = async (file: File, resetInput: () => void) => {\r\n    try {\r\n      setIsUploading(true);\r\n\r\n      const formData = new FormData();\r\n      formData.append('file', file);\r\n      formData.append('roomId', 'avatar');\r\n      formData.append('sender', String(user._id));\r\n      formData.append('receiver', '');\r\n      formData.append('type', 'image');\r\n      formData.append('folderName', 'Avatars');\r\n\r\n      const uploadRes = await fetch(`/api/upload?uploadId=avatar_${user._id}`, {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      const json = await uploadRes.json();\r\n      if (!json.success || !json.link) throw new Error('Upload thất bại');\r\n\r\n      const avatarUrl = json.link;\r\n\r\n      // Update DB\r\n      await fetch('/api/users', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          action: 'update',\r\n          field: '_id',\r\n          value: String(user._id),\r\n          data: { avatar: avatarUrl },\r\n        }),\r\n      });\r\n\r\n      // Update localStorage\r\n      const raw = localStorage.getItem('info_user');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        localStorage.setItem('info_user', JSON.stringify({ ...parsed, avatar: avatarUrl }));\r\n      }\r\n\r\n      onAvatarUpdated?.(avatarUrl);\r\n      toast({ type: 'success', message: 'Cập nhật ảnh đại diện thành công!' });\r\n    } catch {\r\n      toast({ type: 'error', message: 'Lỗi khi cập nhật ảnh' });\r\n    } finally {\r\n      setIsUploading(false);\r\n      resetInput();\r\n    }\r\n  };\r\n\r\n  return { upload, isUploading, avatarFailed, setAvatarFailed };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAEA;;AAJA;;;AAMO,SAAS,gBAAgB,IAAU,EAAE,eAAqC;;IAC/E,MAAM,QAAQ,IAAA,kJAAQ;IACtB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IAEjD,MAAM,SAAS,OAAO,MAAY;QAChC,IAAI;YACF,eAAe;YAEf,MAAM,WAAW,IAAI;YACrB,SAAS,MAAM,CAAC,QAAQ;YACxB,SAAS,MAAM,CAAC,UAAU;YAC1B,SAAS,MAAM,CAAC,UAAU,OAAO,KAAK,GAAG;YACzC,SAAS,MAAM,CAAC,YAAY;YAC5B,SAAS,MAAM,CAAC,QAAQ;YACxB,SAAS,MAAM,CAAC,cAAc;YAE9B,MAAM,YAAY,MAAM,MAAM,CAAC,4BAA4B,EAAE,KAAK,GAAG,EAAE,EAAE;gBACvE,QAAQ;gBACR,MAAM;YACR;YAEA,MAAM,OAAO,MAAM,UAAU,IAAI;YACjC,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,KAAK,IAAI,EAAE,MAAM,IAAI,MAAM;YAEjD,MAAM,YAAY,KAAK,IAAI;YAE3B,YAAY;YACZ,MAAM,MAAM,cAAc;gBACxB,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB,QAAQ;oBACR,OAAO;oBACP,OAAO,OAAO,KAAK,GAAG;oBACtB,MAAM;wBAAE,QAAQ;oBAAU;gBAC5B;YACF;YAEA,sBAAsB;YACtB,MAAM,MAAM,aAAa,OAAO,CAAC;YACjC,IAAI,KAAK;gBACP,MAAM,SAAS,KAAK,KAAK,CAAC;gBAC1B,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;oBAAE,GAAG,MAAM;oBAAE,QAAQ;gBAAU;YAClF;YAEA,kBAAkB;YAClB,MAAM;gBAAE,MAAM;gBAAW,SAAS;YAAoC;QACxE,EAAE,OAAM;YACN,MAAM;gBAAE,MAAM;gBAAS,SAAS;YAAuB;QACzD,SAAU;YACR,eAAe;YACf;QACF;IACF;IAEA,OAAO;QAAE;QAAQ;QAAa;QAAc;IAAgB;AAC9D;GAzDgB;;QACA,kJAAQ"}},
    {"offset": {"line": 1949, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/hooks/useUpdateUser.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useToast } from '@/components/base/toast';\r\n\r\nexport function useUpdateUser(userId: string, onUpdated?: (data: Record<string, unknown>) => void) {\r\n  const [loading, setLoading] = useState(false);\r\n  const toast = useToast();\r\n\r\n  const updateUser = async (data: Record<string, unknown>) => {\r\n    try {\r\n      setLoading(true);\r\n      const isPasswordChange =\r\n        typeof (data as { currentPassword?: unknown }).currentPassword === 'string' &&\r\n        typeof (data as { newPassword?: unknown }).newPassword === 'string';\r\n\r\n      if (isPasswordChange) {\r\n        const { currentPassword, newPassword, confirmPassword } = data as {\r\n          currentPassword?: string;\r\n          newPassword?: string;\r\n          confirmPassword?: string;\r\n        };\r\n\r\n        if (!currentPassword || !newPassword) {\r\n          toast({ type: 'error', message: 'Vui lòng nhập đầy đủ mật khẩu' });\r\n          return;\r\n        }\r\n        if (newPassword.length < 5) {\r\n          toast({ type: 'error', message: 'Mật khẩu mới quá ngắn' });\r\n          return;\r\n        }\r\n        if (confirmPassword && confirmPassword !== newPassword) {\r\n          toast({ type: 'error', message: 'Xác nhận mật khẩu không khớp' });\r\n          return;\r\n        }\r\n\r\n        const res = await fetch('/api/users', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            action: 'changePassword',\r\n            data: { userId, currentPassword, newPassword },\r\n          }),\r\n        });\r\n\r\n        const json = await res.json();\r\n        if (!res.ok || !json.success) {\r\n          toast({ type: 'error', message: String(json.message || 'Đổi mật khẩu thất bại') });\r\n          return;\r\n        }\r\n        toast({ type: 'success', message: String(json.message || 'Đổi mật khẩu thành công') });\r\n        onUpdated?.({});\r\n      } else {\r\n        const res = await fetch('/api/users', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            action: 'update',\r\n            field: '_id',\r\n            value: userId,\r\n            data,\r\n          }),\r\n        });\r\n\r\n        const json = await res.json();\r\n        if (!res.ok || json.error) throw new Error(json.error);\r\n\r\n        const raw = localStorage.getItem('info_user');\r\n        if (raw) {\r\n          const parsed = JSON.parse(raw);\r\n          localStorage.setItem('info_user', JSON.stringify({ ...parsed, ...data }));\r\n        }\r\n\r\n        onUpdated?.(data);\r\n        toast({ type: 'success', message: 'Cập nhật thành công!' });\r\n      }\r\n    } catch {\r\n      toast({ type: 'error', message: 'Lỗi hệ thống' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return { updateUser, loading };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAKO,SAAS,cAAc,MAAc,EAAE,SAAmD;;IAC/F,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,QAAQ,IAAA,kJAAQ;IAEtB,MAAM,aAAa,OAAO;QACxB,IAAI;YACF,WAAW;YACX,MAAM,mBACJ,OAAO,AAAC,KAAuC,eAAe,KAAK,YACnE,OAAO,AAAC,KAAmC,WAAW,KAAK;YAE7D,IAAI,kBAAkB;gBACpB,MAAM,EAAE,eAAe,EAAE,WAAW,EAAE,eAAe,EAAE,GAAG;gBAM1D,IAAI,CAAC,mBAAmB,CAAC,aAAa;oBACpC,MAAM;wBAAE,MAAM;wBAAS,SAAS;oBAAgC;oBAChE;gBACF;gBACA,IAAI,YAAY,MAAM,GAAG,GAAG;oBAC1B,MAAM;wBAAE,MAAM;wBAAS,SAAS;oBAAwB;oBACxD;gBACF;gBACA,IAAI,mBAAmB,oBAAoB,aAAa;oBACtD,MAAM;wBAAE,MAAM;wBAAS,SAAS;oBAA+B;oBAC/D;gBACF;gBAEA,MAAM,MAAM,MAAM,MAAM,cAAc;oBACpC,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,QAAQ;wBACR,MAAM;4BAAE;4BAAQ;4BAAiB;wBAAY;oBAC/C;gBACF;gBAEA,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,OAAO,EAAE;oBAC5B,MAAM;wBAAE,MAAM;wBAAS,SAAS,OAAO,KAAK,OAAO,IAAI;oBAAyB;oBAChF;gBACF;gBACA,MAAM;oBAAE,MAAM;oBAAW,SAAS,OAAO,KAAK,OAAO,IAAI;gBAA2B;gBACpF,YAAY,CAAC;YACf,OAAO;gBACL,MAAM,MAAM,MAAM,MAAM,cAAc;oBACpC,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,QAAQ;wBACR,OAAO;wBACP,OAAO;wBACP;oBACF;gBACF;gBAEA,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,IAAI,CAAC,IAAI,EAAE,IAAI,KAAK,KAAK,EAAE,MAAM,IAAI,MAAM,KAAK,KAAK;gBAErD,MAAM,MAAM,aAAa,OAAO,CAAC;gBACjC,IAAI,KAAK;oBACP,MAAM,SAAS,KAAK,KAAK,CAAC;oBAC1B,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;wBAAE,GAAG,MAAM;wBAAE,GAAG,IAAI;oBAAC;gBACxE;gBAEA,YAAY;gBACZ,MAAM;oBAAE,MAAM;oBAAW,SAAS;gBAAuB;YAC3D;QACF,EAAE,OAAM;YACN,MAAM;gBAAE,MAAM;gBAAS,SAAS;YAAe;QACjD,SAAU;YACR,WAAW;QACb;IACF;IAEA,OAAO;QAAE;QAAY;IAAQ;AAC/B;GA/EgB;;QAEA,kJAAQ"}},
    {"offset": {"line": 2072, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/base/PopupProfile.tsx"],"sourcesContent":["'use client';\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n\r\nimport { useState } from 'react';\r\nimport CropImageModal from '@/components/base/CropImageModal';\r\n\r\nimport ProfileView from '@/components/(profile)/popup-profile/ProfileView';\r\nimport EditInfoView from '@/components/(profile)/popup-profile/EditInfoView';\r\nimport ChangePasswordView from '@/components/(profile)/popup-profile/ChangePasswordView';\r\n\r\nimport { useToast } from '@/components/base/toast';\r\nimport { PopupProfileProps, ViewMode } from '@/types/types';\r\nimport Header from '@/components/(profile)/popup-profile/Header';\r\nimport { useUploadAvatar } from '@/hooks/useUploadAvatar';\r\nimport { useUpdateUser } from '@/hooks/useUpdateUser';\r\n\r\nexport default function PopupProfile({ isOpen, onClose, user, onAvatarUpdated, onUserUpdated }: PopupProfileProps) {\r\n  const [viewMode, setViewMode] = useState<ViewMode>('profile');\r\n\r\n  const toast = useToast();\r\n\r\n  const { upload, isUploading, avatarFailed, setAvatarFailed } = useUploadAvatar(user, onAvatarUpdated);\r\n  const [isUploadingBackground, setIsUploadingBackground] = useState(false);\r\n  const [cropOpen, setCropOpen] = useState(false);\r\n  const [cropSrc, setCropSrc] = useState<string | null>(null);\r\n  const [cropKind, setCropKind] = useState<'avatar' | 'background' | null>(null);\r\n  const [cropFileName, setCropFileName] = useState<string>('image.jpg');\r\n  const [pendingReset, setPendingReset] = useState<(() => void) | null>(null);\r\n\r\n  const { updateUser, loading } = useUpdateUser(String(user._id), onUserUpdated);\r\n\r\n  const [form, setForm] = useState({\r\n    name: String(user.name || ''),\r\n    phone: String(user.phone || ''),\r\n    gender: String(user.gender || ''),\r\n    birthday: String(user.birthday || ''),\r\n    email: String(user.email || ''),\r\n    address: String(user.address || ''),\r\n    title: String(user.title || ''),\r\n    department: String(user.department || ''),\r\n    status: String(user.status || ''),\r\n  });\r\n\r\n  const [passwordForm, setPasswordForm] = useState({\r\n    currentPassword: '',\r\n    newPassword: '',\r\n    confirmPassword: '',\r\n  });\r\n\r\n  const departmentOptions = [\r\n    {\r\n      id: 1,\r\n      name: 'Ban lãnh đạo',\r\n    },\r\n    {\r\n      id: 2,\r\n      name: 'Quản lý',\r\n    },\r\n    {\r\n      id: 3,\r\n      name: 'Kinh doanh',\r\n    },\r\n    {\r\n      id: 4,\r\n      name: 'Thiết kế',\r\n    },\r\n    {\r\n      id: 5,\r\n      name: 'Sản xuất',\r\n    },\r\n    {\r\n      id: 6,\r\n      name: 'Sàn TMĐT',\r\n    },\r\n    {\r\n      id: 7,\r\n      name: 'Kế toán',\r\n    },\r\n    {\r\n      id: 8,\r\n      name: 'Kho TM',\r\n    },\r\n    {\r\n      id: 9,\r\n      name: 'HCNS',\r\n    },\r\n    {\r\n      id: 10,\r\n      name: 'Maketing',\r\n    },\r\n  ];\r\n\r\n  const statusOptions = [\r\n    { value: '1', label: 'Hoạt động' },\r\n    { value: '2', label: 'Tạm khóa' },\r\n    { value: '3', label: 'Nghỉ phép' },\r\n  ];\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const displayName = user.name || user.username || 'Tài khoản';\r\n  const displayId = user.username || user._id;\r\n  const profilePath = `/profile/${displayId}`;\r\n  const profileUrl = typeof window !== 'undefined' ? window.location.origin + profilePath : profilePath;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-md px-4\"\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        className=\"w-full max-w-[400px] bg-white rounded-lg shadow-2xl h-auto max-h-[90vh] overflow-hidden no-scrollbar relative flex flex-col\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-gray-100\">\r\n          <h2 className=\"text-base font-bold text-gray-900\">Thông tin tài khoản</h2>\r\n          <button onClick={onClose} className=\"text-gray-500 hover:text-gray-700 cursor-pointer\">\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              fill=\"none\"\r\n              viewBox=\"0 0 24 24\"\r\n              strokeWidth={1.5}\r\n              stroke=\"currentColor\"\r\n              className=\"w-6 h-6\"\r\n            >\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto custom-scrollbar\">\r\n          {/* Header */}\r\n          <Header\r\n            displayName={displayName}\r\n            avatarUrl={user.avatar}\r\n            backgroundUrl={user.background as string | undefined}\r\n            isUploading={isUploading}\r\n            avatarFailed={avatarFailed}\r\n            setAvatarFailed={setAvatarFailed}\r\n            onSelectFile={(e: React.ChangeEvent<HTMLInputElement>) => {\r\n              const inputEl = e.target;\r\n              const f = inputEl.files?.[0];\r\n              if (!f) return;\r\n              try {\r\n                const reader = new FileReader();\r\n                reader.onload = () => {\r\n                  setCropSrc(String(reader.result || ''));\r\n                  setCropKind('avatar');\r\n                  setCropFileName(f.name || 'avatar.jpg');\r\n                  setPendingReset(() => () => {\r\n                    inputEl.value = '';\r\n                  });\r\n                  setCropOpen(true);\r\n                };\r\n                reader.readAsDataURL(f);\r\n              } catch {}\r\n            }}\r\n            isUploadingBackground={isUploadingBackground}\r\n            onSelectBackgroundFile={async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n              const inputEl = e.currentTarget;\r\n              const f = inputEl.files?.[0];\r\n              if (!f) return;\r\n              try {\r\n                const reader = new FileReader();\r\n                reader.onload = () => {\r\n                  setCropSrc(String(reader.result || ''));\r\n                  setCropKind('background');\r\n                  setCropFileName(f.name || 'background.jpg');\r\n                  setPendingReset(() => () => {\r\n                    inputEl.value = '';\r\n                  });\r\n                  setCropOpen(true);\r\n                };\r\n                reader.readAsDataURL(f);\r\n              } catch {}\r\n            }}\r\n          />\r\n\r\n          <div className=\"pb-5 px-4\">\r\n            {/* MODE SWITCH */}\r\n            {viewMode === 'profile' && (\r\n              <ProfileView\r\n                user={user}\r\n                displayName={displayName}\r\n                displayId={displayId}\r\n                departmentOptions={departmentOptions.map((item) => ({\r\n                  value: String(item.id),\r\n                  label: item.name,\r\n                }))}\r\n                statusOptions={statusOptions.map((item) => ({\r\n                  value: String(item.value),\r\n                  label: item.label,\r\n                }))}\r\n                onEdit={() => setViewMode('editInfo')}\r\n                onChangePassword={() => setViewMode('changePassword')}\r\n              />\r\n            )}\r\n\r\n            {viewMode === 'editInfo' && (\r\n              <EditInfoView\r\n                form={form}\r\n                setForm={(updater) => {\r\n                  if (typeof updater === 'function') {\r\n                    setForm((prev) => {\r\n                      const next = (updater as (prev: typeof form) => Partial<typeof form>)(prev);\r\n                      return {\r\n                        name: String(next.name ?? prev.name),\r\n                        phone: String(next.phone ?? prev.phone),\r\n                        gender: String(next.gender ?? prev.gender),\r\n                        birthday: String(next.birthday ?? prev.birthday),\r\n                        email: String(next.email ?? prev.email),\r\n                        address: String(next.address ?? prev.address),\r\n                        title: String(next.title ?? prev.title),\r\n                        department: String(next.department ?? prev.department),\r\n                        status: String(next.status ?? prev.status),\r\n                      };\r\n                    });\r\n                  } else {\r\n                    setForm({\r\n                      name: String(updater.name ?? form.name),\r\n                      phone: String(updater.phone ?? form.phone),\r\n                      gender: String(updater.gender ?? form.gender),\r\n                      birthday: String(updater.birthday ?? form.birthday),\r\n                      email: String(updater.email ?? form.email),\r\n                      address: String(updater.address ?? form.address),\r\n                      title: String(updater.title ?? form.title),\r\n                      department: String(updater.department ?? form.department),\r\n                      status: String(updater.status ?? form.status),\r\n                    });\r\n                  }\r\n                }}\r\n                loading={loading}\r\n                departmentOptions={departmentOptions.map((item) => ({\r\n                  value: String(item.id),\r\n                  label: item.name,\r\n                }))}\r\n                statusOptions={statusOptions.map((item) => ({\r\n                  value: String(item.value),\r\n                  label: item.label,\r\n                }))}\r\n                onSubmit={() => updateUser(form)}\r\n                onCancel={() => setViewMode('profile')}\r\n              />\r\n            )}\r\n\r\n            {viewMode === 'changePassword' && (\r\n              <ChangePasswordView\r\n                form={passwordForm}\r\n                setForm={setPasswordForm}\r\n                loading={loading}\r\n                onSubmit={async () => {\r\n                  await updateUser(passwordForm);\r\n                  setViewMode('profile');\r\n                }}\r\n                onCancel={() => setViewMode('profile')}\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n        <CropImageModal\r\n          open={cropOpen}\r\n          src={cropSrc}\r\n          onClose={() => {\r\n            setCropOpen(false);\r\n          }}\r\n          onConfirm={async (file: File) => {\r\n            if (cropKind === 'avatar') {\r\n              await upload(file, () => pendingReset?.());\r\n            } else if (cropKind === 'background') {\r\n              try {\r\n                setIsUploadingBackground(true);\r\n                const MAX = 1024 * 1024 * 1024;\r\n                if (!file.type.startsWith('image/') || file.size > MAX) {\r\n                  toast({ type: 'error', message: 'Ảnh không hợp lệ hoặc quá lớn (>1GB)' });\r\n                  return;\r\n                }\r\n                const formData = new FormData();\r\n                formData.append('file', file);\r\n                formData.append('roomId', 'background');\r\n                formData.append('sender', String(user._id));\r\n                formData.append('receiver', '');\r\n                formData.append('type', 'image');\r\n                formData.append('folderName', 'Backgrounds');\r\n                const uploadRes = await fetch(`/api/upload?uploadId=background_${user._id}`, {\r\n                  method: 'POST',\r\n                  body: formData,\r\n                });\r\n                const uploadJson = await uploadRes.json();\r\n                if (!uploadRes.ok || !uploadJson.success || !uploadJson.link) {\r\n                  toast({ type: 'error', message: 'Upload thất bại' });\r\n                  return;\r\n                }\r\n                const newUrl = String(uploadJson.link);\r\n                let updateOk = false;\r\n                try {\r\n                  const res1 = await fetch('/api/users', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                      action: 'update',\r\n                      field: '_id',\r\n                      value: String(user._id),\r\n                      data: { background: newUrl },\r\n                    }),\r\n                  });\r\n                  const json1 = await res1.json();\r\n                  updateOk = res1.ok && !json1.error;\r\n                } catch {}\r\n                if (!updateOk) {\r\n                  try {\r\n                    const res2 = await fetch('/api/users', {\r\n                      method: 'POST',\r\n                      headers: { 'Content-Type': 'application/json' },\r\n                      body: JSON.stringify({\r\n                        action: 'update',\r\n                        field: 'username',\r\n                        value: String(user.username || ''),\r\n                        data: { background: newUrl },\r\n                      }),\r\n                    });\r\n                    const json2 = await res2.json();\r\n                    updateOk = res2.ok && !json2.error;\r\n                  } catch {}\r\n                }\r\n                if (!updateOk) {\r\n                  toast({ type: 'error', message: 'Cập nhật nền thất bại' });\r\n                  return;\r\n                }\r\n                try {\r\n                  const raw = localStorage.getItem('info_user');\r\n                  if (raw) {\r\n                    const parsed = JSON.parse(raw);\r\n                    localStorage.setItem('info_user', JSON.stringify({ ...parsed, background: newUrl }));\r\n                  }\r\n                } catch {}\r\n                onUserUpdated?.({ background: newUrl });\r\n                toast({ type: 'success', message: 'Cập nhật nền thành công!' });\r\n              } finally {\r\n                setIsUploadingBackground(false);\r\n                pendingReset?.();\r\n              }\r\n            }\r\n            setCropOpen(false);\r\n            setCropSrc(null);\r\n            setCropKind(null);\r\n          }}\r\n          aspectRatio={cropKind === 'background' ? 16 / 9 : 1}\r\n          circle={cropKind === 'avatar'}\r\n          fileName={cropFileName}\r\n          outputType=\"image/jpeg\"\r\n          quality={0.92}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2542, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/public/imgs/bannerzalo.png.mjs%20%28structured%20image%20object%20with%20data%20url%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 441, height: 80, blurWidth: 8, blurHeight: 1, blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAABCAYAAADjAO9DAAAAI0lEQVR42mOQy33yT6346X+W2If/GaIfADGQjgFiED/u0T8AJnISWO9FrscAAAAASUVORK5CYII=\"};\n"],"names":[],"mappings":";;;;AAAA;;uCACe;IAAE,KAAA,iJAAG;IAAE,OAAO;IAAK,QAAQ;IAAI,WAAW;IAAG,YAAY;IAAG,aAAa;AAAoJ"}},
    {"offset": {"line": 2563, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28menu%29/help.tsx"],"sourcesContent":["// components/ZaloContactCard.jsx\r\n\r\nimport React from 'react';\r\nimport Zalo from '@/public/imgs/bannerzalo.png';\r\nimport Image from 'next/image';\r\n\r\nconst ZaloContactCard = () => {\r\n  return (\r\n    <div className=\"w-120 h-60 rounded-xl overflow-hidden shadow-2xl bg-white\">\r\n      {/* HEADER SECTION (Màu xanh Zalo) */}\r\n      <div className=\"relative w-120 h-20\">\r\n        {/* Ảnh nền */}\r\n        <Image src={Zalo} alt=\"Zalo Banner\" fill className=\"object-cover \" priority />\r\n      </div>\r\n      {/* CONTENT SECTION (Thông tin liên hệ) */}\r\n      <div className=\"p-5\">\r\n        <h2 className=\"text-xl font-semibold text-gray-800 mb-4 \">Liên hệ</h2>\r\n\r\n        {/* Email Row */}\r\n        <div className=\"flex items-center mb-4 text-base\">\r\n          <span className=\"text-gray-600 font-medium w-32\">Email:</span>\r\n          <a\r\n            href=\"mailto:feedbackpc@zalo.me\"\r\n            className=\"text-[#0068FF] hover:text-blue-700 hover:underline transition duration-150 break-words\"\r\n          >\r\n            feedbackpc@zalo.me\r\n          </a>\r\n        </div>\r\n\r\n        {/* Website Row */}\r\n        <div className=\"flex items-center text-base\">\r\n          <span className=\"text-gray-600 font-medium w-32\">Website:</span>\r\n          <a\r\n            href=\"https://zalo.me/pc\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            className=\"text-[#0068FF] hover:text-blue-700 hover:underline transition duration-150 break-words\"\r\n          >\r\n            https://zalo.me/pc\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ZaloContactCard;\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;;AAGjC;AACA;;;;AAEA,MAAM,kBAAkB;IACtB,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;0BAEb,cAAA,6LAAC,2IAAK;oBAAC,KAAK,wUAAI;oBAAE,KAAI;oBAAc,IAAI;oBAAC,WAAU;oBAAgB,QAAQ;;;;;;;;;;;0BAG7E,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAA4C;;;;;;kCAG1D,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAAiC;;;;;;0CACjD,6LAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;;;;;;;kCAMH,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAAiC;;;;;;0CACjD,6LAAC;gCACC,MAAK;gCACL,QAAO;gCACP,KAAI;gCACJ,WAAU;0CACX;;;;;;;;;;;;;;;;;;;;;;;;AAOX;KAtCM;uCAwCS"}},
    {"offset": {"line": 2688, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/public/imgs/zCloud.png.mjs%20%28structured%20image%20object%20with%20data%20url%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 868, height: 540, blurWidth: 8, blurHeight: 5, blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAsElEQVR42gGlAFr/AAAAAAAFBgcBSFlgGYeswDSJrcE0RlZfFQUHBwEAAAAAAAAAAABASEwLttThPa7d+W2s2fhwuNfoO0NNUhABAQEBAAQFBQGHkpkVv9nyWHWs9NBpoPLfsdLzYXqWrV4IDhQUAAQFBwM9TFkjgqTPdFWI1dlTgtPZd5jKci88SCQBAgMDAAAAAAARGiMiKz9USBEaKSARGSkgFx0kEgcLDwoAAAAAQ2QyAhRAwfQAAAAASUVORK5CYII=\"};\n"],"names":[],"mappings":";;;;AAAA;;uCACe;IAAE,KAAA,6IAAG;IAAE,OAAO;IAAK,QAAQ;IAAK,WAAW;IAAG,YAAY;IAAG,aAAa;AAAgV"}},
    {"offset": {"line": 2709, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28menu%29/icloud.tsx"],"sourcesContent":["import React from 'react';\r\nimport Zicloud from '@/public/imgs/zCloud.png';\r\nimport Image from 'next/image';\r\n\r\ninterface ZaloCloudPopupProps {\r\n  onClose: () => void; // bắt buộc có hàm onClose\r\n}\r\n\r\nconst ZaloCloudPopup: React.FC<ZaloCloudPopupProps> = ({ onClose }) => {\r\n  return (\r\n    <div className=\"relative w-85 ml-1 bg-white rounded-xl overflow-hidden shadow-xl border border-gray-200\">\r\n      {/* Close Button */}\r\n      <button\r\n        onClick={onClose}\r\n        className=\"cursor-pointer absolute top-2 right-2 text-gray-400 hover:text-gray-600 p-1\"\r\n        aria-label=\"Close\"\r\n      >\r\n        <svg\r\n          className=\"w-5 h-5\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n        >\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n        </svg>\r\n      </button>\r\n\r\n      {/* Top Image Section */}\r\n      <div className=\"bg-[#f0f7ff] p-4 flex flex-col items-center justify-center relative\">\r\n        <Image priority width={100} height={40} src={Zicloud.src} alt=\"ZCloud\" className=\"w-100 h-40 object-contain\" />\r\n\r\n        {/* Accent Elements */}\r\n        <span className=\"absolute top-2 left-1/4 w-2 h-2 bg-red-500 rounded-full rotate-45\"></span>\r\n        <span className=\"absolute top-6 right-1/4 w-2 h-2 bg-yellow-400 rounded-full\"></span>\r\n        <span className=\"absolute bottom-6 left-6 w-3 h-3 bg-blue-400 rounded-lg\"></span>\r\n        <span className=\"absolute bottom-8 right-10 w-2 h-2 bg-green-500 rounded-full\"></span>\r\n      </div>\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-4\">\r\n        <h2 className=\"text-lg font-bold text-gray-900 mb-2\">Bảo toàn dữ liệu Zalo với zCloud</h2>\r\n        <p className=\"text-sm text-gray-600 leading-relaxed mb-4\">\r\n          Khám phá ngay tiện ích lưu trữ an toàn ảnh, video, và tệp quan trọng trên zCloud, đồng thời giải phóng dung\r\n          lượng máy.\r\n        </p>\r\n\r\n        <button className=\"cursor-pointer w-full py-2 bg-[#e8e9ea] text-sm font-semibold text-gray-800 rounded-lg hover:bg-[#dcdde0] transition duration-200\">\r\n          Tìm hiểu zCloud ngay\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ZaloCloudPopup;\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAMA,MAAM,iBAAgD,CAAC,EAAE,OAAO,EAAE;IAChE,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBACC,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEX,cAAA,6LAAC;oBACC,WAAU;oBACV,MAAK;oBACL,QAAO;oBACP,SAAQ;oBACR,OAAM;8BAEN,cAAA,6LAAC;wBAAK,eAAc;wBAAQ,gBAAe;wBAAQ,aAAY;wBAAI,GAAE;;;;;;;;;;;;;;;;0BAKzE,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,2IAAK;wBAAC,QAAQ;wBAAC,OAAO;wBAAK,QAAQ;wBAAI,KAAK,gUAAO,CAAC,GAAG;wBAAE,KAAI;wBAAS,WAAU;;;;;;kCAGjF,6LAAC;wBAAK,WAAU;;;;;;kCAChB,6LAAC;wBAAK,WAAU;;;;;;kCAChB,6LAAC;wBAAK,WAAU;;;;;;kCAChB,6LAAC;wBAAK,WAAU;;;;;;;;;;;;0BAIlB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCAAuC;;;;;;kCACrD,6LAAC;wBAAE,WAAU;kCAA6C;;;;;;kCAK1D,6LAAC;wBAAO,WAAU;kCAAoI;;;;;;;;;;;;;;;;;;AAM9J;KA7CM;uCA+CS"}},
    {"offset": {"line": 2853, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/ui/ConfirmModal.tsx"],"sourcesContent":["import React from 'react';\r\nimport { HiX, HiLogout } from 'react-icons/hi';\r\nimport { HiExclamationTriangle } from 'react-icons/hi2';\r\n\r\nexport const ConfirmModal: React.FC<{\r\n  title: string;\r\n  message: string;\r\n  onCancel: () => void;\r\n  onConfirm: () => void;\r\n  confirmText?: string; // Tùy chọn: \"Xóa\", \"Rời nhóm\", \"Đăng xuất\"...\r\n  variant?: 'danger' | 'warning'; // Màu nút xác nhận\r\n}> = ({ title, message, onCancel, onConfirm, confirmText = 'Xác nhận', variant = 'danger' }) => {\r\n  const isDanger = variant === 'danger';\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm px-4\">\r\n      <div\r\n        className=\"bg-white rounded-3xl md:rounded-none shadow-2xl md:shadow-none overflow-hidden    animate-in fade-in zoom-in-95 duration-300\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header với icon cảnh báo + nút đóng */}\r\n        <div className=\"relative px-8 pt-10 pb-6 text-center\">\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"absolute top-4 cursor-pointer right-4 p-2.5 rounded-full bg-gray-100 hover:bg-gray-200 transition-all active:scale-95\"\r\n          >\r\n            <HiX className=\"w-5 h-5 text-gray-600\" />\r\n          </button>\r\n\r\n          {/* Icon cảnh báo lớn */}\r\n          <div className=\"mx-auto w-20 h-20 rounded-full bg-red-100 flex items-center justify-center mb-5\">\r\n            {isDanger ? (\r\n              <HiExclamationTriangle className=\"w-12 h-12 text-red-600\" />\r\n            ) : (\r\n              <HiExclamationTriangle className=\"w-12 h-12 text-yellow-600\" />\r\n            )}\r\n          </div>\r\n\r\n          <h3 className=\"text-2xl font-bold text-gray-900\">{title}</h3>\r\n        </div>\r\n\r\n        {/* Nội dung */}\r\n        <div className=\"px-8 pb-8\">\r\n          <p className=\"text-gray-600 text-center text-lg leading-relaxed\">{message}</p>\r\n        </div>\r\n\r\n        {/* Footer - Nút hành động */}\r\n        <div className=\"flex gap-4 px-8 pb-8\">\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"flex-1 cursor-pointer py-4 bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold text-lg rounded-2xl transition-all duration-200 active:scale-95 shadow-md\"\r\n          >\r\n            Hủy\r\n          </button>\r\n          <button\r\n            onClick={onConfirm}\r\n            className={`flex-1 cursor-pointer py-4 font-bold text-lg rounded-2xl shadow-xl transition-all duration-300 active:scale-95 flex items-center justify-center gap-3\r\n              ${\r\n                isDanger\r\n                  ? 'bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-700 hover:to-rose-700 text-white shadow-red-300'\r\n                  : 'bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white shadow-orange-300'\r\n              }`}\r\n          >\r\n            {confirmText === 'Đăng xuất' && <HiLogout className=\"w-6 h-6\" />}\r\n            {confirmText.includes('Xóa') && <HiExclamationTriangle className=\"w-6 h-6\" />}\r\n            {confirmText}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAEO,MAAM,eAOR,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,cAAc,UAAU,EAAE,UAAU,QAAQ,EAAE;IACzF,MAAM,WAAW,YAAY;IAE7B,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAGjC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,SAAS;4BACT,WAAU;sCAEV,cAAA,6LAAC,wJAAG;gCAAC,WAAU;;;;;;;;;;;sCAIjB,6LAAC;4BAAI,WAAU;sCACZ,yBACC,6LAAC,2KAAqB;gCAAC,WAAU;;;;;yFAEjC,6LAAC,2KAAqB;gCAAC,WAAU;;;;;;;;;;;sCAIrC,6LAAC;4BAAG,WAAU;sCAAoC;;;;;;;;;;;;8BAIpD,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAE,WAAU;kCAAqD;;;;;;;;;;;8BAIpE,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,SAAS;4BACT,WAAU;sCACX;;;;;;sCAGD,6LAAC;4BACC,SAAS;4BACT,WAAW,CAAC;cACV,EACE,WACI,6GACA,yHACJ;;gCAEH,gBAAgB,6BAAe,6LAAC,6JAAQ;oCAAC,WAAU;;;;;;gCACnD,YAAY,QAAQ,CAAC,wBAAU,6LAAC,2KAAqB;oCAAC,WAAU;;;;;;gCAChE;;;;;;;;;;;;;;;;;;;;;;;;AAMb;KAnEa"}},
    {"offset": {"line": 3004, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28menu%29/menu.tsx"],"sourcesContent":["'use client';\r\n/* eslint-disable @typescript-eslint/no-unused-vars */\r\n\r\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Image from 'next/image';\r\n\r\nimport { cookieBase } from '../../utils/cookie';\r\nimport { getProxyUrl } from '../../utils/utils';\r\nimport { User } from '../../types/User';\r\n\r\nimport PopupProfile from '../base/PopupProfile';\r\nimport ZaloContactCard from './help';\r\nimport ZaloCloudPopup from './icloud';\r\nimport { ConfirmModal } from '@/components/ui/ConfirmModal';\r\n\r\n// React Icons - Full modern set\r\nimport {\r\n  HiHome,\r\n  HiUserGroup,\r\n  HiBriefcase,\r\n  HiCog,\r\n  HiQuestionMarkCircle,\r\n  HiOutlineTranslate,\r\n  HiLogout,\r\n  HiUserCircle,\r\n  HiChevronRight,\r\n  HiChevronDown,\r\n  HiLightningBolt,\r\n  HiCollection,\r\n  HiChatAlt2,\r\n  HiStar,\r\n  HiClock,\r\n  HiUpload,\r\n  HiDeviceMobile,\r\n  HiInformationCircle,\r\n  HiSupport,\r\n  HiDocumentText,\r\n  HiBookOpen,\r\n  HiCheck,\r\n} from 'react-icons/hi';\r\nimport { FaPager } from 'react-icons/fa6';\r\nimport { HiRectangleGroup } from 'react-icons/hi2';\r\n// import { FaPager } from 'react-icons/fa6';\r\n\r\ninterface SidebarMenuProps {\r\n  totalUnread?: number;\r\n  unreadGroups?: number;\r\n  unreadContacts?: number;\r\n}\r\n\r\nexport default function SidebarMenu({ totalUnread = 0, unreadGroups = 0, unreadContacts = 0 }: SidebarMenuProps) {\r\n  const router = useRouter();\r\n\r\n  const [openMenu, setOpenMenu] = useState<{\r\n    avatar: boolean;\r\n    business: boolean;\r\n    cloud: boolean;\r\n    submenu: 'lang' | 'support' | null;\r\n  }>({\r\n    avatar: false,\r\n    business: false,\r\n    cloud: false,\r\n    submenu: null,\r\n  });\r\n\r\n  const [activeItem, setActiveItem] = useState<string>('home');\r\n  const [showContactCard, setShowContactCard] = useState(false);\r\n  const [showAccountModal, setShowAccountModal] = useState(false);\r\n  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);\r\n  const [userInfo, setUserInfo] = useState<User | null>(null);\r\n\r\n  const avatarRef = useRef<HTMLDivElement>(null);\r\n  const businessRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Load user\r\n  useEffect(() => {\r\n    try {\r\n      const raw = localStorage.getItem('info_user');\r\n      if (raw) setUserInfo(JSON.parse(raw));\r\n    } catch (e) {\r\n      console.error('Failed to parse info_user', e);\r\n    }\r\n  }, []);\r\n\r\n  // Click outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      if (avatarRef.current && !avatarRef.current.contains(e.target as Node)) {\r\n        setOpenMenu((prev) => ({ ...prev, avatar: false, submenu: null }));\r\n      }\r\n      if (businessRef.current && !businessRef.current.contains(e.target as Node)) {\r\n        setOpenMenu((prev) => ({ ...prev, business: false }));\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  const handleLogout = () => {\r\n    setShowLogoutConfirm(true);\r\n    setOpenMenu((prev) => ({ ...prev, avatar: false }));\r\n  };\r\n\r\n  const finalizeLogout = async () => {\r\n    try {\r\n      await fetch('/api/users', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'logout' }),\r\n      });\r\n    } catch (err) {\r\n      console.error('Logout error:', err);\r\n    }\r\n\r\n    cookieBase.remove('session_token');\r\n    cookieBase.remove('remember_login');\r\n    localStorage.removeItem('info_user');\r\n    localStorage.removeItem('remember_login');\r\n    router.push('/');\r\n  };\r\n\r\n  const navigate = useCallback(\r\n    (path: string, key: string) => {\r\n      setActiveItem(key);\r\n      router.push(path);\r\n    },\r\n    [router],\r\n  );\r\n\r\n  const toggleMenu = (menu: keyof typeof openMenu, value?: boolean) => {\r\n    setOpenMenu((prev) => ({\r\n      ...prev,\r\n      [menu]: value !== undefined ? value : !prev[menu],\r\n      submenu: menu === 'avatar' && value !== true ? null : prev.submenu,\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Sidebar Gradient */}\r\n      <div className=\"h-screen w-16 bg-blue-400 flex flex-col items-center py-6 text-white shadow-2xl\">\r\n        {/* Avatar Dropdown */}\r\n        <div ref={avatarRef} className=\"mb-10 relative\">\r\n          <button\r\n            onClick={() => toggleMenu('avatar')}\r\n            className=\"group cursor-pointer relative w-10 h-10 rounded-full overflow-hidden ring-2 ring-white/30 hover:ring-yellow-400 transition-all duration-300 shadow-2xl\"\r\n          >\r\n            {userInfo?.avatar ? (\r\n              <Image\r\n                src={getProxyUrl(userInfo.avatar)}\r\n                width={56}\r\n                height={56}\r\n                alt={userInfo.name}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            ) : (\r\n              <Image\r\n                src=\"/logo/avata.webp\"\r\n                alt={userInfo?.name || 'User'}\r\n                width={56}\r\n                height={56}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            )}\r\n            <div className=\"absolute inset-0 rounded-full bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\r\n          </button>\r\n\r\n          {/* Avatar Menu */}\r\n          {openMenu.avatar && userInfo && (\r\n            <div className=\"absolute left-4 top-12 w-80 bg-white text-gray-800 rounded-lg shadow-xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-4 duration-300 border border-gray-100\">\r\n              {/* Header - Name */}\r\n              <div className=\"px-4 py-4\">\r\n                <h3 className=\"text-xl font-bold text-gray-900\">{userInfo.name}</h3>\r\n              </div>\r\n\r\n              <div className=\"h-px bg-gray-100 mx-4\" />\r\n\r\n              {/* Menu Items */}\r\n              <div className=\"py-2\">\r\n                {/* Hồ sơ của bạn */}\r\n                <div\r\n                  className=\"flex items-center justify-between px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors\"\r\n                  onClick={() => {\r\n                    setOpenMenu({ avatar: false, business: false, cloud: false, submenu: null });\r\n                    router.push(`/profile/${userInfo.username}`);\r\n                  }}\r\n                >\r\n                  <span className=\"text-gray-700 font-medium\">Hồ sơ của bạn</span>\r\n                </div>\r\n\r\n                {/* Cài đặt */}\r\n                <div\r\n                  className=\"flex items-center justify-between px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors\"\r\n                  onClick={() => {\r\n                    setOpenMenu({ avatar: false, business: false, cloud: false, submenu: null });\r\n                    setShowAccountModal(true);\r\n                  }}\r\n                >\r\n                  <span className=\"text-gray-700 font-medium\">Tài khoản</span>\r\n                </div>\r\n\r\n                <div className=\"h-px bg-gray-100 mx-4 my-1\" />\r\n\r\n                {/* Đăng xuất */}\r\n                <div\r\n                  className=\"flex items-center justify-between px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors\"\r\n                  onClick={() => {\r\n                    setOpenMenu({ avatar: false, business: false, cloud: false, submenu: null });\r\n                    handleLogout();\r\n                  }}\r\n                >\r\n                  <span className=\"text-gray-700 font-medium\">Đăng xuất</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Main Navigation */}\r\n        <nav className=\"flex-1 flex flex-col items-center gap-4 mt-4\">\r\n          <button\r\n            onClick={() => navigate('/home', 'home')}\r\n            className={`relative p-2 cursor-pointer rounded-[0.5rem] transition-all duration-300 ${activeItem === 'home' ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n          >\r\n            <HiHome className=\"w-5 h-5\" />\r\n            {totalUnread > 0 && (\r\n              <span className=\"absolute -top-2 -right-2 min-w-[1.25rem] h-5 px-1 rounded-full bg-red-600 text-white text-[10px] font-bold flex items-center justify-center shadow-sm\">\r\n                {totalUnread > 99 ? '99+' : totalUnread}\r\n              </span>\r\n            )}\r\n          </button>\r\n          <button\r\n            onClick={() => navigate('/group', 'group')}\r\n            className={`relative p-2 cursor-pointer rounded-[0.5rem] transition-all duration-300 ${activeItem === 'group' ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n          >\r\n            <HiRectangleGroup className=\"w-5 h-5\" />\r\n            {unreadGroups > 0 && (\r\n              <span className=\"absolute -top-2 -right-2 min-w-[1.25rem] h-5 px-1 rounded-full bg-red-600 text-white text-[10px] font-bold flex items-center justify-center shadow-sm\">\r\n                {unreadGroups > 99 ? '99+' : unreadGroups}\r\n              </span>\r\n            )}\r\n          </button>\r\n          <button\r\n            onClick={() => navigate('/moments', 'moments')}\r\n            className={`p-2 cursor-pointer rounded-[0.5rem] transition-all duration-300 ${activeItem === 'moments' ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n          >\r\n            <FaPager className=\"w-5 h-5\" />\r\n          </button>\r\n          <button\r\n            onClick={() => navigate('/directory', 'directory')}\r\n            className={`relative p-2 cursor-pointer rounded-[0.5rem] transition-all duration-300 ${activeItem === 'directory' ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n          >\r\n            <HiUserGroup className=\"w-5 h-5\" />\r\n            {unreadContacts > 0 && (\r\n              <span className=\"absolute -top-2 -right-2 min-w-[1.25rem] h-5 px-1 rounded-full bg-red-600 text-white text-[10px] font-bold flex items-center justify-center shadow-sm\">\r\n                {unreadContacts > 99 ? '99+' : unreadContacts}\r\n              </span>\r\n            )}\r\n          </button>\r\n          <button\r\n            onClick={() => {\r\n              if (userInfo?._id) {\r\n                navigate(`/profile/${userInfo._id}`, 'profile');\r\n              } else {\r\n                console.warn('User info or ID missing');\r\n              }\r\n            }}\r\n            className={`p-2 cursor-pointer rounded-[0.5rem] transition-all duration-300 ${activeItem === 'profile' ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n          >\r\n            <HiUserCircle className=\"w-5 h-5\" />\r\n          </button>\r\n        </nav>\r\n\r\n        {/* Bottom Actions */}\r\n        <div className=\"flex flex-col gap-4\">\r\n          {/* Cloud Z */}\r\n          <div className=\"relative\">\r\n            <button\r\n              onClick={() => toggleMenu('cloud')}\r\n              className={`p-2 cursor-pointer rounded-[0.5rem] transition-all duration-300 ${openMenu.cloud ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n            >\r\n              <HiUpload className=\"w-5 h-5\" />\r\n            </button>\r\n            {openMenu.cloud && (\r\n              <div className=\"absolute left-24 bottom-0 z-50\">\r\n                <ZaloCloudPopup onClose={() => toggleMenu('cloud', false)} />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <button className=\"p-2 cursor-pointer rounded-[0.5rem] hover:bg-white/10 hover:scale-110 transition-all\">\r\n            <HiDeviceMobile className=\"w-5 h-5\" />\r\n          </button>\r\n\r\n          {/* zBusiness */}\r\n          <div ref={businessRef} className=\"relative\">\r\n            <button\r\n              onClick={() => toggleMenu('business')}\r\n              className={`p-2 cursor-pointer rounded-[0.5rem] transition-all duration-300 ${openMenu.business ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n            >\r\n              <HiBriefcase className=\"w-5 h-5\" />\r\n            </button>\r\n            {openMenu.business && (\r\n              <div className=\"absolute left-24 bottom-0 w-96 bg-white rounded-3xl shadow-2xl p-8 z-50 border border-gray-100\">\r\n                <h3 className=\"text-2xl font-bold text-gray-800 mb-8\">Công cụ zBusiness</h3>\r\n                <div className=\"grid grid-cols-3 gap-8\">\r\n                  {[\r\n                    { icon: <HiLightningBolt className=\"w-10 h-10 text-yellow-500\" />, label: 'Tin nhắn nhanh' },\r\n                    { icon: <HiCollection className=\"w-10 h-10 text-gray-400\" />, label: 'Danh mục', disabled: true },\r\n                    {\r\n                      icon: <HiChatAlt2 className=\"w-10 h-10 text-gray-400\" />,\r\n                      label: 'Trả lời tự động',\r\n                      disabled: true,\r\n                    },\r\n                    { icon: <HiStar className=\"w-10 h-10 text-purple-500\" />, label: 'Tin đánh dấu' },\r\n                    { icon: <HiClock className=\"w-10 h-10 text-gray-400\" />, label: 'Tin đồng thời', disabled: true },\r\n                    { icon: <HiDocumentText className=\"w-10 h-10 text-blue-500\" />, label: 'Ghi chú' },\r\n                  ].map((tool, i) => (\r\n                    <div\r\n                      key={i}\r\n                      className={`text-center ${tool.disabled ? 'opacity-40' : 'cursor-pointer hover:scale-110 transition-transform'}`}\r\n                    >\r\n                      <div className=\"w-20 h-20 bg-gray-100 rounded-3xl flex items-center justify-center shadow-xl mb-3 mx-auto\">\r\n                        {tool.icon}\r\n                      </div>\r\n                      <p className=\"text-sm font-medium text-gray-700\">{tool.label}</p>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <button\r\n            className={`p-2 cursor-pointer rounded-2xl transition-all duration-300 ${activeItem === 'setting' ? 'bg-white/20 shadow-xl scale-110' : 'hover:bg-white/10 hover:scale-110'}`}\r\n          >\r\n            <HiCog className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      {showLogoutConfirm && (\r\n        <ConfirmModal\r\n          title=\"Đăng xuất\"\r\n          message=\"Bạn có chắc chắn muốn thoát khỏi tài khoản hiện tại?\"\r\n          confirmText=\"Đăng xuất\"\r\n          onCancel={() => setShowLogoutConfirm(false)}\r\n          onConfirm={finalizeLogout}\r\n        />\r\n      )}\r\n\r\n      {showContactCard && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4\"\r\n          onClick={() => setShowContactCard(false)}\r\n        >\r\n          <div onClick={(e) => e.stopPropagation()}>\r\n            <ZaloContactCard />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {userInfo && (\r\n        <PopupProfile\r\n          isOpen={showAccountModal}\r\n          onClose={() => setShowAccountModal(false)}\r\n          user={userInfo}\r\n          onAvatarUpdated={(newUrl) => setUserInfo((prev) => (prev ? { ...prev, avatar: newUrl } : null))}\r\n          onUserUpdated={(updated) => setUserInfo((prev) => (prev ? { ...prev, ...updated } : prev))}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3713, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/fetch/messages.ts"],"sourcesContent":["'use client';\r\n\r\nimport type { Message, MessageCreate } from '@/types/Message';\r\n\r\ninterface MessagesApiResponse<T = unknown> {\r\n  success?: boolean;\r\n  data?: T;\r\n  _id?: string;\r\n  message?: string;\r\n}\r\n\r\nexport async function createMessageApi(payload: MessageCreate & { roomId: string }): Promise<MessagesApiResponse> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'create',\r\n      data: payload,\r\n    }),\r\n  });\r\n  const ct = res.headers.get('content-type') || '';\r\n  if (ct.includes('application/json')) {\r\n    return res.json();\r\n  }\r\n  return { success: false, message: res.statusText };\r\n}\r\n\r\nexport async function readMessagesApi(\r\n  roomId: string,\r\n  options?: { skip?: number; limit?: number; before?: number; sortOrder?: 'asc' | 'desc'; extraFilters?: Record<string, unknown> },\r\n): Promise<MessagesApiResponse<Message[]>> {\r\n  try {\r\n    const filters: Record<string, unknown> = { roomId, ...(options?.extraFilters || {}) };\r\n    if (typeof options?.before === 'number') {\r\n      filters.timestamp = { $lt: options.before };\r\n    }\r\n    const res = await fetch('/api/messages', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        action: 'read',\r\n        filters,\r\n        skip: options?.skip ?? 0,\r\n        limit: options?.limit ?? 20,\r\n        sort: { field: 'timestamp', order: options?.sortOrder ?? 'desc' },\r\n      }),\r\n    });\r\n    if (!res.ok) {\r\n      return { success: false, message: res.statusText };\r\n    }\r\n    return res.json();\r\n  } catch (error) {\r\n    console.error('readMessagesApi error:', error);\r\n    return { success: false, message: String(error) };\r\n  }\r\n}\r\n\r\nexport async function readPinnedMessagesApi(\r\n  roomId: string,\r\n  options?: { skip?: number; limit?: number },\r\n): Promise<MessagesApiResponse<Message[]>> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'read',\r\n      filters: { roomId, isPinned: true },\r\n      skip: options?.skip ?? 0,\r\n      limit: options?.limit ?? 10,\r\n      sort: { field: 'pinnedAt', order: 'desc' },\r\n    }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function togglePinMessageApi(messageId: string, isPinned: boolean): Promise<MessagesApiResponse> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'togglePin',\r\n      messageId,\r\n      data: { isPinned },\r\n    }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function recallMessageApi(roomId: string, messageId: string): Promise<MessagesApiResponse> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'recall',\r\n      messageId,\r\n      roomId,\r\n    }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function markAsReadApi(roomId: string, userId: string): Promise<void> {\r\n  await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'markAsRead',\r\n      roomId,\r\n      userId,\r\n    }),\r\n  });\r\n}\r\n\r\nexport async function updateMessageApi(messageId: string, data: Partial<MessageCreate & Message>): Promise<MessagesApiResponse> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'update',\r\n      field: '_id',\r\n      value: messageId,\r\n      data,\r\n    }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function deleteMessageApi(messageId: string): Promise<MessagesApiResponse> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'delete',\r\n      field: '_id',\r\n      value: messageId,\r\n    }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function fireReminderOnceApi(messageId: string): Promise<{ success: boolean; modifiedCount?: number }> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'updateMany',\r\n      filters: { _id: messageId, reminderFired: { $ne: true } },\r\n      data: { reminderFired: true },\r\n    }),\r\n  });\r\n  const json = await res.json();\r\n  return { success: !!json.success, modifiedCount: json.modifiedCount };\r\n}\r\n\r\nexport async function tryLockPollApi(\r\n  messageId: string,\r\n  updates: { isPollLocked: true; pollLockedAt: number; editedAt: number; timestamp: number },\r\n): Promise<{ success: boolean; modifiedCount?: number }> {\r\n  const res = await fetch('/api/messages', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({\r\n      action: 'updateMany',\r\n      filters: { _id: messageId, isPollLocked: { $ne: true } },\r\n      data: updates,\r\n    }),\r\n  });\r\n  const json = await res.json();\r\n  return { success: !!json.success, modifiedCount: json.modifiedCount };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3947, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28call%29/IncomingCallModal.tsx"],"sourcesContent":["import React from 'react';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport { HiPhone, HiVideoCamera } from 'react-icons/hi2';\r\nimport { PiPhoneDisconnectFill } from 'react-icons/pi';\r\n\r\ntype Props = {\r\n  avatar?: string;\r\n  name: string;\r\n  onAccept: () => void | Promise<void>;\r\n  onReject: () => void | Promise<void>;\r\n  acceptText?: string;\r\n  rejectText?: string;\r\n  titleText?: string;\r\n  callType?: 'voice' | 'video';\r\n};\r\n\r\nexport default function IncomingCallModal({\r\n  avatar,\r\n  name,\r\n  onAccept,\r\n  onReject,\r\n  titleText = 'Cuộc gọi đến',\r\n  callType = 'voice',\r\n}: Props) {\r\n  return (\r\n    <div className=\"relative w-full min-h-[46vh] md:min-h-[24rem] md:max-h-[28rem] md:rounded-xl rounded-none overflow-hidden bg-black md:pt-10 pt-16\">\r\n      {avatar && (\r\n        <Image\r\n          src={getProxyUrl(avatar)}\r\n          alt={name || ''}\r\n          fill\r\n          className=\"object-cover blur-xl opacity-40\"\r\n          sizes=\"100vw\"\r\n        />\r\n      )}\r\n      <div className=\"absolute inset-0 bg-black/40\" />\r\n      <div className=\"relative z-10 h-full flex flex-col items-center justify-center gap-4\">\r\n        <div className=\"flex flex-col items-center gap-3\">\r\n          {avatar ? (\r\n            <div className=\"w-24 h-24 rounded-full overflow-hidden ring-4 ring-white/60\">\r\n              <Image\r\n                src={getProxyUrl(avatar)}\r\n                alt={name || ''}\r\n                width={96}\r\n                height={96}\r\n                className=\"w-full h-full  object-cover\"\r\n              />\r\n            </div>\r\n          ) : (\r\n            <div className=\"w-24 h-24 rounded-full bg-gray-500 flex items-center justify-center text-white text-2xl font-semibold ring-4 ring-white/60\">\r\n              <Image\r\n                src=\"/logo/avata.webp\"\r\n                alt={name}\r\n                width={64}\r\n                height={64}\r\n                className=\"w-full h-full rounded-full object-cover\"\r\n              />\r\n            </div>\r\n          )}\r\n          <div className=\"text-white font-medium text-base\">{name}</div>\r\n          <div className=\"text-white/80 text-sm\">\r\n            {titleText || (callType === 'video' ? 'Cuộc gọi video đến' : 'Cuộc gọi thoại đến')}\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-6 flex items-center justify-center gap-4\">\r\n          <button\r\n            className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n            onClick={() => void onAccept()}\r\n            title={titleText || 'Chấp nhận'}\r\n          >\r\n            {callType === 'video' ? (\r\n              <HiVideoCamera className=\"w-7 h-7 text-green-500\" />\r\n            ) : (\r\n              <HiPhone className=\"w-7 h-7 text-green-500\" />\r\n            )}\r\n          </button>\r\n          <button\r\n            className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n            onClick={() => void onReject()}\r\n            title=\"Từ chối\"\r\n          >\r\n            {callType === 'video' ? (\r\n              <PiPhoneDisconnectFill className=\"w-7 h-7 text-red-500\" />\r\n            ) : (\r\n              <PiPhoneDisconnectFill className=\"w-7 h-7 text-red-500\" />\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;;;;AAae,SAAS,kBAAkB,EACxC,MAAM,EACN,IAAI,EACJ,QAAQ,EACR,QAAQ,EACR,YAAY,cAAc,EAC1B,WAAW,OAAO,EACZ;IACN,qBACE,6LAAC;QAAI,WAAU;;YACZ,wBACC,6LAAC,2IAAK;gBACJ,KAAK,IAAA,uIAAW,EAAC;gBACjB,KAAK,QAAQ;gBACb,IAAI;gBACJ,WAAU;gBACV,OAAM;;;;;;0BAGV,6LAAC;gBAAI,WAAU;;;;;;0BACf,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;4BACZ,uBACC,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,2IAAK;oCACJ,KAAK,IAAA,uIAAW,EAAC;oCACjB,KAAK,QAAQ;oCACb,OAAO;oCACP,QAAQ;oCACR,WAAU;;;;;;;;;;qDAId,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,2IAAK;oCACJ,KAAI;oCACJ,KAAK;oCACL,OAAO;oCACP,QAAQ;oCACR,WAAU;;;;;;;;;;;0CAIhB,6LAAC;gCAAI,WAAU;0CAAoC;;;;;;0CACnD,6LAAC;gCAAI,WAAU;0CACZ,aAAa,CAAC,aAAa,UAAU,uBAAuB,oBAAoB;;;;;;;;;;;;kCAGrF,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,WAAU;gCACV,SAAS,IAAM,KAAK;gCACpB,OAAO,aAAa;0CAEnB,aAAa,wBACZ,6LAAC,mKAAa;oCAAC,WAAU;;;;;yDAEzB,6LAAC,6JAAO;oCAAC,WAAU;;;;;;;;;;;0CAGvB,6LAAC;gCACC,WAAU;gCACV,SAAS,IAAM,KAAK;gCACpB,OAAM;0CAEL,aAAa,wBACZ,6LAAC,0KAAqB;oCAAC,WAAU;;;;;yDAEjC,6LAAC,0KAAqB;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO/C;KA3EwB"}},
    {"offset": {"line": 4122, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/svg/MicOffIcon.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\nconst MicOffIcon = ({\r\n  className,\r\n  stroke,\r\n  title\r\n}: {\r\n  className?: string;\r\n  stroke?: string;\r\n  title?: string;\r\n}) => {\r\n  return (\r\n    <div>\r\n      <svg\r\n        className={className}\r\n        width=\"800px\"\r\n        height=\"800px\"\r\n        viewBox=\"0 0 56 56\"\r\n        fill=\"none\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n      >\r\n        {title && <title>{title}</title>}\r\n        <path\r\n          d=\"M 33.7891 25.5859 L 33.7891 11.2656 C 33.7891 6.9297 30.8828 3.7187 26.711 3.7187 C 22.6094 3.7187 19.6094 6.8125 19.6094 11.0078 L 19.6094 11.3828 Z\"\r\n          fill={stroke || \"#000\"}\r\n        />\r\n        <path\r\n          d=\"M 46.3281 47.1484 C 47.0313 47.8516 48.1797 47.8516 48.8594 47.1484 C 49.5859 46.4687 49.5859 45.2969 48.8594 44.5937 L 9.6719 5.4062 C 8.9688 4.7031 7.7735 4.7031 7.0938 5.4062 C 6.4141 6.1094 6.4141 7.2813 7.0938 7.9609 Z\"\r\n          fill={stroke || \"#000\"}\r\n        />\r\n        <path\r\n          d=\"M 15.7657 48.7422 C 14.8281 48.7422 13.9844 49.5859 13.9844 50.5234 C 13.9844 51.4609 14.8281 52.2813 15.7657 52.2813 L 37.6328 52.2813 C 38.5703 52.2813 39.4141 51.4609 39.4141 50.5234 C 39.4141 49.5859 38.5703 48.7422 37.6328 48.7422 L 28.4688 48.7422 L 28.4688 43.6094 C 31.4453 43.3516 34.0469 42.3906 36.1797 40.8906 L 33.6719 38.3828 C 31.7735 39.6484 29.4062 40.375 26.711 40.375 C 19.3516 40.375 14.2188 35.125 14.2188 27.9766 L 14.2188 22.5391 C 14.2188 21.4375 13.5157 20.7578 12.4844 20.7578 C 11.4531 20.7578 10.7735 21.4375 10.7735 22.5391 L 10.7735 27.9766 C 10.7735 36.5547 16.3984 42.8594 24.9297 43.6094 L 24.9297 48.7422 Z\"\r\n          fill={stroke || \"#000\"}\r\n        />\r\n        <path\r\n          d=\"M 42.625 22.5391 C 42.625 21.4375 41.9453 20.7578 40.9141 20.7578 C 39.8828 20.7578 39.1797 21.4375 39.1797 22.5391 L 39.1797 27.9766 C 39.1797 28.914 39.0859 29.8047 38.8984 30.6953 L 41.7578 33.5313 C 42.3203 31.8203 42.625 29.9687 42.625 27.9766 Z\"\r\n          fill={stroke || \"#000\"}\r\n        />\r\n        <path\r\n          d=\"M 29.9453 34.6562 L 19.6094 24.3203 L 19.6094 28 C 19.6094 32.3125 22.5157 35.5469 26.711 35.5469 C 27.9531 35.5469 29.0313 35.2187 29.9453 34.6562 Z\"\r\n          fill={stroke || \"#000\"}\r\n        />\r\n      </svg>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MicOffIcon;\r\n"],"names":[],"mappings":";;;;;;AAEA,MAAM,aAAa,CAAC,EAClB,SAAS,EACT,MAAM,EACN,KAAK,EAKN;IACC,qBACE,6LAAC;kBACC,cAAA,6LAAC;YACC,WAAW;YACX,OAAM;YACN,QAAO;YACP,SAAQ;YACR,MAAK;YACL,OAAM;;gBAEL,uBAAS,6LAAC;8BAAO;;;;;;8BAClB,6LAAC;oBACC,GAAE;oBACF,MAAM,UAAU;;;;;;8BAElB,6LAAC;oBACC,GAAE;oBACF,MAAM,UAAU;;;;;;8BAElB,6LAAC;oBACC,GAAE;oBACF,MAAM,UAAU;;;;;;8BAElB,6LAAC;oBACC,GAAE;oBACF,MAAM,UAAU;;;;;;8BAElB,6LAAC;oBACC,GAAE;oBACF,MAAM,UAAU;;;;;;;;;;;;;;;;;AAK1B;KA3CM;uCA6CS"}},
    {"offset": {"line": 4208, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/svg/ICVideoOff.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\ninterface IconProps {\r\n  className?: string;\r\n  stroke?: string;\r\n  title?: string;\r\n}\r\n\r\nconst ICVideoOff = ({ className, stroke, title }: IconProps) => {\r\n  return (\r\n    <div>\r\n      <svg\r\n        className={className}\r\n        width=\"800px\"\r\n        height=\"800px\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        aria-label={title}\r\n        role=\"img\"\r\n      >\r\n        {title && <title>{title}</title>}\r\n        <path\r\n          d=\"M3 6V16C3 17.1046 3.89543 18 5 18H13C13.3151 18 13.6095 17.9252 13.8712 17.792M16 10L21 7V17L18.5 15.75\"\r\n          stroke={stroke || \"#141415\"}\r\n          strokeWidth=\"0.9\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        />\r\n        <path\r\n          d=\"M3 3L21 21\"\r\n          stroke={stroke || \"#141415\"}\r\n          strokeWidth=\"1.2\"\r\n          strokeLinecap=\"round\"\r\n        />\r\n      </svg>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ICVideoOff;\r\n"],"names":[],"mappings":";;;;;;AAQA,MAAM,aAAa,CAAC,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,EAAa;IACzD,qBACE,6LAAC;kBACC,cAAA,6LAAC;YACC,WAAW;YACX,OAAM;YACN,QAAO;YACP,SAAQ;YACR,MAAK;YACL,OAAM;YACN,cAAY;YACZ,MAAK;;gBAEJ,uBAAS,6LAAC;8BAAO;;;;;;8BAClB,6LAAC;oBACC,GAAE;oBACF,QAAQ,UAAU;oBAClB,aAAY;oBACZ,eAAc;oBACd,gBAAe;;;;;;8BAEjB,6LAAC;oBACC,GAAE;oBACF,QAAQ,UAAU;oBAClB,aAAY;oBACZ,eAAc;;;;;;;;;;;;;;;;;AAKxB;KA9BM;uCAgCS"}},
    {"offset": {"line": 4277, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28call%29/ModalCall.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport { HiChevronLeft, HiChevronRight, HiMicrophone, HiPhone, HiVideoCamera } from 'react-icons/hi2';\r\nimport MicOffIcon from '../svg/MicOffIcon';\r\nimport ICVideoOff from '../svg/ICVideoOff';\r\n\r\ntype RemotePeer = { userId: string; stream: MediaStream; name?: string; avatar?: string };\r\ntype Participant = { userId: string; name?: string; avatar?: string };\r\ntype Props = {\r\n  avatar?: string;\r\n  name: string;\r\n  mode: 'connecting' | 'active';\r\n  callType: 'voice' | 'video';\r\n  callStartAt?: number | null;\r\n  localVideoRef?: React.RefObject<HTMLVideoElement | null>;\r\n  currentUserName?: string;\r\n  currentUserAvatar?: string;\r\n  remotePeers?: RemotePeer[];\r\n  participants?: Participant[];\r\n  micEnabled?: boolean;\r\n  camEnabled?: boolean;\r\n  onToggleMic?: () => void;\r\n  onToggleCamera?: () => void;\r\n  onEndCall: () => void;\r\n};\r\n\r\nexport default function ModalCall({\r\n  avatar,\r\n  name,\r\n  mode,\r\n  callType,\r\n  callStartAt,\r\n  localVideoRef,\r\n  currentUserName,\r\n  currentUserAvatar,\r\n  remotePeers = [],\r\n  participants = [],\r\n  micEnabled = true,\r\n  camEnabled = true,\r\n  onToggleMic,\r\n  onToggleCamera,\r\n  onEndCall,\r\n}: Props) {\r\n  const timer = (() => {\r\n    if (!callStartAt) return '';\r\n    const now = Date.now();\r\n    const s = Math.floor((now - callStartAt) / 1000);\r\n    const m = Math.floor(s / 60);\r\n    const ss = s % 60;\r\n    const mm = String(m).padStart(2, '0');\r\n    const sss = String(ss).padStart(2, '0');\r\n    return `${mm}:${sss}`;\r\n  })();\r\n  const [hiddenCam, setHiddenCam] = useState(false);\r\n  const audioRefs = useRef<Map<string, HTMLAudioElement>>(new Map());\r\n  const videoRefs = useRef<Map<string, HTMLVideoElement>>(new Map());\r\n  useEffect(() => {\r\n    remotePeers.forEach((peer) => {\r\n      const a = audioRefs.current.get(peer.userId);\r\n      if (a) {\r\n        try {\r\n          a.muted = false;\r\n          (a as HTMLAudioElement & { autoplay?: boolean }).autoplay = true;\r\n          (a as HTMLAudioElement & { srcObject?: MediaStream }).srcObject = peer.stream;\r\n          void a.play().catch(() => {});\r\n        } catch {}\r\n      }\r\n      const v = videoRefs.current.get(peer.userId);\r\n      if (v) {\r\n        try {\r\n          (v as HTMLVideoElement & { srcObject?: MediaStream }).srcObject = peer.stream;\r\n          void v.play().catch(() => {});\r\n        } catch {}\r\n      }\r\n    });\r\n  }, [remotePeers]);\r\n  if (mode === 'connecting') {\r\n    return (\r\n      <div className=\"relative w-full max-md:h-[100vh] md:min-h-[24rem] md:max-h-[28rem] md:rounded-xl rounded-none overflow-hidden bg-black\">\r\n        {avatar && (\r\n          <Image src={getProxyUrl(avatar)} alt={name} fill className=\"object-cover blur-xl opacity-40\" sizes=\"100vw\" />\r\n        )}\r\n        <div className=\"absolute inset-0 bg-blue/40\" />\r\n\r\n        <div className=\"relative z-10 h-full flex flex-col items-center justify-center gap-4\">\r\n          <div className=\"flex flex-col items-center gap-3 pt-10\">\r\n            {avatar ? (\r\n              <div className=\"w-24 h-24 rounded-full overflow-hidden ring-4 ring-white/60\">\r\n                <Image\r\n                  src={getProxyUrl(avatar)}\r\n                  alt={name}\r\n                  width={96}\r\n                  height={96}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n              </div>\r\n            ) : (\r\n              <div className=\"w-24 h-24 rounded-full bg-gray-500 flex items-center rounded-full justify-center text-white text-2xl font-semibold ring-4 ring-white/60\">\r\n                <Image\r\n                  src=\"/logo/avata.webp\"\r\n                  alt={name}\r\n                  width={64}\r\n                  height={64}\r\n                  className=\"w-full h-full rounded-full object-cover\"\r\n                />\r\n              </div>\r\n            )}\r\n            <div className=\"text-white font-medium text-base\">{name}</div>\r\n            <div className=\"text-white/80 text-sm\">Đang đổ chuông...</div>\r\n          </div>\r\n          {/* Desktop row */}\r\n          <div className=\"mt-6 md:flex hidden items-center justify-center gap-4\">\r\n            <button\r\n              className=\"px-4 py-3 rounded-full bg-white/10 text-white opacity-60 cursor-default\"\r\n              disabled\r\n              title=\"Mic\"\r\n            >\r\n              <HiMicrophone className=\"w-6 h-6\" />\r\n            </button>\r\n            <button\r\n              className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n              onClick={onEndCall}\r\n              title=\"Kết thúc\"\r\n            >\r\n              <HiPhone className=\"w-7 h-7 text-red-500\" />\r\n            </button>\r\n            {callType === 'video' && (\r\n              <button className=\"px-4 py-3 rounded-full bg-white/10 opacity-60 cursor-default\" disabled title=\"Video\">\r\n                <HiVideoCamera className=\"w-6 h-6 text-white\" />\r\n              </button>\r\n            )}\r\n          </div>\r\n          {/* Mobile bottom controls */}\r\n          <div className=\"fixed bottom-8 left-0 right-0 md:hidden flex justify-center gap-6\">\r\n            {callType === 'video' && (\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                <button\r\n                  className=\"w-12 h-12 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition\"\r\n                  onClick={() => onToggleCamera && onToggleCamera()}\r\n                  title={camEnabled ? 'Tắt camera' : 'Bật camera'}\r\n                >\r\n                  {camEnabled ? <HiVideoCamera className=\"w-6 h-6\" /> : <ICVideoOff className=\"w-6 h-6\" />}\r\n                </button>\r\n                <span className=\"text-white text-xs\">Camera</span>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex flex-col items-center gap-2\">\r\n              <button\r\n                className=\"w-12 h-12 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition\"\r\n                onClick={() => onToggleMic && onToggleMic()}\r\n                title={micEnabled ? 'Tắt mic' : 'Bật mic'}\r\n              >\r\n                {micEnabled ? <HiMicrophone className=\"w-6 h-6\" /> : <MicOffIcon className=\"w-6 h-6\" stroke=\"red\" />}\r\n              </button>\r\n              <span className=\"text-white text-xs\">Mic</span>\r\n            </div>\r\n            <div className=\"flex flex-col items-center gap-2\">\r\n              <button\r\n                className=\"w-12 h-12 flex items-center justify-center rounded-full bg-red-600 text-white hover:bg-red-700 transition\"\r\n                onClick={onEndCall}\r\n                title=\"Kết thúc\"\r\n              >\r\n                <HiPhone className=\"w-6 h-6\" />\r\n              </button>\r\n              <span className=\"text-white text-xs\">Kết thúc</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative w-full max-md:h-[100vh] md:min-h-[24rem] md:max-h-[28rem] md:rounded-xl rounded-none overflow-hidden bg-black\">\r\n      {avatar && (\r\n        <Image src={getProxyUrl(avatar)} alt={name} fill className=\"object-cover blur-xl opacity-40\" sizes=\"100vw\" />\r\n      )}\r\n      <div className=\" inset-0 bg-black/30\" />\r\n      {timer && (\r\n        <div className=\"absolute top-4 left-4 z-20\">\r\n          <span className=\"px-2 py-1 rounded bg-green-700 text-white text-xs font-medium\">{timer}</span>\r\n        </div>\r\n      )}\r\n      {callType === 'voice' ? (\r\n        <div className=\"relative z-10 h-full flex flex-col items-center justify-center gap-5 pt-10\">\r\n          {avatar ? (\r\n            <div className=\"w-24 h-24 rounded-full overflow-hidden ring-4 ring-white/60\">\r\n              <Image\r\n                src={getProxyUrl(avatar)}\r\n                alt={name}\r\n                width={96}\r\n                height={96}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            </div>\r\n          ) : (\r\n            <div className=\"w-24 h-24 rounded-full bg-gray-500 flex items-center rounded-full justify-center text-white text-2xl font-semibold ring-4 ring-white/60\">\r\n              <Image\r\n                src=\"/logo/avata.webp\"\r\n                alt={name}\r\n                width={64}\r\n                height={64}\r\n                className=\"w-full h-full rounded-full object-cover\"\r\n              />\r\n            </div>\r\n          )}\r\n          <div className=\"text-white font-medium text-base\">{name}</div>\r\n          <div className=\" b-0 left-0 right-0 flex items-center justify-center gap-4\">\r\n            <button\r\n              className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n              onClick={onToggleMic}\r\n              title={micEnabled ? 'Tắt mic' : 'Bật mic'}\r\n            >\r\n              {micEnabled ? (\r\n                <HiMicrophone className=\"w-6 h-6 text-white\" />\r\n              ) : (\r\n                <MicOffIcon className=\"w-6 h-6\" stroke=\"red\" />\r\n              )}\r\n            </button>\r\n            <button\r\n              className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n              onClick={onEndCall}\r\n              title=\"Kết thúc\"\r\n            >\r\n              <HiPhone className=\"w-7 h-7 text-red-500\" />\r\n            </button>\r\n          </div>\r\n          <div className=\"sr-only\">\r\n            {remotePeers.map((peer) => (\r\n              <audio\r\n                key={peer.userId}\r\n                autoPlay\r\n                ref={(el) => {\r\n                  if (el) {\r\n                    const a = el as HTMLAudioElement & { srcObject?: MediaStream };\r\n                    a.srcObject = peer.stream;\r\n                    try {\r\n                      a.play();\r\n                    } catch {}\r\n                    audioRefs.current.set(peer.userId, el);\r\n                  }\r\n                }}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"relative z-10 p-3\">\r\n          {remotePeers.length <= 1 ? (\r\n            <div className=\"relative w-full aspect-video bg-black rounded-lg overflow-hidden\">\r\n              {(() => {\r\n                const peer = remotePeers[0];\r\n                const hasRemoteVideo = !!peer && peer.stream.getVideoTracks().some((t) => t.enabled);\r\n                if (peer && hasRemoteVideo) {\r\n                  return (\r\n                    <video\r\n                      className=\"w-full h-full object-cover\"\r\n                      autoPlay\r\n                      playsInline\r\n                      ref={(el) => {\r\n                        if (el) {\r\n                          const v = el as HTMLVideoElement & { srcObject?: MediaStream };\r\n                          v.srcObject = peer.stream;\r\n                          try {\r\n                            v.play();\r\n                          } catch {}\r\n                        }\r\n                      }}\r\n                    />\r\n                  );\r\n                }\r\n                const remoteAvatar: string | undefined = peer?.avatar ?? avatar;\r\n                const nameShow: string | undefined = peer?.name ?? name;\r\n                return (\r\n                  <div className=\"flex items-center justify-center w-full h-full bg-black\">\r\n                    {remoteAvatar ? (\r\n                      <div className=\"w-16 h-16 rounded-full overflow-hidden ring-4 ring-white/60\">\r\n                        <Image\r\n                          src={getProxyUrl(remoteAvatar)}\r\n                          alt={nameShow || ''}\r\n                          width={112}\r\n                          height={112}\r\n                          className=\"w-full h-full object-cover\"\r\n                        />\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"w-28 h-28 rounded-full bg-gray-500 flex items-center justify-center text-white text-2xl font-semibold ring-4 ring-white/60\">\r\n                        <Image\r\n                          src=\"/logo/avata.webp\"\r\n                          alt={name}\r\n                          width={64}\r\n                          height={64}\r\n                          className=\"w-full h-full rounded-full object-cover\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })()}\r\n              <div className=\"\">\r\n                {!hiddenCam ? (\r\n                  <button\r\n                    className=\"cursor-pointer hover:bg-gray-600 z-[50] absolute top-4 right-4 text-white text-sm bg-black/50 px-1 py-1 rounded-full transition-colors\"\r\n                    onClick={() => setHiddenCam(true)}\r\n                  >\r\n                    <HiChevronRight className=\"w-4 h-4 text-gray-400\" />\r\n                  </button>\r\n                ) : (\r\n                  <button\r\n                    className=\"cursor-pointer hover:bg-gray-600 z-[50] absolute top-4 right-4 text-white text-sm bg-black/50 px-1 py-1 rounded-full transition-colors\"\r\n                    onClick={() => setHiddenCam(false)}\r\n                  >\r\n                    <HiChevronLeft className=\"w-4 h-4 text-gray-400\" />\r\n                  </button>\r\n                )}\r\n\r\n                <div\r\n                  className={`absolute top-3 right-3 w-40 aspect-video bg-black/80 rounded-lg overflow-hidden border border-white/20 ${\r\n                    hiddenCam ? 'hidden' : ''\r\n                  }`}\r\n                >\r\n                  <video\r\n                    ref={localVideoRef}\r\n                    className={`w-full h-full object-cover ${camEnabled ? '' : 'opacity-0'}`}\r\n                    muted\r\n                    playsInline\r\n                    autoPlay\r\n                  />\r\n                  {!camEnabled && (\r\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                      {currentUserAvatar ? (\r\n                        <div className=\"w-16 h-16 rounded-full overflow-hidden ring-2 ring-white/60\">\r\n                          <Image\r\n                            src={getProxyUrl(currentUserAvatar)}\r\n                            alt={currentUserName || ''}\r\n                            width={64}\r\n                            height={64}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"w-16 h-16 rounded-full bg-gray-500 flex items-center justify-center text-white text-xl font-semibold ring-2 ring-white/60\">\r\n                          <Image\r\n                            src=\"/logo/avata.webp\"\r\n                            alt={name}\r\n                            width={64}\r\n                            height={64}\r\n                            className=\"w-full h-full rounded-full object-cover\"\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <p className=\"absolute bottom-3 left-3 text-white text-sm\">{name || 'U'}</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              <div className=\"relative bg-black rounded-lg overflow-hidden aspect-video\">\r\n                <video\r\n                  ref={localVideoRef}\r\n                  className={`w-full h-full object-cover ${camEnabled ? '' : 'opacity-0'}`}\r\n                  muted\r\n                  playsInline\r\n                  autoPlay\r\n                />\r\n                {!camEnabled && (\r\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black\">\r\n                    {currentUserAvatar ? (\r\n                      <div className=\"w-16 h-16 rounded-full overflow-hidden ring-4 ring-white/60\">\r\n                        <Image\r\n                          src={getProxyUrl(currentUserAvatar)}\r\n                          alt={currentUserName || ''}\r\n                          width={96}\r\n                          height={96}\r\n                          className=\"w-full h-full object-cover\"\r\n                        />\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"w-16 h-16 rounded-full bg-gray-500 flex items-center justify-center text-white text-2xl font-semibold ring-4 ring-white/60\">\r\n                        <Image\r\n                          src=\"/logo/avata.webp\"\r\n                          alt={name}\r\n                          width={64}\r\n                          height={64}\r\n                          className=\"w-full h-full object-cover\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              {remotePeers.map((peer) => (\r\n                <div key={peer.userId} className=\"relative bg-black rounded-lg overflow-hidden aspect-video\">\r\n                  {peer.stream.getVideoTracks().some((t) => t.enabled) ? (\r\n                    <video\r\n                      className=\"w-full h-full object-cover\"\r\n                      autoPlay\r\n                      playsInline\r\n                      ref={(el) => {\r\n                        if (el) {\r\n                          const v = el as HTMLVideoElement & { srcObject?: MediaStream };\r\n                          try {\r\n                            v.muted = true;\r\n                          } catch {}\r\n                          v.srcObject = peer.stream;\r\n                          try {\r\n                            v.play();\r\n                          } catch {}\r\n                          videoRefs.current.set(peer.userId, el);\r\n                        }\r\n                      }}\r\n                    />\r\n                  ) : (\r\n                    <div className=\"flex items-center justify-center w-full h-full bg-black\">\r\n                      {peer.avatar ? (\r\n                        <div className=\"w-16 h-16 rounded-full overflow-hidden ring-4 ring-white/60\">\r\n                          <Image\r\n                            src={getProxyUrl(peer.avatar)}\r\n                            alt={peer.name || ''}\r\n                            width={96}\r\n                            height={96}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"w-16 h-16 rounded-full bg-gray-500 flex items-center justify-center text-white text-2xl font-semibold ring-4 ring-white/60\">\r\n                          <Image\r\n                            src=\"/logo/avata.webp\"\r\n                            alt={name}\r\n                            width={64}\r\n                            height={64}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n              <div className=\"sr-only\">\r\n                {remotePeers.map((peer) => (\r\n                  <audio\r\n                    key={`aud-${peer.userId}`}\r\n                    autoPlay\r\n                    ref={(el) => {\r\n                      if (el) {\r\n                        const a = el as HTMLAudioElement & { srcObject?: MediaStream };\r\n                        a.srcObject = peer.stream;\r\n                        try {\r\n                          a.play();\r\n                        } catch {}\r\n                        audioRefs.current.set(peer.userId, el);\r\n                      }\r\n                    }}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div className=\"flex items-center justify-center gap-4 mt-3\">\r\n            <button\r\n              className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n              onClick={onToggleMic}\r\n              title={micEnabled ? 'Tắt mic' : 'Bật mic'}\r\n            >\r\n              {micEnabled ? (\r\n                <HiMicrophone className=\"w-6 h-6 text-white\" />\r\n              ) : (\r\n                <MicOffIcon className=\"w-6 h-6\" stroke=\"red\" />\r\n              )}\r\n            </button>\r\n            <button\r\n              className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n              onClick={onToggleCamera}\r\n              title={camEnabled ? 'Tắt video' : 'Bật video'}\r\n            >\r\n              {camEnabled ? (\r\n                <HiVideoCamera className=\"w-6 h-6 text-white\" />\r\n              ) : (\r\n                <ICVideoOff className=\"w-6 h-6\" stroke=\"red\" />\r\n              )}\r\n            </button>\r\n            <button\r\n              className=\"px-4 py-3 rounded-full bg-white/10 hover:bg-white/20 hover:cursor-pointer\"\r\n              onClick={onEndCall}\r\n              title=\"Kết thúc\"\r\n            >\r\n              <HiPhone className=\"w-7 h-7 text-red-500\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5223, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28call%29/LiveKitCall.tsx"],"sourcesContent":["import React from 'react';\r\nimport {\r\n  LiveKitRoom,\r\n  ParticipantTile,\r\n  RoomAudioRenderer,\r\n  useTracks,\r\n  TrackToggle,\r\n  DisconnectButton,\r\n  VideoTrack,\r\n  ParticipantName,\r\n  useIsMuted,\r\n  useRoomContext,\r\n  useLocalParticipant,\r\n} from '@livekit/components-react';\r\nimport { Track } from 'livekit-client';\r\nimport { CiPhone } from 'react-icons/ci';\r\nimport Image from 'next/image';\r\nimport type { TrackReference, TrackReferenceOrPlaceholder } from '@livekit/components-core';\r\nimport { HiEye, HiEyeSlash, HiChevronLeft } from 'react-icons/hi2';\r\nimport { BiRefresh } from 'react-icons/bi';\r\n\r\ntype Props = {\r\n  serverUrl: string;\r\n  token: string;\r\n  onDisconnected?: () => void;\r\n  onRequestEnd?: () => void;\r\n  className?: string;\r\n  titleName?: string;\r\n  callStartAt?: number | null;\r\n  avatarUrl?: string;\r\n  myName?: string;\r\n  myAvatarUrl?: string;\r\n  localPreviewSize?: { w: number; h: number };\r\n  offMinHeight?: number;\r\n  onParticipantsChanged?: (participants: Array<{ id: string; name?: string }>) => void;\r\n  callMode?: 'voice' | 'video';\r\n  uiVariant?: 'full' | 'mini';\r\n  isGroup?: boolean;\r\n};\r\n\r\nfunction CustomTrackTile({\r\n  trackRef,\r\n  title,\r\n  avatarUrl,\r\n  offMinHeight,\r\n  cover,\r\n  contain,\r\n  callMode,\r\n}: {\r\n  trackRef: TrackReferenceOrPlaceholder;\r\n  title?: string | null;\r\n  avatarUrl?: string;\r\n  offMinHeight?: number;\r\n  cover?: boolean;\r\n  contain?: boolean;\r\n  callMode?: 'voice' | 'video';\r\n}) {\r\n  const isMuted = useIsMuted(trackRef);\r\n  const ref = trackRef as TrackReference;\r\n  const pub = ref?.publication as unknown as\r\n    | {\r\n        isEnabled?: boolean;\r\n        isSubscribed?: boolean;\r\n      }\r\n    | undefined;\r\n  const showVideo = !!(pub && pub.isEnabled !== false && pub.isSubscribed !== false && !isMuted);\r\n  const [portrait, setPortrait] = React.useState<boolean>(false);\r\n  const handleMeta = (e: React.SyntheticEvent<HTMLVideoElement>) => {\r\n    const v = e.currentTarget;\r\n    const w = v.videoWidth || 0;\r\n    const h = v.videoHeight || 0;\r\n    setPortrait(w > 0 && h > 0 ? h > w : false);\r\n  };\r\n  const displayName =\r\n    title ??\r\n    ((trackRef as unknown as { participant?: { name?: string; identity?: string } })?.participant?.name ||\r\n      (trackRef as unknown as { participant?: { identity?: string } })?.participant?.identity ||\r\n      '');\r\n  return (\r\n    <div className={`relative w-full  h-full bg-black overflow-hidden rounded-md`}>\r\n      {showVideo ? (\r\n        <VideoTrack\r\n          trackRef={trackRef as TrackReference}\r\n          className={\r\n            contain\r\n              ? 'w-full h-full object-contain'\r\n              : cover || !portrait\r\n                ? 'w-full h-full object-cover'\r\n                : 'w-full h-full object-contain'\r\n          }\r\n          onLoadedMetadata={handleMeta}\r\n          muted\r\n          playsInline\r\n          autoPlay\r\n        />\r\n      ) : (\r\n        <div className=\"w-full h-full flex items-center justify-center bg-black\">\r\n          {avatarUrl ? (\r\n            <Image\r\n              src={avatarUrl}\r\n              alt={title || 'avatar'}\r\n              width={240}\r\n              height={240}\r\n              className=\"w-14 h-14 rounded-full object-cover\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-14 h-14 rounded-full bg-white/10\" />\r\n          )}\r\n        </div>\r\n      )}\r\n      <div className=\"absolute bottom-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded\">{displayName}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CallTiles({\r\n  titleName,\r\n  avatarUrl,\r\n  offMinHeight,\r\n  myName,\r\n  myAvatarUrl,\r\n  callMode,\r\n  mini,\r\n}: {\r\n  titleName?: string | null;\r\n  avatarUrl?: string;\r\n  offMinHeight?: number;\r\n  myName?: string;\r\n  myAvatarUrl?: string;\r\n  callMode?: 'voice' | 'video';\r\n  mini?: boolean;\r\n}) {\r\n  const cameraTracks = useTracks([Track.Source.Camera]);\r\n  const screenShareTracks = useTracks([Track.Source.ScreenShare]);\r\n  const remoteTracks = cameraTracks.filter((t) => !t.participant?.isLocal);\r\n  const localTrack = cameraTracks.find((t) => t.participant?.isLocal);\r\n  const remoteScreenShares = screenShareTracks.filter((t) => !t.participant?.isLocal);\r\n  const localScreenShare = screenShareTracks.find((t) => t.participant?.isLocal);\r\n\r\n  const remoteIds = React.useMemo(() => {\r\n    return remoteTracks\r\n      .map((tr) =>\r\n        String(((tr as unknown as { participant?: { identity?: string } })?.participant?.identity || '').trim()),\r\n      )\r\n      .filter((id) => !!id);\r\n  }, [remoteTracks]);\r\n\r\n  const [miniPickId, setMiniPickId] = React.useState<string | null>(null);\r\n  React.useEffect(() => {\r\n    if (!mini) return;\r\n    if (remoteIds.length === 0) {\r\n      setMiniPickId(null);\r\n      return;\r\n    }\r\n    if (miniPickId && remoteIds.includes(miniPickId)) return;\r\n    const next = remoteIds[Math.floor(Math.random() * remoteIds.length)];\r\n    setMiniPickId(next);\r\n  }, [mini, remoteIds, miniPickId]);\r\n\r\n  const isGridMode = cameraTracks.length >= 3;\r\n  const gridTracks = isGridMode ? cameraTracks : remoteTracks;\r\n  const [avatarsMap, setAvatarsMap] = React.useState<Record<string, string>>({});\r\n  const [showRoster, setShowRoster] = React.useState(false);\r\n  const [spotlightId, setSpotlightId] = React.useState<string | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    const ids = gridTracks\r\n      .map((tr) =>\r\n        String(((tr as unknown as { participant?: { identity?: string } })?.participant?.identity || '').trim()),\r\n      )\r\n      .filter((id) => !!id && !avatarsMap[id]);\r\n    if (ids.length === 0) return;\r\n    const run = async () => {\r\n      try {\r\n        const results = await Promise.all(\r\n          ids.map(async (id) => {\r\n            const res = await fetch('/api/users', {\r\n              method: 'POST',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify({ action: 'getById', _id: String(id) }),\r\n            });\r\n            const data = await res.json();\r\n            const row = (data && (data.row || (Array.isArray(data?.data) ? data.data[0] : null))) || null;\r\n            const avatar = typeof row?.avatar === 'string' ? row.avatar : '';\r\n            return { id, avatar };\r\n          }),\r\n        );\r\n        const next: Record<string, string> = { ...avatarsMap };\r\n        results.forEach(({ id, avatar }) => {\r\n          if (avatar) next[id] = avatar;\r\n        });\r\n        setAvatarsMap(next);\r\n      } catch {}\r\n    };\r\n    void run();\r\n  }, [gridTracks, avatarsMap]);\r\n\r\n  const sortedTracks = React.useMemo(() => {\r\n    if (!spotlightId) return gridTracks;\r\n    const s = gridTracks.slice();\r\n    const idx = s.findIndex(\r\n      (tr) =>\r\n        String(((tr as unknown as { participant?: { identity?: string } })?.participant?.identity || '').trim()) ===\r\n        spotlightId,\r\n    );\r\n    if (idx > 0) {\r\n      const [sp] = s.splice(idx, 1);\r\n      s.unshift(sp);\r\n    }\r\n    return s;\r\n  }, [gridTracks, spotlightId]);\r\n  const maxTiles = 9;\r\n  const total = sortedTracks.length;\r\n  const showMore = total > maxTiles;\r\n  const displayLimit = showMore ? maxTiles - 1 : maxTiles;\r\n  const displayTracks = sortedTracks.slice(0, displayLimit);\r\n  const moreCount = Math.max(0, total - displayTracks.length);\r\n  const totalTiles = displayTracks.length + (moreCount > 0 ? 1 : 0);\r\n  const cols = totalTiles <= 1 ? 1 : totalTiles <= 4 ? 2 : totalTiles <= 9 ? 3 : 4;\r\n  const rows = Math.ceil(totalTiles / cols);\r\n\r\n  if (mini) {\r\n    const screenRef = localScreenShare || remoteScreenShares[0];\r\n    const picked = screenRef\r\n      ? screenRef\r\n      : miniPickId\r\n        ? remoteTracks.find(\r\n            (tr) =>\r\n              String(\r\n                ((tr as unknown as { participant?: { identity?: string } })?.participant?.identity || '').trim(),\r\n              ) === miniPickId,\r\n          )\r\n        : undefined;\r\n    const trackToShow = picked || localTrack;\r\n    if (callMode === 'voice') {\r\n      return (\r\n        <div\r\n          className={`relative w-full h-full overflow-hidden ${callMode === 'voice' ? 'bg-blue-500' : 'bg-black'}`}\r\n          style={{ minHeight: offMinHeight ?? 120 }}\r\n        >\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <div className=\"flex flex-col items-center gap-3\">\r\n              {avatarUrl ? (\r\n                <Image\r\n                  src={avatarUrl}\r\n                  alt={titleName || 'avatar'}\r\n                  width={96}\r\n                  height={96}\r\n                  className=\"w-16 h-16 rounded-full object-cover\"\r\n                />\r\n              ) : (\r\n                <div className=\"w-16 h-16 rounded-full bg-white/10\" />\r\n              )}\r\n              <div className=\"text-white/90 text-sm\">{titleName || ''}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"relative w-full h-full overflow-hidden bg-black\" style={{ minHeight: offMinHeight ?? 120 }}>\r\n        {trackToShow ? (\r\n          <CustomTrackTile\r\n            trackRef={trackToShow}\r\n            offMinHeight={offMinHeight}\r\n            avatarUrl={\r\n              (trackToShow as unknown as { participant?: { isLocal?: boolean } })?.participant?.isLocal\r\n                ? myAvatarUrl\r\n                : avatarUrl\r\n            }\r\n            contain\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <div className=\"text-white/80 text-xs\">Đang chờ camera...</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`relative w-full h-full overflow-hidden max-md:h-[100vh]  ${callMode === 'voice' ? 'bg-blue-500' : 'bg-black'}`}\r\n      style={{ minHeight: offMinHeight ?? 240 }}\r\n    >\r\n      <div className=\"md:block hidden rounded-lg w-full h-full\">\r\n        {callMode === 'voice' ? (\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <div className=\"flex flex-col items-center gap-4 mt-20\">\r\n              {avatarUrl ? (\r\n                <Image\r\n                  src={avatarUrl}\r\n                  alt={titleName || 'avatar'}\r\n                  width={160}\r\n                  height={160}\r\n                  className=\"w-32 h-32 rounded-full object-cover\"\r\n                />\r\n              ) : (\r\n                <div className=\"w-32 h-32 rounded-full bg-white/10\" />\r\n              )}\r\n              <div className=\"text-white/90 text-lg\">{titleName || ''}</div>\r\n            </div>\r\n          </div>\r\n        ) : localScreenShare || remoteScreenShares[0] ? (\r\n          <div className=\"w-full h-full\">\r\n            <CustomTrackTile\r\n              trackRef={(localScreenShare || remoteScreenShares[0]) as TrackReferenceOrPlaceholder}\r\n              offMinHeight={offMinHeight}\r\n              contain\r\n            />\r\n          </div>\r\n        ) : displayTracks.length > 0 ? (\r\n          <div\r\n            className=\"grid w-full h-full gap-2 p-2\"\r\n            style={{\r\n              gridTemplateColumns: `repeat(${cols}, minmax(0, 1fr))`,\r\n              gridTemplateRows: `repeat(${rows}, minmax(0, 1fr))`,\r\n            }}\r\n          >\r\n            {displayTracks.map((tr, i) => (\r\n              <div\r\n                key={`${String((tr as unknown as { participant?: { identity?: string } })?.participant?.identity || '')}-${i}`}\r\n                className=\"relative\"\r\n              >\r\n                <CustomTrackTile\r\n                  trackRef={tr}\r\n                  offMinHeight={offMinHeight}\r\n                  avatarUrl={\r\n                    ((tr as unknown as { participant?: { isLocal?: boolean } })?.participant?.isLocal\r\n                      ? myAvatarUrl\r\n                      : avatarsMap[\r\n                          String(\r\n                            (\r\n                              (tr as unknown as { participant?: { identity?: string } })?.participant?.identity || ''\r\n                            ).trim(),\r\n                          )\r\n                        ]) || (isGridMode ? undefined : avatarUrl)\r\n                  }\r\n                />\r\n              </div>\r\n            ))}\r\n            {moreCount > 0 && (\r\n              <button\r\n                onClick={() => setShowRoster(true)}\r\n                className=\"flex items-center justify-center bg-white/10 hover:bg-white/20 text-white text-lg font-semibold rounded-md\"\r\n                title=\"Xem thêm\"\r\n              >\r\n                +{moreCount}\r\n              </button>\r\n            )}\r\n          </div>\r\n        ) : localTrack ? (\r\n          <div className=\"w-full h-full\">\r\n            <CustomTrackTile trackRef={localTrack} title={myName} avatarUrl={myAvatarUrl} offMinHeight={offMinHeight} />\r\n          </div>\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <div className=\"text-white/80 text-sm\">Đang chờ đối phương bật camera...</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"md:hidden  w-full h-full flex items-center justify-center\">\r\n        {callMode === 'voice' ? (\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <div className=\"flex flex-col items-center gap-4 mt-40 max-md:mt-0\">\r\n              {avatarUrl ? (\r\n                <Image\r\n                  src={avatarUrl}\r\n                  alt={titleName || 'avatar'}\r\n                  width={128}\r\n                  height={128}\r\n                  className=\"w-28 h-28 rounded-full object-cover\"\r\n                />\r\n              ) : (\r\n                <div className=\"w-28 h-28 rounded-full bg-white/10\" />\r\n              )}\r\n              <div className=\"text-white/90 text-xl font-bold\">{titleName || ''}</div>\r\n            </div>\r\n          </div>\r\n        ) : localScreenShare || remoteScreenShares[0] ? (\r\n          <div className=\"w-full h-full\">\r\n            <CustomTrackTile\r\n              trackRef={(localScreenShare || remoteScreenShares[0]) as TrackReferenceOrPlaceholder}\r\n              offMinHeight={offMinHeight}\r\n              contain\r\n            />\r\n          </div>\r\n        ) : displayTracks.length > 0 ? (\r\n          <div\r\n            className=\"grid w-full h-full\"\r\n            style={{\r\n              gridTemplateColumns: `repeat(${cols}, minmax(0, 1fr))`,\r\n              gridTemplateRows: `repeat(${rows}, minmax(0, 1fr))`,\r\n            }}\r\n          >\r\n            {displayTracks.map((tr, i) => (\r\n              <div\r\n                key={`${String((tr as unknown as { participant?: { identity?: string } })?.participant?.identity || '')}-${i}`}\r\n                className=\"relative\"\r\n              >\r\n                <CustomTrackTile\r\n                  trackRef={tr}\r\n                  offMinHeight={offMinHeight}\r\n                  contain\r\n                  avatarUrl={\r\n                    ((tr as unknown as { participant?: { isLocal?: boolean } })?.participant?.isLocal\r\n                      ? myAvatarUrl\r\n                      : avatarsMap[\r\n                          String(\r\n                            (\r\n                              (tr as unknown as { participant?: { identity?: string } })?.participant?.identity || ''\r\n                            ).trim(),\r\n                          )\r\n                        ]) || (isGridMode ? undefined : avatarUrl)\r\n                  }\r\n                />\r\n              </div>\r\n            ))}\r\n            {moreCount > 0 && (\r\n              <button\r\n                onClick={() => setShowRoster(true)}\r\n                className=\"flex items-center justify-center bg-white/10 hover:bg-white/20 text-white text-lg font-semibold rounded-md\"\r\n                title=\"Xem thêm\"\r\n              >\r\n                +{moreCount}\r\n              </button>\r\n            )}\r\n          </div>\r\n        ) : localTrack ? (\r\n          <div className=\"w-full h-[85vh] mt-4\">\r\n            <CustomTrackTile\r\n              trackRef={localTrack}\r\n              title={myName}\r\n              avatarUrl={myAvatarUrl}\r\n              offMinHeight={offMinHeight}\r\n              contain\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <div className=\"text-white/80 text-sm\">Đang chờ đối phương bật camera...</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      {showRoster && callMode === 'video' && (\r\n        <div className=\"absolute inset-0 bg-black/80 z-50 flex flex-col\">\r\n          <div className=\"flex items-center justify-between px-4 py-3\">\r\n            <div className=\"text-white text-sm\">Người tham gia khác</div>\r\n            <button\r\n              className=\"px-3 py-1 rounded bg-white/10 text-white hover:bg-white/20\"\r\n              onClick={() => setShowRoster(false)}\r\n              title=\"Đóng\"\r\n            >\r\n              Đóng\r\n            </button>\r\n          </div>\r\n          <div className=\"flex-1 overflow-auto p-3\">\r\n            <div className=\"grid gap-3\" style={{ gridTemplateColumns: 'repeat(3, minmax(0, 1fr))' }}>\r\n              {sortedTracks.slice(displayTracks.length).map((tr, i) => {\r\n                const id = String(\r\n                  ((tr as unknown as { participant?: { identity?: string } })?.participant?.identity || '').trim(),\r\n                );\r\n                return (\r\n                  <button\r\n                    key={`${id}-${i}`}\r\n                    className=\"relative rounded-md overflow-hidden bg-black\"\r\n                    onClick={() => {\r\n                      setSpotlightId(id);\r\n                      setShowRoster(false);\r\n                    }}\r\n                    title=\"Đẩy lên giao diện chính\"\r\n                  >\r\n                    <CustomTrackTile\r\n                      trackRef={tr}\r\n                      offMinHeight={120}\r\n                      contain\r\n                      avatarUrl={\r\n                        ((tr as unknown as { participant?: { isLocal?: boolean } })?.participant?.isLocal\r\n                          ? myAvatarUrl\r\n                          : avatarsMap[id]) || avatarUrl\r\n                      }\r\n                    />\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction formatTime(startAt?: number | null) {\r\n  if (!startAt) return '00:00';\r\n  const s = Math.max(0, Math.floor((Date.now() - startAt) / 1000));\r\n  const m = Math.floor(s / 60)\r\n    .toString()\r\n    .padStart(2, '0');\r\n  const r = (s % 60).toString().padStart(2, '0');\r\n  return `${m}:${r}`;\r\n}\r\n\r\nexport default function LiveKitCall({\r\n  serverUrl,\r\n  token,\r\n  onDisconnected,\r\n  onRequestEnd,\r\n  className,\r\n  titleName,\r\n  callStartAt,\r\n  avatarUrl,\r\n  myName,\r\n  myAvatarUrl,\r\n  localPreviewSize,\r\n  offMinHeight,\r\n  onParticipantsChanged,\r\n  callMode = 'video',\r\n  uiVariant = 'full',\r\n  isGroup = false,\r\n}: Props) {\r\n  const isMini = uiVariant === 'mini';\r\n  const [showLocalPreview, setShowLocalPreview] = React.useState(true);\r\n  const [showControls, setShowControls] = React.useState(false);\r\n  const [tick, setTick] = React.useState(0);\r\n  const initialPreview = React.useMemo(() => {\r\n    return { w: localPreviewSize?.w ?? 80, h: localPreviewSize?.h ?? 50 };\r\n  }, [localPreviewSize]);\r\n\r\n  const toggleControls = () => {\r\n    setShowControls((prev) => !prev);\r\n  };\r\n  React.useEffect(() => {\r\n    if (!callStartAt) {\r\n      setTick(0);\r\n      return;\r\n    }\r\n    setTick(0);\r\n    const id = window.setInterval(() => setTick((x) => x + 1), 1000);\r\n    return () => window.clearInterval(id);\r\n  }, [callStartAt]);\r\n\r\n  // function ParticipantsCounter() {\r\n  //   const tracks = useTracks([Track.Source.Camera]);\r\n  //   const count = tracks.filter((t) => !t.participant?.isLocal).length;\r\n  //   return (\r\n  //     <div className=\"absolute top-3 right-3 text-xs font-semibold bg-white/20 text-white px-2 py-1 rounded\">\r\n  //       {count} người\r\n  //     </div>\r\n  //   );\r\n  // }\r\n  function ParticipantsWatcher({ onChanged }: { onChanged?: (parts: Array<{ id: string; name?: string }>) => void }) {\r\n    const tracks = useTracks([Track.Source.Camera]);\r\n    const parts = React.useMemo(() => {\r\n      return tracks\r\n        .filter((t) => !t.participant?.isLocal)\r\n        .map((t) => ({\r\n          id: String(((t as unknown as { participant?: { identity?: string } })?.participant?.identity || '').trim()),\r\n          name: String(\r\n            (\r\n              (t as unknown as { participant?: { name?: string; identity?: string } })?.participant?.name ||\r\n              (t as unknown as { participant?: { identity?: string } })?.participant?.identity ||\r\n              ''\r\n            ).trim(),\r\n          ),\r\n        }))\r\n        .filter((p) => !!p.id);\r\n    }, [tracks]);\r\n    const prevRef = React.useRef<Array<{ id: string; name?: string }>>([]);\r\n    React.useEffect(() => {\r\n      const prev = prevRef.current;\r\n      const changed = prev.length !== parts.length || prev.some((p, i) => p.id !== parts[i]?.id);\r\n      if (changed) {\r\n        prevRef.current = parts;\r\n        if (onChanged) onChanged(parts);\r\n      }\r\n    }, [parts, onChanged]);\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={className ? className : ''}>\r\n      <LiveKitRoom\r\n        serverUrl={serverUrl}\r\n        token={token}\r\n        connect\r\n        video={callMode === 'video'}\r\n        audio={true}\r\n        onDisconnected={onDisconnected}\r\n      >\r\n        <RoomAudioRenderer />\r\n        <div\r\n          className={`relative w-full h-full ${isMini ? '' : 'group'}`}\r\n          onClick={isMini ? undefined : toggleControls}\r\n        >\r\n          <CallTiles\r\n            titleName={titleName}\r\n            avatarUrl={avatarUrl}\r\n            offMinHeight={offMinHeight}\r\n            myName={myName}\r\n            myAvatarUrl={myAvatarUrl}\r\n            callMode={callMode}\r\n            mini={isMini}\r\n          />\r\n\r\n          {!isMini && (\r\n            <>\r\n              <div className=\"absolute md:block hidden top-3 left-3 text-xs font-semibold bg-green-600 text-white px-2 py-1 rounded\">\r\n                {formatTime(callStartAt)}\r\n              </div>\r\n              <div className=\"absolute md:hidden block top-3 left-1/2 -translate-x-1/2 text-xs font-semibold  text-white px-2 py-1 rounded\">\r\n                <p className=\"text-green-500 text-[1rem]\">{formatTime(callStartAt)}</p>\r\n              </div>\r\n              <div className=\"absolute top-3 left-3 md:hidden\">\r\n                <button\r\n                  className=\"w-9 h-9 rounded-full bg-white/10 text-white flex items-center justify-center hover:bg-white/20 transition z-50\"\r\n                  onClick={(e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    try {\r\n                      window.dispatchEvent(new CustomEvent('minimizeCallOverlay'));\r\n                      window.dispatchEvent(new CustomEvent('hideCallOverlay'));\r\n                    } catch {}\r\n                  }}\r\n                  title=\"Quay lại\"\r\n                >\r\n                  <HiChevronLeft className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {/* <ParticipantsCounter /> */}\r\n          <ParticipantsWatcher onChanged={onParticipantsChanged} />\r\n\r\n          {/* Local preview (toggleable) */}\r\n          {!isMini && showLocalPreview && callMode === 'video' && (\r\n            <LocalPreview myName={myName} myAvatarUrl={myAvatarUrl} size={initialPreview} />\r\n          )}\r\n\r\n          {!isMini && (\r\n            <div className=\"absolute left-0 right-0 bottom-4 md:flex hidden justify-center\">\r\n              <div className=\"flex items-center gap-3 bg-black/40 text-white px-4 py-2 rounded-full backdrop-blur-md transition-opacity duration-300 opacity-0 group-hover:opacity-100\">\r\n                {callMode === 'video' && (\r\n                  <>\r\n                    <TrackToggle\r\n                      source={Track.Source.ScreenShare}\r\n                      className=\"cursor-pointer p-2 rounded-full bg-white/10 hover:bg-white/20 transition\"\r\n                    />\r\n                    <TrackToggle\r\n                      source={Track.Source.Camera}\r\n                      className=\"cursor-pointer p-2 rounded-full bg-white/10 hover:bg-white/20 transition\"\r\n                    />\r\n                  </>\r\n                )}\r\n                <button\r\n                  className=\"cursor-pointer p-2 rounded-full bg-red-600 hover:bg-red-700 transition text-white\"\r\n                  onClick={() => {\r\n                    if (onRequestEnd) onRequestEnd();\r\n                  }}\r\n                  title=\"Kết thúc\"\r\n                >\r\n                  <CiPhone className=\"w-5 h-5\" />\r\n                </button>\r\n                <TrackToggle\r\n                  source={Track.Source.Microphone}\r\n                  className=\"cursor-pointer p-2 rounded-full bg-white/10 hover:bg-white/20 transition\"\r\n                />\r\n                {callMode === 'video' && (\r\n                  <button\r\n                    className=\"cursor-pointer p-2 rounded-full bg-white/10 hover:bg-white/20 transition\"\r\n                    onClick={() => setShowLocalPreview((v) => !v)}\r\n                    title={showLocalPreview ? 'Ẩn cam của tôi' : 'Hiện cam của tôi'}\r\n                  >\r\n                    {showLocalPreview ? <HiEyeSlash className=\"w-5 h-5\" /> : <HiEye className=\"w-5 h-5\" />}\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {!isMini && (\r\n            <div\r\n              className={`fixed bottom-6 left-0 right-0 md:hidden flex justify-center gap-3 transition-opacity duration-300 ${showControls ? 'opacity-100' : 'opacity-0'}`}\r\n            >\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                {callMode === 'video' && (\r\n                  <>\r\n                    <TrackToggle\r\n                      source={Track.Source.Camera}\r\n                      className=\"w-12 h-12 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition\"\r\n                    />\r\n                  </>\r\n                )}\r\n              </div>\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                {callMode === 'video' && (\r\n                  <>\r\n                    <TrackToggle\r\n                      source={Track.Source.ScreenShare}\r\n                      className=\"w-12 h-12 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition\"\r\n                    />\r\n                  </>\r\n                )}\r\n              </div>\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                <button\r\n                  className=\"w-12 h-12 flex items-center justify-center rounded-full bg-red-600 text-white hover:bg-red-700 transition\"\r\n                  onClick={() => {\r\n                    if (onRequestEnd) onRequestEnd();\r\n                  }}\r\n                  title=\"Kết thúc\"\r\n                >\r\n                  <CiPhone className=\"w-6 h-6\" />\r\n                </button>\r\n              </div>\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                <TrackToggle\r\n                  source={Track.Source.Microphone}\r\n                  className=\"w-12 h-12 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition\"\r\n                />\r\n              </div>\r\n\r\n              {callMode === 'video' && !isGroup && (\r\n                <>\r\n                  <div className=\"flex flex-col items-center gap-2\">\r\n                    <button\r\n                      className=\"w-12 h-12 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition\"\r\n                      onClick={() => setShowLocalPreview((v) => !v)}\r\n                      title={showLocalPreview ? 'Ẩn cam' : 'Hiện cam'}\r\n                    >\r\n                      {showLocalPreview ? <HiEyeSlash className=\"w-6 h-6\" /> : <HiEye className=\"w-6 h-6\" />}\r\n                    </button>\r\n                  </div>\r\n                </>\r\n              )}\r\n              {callMode === 'video' && (\r\n                <div className=\"flex flex-col items-center gap-2 md:hidden\">\r\n                  <CameraSwitchButtonMobile />\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </LiveKitRoom>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CameraSwitchButtonMobile() {\r\n  const room = useRoomContext();\r\n  const local = useLocalParticipant();\r\n  const [facing, setFacing] = React.useState<'user' | 'environment'>('user');\r\n\r\n  const switchCamera = async () => {\r\n    try {\r\n      const pub = (local as unknown as { cameraTrack?: unknown }).cameraTrack as\r\n        | {\r\n            videoTrack?: { restartTrack?: (opts: { facingMode?: 'user' | 'environment' }) => Promise<void> | void };\r\n            track?: { restartTrack?: (opts: { facingMode?: 'user' | 'environment' }) => Promise<void> | void };\r\n          }\r\n        | undefined;\r\n      const vtrack = pub?.videoTrack || pub?.track;\r\n      const nextFacing = facing === 'user' ? 'environment' : 'user';\r\n      if (vtrack && typeof vtrack.restartTrack === 'function') {\r\n        await vtrack.restartTrack({ facingMode: nextFacing });\r\n        setFacing(nextFacing);\r\n        return;\r\n      }\r\n      const anyRoom = room as unknown as {\r\n        switchActiveDevice?: (kind: 'videoinput', deviceId: string) => Promise<void>;\r\n      };\r\n      let devices: MediaDeviceInfo[] = [];\r\n      try {\r\n        const lkGet = (room as unknown as { getLocalDevices?: (kind: MediaDeviceKind) => Promise<MediaDeviceInfo[]> })\r\n          .getLocalDevices;\r\n        devices = lkGet ? await lkGet('videoinput') : await navigator.mediaDevices.enumerateDevices();\r\n      } catch {\r\n        devices = await navigator.mediaDevices.enumerateDevices();\r\n      }\r\n      const target = devices.find(\r\n        (d) =>\r\n          d.kind === 'videoinput' &&\r\n          (((d as unknown as { facing?: string }).facing || '').toLowerCase() === nextFacing ||\r\n            String(d.label || '')\r\n              .toLowerCase()\r\n              .includes(nextFacing)),\r\n      );\r\n      if (target && anyRoom.switchActiveDevice) {\r\n        await anyRoom.switchActiveDevice('videoinput', target.deviceId);\r\n        setFacing(nextFacing);\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  return (\r\n    <button\r\n      className=\"w-12 h-12 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20 transition\"\r\n      onClick={() => void switchCamera()}\r\n      title=\"Đổi camera trước/sau\"\r\n    >\r\n      <BiRefresh className=\"w-6 h-6\" />\r\n    </button>\r\n  );\r\n}\r\n\r\nfunction LocalPreview({\r\n  myName,\r\n  myAvatarUrl,\r\n  size,\r\n}: {\r\n  myName?: string;\r\n  myAvatarUrl?: string;\r\n  size: { w: number; h: number };\r\n}) {\r\n  const cameraTracks = useTracks([Track.Source.Camera]);\r\n  const localTrack = cameraTracks.find((t) => t.participant?.isLocal);\r\n\r\n  const [isDesktop, setIsDesktop] = React.useState<boolean>(false);\r\n  const [pos, setPos] = React.useState<{ x: number; y: number }>({ x: 12, y: 12 });\r\n  React.useEffect(() => {\r\n    const apply = () => {\r\n      if (typeof window === 'undefined') return;\r\n      const width = window.innerWidth;\r\n      const desktop = width >= 768;\r\n      setIsDesktop(desktop);\r\n      if (!desktop) {\r\n        setPos({ x: Math.max(8, width - size.w - 12), y: 12 });\r\n      }\r\n    };\r\n    apply();\r\n    window.addEventListener('resize', apply);\r\n    return () => window.removeEventListener('resize', apply);\r\n  }, [size.w]);\r\n  const handleDragStart = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (isDesktop) return;\r\n    const st = { sx: e.clientX, sy: e.clientY, ox: pos.x, oy: pos.y };\r\n    const onMove = (ev: MouseEvent) => {\r\n      const dx = ev.clientX - st.sx;\r\n      const dy = ev.clientY - st.sy;\r\n      const nx = Math.min(Math.max(8, st.ox + dx), Math.max(8, (window.innerWidth || 360) - size.w - 8));\r\n      const ny = Math.min(Math.max(8, st.oy + dy), Math.max(8, (window.innerHeight || 640) - size.h - 8));\r\n      setPos({ x: nx, y: ny });\r\n    };\r\n    const onUp = () => {\r\n      window.removeEventListener('mousemove', onMove);\r\n      window.removeEventListener('mouseup', onUp);\r\n    };\r\n    window.addEventListener('mousemove', onMove);\r\n    window.addEventListener('mouseup', onUp);\r\n  };\r\n  const handleTouchStart = (e: React.TouchEvent<HTMLDivElement>) => {\r\n    if (isDesktop) return;\r\n    const t = e.touches[0];\r\n    const st = { sx: t.clientX, sy: t.clientY, ox: pos.x, oy: pos.y };\r\n    const onMove = (ev: TouchEvent) => {\r\n      const tt = ev.touches[0];\r\n      const dx = tt.clientX - st.sx;\r\n      const dy = tt.clientY - st.sy;\r\n      const nx = Math.min(Math.max(8, st.ox + dx), Math.max(8, (window.innerWidth || 360) - size.w - 8));\r\n      const ny = Math.min(Math.max(8, st.oy + dy), Math.max(8, (window.innerHeight || 640) - size.h - 8));\r\n      setPos({ x: nx, y: ny });\r\n    };\r\n    const onUp = () => {\r\n      window.removeEventListener('touchmove', onMove);\r\n      window.removeEventListener('touchend', onUp);\r\n    };\r\n    window.addEventListener('touchmove', onMove, { passive: false });\r\n    window.addEventListener('touchend', onUp, { passive: false });\r\n  };\r\n  const style: React.CSSProperties = { width: size.w, height: size.h };\r\n  if (isDesktop) {\r\n    // desktop: fixed position handled by className; keep size only\r\n  } else {\r\n    style.left = pos.x;\r\n    style.top = pos.y;\r\n  }\r\n\r\n  // Hide local preview if we have 3 or more participants (grid mode)\r\n  if (cameraTracks.length >= 3) return null;\r\n\r\n  return (\r\n    <div\r\n      className={`${isDesktop ? 'absolute top-2 right-2' : 'absolute'} rounded-lg overflow-hidden bg-black ${isDesktop ? '' : 'cursor-move'}`}\r\n      style={style}\r\n      onMouseDown={handleDragStart}\r\n      onTouchStart={handleTouchStart}\r\n    >\r\n      {localTrack ? (\r\n        <CustomTrackTile trackRef={localTrack} title={myName} avatarUrl={myAvatarUrl} />\r\n      ) : (\r\n        <div className=\"w-full h-full flex items-center justify-center\">\r\n          <div className=\"text-white/70 text-xs px-2 py-1\">Không có camera</div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6553, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/utils/callRing.ts"],"sourcesContent":["let ringCtx: AudioContext | null = null;\r\nlet ringGain: GainNode | null = null;\r\nlet ringOsc: OscillatorNode | null = null;\r\nlet ringInterval: number | null = null;\r\nlet ringOn = false;\r\n\r\nexport function playGlobalRingTone(onMs = 1000, offMs = 1000, freq = 800) {\r\n  if (ringOn) return;\r\n  \r\n  try {\r\n    const Ctx = (window as typeof window & { webkitAudioContext?: typeof AudioContext }).AudioContext ||\r\n      (window as typeof window & { webkitAudioContext?: typeof AudioContext }).webkitAudioContext;\r\n    if (!Ctx) return;\r\n    const ctx: AudioContext = new Ctx();\r\n    const osc = ctx.createOscillator();\r\n    const gain = ctx.createGain();\r\n    \r\n    osc.type = 'sine';\r\n    osc.frequency.value = freq;\r\n    gain.gain.value = 0;\r\n    osc.connect(gain);\r\n    gain.connect(ctx.destination);\r\n    osc.start();\r\n    \r\n    ringCtx = ctx;\r\n    ringOsc = osc;\r\n    ringGain = gain;\r\n    ringOn = true;\r\n    \r\n    let on = false;\r\n    ringInterval = window.setInterval(() => {\r\n      on = !on;\r\n      if (ringGain) ringGain.gain.value = on ? 0.2 : 0;\r\n    }, onMs + offMs);\r\n    \r\n    setTimeout(() => {\r\n      if (ringGain) {\r\n        ringGain.gain.value = 0.2;\r\n        setTimeout(() => {\r\n          if (ringGain) ringGain.gain.value = 0;\r\n        }, onMs);\r\n      }\r\n    }, 0);\r\n    \r\n  } catch (err) {\r\n    console.error('❌ [GLOBAL] Ring error:', err);\r\n  }\r\n}\r\n\r\nexport function stopGlobalRingTone() {\r\n  try {\r\n    if (ringInterval) {\r\n      window.clearInterval(ringInterval);\r\n      ringInterval = null;\r\n    }\r\n    \r\n    if (ringGain) {\r\n      ringGain.gain.value = 0;\r\n    }\r\n    \r\n    if (ringOsc) {\r\n      try {\r\n        ringOsc.stop();\r\n      } catch {}\r\n      ringOsc.disconnect();\r\n      ringOsc = null;\r\n    }\r\n    \r\n    if (ringCtx) {\r\n      try {\r\n        ringCtx.close();\r\n      } catch {}\r\n      ringCtx = null;\r\n    }\r\n    \r\n    ringGain = null;\r\n    ringOn = false;\r\n    \r\n  } catch (err) {\r\n    console.error('❌ [GLOBAL] Stop ring error:', err);\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA,IAAI,UAA+B;AACnC,IAAI,WAA4B;AAChC,IAAI,UAAiC;AACrC,IAAI,eAA8B;AAClC,IAAI,SAAS;AAEN,SAAS,mBAAmB,OAAO,IAAI,EAAE,QAAQ,IAAI,EAAE,OAAO,GAAG;IACtE,IAAI,QAAQ;IAEZ,IAAI;QACF,MAAM,MAAM,AAAC,OAAwE,YAAY,IAC/F,AAAC,OAAwE,kBAAkB;QAC7F,IAAI,CAAC,KAAK;QACV,MAAM,MAAoB,IAAI;QAC9B,MAAM,MAAM,IAAI,gBAAgB;QAChC,MAAM,OAAO,IAAI,UAAU;QAE3B,IAAI,IAAI,GAAG;QACX,IAAI,SAAS,CAAC,KAAK,GAAG;QACtB,KAAK,IAAI,CAAC,KAAK,GAAG;QAClB,IAAI,OAAO,CAAC;QACZ,KAAK,OAAO,CAAC,IAAI,WAAW;QAC5B,IAAI,KAAK;QAET,UAAU;QACV,UAAU;QACV,WAAW;QACX,SAAS;QAET,IAAI,KAAK;QACT,eAAe,OAAO,WAAW,CAAC;YAChC,KAAK,CAAC;YACN,IAAI,UAAU,SAAS,IAAI,CAAC,KAAK,GAAG,KAAK,MAAM;QACjD,GAAG,OAAO;QAEV,WAAW;YACT,IAAI,UAAU;gBACZ,SAAS,IAAI,CAAC,KAAK,GAAG;gBACtB,WAAW;oBACT,IAAI,UAAU,SAAS,IAAI,CAAC,KAAK,GAAG;gBACtC,GAAG;YACL;QACF,GAAG;IAEL,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;IAC1C;AACF;AAEO,SAAS;IACd,IAAI;QACF,IAAI,cAAc;YAChB,OAAO,aAAa,CAAC;YACrB,eAAe;QACjB;QAEA,IAAI,UAAU;YACZ,SAAS,IAAI,CAAC,KAAK,GAAG;QACxB;QAEA,IAAI,SAAS;YACX,IAAI;gBACF,QAAQ,IAAI;YACd,EAAE,OAAM,CAAC;YACT,QAAQ,UAAU;YAClB,UAAU;QACZ;QAEA,IAAI,SAAS;YACX,IAAI;gBACF,QAAQ,KAAK;YACf,EAAE,OAAM,CAAC;YACT,UAAU;QACZ;QAEA,WAAW;QACX,SAAS;IAEX,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,+BAA+B;IAC/C;AACF"}},
    {"offset": {"line": 6634, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/hooks/useLiveKitSession.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useCallback, useEffect, useRef, useState } from 'react';\r\nimport io, { Socket } from 'socket.io-client';\r\nimport { resolveSocketUrl } from '@/utils/utils';\r\nimport { playGlobalRingTone, stopGlobalRingTone } from '@/utils/callRing';\r\nimport type { User } from '@/types/User';\r\n\r\ntype CallType = 'voice' | 'video';\r\ntype Member = string | { _id: string };\r\n\r\nexport function useLiveKitSession({\r\n  socketRef,\r\n  roomId,\r\n  currentUserId,\r\n  currentUser,\r\n  isGroup,\r\n  selectedChat,\r\n}: {\r\n  socketRef: React.MutableRefObject<Socket | null>;\r\n  roomId: string;\r\n  currentUserId: string;\r\n  currentUser: User | null;\r\n  isGroup: boolean;\r\n  selectedChat?: { _id?: string; members?: Member[] } | null;\r\n}) {\r\n  const [incomingCall, setIncomingCall] = useState<{ from: string; type: CallType; roomId: string } | null>(null);\r\n  const [callActive, setCallActive] = useState(false);\r\n  const [callType, setCallType] = useState<CallType | null>(null);\r\n  const [callStartAt, setCallStartAt] = useState<number | null>(null);\r\n  const [callConnecting, setCallConnecting] = useState(false);\r\n  const [roomCallActive, setRoomCallActive] = useState(false);\r\n  const [roomCallType, setRoomCallType] = useState<CallType | null>(null);\r\n  const [roomParticipants, setRoomParticipants] = useState<string[]>([]);\r\n  const [activeRoomId, setActiveRoomId] = useState<string>(roomId);\r\n  const [counterpartId, setCounterpartId] = useState<string | null>(null);\r\n  const [livekitToken, setLivekitToken] = useState<string | null>(null);\r\n  const [livekitUrl, setLivekitUrl] = useState<string | null>(null);\r\n\r\n  const receiversRef = useRef<string[]>([]);\r\n  const ringTimeoutRef = useRef<number | null>(null);\r\n  const callActiveRef = useRef<boolean>(false);\r\n  const callConnectingRef = useRef<boolean>(false);\r\n  const lastJoinedRoomRef = useRef<string>('');\r\n  const activeRoomIdRef = useRef<string>('');\r\n  const ignoreRemoteEndUntilRef = useRef<number>(0);\r\n  const roomParticipantsRef = useRef<string[]>([]);\r\n  const callTypeRef = useRef<CallType | null>(null);\r\n\r\n  useEffect(() => {\r\n    callActiveRef.current = callActive;\r\n  }, [callActive]);\r\n  useEffect(() => {\r\n    callTypeRef.current = callType;\r\n  }, [callType]);\r\n  useEffect(() => {\r\n    callConnectingRef.current = callConnecting;\r\n  }, [callConnecting]);\r\n  useEffect(() => {\r\n    activeRoomIdRef.current = String(activeRoomId || '');\r\n  }, [activeRoomId]);\r\n  useEffect(() => {\r\n    roomParticipantsRef.current = roomParticipants;\r\n  }, [roomParticipants]);\r\n  useEffect(() => {\r\n    const ensureUserJoin = async () => {\r\n      try {\r\n        if (!currentUserId) return;\r\n        if (!socketRef.current || !socketRef.current.connected) {\r\n          socketRef.current = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n          await new Promise<void>((resolve) => {\r\n            socketRef.current!.on('connect', () => resolve());\r\n          });\r\n        }\r\n        socketRef.current!.emit('join_user', { userId: String(currentUserId) });\r\n      } catch {}\r\n    };\r\n    void ensureUserJoin();\r\n  }, [currentUserId]);\r\n  useEffect(() => {\r\n    if (callActive || callConnecting) {\r\n      ignoreRemoteEndUntilRef.current = Date.now() + 5000;\r\n      return;\r\n    }\r\n    setActiveRoomId(roomId);\r\n  }, [roomId, callActive, callConnecting]);\r\n  useEffect(() => {\r\n    const rid = String(roomId || '');\r\n    if (!rid) {\r\n      setRoomCallActive(false);\r\n      setRoomCallType(null);\r\n      setRoomParticipants([]);\r\n      return;\r\n    }\r\n    if (callActiveRef.current || callConnectingRef.current) return;\r\n    setRoomCallActive(false);\r\n    setRoomCallType(null);\r\n    setRoomParticipants([]);\r\n  }, [roomId]);\r\n  useEffect(() => {\r\n    const rid = String(roomId || '');\r\n    if (!rid) return;\r\n    const ensureJoin = async () => {\r\n      try {\r\n        if (callActive || callConnecting) return;\r\n        if (!socketRef.current || !socketRef.current.connected) {\r\n          socketRef.current = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n          await new Promise<void>((resolve) => {\r\n            socketRef.current!.on('connect', () => resolve());\r\n          });\r\n          socketRef.current!.emit('join_user', { userId: String(currentUserId) });\r\n        }\r\n        if (lastJoinedRoomRef.current !== rid) {\r\n          socketRef.current?.emit('join_room', rid);\r\n          lastJoinedRoomRef.current = rid;\r\n        }\r\n      } catch {}\r\n    };\r\n    void ensureJoin();\r\n  }, [roomId, currentUserId, socketRef, callActive, callConnecting]);\r\n\r\n  // Bỏ hoàn toàn lưu trạng thái phòng gọi vào localStorage\r\n\r\n  const getReceiverIds = useCallback(() => {\r\n    if (isGroup) {\r\n      const members = (selectedChat?.members || []) as Member[];\r\n      const ids = members\r\n        .map((m) => (typeof m === 'object' ? String(m._id) : String(m)))\r\n        .filter((id) => id !== String(currentUserId));\r\n      return ids;\r\n    }\r\n    const id = String(selectedChat?._id || '');\r\n    return id ? [id] : [];\r\n  }, [isGroup, selectedChat, currentUserId]);\r\n\r\n  const fetchToken = useCallback(async (rid: string) => {\r\n    const res = await fetch(`/api/livekit/token?room=${encodeURIComponent(rid)}`, { method: 'GET' });\r\n    if (!res.ok) throw new Error('token failed');\r\n    const data = await res.json();\r\n    setLivekitToken(String(data.token || ''));\r\n    setLivekitUrl(String(data.serverUrl || ''));\r\n  }, []);\r\n\r\n  const sendNotify = useCallback(\r\n    async (content: string) => {\r\n      if (!roomId || !currentUserId) return;\r\n      const myName = currentUser?.name || 'Bạn';\r\n      const msgData = {\r\n        roomId,\r\n        sender: currentUserId,\r\n        type: 'notify',\r\n        content,\r\n        timestamp: Date.now(),\r\n      };\r\n      try {\r\n        const res = await fetch('/api/messages', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            action: 'create',\r\n            data: msgData,\r\n          }),\r\n        });\r\n        const json = await res.json();\r\n        if (json.success && json._id) {\r\n          let members: Member[] = [];\r\n          if (selectedChat && String(selectedChat._id) === String(roomId) && isGroup) {\r\n            members = selectedChat.members || [];\r\n          }\r\n\r\n          socketRef.current?.emit('send_message', {\r\n            ...msgData,\r\n            _id: json._id,\r\n            senderName: myName,\r\n            isGroup,\r\n            receiver: null,\r\n            members,\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to send notify', e);\r\n      }\r\n    },\r\n    [roomId, currentUserId, currentUser, isGroup, selectedChat, socketRef],\r\n  );\r\n\r\n  const joinActiveGroupCall = useCallback(async () => {\r\n    try {\r\n      if (!isGroup || !roomCallActive) return;\r\n      const rid = String(roomId);\r\n      if (!socketRef.current || !socketRef.current.connected) {\r\n        socketRef.current = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n        await new Promise<void>((resolve) => {\r\n          socketRef.current!.on('connect', () => resolve());\r\n        });\r\n        socketRef.current!.emit('join_user', { userId: String(currentUserId) });\r\n      }\r\n      socketRef.current?.emit('join_room', rid);\r\n      const target = (Array.isArray(roomParticipants) ? roomParticipants : []).find(\r\n        (id) => String(id) !== String(currentUserId),\r\n      );\r\n      if (target) {\r\n        socketRef.current?.emit('call_answer', {\r\n          roomId: rid,\r\n          target: String(target),\r\n          from: String(currentUserId),\r\n          sdp: null,\r\n        });\r\n      }\r\n      setActiveRoomId(rid);\r\n      setCallType(roomCallType || 'voice');\r\n      setCallConnecting(false);\r\n      await fetchToken(rid);\r\n      setCallActive(true);\r\n\r\n      const myName = currentUser?.name || 'Bạn';\r\n      void sendNotify(`${myName} đã tham gia cuộc gọi video`);\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }, [\r\n    isGroup,\r\n    roomCallActive,\r\n    roomParticipants,\r\n    roomId,\r\n    currentUserId,\r\n    roomCallType,\r\n    fetchToken,\r\n    currentUser,\r\n    sendNotify,\r\n  ]);\r\n\r\n  const startCall = useCallback(\r\n    async (type: CallType, overrideTargetId?: string) => {\r\n      try {\r\n        if (!socketRef.current || !socketRef.current.connected) {\r\n          socketRef.current = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n          await new Promise<void>((resolve) => {\r\n            socketRef.current!.on('connect', () => resolve());\r\n          });\r\n          socketRef.current.emit('join_room', roomId);\r\n          socketRef.current.emit('join_user', { userId: String(currentUserId) });\r\n        }\r\n      } catch {}\r\n      const receivers = (() => {\r\n        if (!isGroup && overrideTargetId) {\r\n          return [String(overrideTargetId)];\r\n        }\r\n        if (isGroup && roomCallActive && roomParticipants && roomParticipants.length > 0) {\r\n          return roomParticipants.filter((id) => String(id) !== String(currentUserId));\r\n        }\r\n        return getReceiverIds();\r\n      })();\r\n      receiversRef.current = receivers;\r\n      if (receivers.length === 0) return;\r\n\r\n      if (isGroup) {\r\n        const myName = currentUser?.name || 'Bạn';\r\n        void sendNotify(`${myName} đã tham gia cuộc gọi video`);\r\n      }\r\n\r\n      setCallType(type);\r\n      setCallStartAt(null);\r\n      setCallConnecting(true);\r\n      setLivekitToken(null);\r\n      setLivekitUrl(null);\r\n      setActiveRoomId(roomId);\r\n      {\r\n        const otherId = (() => {\r\n          if (isGroup) return null;\r\n          if (overrideTargetId) return String(overrideTargetId);\r\n          if (receivers.length > 0) return String(receivers[0]);\r\n          const parts = String(roomId).split('_').filter(Boolean);\r\n          const me = String(currentUserId);\r\n          const t = parts.length === 2 ? parts.find((id) => String(id) !== me) : undefined;\r\n          return t ? String(t) : null;\r\n        })();\r\n        setCounterpartId(otherId);\r\n      }\r\n      if (ringTimeoutRef.current) {\r\n        window.clearTimeout(ringTimeoutRef.current);\r\n        ringTimeoutRef.current = null;\r\n      }\r\n      playGlobalRingTone();\r\n      ringTimeoutRef.current = window.setTimeout(() => {\r\n        if (!callActiveRef.current && callConnectingRef.current) {\r\n          stopGlobalRingTone();\r\n          endCall('local');\r\n        }\r\n      }, 30000);\r\n      try {\r\n        for (const otherId of receivers) {\r\n          socketRef.current?.emit('call_offer', {\r\n            roomId,\r\n            target: otherId,\r\n            from: String(currentUserId),\r\n            type,\r\n            sdp: null,\r\n          });\r\n        }\r\n      } catch {\r\n        setCallConnecting(false);\r\n      }\r\n    },\r\n    [getReceiverIds, roomId, currentUserId, isGroup, roomCallActive, roomParticipants, currentUser, sendNotify],\r\n  );\r\n\r\n  const endCall = useCallback(\r\n    (source: 'local' | 'remote' = 'local') => {\r\n      stopGlobalRingTone();\r\n      setCallActive(false);\r\n      setCallType(null);\r\n      setCallStartAt(null);\r\n      setCallConnecting(false);\r\n      setIncomingCall(null);\r\n      setCounterpartId(null);\r\n      setActiveRoomId('');\r\n      setLivekitToken(null);\r\n      setLivekitUrl(null);\r\n      if (ringTimeoutRef.current) {\r\n        window.clearTimeout(ringTimeoutRef.current);\r\n        ringTimeoutRef.current = null;\r\n      }\r\n      if (source === 'local' && socketRef.current?.connected) {\r\n        if (isGroup) {\r\n          socketRef.current.emit('call_leave', {\r\n            roomId,\r\n            userId: String(currentUserId),\r\n          });\r\n\r\n          const myName = currentUser?.name || 'Bạn';\r\n          void sendNotify(`${myName} đã rời cuộc gọi video`);\r\n\r\n          const type = callTypeRef.current;\r\n          if (type === 'video') {\r\n            const currentParts = roomParticipantsRef.current || [];\r\n            const remaining = currentParts.filter((id) => String(id) !== String(currentUserId));\r\n            if (remaining.length === 0) {\r\n              const time = new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });\r\n              void sendNotify(`Cuộc gọi video đã kết thúc lúc ${time}`);\r\n            }\r\n          }\r\n          setRoomParticipants((prev) => {\r\n            const next = (prev || []).filter((id) => String(id) !== String(currentUserId));\r\n            if (next.length === 0) {\r\n              setRoomCallActive(false);\r\n              setRoomCallType(null);\r\n            }\r\n            return next;\r\n          });\r\n        } else {\r\n          let targets = receiversRef.current;\r\n          if (!targets || targets.length === 0) {\r\n            const other = counterpartId\r\n              ? String(counterpartId)\r\n              : (() => {\r\n                  const parts = String(roomId).split('_').filter(Boolean);\r\n                  const me = String(currentUserId);\r\n                  const t = parts.length === 2 ? parts.find((id) => String(id) !== me) : undefined;\r\n                  return t ? String(t) : undefined;\r\n                })();\r\n            targets = other ? [other] : [];\r\n          }\r\n          socketRef.current.emit('call_end', {\r\n            roomId,\r\n            from: String(currentUserId),\r\n            targets,\r\n          });\r\n        }\r\n      }\r\n    },\r\n    [roomId, currentUserId, counterpartId, isGroup, callType, currentUser, sendNotify],\r\n  );\r\n\r\n  const acceptIncomingCall = useCallback(async () => {\r\n    if (!incomingCall) return;\r\n    stopGlobalRingTone();\r\n    setCallType(incomingCall.type);\r\n    setActiveRoomId(incomingCall.roomId);\r\n    setCallConnecting(false);\r\n    try {\r\n      if (!socketRef.current || !socketRef.current.connected) {\r\n        socketRef.current = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n        await new Promise<void>((resolve) => {\r\n          socketRef.current!.on('connect', () => resolve());\r\n        });\r\n        socketRef.current!.emit('join_user', { userId: String(currentUserId) });\r\n      }\r\n      socketRef.current?.emit('join_room', incomingCall.roomId);\r\n      socketRef.current?.emit('call_answer', {\r\n        roomId: incomingCall.roomId,\r\n        target: String(incomingCall.from),\r\n        from: String(currentUserId),\r\n        sdp: null,\r\n      });\r\n      const parts = String(incomingCall.roomId).split('_').filter(Boolean);\r\n      if (parts.length === 2) {\r\n        setCounterpartId(String(incomingCall.from));\r\n      } else {\r\n        setCounterpartId(null);\r\n      }\r\n      setCallActive(true);\r\n      await fetchToken(incomingCall.roomId);\r\n      setIncomingCall(null);\r\n      setCallStartAt((prev) => (prev && prev > 0 ? prev : Date.now()));\r\n    } catch {\r\n      setCallActive(true);\r\n    }\r\n  }, [incomingCall, fetchToken, currentUserId]);\r\n\r\n  useEffect(() => {\r\n    const socket = socketRef.current;\r\n    if (!socket) return;\r\n    socket.off('call_offer');\r\n    socket.off('call_answer');\r\n    socket.off('call_end');\r\n    socket.off('call_reject');\r\n    socket.off('call_leave');\r\n    socket.off('call_state');\r\n    const handleCallOffer = (data: { roomId: string; target: string; from: string; type: CallType }) => {\r\n      if (String(data.target) !== String(currentUserId)) return;\r\n      if (callActiveRef.current || callConnectingRef.current) {\r\n        socket.emit('call_candidate', {\r\n          roomId: data.roomId,\r\n          target: data.from,\r\n          from: currentUserId,\r\n          candidate: 'busy-signal',\r\n        });\r\n        return;\r\n      }\r\n      setIncomingCall({ from: String(data.from), type: data.type, roomId: data.roomId });\r\n      playGlobalRingTone();\r\n    };\r\n    const handleCallCandidate = (data: {\r\n      roomId: string;\r\n      target?: string;\r\n      candidate?: string | RTCIceCandidate;\r\n      from?: string;\r\n    }) => {\r\n      if (data.target && String(data.target) !== String(currentUserId)) return;\r\n      if (data.candidate === 'busy-signal') {\r\n        const ev = new CustomEvent('callBusy', { detail: { roomId: data.roomId, from: data.from } });\r\n        window.dispatchEvent(ev as unknown as Event);\r\n      }\r\n    };\r\n    const handleCallAnswer = async (data: { roomId: string; target: string; from: string }) => {\r\n      if (String(data.target) !== String(currentUserId)) return;\r\n      stopGlobalRingTone();\r\n      setCallConnecting(false);\r\n      setActiveRoomId(data.roomId);\r\n      setCallStartAt((prev) => (prev && prev > 0 ? prev : Date.now()));\r\n      await fetchToken(data.roomId);\r\n      setCallActive(true);\r\n    };\r\n    const handleCallEnd = (data: { roomId: string; from?: string; targets?: string[] }) => {\r\n      stopGlobalRingTone();\r\n      setIncomingCall(null);\r\n      const isDirect = String(data.roomId).split('_').filter(Boolean).length === 2;\r\n      const fromOther = typeof data.from === 'string' && String(data.from) !== String(currentUserId);\r\n      const explicit = fromOther || (Array.isArray(data.targets) && data.targets.length > 0);\r\n      // 1-1: luôn kết thúc khi roomId trùng phòng đang gọi (dù explicit hay không)\r\n      if (isDirect) {\r\n        if (String(data.roomId) !== String(activeRoomIdRef.current)) return;\r\n        endCall('remote');\r\n        if (String(data.roomId) === String(roomId)) {\r\n          setRoomCallActive(false);\r\n          setRoomCallType(null);\r\n          setRoomParticipants([]);\r\n        }\r\n        return;\r\n      }\r\n      if (String(data.roomId) !== String(activeRoomIdRef.current)) return;\r\n      endCall('remote');\r\n      if (String(data.roomId) === String(roomId)) {\r\n        setRoomCallActive(false);\r\n        setRoomCallType(null);\r\n        setRoomParticipants([]);\r\n      }\r\n    };\r\n    const handleCallReject = (data: { roomId: string }) => {\r\n      stopGlobalRingTone();\r\n      setIncomingCall(null);\r\n      if (String(data.roomId).split('_').filter(Boolean).length === 2) {\r\n        if (String(data.roomId) !== String(activeRoomIdRef.current)) return;\r\n        endCall('remote');\r\n        if (String(data.roomId) === String(roomId)) {\r\n          setRoomCallActive(false);\r\n          setRoomCallType(null);\r\n          setRoomParticipants([]);\r\n        }\r\n      }\r\n    };\r\n    const handleCallLeave = (data: { roomId: string; userId: string }) => {\r\n      if (String(data.roomId) !== String(roomId)) return;\r\n      setRoomParticipants((prev) => {\r\n        const next = (prev || []).filter((id) => String(id) !== String(data.userId));\r\n        if (next.length === 0) {\r\n          setRoomCallActive(false);\r\n          setRoomCallType(null);\r\n        }\r\n        return next;\r\n      });\r\n    };\r\n    const handleCallState = (data: {\r\n      roomId: string;\r\n      type: CallType;\r\n      participants: string[];\r\n      active: boolean;\r\n      startAt?: number | null;\r\n    }) => {\r\n      if (String(data.roomId) !== String(roomId)) return;\r\n      const isDirect = String(data.roomId).split('_').filter(Boolean).length === 2;\r\n      if (isDirect) return;\r\n      setRoomCallActive(!!data.active);\r\n      setRoomCallType(data.type);\r\n      setRoomParticipants(Array.isArray(data.participants) ? data.participants.map((x) => String(x)) : []);\r\n      setCallStartAt(typeof data.startAt === 'number' ? data.startAt : null);\r\n    };\r\n    socket.on('call_offer', handleCallOffer);\r\n    socket.on('call_answer', handleCallAnswer);\r\n    socket.on('call_end', handleCallEnd);\r\n    socket.on('call_reject', handleCallReject);\r\n    socket.on('call_leave', handleCallLeave);\r\n    socket.on('call_state', handleCallState);\r\n    socket.on('call_candidate', handleCallCandidate);\r\n    return () => {\r\n      socket.off('call_offer', handleCallOffer);\r\n      socket.off('call_answer', handleCallAnswer);\r\n      socket.off('call_end', handleCallEnd);\r\n      socket.off('call_reject', handleCallReject);\r\n      socket.off('call_leave', handleCallLeave);\r\n      socket.off('call_state', handleCallState);\r\n      socket.off('call_candidate', handleCallCandidate);\r\n    };\r\n  }, [currentUserId, socketRef, endCall, roomId, fetchToken]);\r\n\r\n  useEffect(() => {\r\n    if (!callConnecting) {\r\n      stopGlobalRingTone();\r\n      if (ringTimeoutRef.current) {\r\n        window.clearTimeout(ringTimeoutRef.current);\r\n        ringTimeoutRef.current = null;\r\n      }\r\n    }\r\n  }, [callConnecting]);\r\n  useEffect(() => {\r\n    if (!incomingCall) {\r\n      stopGlobalRingTone();\r\n      if (ringTimeoutRef.current) {\r\n        window.clearTimeout(ringTimeoutRef.current);\r\n        ringTimeoutRef.current = null;\r\n      }\r\n    }\r\n  }, [incomingCall]);\r\n\r\n  return {\r\n    callActive,\r\n    callType,\r\n    callStartAt,\r\n    callConnecting,\r\n    incomingCall,\r\n    startCall,\r\n    endCall,\r\n    acceptIncomingCall,\r\n    setIncomingCall,\r\n    roomCallActive,\r\n    roomCallType,\r\n    roomParticipants,\r\n    activeRoomId,\r\n    counterpartId,\r\n    livekitToken,\r\n    livekitUrl,\r\n    joinActiveGroupCall,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7399, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/hooks/useChatNotifications.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useCallback, useEffect, useRef } from 'react';\r\nimport type { Message } from '@/types/Message';\r\nimport { isVideoFile } from '@/utils/utils';\r\n\r\nconst MESSAGE_SOUND_URL = 'https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3';\r\n\r\nlet globalAudioContext: AudioContext | null = null;\r\n\r\ninterface UseChatNotificationsOptions {\r\n  chatName?: string;\r\n}\r\n\r\nexport function useChatNotifications({ chatName }: UseChatNotificationsOptions) {\r\n  const messageAudioRef = useRef<HTMLAudioElement | null>(null);\r\n  const lastPlayedAtRef = useRef<number>(0);\r\n  const flashingIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const flashTabTitle = useCallback(() => {\r\n    if (typeof window === 'undefined') return;\r\n    if (!document.hidden) return; // Chỉ nhấp nháy khi tab đang ẩn\r\n\r\n    if (flashingIntervalRef.current) return; // Đang nhấp nháy rồi thì thôi\r\n\r\n    const originalTitle = document.title;\r\n    let isOriginal = false;\r\n    \r\n    flashingIntervalRef.current = setInterval(() => {\r\n      document.title = isOriginal ? 'Bạn có tin nhắn mới' : originalTitle;\r\n      isOriginal = !isOriginal;\r\n    }, 1000);\r\n\r\n    const stopFlashing = () => {\r\n      if (flashingIntervalRef.current) {\r\n        clearInterval(flashingIntervalRef.current);\r\n        flashingIntervalRef.current = null;\r\n      }\r\n      document.title = originalTitle;\r\n      window.removeEventListener('focus', stopFlashing);\r\n      window.removeEventListener('click', stopFlashing);\r\n    };\r\n\r\n    window.addEventListener('focus', stopFlashing);\r\n    window.addEventListener('click', stopFlashing);\r\n  }, []);\r\n\r\n  const playMessageSound = useCallback(() => {\r\n    if (typeof window === 'undefined') return;\r\n    try {\r\n      const now = Date.now();\r\n      if (now - (lastPlayedAtRef.current || 0) < 400) {\r\n        return;\r\n      }\r\n      if (!messageAudioRef.current) {\r\n        const a = new Audio(MESSAGE_SOUND_URL);\r\n        a.preload = 'auto';\r\n        messageAudioRef.current = a;\r\n      }\r\n      const audio = messageAudioRef.current;\r\n      audio.currentTime = 0;\r\n      void audio.play().catch(() => {\r\n        try {\r\n          const AC = (window as unknown as { AudioContext?: typeof AudioContext; webkitAudioContext?: typeof AudioContext })\r\n            .AudioContext || (window as unknown as { webkitAudioContext?: typeof AudioContext }).webkitAudioContext;\r\n          if (!AC) return;\r\n          \r\n          let ctx = globalAudioContext;\r\n          if (!ctx) {\r\n            ctx = new AC();\r\n            globalAudioContext = ctx;\r\n          }\r\n\r\n          if (ctx.state === 'suspended') {\r\n             void ctx.resume();\r\n          }\r\n\r\n          const gain = ctx.createGain();\r\n          gain.gain.setValueAtTime(0, ctx.currentTime);\r\n          gain.connect(ctx.destination);\r\n\r\n          const osc1 = ctx.createOscillator();\r\n          osc1.type = 'sine';\r\n          osc1.frequency.setValueAtTime(820, ctx.currentTime);\r\n          osc1.frequency.linearRampToValueAtTime(1180, ctx.currentTime + 0.08);\r\n          osc1.connect(gain);\r\n\r\n          const osc2 = ctx.createOscillator();\r\n          osc2.type = 'sine';\r\n          osc2.frequency.setValueAtTime(620, ctx.currentTime + 0.05);\r\n          osc2.frequency.linearRampToValueAtTime(980, ctx.currentTime + 0.12);\r\n          osc2.connect(gain);\r\n\r\n          gain.gain.linearRampToValueAtTime(0.14, ctx.currentTime + 0.02);\r\n          gain.gain.linearRampToValueAtTime(0.0, ctx.currentTime + 0.20);\r\n\r\n          osc1.start(ctx.currentTime);\r\n          osc1.stop(ctx.currentTime + 0.18);\r\n          osc2.start(ctx.currentTime + 0.05);\r\n          try {\r\n            osc2.stop(ctx.currentTime + 0.23);\r\n          } catch {}\r\n          setTimeout(() => {\r\n            try {\r\n              osc1.disconnect();\r\n              osc2.disconnect();\r\n              gain.disconnect();\r\n              // Do NOT close the global context, just disconnect nodes\r\n              // ctx.close(); \r\n            } catch {}\r\n          }, 260);\r\n        } catch {}\r\n      });\r\n      lastPlayedAtRef.current = now;\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }, []);\r\n\r\n  const showMessageNotification = useCallback(\r\n    (msg: Message) => {\r\n      if (typeof window === 'undefined') return;\r\n      if (!('Notification' in window)) return;\r\n\r\n      // Nếu chưa xin quyền, xin ngay lúc nhận tin nhắn\r\n      if (Notification.permission === 'default') {\r\n        Notification.requestPermission().then((permission) => {\r\n          if (permission === 'granted') {\r\n            new Notification(chatName || 'Tin nhắn mới', {\r\n              body:\r\n                msg.content ||\r\n                (msg.type === 'image'\r\n                  ? 'Đã gửi cho bạn một ảnh.'\r\n                  : msg.type === 'video' || isVideoFile(msg.fileName)\r\n                    ? 'Đã gửi cho bạn một video.'\r\n                    : msg.type === 'file'\r\n                      ? 'Đã gửi cho bạn một file.'\r\n                      : 'Bạn có tin nhắn mới.'),\r\n            });\r\n          }\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (Notification.permission !== 'granted') return;\r\n\r\n      const body =\r\n        msg.content ||\r\n        (msg.type === 'image'\r\n          ? 'Đã gửi cho bạn một ảnh.'\r\n          : msg.type === 'video' || isVideoFile(msg.fileName)\r\n            ? 'Đã gửi cho bạn một video.'\r\n            : msg.type === 'file'\r\n              ? 'Đã gửi cho bạn một file.'\r\n              : 'Bạn có tin nhắn mới.');\r\n\r\n      new Notification(chatName || 'Tin nhắn mới', {\r\n        body,\r\n      });\r\n    },\r\n    [chatName],\r\n  );\r\n\r\n  // Xin quyền thông báo 1 lần khi mở cửa sổ chat\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    if (!('Notification' in window)) return;\r\n    if (Notification.permission === 'default') {\r\n      Notification.requestPermission().catch(() => {\r\n        // ignore\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  // Unlock WebAudio context on user interaction\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const initAudio = () => {\r\n      // 1. Unlock HTML5 Audio (existing logic)\r\n      if (!messageAudioRef.current) {\r\n        const a = new Audio(MESSAGE_SOUND_URL);\r\n        a.preload = 'auto';\r\n        messageAudioRef.current = a;\r\n      }\r\n      const audio = messageAudioRef.current;\r\n      try {\r\n        audio.muted = true;\r\n        audio.currentTime = 0;\r\n        void audio\r\n          .play()\r\n          .then(() => {\r\n            audio.pause();\r\n            audio.muted = false;\r\n            audio.currentTime = 0;\r\n          })\r\n          .catch(() => {\r\n            // ignore\r\n          });\r\n      } catch {\r\n        // ignore\r\n      }\r\n\r\n      // 2. Unlock WebAudio Context (New Logic for Mobile)\r\n      try {\r\n        const AC = (window as unknown as { AudioContext?: typeof AudioContext; webkitAudioContext?: typeof AudioContext })\r\n          .AudioContext || (window as unknown as { webkitAudioContext?: typeof AudioContext }).webkitAudioContext;\r\n        \r\n        if (AC) {\r\n          if (!globalAudioContext) {\r\n            globalAudioContext = new AC();\r\n          }\r\n          const ctx = globalAudioContext;\r\n          if (ctx.state === 'suspended') {\r\n            void ctx.resume();\r\n          }\r\n          // Play a silent buffer to fully unlock iOS/Android\r\n          const buffer = ctx.createBuffer(1, 1, 22050);\r\n          const source = ctx.createBufferSource();\r\n          source.buffer = buffer;\r\n          source.connect(ctx.destination);\r\n          source.start(0);\r\n        }\r\n      } catch {\r\n        // ignore\r\n      }\r\n    };\r\n\r\n    const events = ['click', 'pointerdown', 'touchstart', 'keydown'] as const;\r\n    events.forEach((ev) => window.addEventListener(ev, initAudio, { once: true }));\r\n    return () => {\r\n      events.forEach((ev) => window.removeEventListener(ev, initAudio));\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    playMessageSound,\r\n    showMessageNotification,\r\n    flashTabTitle,\r\n  };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7645, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/layout/layout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport SidebarMenu from '../(menu)/menu';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport io, { type Socket } from 'socket.io-client';\r\nimport { resolveSocketUrl } from '@/utils/utils';\r\nimport { createMessageApi } from '@/fetch/messages';\r\nimport type { GroupConversation } from '@/types/Group';\r\nimport type { User } from '@/types/User';\r\nimport IncomingCallModal from '@/components/(call)/IncomingCallModal';\r\nimport ModalCall from '@/components/(call)/ModalCall';\r\nimport LiveKitCall from '@/components/(call)/LiveKitCall';\r\nimport { useLiveKitSession } from '@/hooks/useLiveKitSession';\r\nimport { useToast } from '@/components/base/toast';\r\n\r\n// React Icons – Bộ hiện đại nhất 2025\r\nimport {\r\n  HiChatBubbleLeftRight,\r\n  HiUserGroup,\r\n  HiPhoto,\r\n  HiUserCircle,\r\n  HiSparkles,\r\n  HiRectangleGroup,\r\n  HiArrowsPointingIn,\r\n  HiArrowsPointingOut,\r\n  HiMinus,\r\n  HiXMark,\r\n} from 'react-icons/hi2';\r\n\r\nimport { useChatNotifications } from '@/hooks/useChatNotifications';\r\n\r\nconst LayoutBase = ({ children }: { children: React.ReactNode }) => {\r\n  const [isAuthed, setIsAuthed] = useState<boolean>(false);\r\n  const [checked, setChecked] = useState<boolean>(false);\r\n  const [hideMobileFooter, setHideMobileFooter] = useState<boolean>(false);\r\n  const [currentUserId, setCurrentUserId] = useState<string | null>(null);\r\n  const [totalUnread, setTotalUnread] = useState<number>(0);\r\n  const [unreadGroups, setUnreadGroups] = useState<number>(0);\r\n  const [unreadContacts, setUnreadContacts] = useState<number>(0);\r\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const groupMembersRef = useRef<Map<string, Array<{ _id: string } | string>>>(new Map());\r\n  const groupInfoRef = useRef<Map<string, { name?: string; avatar?: string }>>(new Map());\r\n  const callNotifySeenRef = useRef<Set<string>>(new Set());\r\n  const [showNewMsgBanner, setShowNewMsgBanner] = useState(false);\r\n  const newMsgBannerTimerRef = useRef<number | null>(null);\r\n  const [globalCallFullscreen, setGlobalCallFullscreen] = useState<boolean>(false);\r\n  const callOverlayRef = useRef<HTMLDivElement | null>(null);\r\n  useEffect(() => {\r\n    const el = callOverlayRef.current;\r\n    if (globalCallFullscreen) {\r\n      try {\r\n        if (el && typeof el.requestFullscreen === 'function') {\r\n          void el.requestFullscreen();\r\n        }\r\n      } catch {}\r\n    } else {\r\n      try {\r\n        if (document.fullscreenElement) {\r\n          void document.exitFullscreen();\r\n        }\r\n      } catch {}\r\n    }\r\n  }, [globalCallFullscreen]);\r\n  useEffect(() => {\r\n    const handler = () => {\r\n      const active = !!document.fullscreenElement;\r\n      if (!active && globalCallFullscreen) {\r\n        setGlobalCallFullscreen(false);\r\n      }\r\n    };\r\n    document.addEventListener('fullscreenchange', handler);\r\n    return () => document.removeEventListener('fullscreenchange', handler);\r\n  }, [globalCallFullscreen]);\r\n\r\n  const { playMessageSound, flashTabTitle } = useChatNotifications({});\r\n\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n\r\n  const isProfilePage =\r\n    pathname === '/profile' || pathname === '/me' || pathname?.startsWith('/profile') || pathname?.startsWith('/me');\r\n\r\n  const pathnameRef = useRef(pathname);\r\n  useEffect(() => {\r\n    pathnameRef.current = pathname;\r\n  }, [pathname]);\r\n\r\n  // Kiểm tra đăng nhập – giữ nguyên logic\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const checkAuth = async () => {\r\n      try {\r\n        const res = await fetch('/api/auth/refresh', { credentials: 'include' });\r\n        if (res.ok) {\r\n          const meRes = await fetch('/api/users/me', { credentials: 'include' });\r\n          const meJson = await meRes.json();\r\n          if (mounted) {\r\n            setIsAuthed(!!meJson?.success);\r\n            if (meJson?.success && meJson?.user) setCurrentUser(meJson.user as User);\r\n          }\r\n        } else {\r\n          const meRes = await fetch('/api/users/me', { credentials: 'include' });\r\n          const meJson = await meRes.json();\r\n          if (mounted) {\r\n            setIsAuthed(!!meJson?.success);\r\n            if (meJson?.success && meJson?.user) setCurrentUser(meJson.user as User);\r\n          }\r\n        }\r\n      } catch {\r\n        try {\r\n          const raw = localStorage.getItem('info_user');\r\n          const u = raw ? JSON.parse(raw) : null;\r\n          if (mounted) {\r\n            setIsAuthed(!!u && !!u._id);\r\n            if (u && u._id) setCurrentUser(u as User);\r\n          }\r\n        } catch {\r\n          if (mounted) setIsAuthed(false);\r\n        }\r\n      } finally {\r\n        if (mounted) setChecked(true);\r\n      }\r\n    };\r\n    checkAuth();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  // Lấy current user id để dùng tính tổng unread\r\n  useEffect(() => {\r\n    const loadMe = async () => {\r\n      try {\r\n        const meRes = await fetch('/api/users/me', { credentials: 'include' });\r\n        const meJson = await meRes.json();\r\n        const id = String(meJson?.data?._id || '').trim();\r\n        if (id) {\r\n          setCurrentUserId(id);\r\n          return;\r\n        }\r\n      } catch {}\r\n      try {\r\n        const raw = localStorage.getItem('info_user');\r\n        const u = raw ? JSON.parse(raw) : null;\r\n        const id = String(u?._id || u?.username || '').trim();\r\n        if (id) setCurrentUserId(id);\r\n      } catch {}\r\n    };\r\n    if (isAuthed && checked) loadMe();\r\n  }, [isAuthed, checked]);\r\n\r\n  // Tính tổng tin nhắn chưa đọc\r\n  const fetchUnreadTotal = useCallback(async () => {\r\n    if (!currentUserId) return;\r\n    try {\r\n      const [usersRes, groupsRes] = await Promise.all([\r\n        fetch('/api/users', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'read', currentUserId }),\r\n        }),\r\n        fetch('/api/groups', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'readGroups', _id: currentUserId }),\r\n        }),\r\n      ]);\r\n      const usersJson = await usersRes.json();\r\n      const groupsJson = await groupsRes.json();\r\n      const users = (Array.isArray(usersJson) ? usersJson : usersJson.data || []) as Array<Partial<User>>;\r\n      const groups = (Array.isArray(groupsJson) ? groupsJson : groupsJson.data || []) as Array<\r\n        Partial<GroupConversation>\r\n      >;\r\n      const sumUsers = users.reduce((acc: number, u: Partial<User>) => acc + Number(u?.unreadCount || 0), 0);\r\n      const sumGroups = groups.reduce(\r\n        (acc: number, g: Partial<GroupConversation>) => acc + Number(g?.unreadCount || 0),\r\n        0,\r\n      );\r\n      setTotalUnread(sumUsers + sumGroups);\r\n      setUnreadContacts(sumUsers);\r\n      setUnreadGroups(sumGroups);\r\n    } catch {\r\n      // bỏ qua lỗi\r\n    }\r\n  }, [currentUserId]);\r\n\r\n  useEffect(() => {\r\n    fetchUnreadTotal();\r\n    // Polling removed in favor of socket events\r\n  }, [fetchUnreadTotal]);\r\n\r\n  // Ẩn/hiện mobile footer\r\n  useEffect(() => {\r\n    const handler = (e: Event) => {\r\n      const evt = e as CustomEvent<{ hidden?: boolean }>;\r\n      setHideMobileFooter(!!evt.detail?.hidden);\r\n    };\r\n    window.addEventListener('mobile-footer', handler);\r\n    return () => window.removeEventListener('mobile-footer', handler);\r\n  }, []);\r\n\r\n  // Redirect khi chưa đăng nhập hoặc khi API trả về 401\r\n  useEffect(() => {\r\n    const orig: typeof fetch = window.fetch;\r\n    let refreshPromise: Promise<Response> | null = null;\r\n\r\n    const wrapped: typeof fetch = async (input, init) => {\r\n      const url =\r\n        typeof input === 'string'\r\n          ? input\r\n          : input instanceof URL\r\n            ? input.toString()\r\n            : input instanceof Request\r\n              ? input.url\r\n              : '';\r\n      let res: Response;\r\n      try {\r\n        res = await orig(input, init);\r\n      } catch (err) {\r\n        return new Response(null, { status: 502, statusText: 'Network Error' });\r\n      }\r\n\r\n      // Chỉ xử lý refresh token cho các API nội bộ (bắt đầu bằng /api/)\r\n      // và bỏ qua các request không phải API (ví dụ: socket.io, assets, external links)\r\n      if (!url.includes('/api/') || url.includes('/api/auth/refresh')) {\r\n        if (res.status === 401 && url.includes('/api/auth/refresh') && pathname !== '/login') {\r\n          router.push('/login');\r\n        }\r\n        return res;\r\n      }\r\n\r\n      if (res.status !== 401) return res;\r\n\r\n      if (!refreshPromise) {\r\n        refreshPromise = orig('/api/auth/refresh', { credentials: 'include' }).finally(() => {\r\n          refreshPromise = null;\r\n        });\r\n      }\r\n\r\n      try {\r\n        const r = await refreshPromise;\r\n        if (r.ok) {\r\n          return await orig(input, init);\r\n        }\r\n      } catch {}\r\n      if (pathname !== '/login') router.push('/login');\r\n      return res;\r\n    };\r\n    window.fetch = wrapped;\r\n    return () => {\r\n      window.fetch = orig;\r\n    };\r\n  }, [router, pathname]);\r\n\r\n  useEffect(() => {\r\n    if (checked && !isAuthed && pathname !== '/login') {\r\n      router.push('/login');\r\n    }\r\n  }, [checked, isAuthed, pathname, router]);\r\n\r\n  useEffect(() => {\r\n    if (!checked || !isAuthed || !currentUser) return;\r\n    if (socketRef.current?.connected) return;\r\n    const s = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n    socketRef.current = s;\r\n    s.emit('join_user', { userId: String(currentUser._id) });\r\n    const joinAllGroups = async () => {\r\n      try {\r\n        const res = await fetch('/api/groups', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'readGroups', _id: String(currentUser._id) }),\r\n        });\r\n        const j = await res.json();\r\n        const arr = (j?.data || []) as GroupConversation[];\r\n        const m = new Map<string, Array<{ _id: string } | string>>();\r\n        arr.forEach((g) => {\r\n          const gid = String(g._id);\r\n          const members = (Array.isArray(g.members) ? g.members : []) as Array<{ _id: string } | string>;\r\n          m.set(gid, members);\r\n          groupInfoRef.current.set(gid, { name: g.name, avatar: g.avatar });\r\n          s.emit('join_room', gid);\r\n        });\r\n        groupMembersRef.current = m;\r\n      } catch {}\r\n    };\r\n    void joinAllGroups();\r\n    s.on('connect', () => {\r\n      void joinAllGroups();\r\n    });\r\n    s.on(\r\n      'update_sidebar',\r\n      (data: {\r\n        sender: string;\r\n        receiver?: string;\r\n        roomId: string;\r\n        type: string;\r\n        content?: string;\r\n        isRecalled?: boolean;\r\n        lastMessage?: string;\r\n        timestamp?: number;\r\n        senderName?: string;\r\n        isGroup: boolean;\r\n        members?: (string | { _id: string })[];\r\n        groupName?: string;\r\n      }) => {\r\n        // const p = pathnameRef.current;\r\n        // const isChatPage = p === '/' || p === '/home' || p?.startsWith('/chat');\r\n\r\n        if (data.sender === String(currentUser._id)) return;\r\n\r\n        const soundEnabled =\r\n          (currentUser as unknown as { notifications?: { soundEnabled?: boolean } })?.notifications?.soundEnabled !==\r\n          false;\r\n\r\n        if (soundEnabled) {\r\n          playMessageSound();\r\n        }\r\n        flashTabTitle();\r\n\r\n        const isMsgType =\r\n          data.type === 'text' ||\r\n          data.type === 'image' ||\r\n          data.type === 'file' ||\r\n          data.type === 'sticker' ||\r\n          data.type === 'video' ||\r\n          data.type === 'notify';\r\n        if (isMsgType) {\r\n          // Update unread count when new message arrives\r\n          fetchUnreadTotal();\r\n\r\n          setShowNewMsgBanner(true);\r\n          if (newMsgBannerTimerRef.current) {\r\n            window.clearTimeout(newMsgBannerTimerRef.current);\r\n            newMsgBannerTimerRef.current = null;\r\n          }\r\n          newMsgBannerTimerRef.current = window.setTimeout(() => {\r\n            setShowNewMsgBanner(false);\r\n            newMsgBannerTimerRef.current = null;\r\n          }, 5000);\r\n        }\r\n        if (data.type === 'notify' && typeof data.content === 'string') {\r\n          const rid = String(data.roomId || '');\r\n          if (rid && data.content.toLowerCase().includes('cuộc gọi nhóm đã kết thúc')) {\r\n            const prev = new Map(activeGroupCallRooms);\r\n            if (prev.has(rid)) {\r\n              prev.set(rid, { active: false, type: prev.get(rid)?.type || null, participants: [], startAt: null });\r\n              setActiveGroupCallRooms(prev);\r\n              const activeRooms = Array.from(prev.entries())\r\n                .filter(([, v]) => v.active)\r\n                .map(([k]) => k);\r\n              try {\r\n                localStorage.setItem('ACTIVE_GROUP_CALL_ROOMS', JSON.stringify(activeRooms));\r\n              } catch {}\r\n              const ev2 = new CustomEvent('activeGroupCallsUpdated', { detail: { rooms: activeRooms } });\r\n              window.dispatchEvent(ev2 as unknown as Event);\r\n            }\r\n          }\r\n        }\r\n      },\r\n    );\r\n\r\n    s.on(\r\n      'call_state',\r\n      (payload: { roomId: string; type: string; participants: string[]; active: boolean; startAt?: number | null }) => {\r\n        try {\r\n          const rid = String(payload.roomId || '');\r\n          if (!rid) return;\r\n          const prevEntry = activeGroupCallRoomsRef.current.get(rid) || {\r\n            active: false,\r\n            type: null,\r\n            participants: [],\r\n            startAt: null,\r\n          };\r\n          const wasActive = !!prevEntry.active;\r\n          const prevParticipants = Array.isArray(prevEntry.participants)\r\n            ? prevEntry.participants.map((x) => String(x))\r\n            : [];\r\n          const nowActive = !!payload.active;\r\n          const nowParticipants = Array.isArray(payload.participants) ? payload.participants.map((x) => String(x)) : [];\r\n          const isGroupRoom = rid.split('_').filter(Boolean).length !== 2;\r\n          const amLast =\r\n            isGroupRoom &&\r\n            wasActive &&\r\n            !nowActive &&\r\n            prevParticipants.length <= 1 &&\r\n            prevParticipants.includes(String(currentUser?._id || ''));\r\n          const prev = new Map(activeGroupCallRooms);\r\n          prev.set(rid, {\r\n            active: nowActive,\r\n            type: payload.type || null,\r\n            participants: nowParticipants,\r\n            startAt: typeof payload.startAt === 'number' ? payload.startAt : null,\r\n          });\r\n          setActiveGroupCallRooms(prev);\r\n          const activeRooms = Array.from(prev.entries())\r\n            .filter(([, v]) => v.active)\r\n            .map(([k]) => k);\r\n          try {\r\n            localStorage.setItem('ACTIVE_GROUP_CALL_ROOMS', JSON.stringify(activeRooms));\r\n          } catch {}\r\n          const ev = new CustomEvent('activeGroupCallsUpdated', { detail: { rooms: activeRooms } });\r\n          window.dispatchEvent(ev as unknown as Event);\r\n          if (amLast) {\r\n            const members = groupMembersRef.current.get(rid) || [];\r\n            socketRef.current?.emit('send_message', {\r\n              roomId: rid,\r\n              sender: String(currentUser?._id || ''),\r\n              senderName: String(currentUser?.name || 'Hệ thống'),\r\n              isGroup: true,\r\n              members,\r\n              type: 'notify',\r\n              content: 'Cuộc gọi nhóm đã kết thúc',\r\n            });\r\n          }\r\n        } catch {}\r\n      },\r\n    );\r\n    s.on('call_end', (payload: { roomId: string; from?: string }) => {\r\n      try {\r\n        const rid = String(payload.roomId || '');\r\n        if (!rid) return;\r\n        const prevEntry = activeGroupCallRoomsRef.current.get(rid) || {\r\n          active: false,\r\n          type: null,\r\n          participants: [],\r\n          startAt: null,\r\n        };\r\n        const wasActive = !!prevEntry.active;\r\n        const prevParticipants = Array.isArray(prevEntry.participants) ? prevEntry.participants : [];\r\n        const isGroupRoom = rid.split('_').filter(Boolean).length !== 2;\r\n        const prev = new Map(activeGroupCallRooms);\r\n        prev.set(rid, {\r\n          active: false,\r\n          type: (prev.get(rid)?.type as string) || null,\r\n          participants: [],\r\n          startAt: null,\r\n        });\r\n        setActiveGroupCallRooms(prev);\r\n        const activeRooms = Array.from(prev.entries())\r\n          .filter(([, v]) => v.active)\r\n          .map(([k]) => k);\r\n        try {\r\n          localStorage.setItem('ACTIVE_GROUP_CALL_ROOMS', JSON.stringify(activeRooms));\r\n        } catch {}\r\n        const ev = new CustomEvent('activeGroupCallsUpdated', { detail: { rooms: activeRooms } });\r\n        window.dispatchEvent(ev as unknown as Event);\r\n        const senderId = String(payload?.from || '');\r\n        const amLast =\r\n          isGroupRoom &&\r\n          wasActive &&\r\n          prevParticipants.length <= 1 &&\r\n          prevParticipants.includes(String(currentUser?._id || '')) &&\r\n          senderId &&\r\n          String(currentUser?._id || '') === senderId;\r\n        if (amLast) {\r\n          const members = groupMembersRef.current.get(rid) || [];\r\n          socketRef.current?.emit('send_message', {\r\n            roomId: rid,\r\n            sender: String(currentUser?._id || ''),\r\n            senderName: String(currentUser?.name || 'Hệ thống'),\r\n            isGroup: true,\r\n            members,\r\n            type: 'notify',\r\n            content: 'Cuộc gọi nhóm đã kết thúc',\r\n          });\r\n        }\r\n      } catch {}\r\n    });\r\n    (async () => {\r\n      try {\r\n        const res = await fetch('/api/groups', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'readGroups', _id: String(currentUser?._id || '') }),\r\n        });\r\n        const j = await res.json();\r\n        const arr = (j?.data || []) as GroupConversation[];\r\n        arr.forEach((g) => {\r\n          const gid = String(g._id);\r\n          s.emit('join_room', gid);\r\n        });\r\n      } catch {}\r\n    })();\r\n\r\n    s.on('call_notify', async () => {});\r\n    return () => {\r\n      try {\r\n        socketRef.current?.disconnect();\r\n      } catch {}\r\n      socketRef.current = null;\r\n    };\r\n  }, [checked, isAuthed, currentUser, playMessageSound, flashTabTitle, fetchUnreadTotal]);\r\n\r\n  // Xác định tab active\r\n  const isActive = (paths: string[]) => {\r\n    return paths.some(\r\n      (p) =>\r\n        pathname === p ||\r\n        pathname?.startsWith(p + '/') ||\r\n        (p === '/home' && (pathname === '/' || pathname?.startsWith('/chat'))),\r\n    );\r\n  };\r\n\r\n  const mobileTabs = [\r\n    { key: 'home', label: 'Tin nhắn', paths: ['/home', '/chat', '/'], icon: HiChatBubbleLeftRight },\r\n    { key: 'group', label: 'Nhóm', paths: ['/group'], icon: HiRectangleGroup },\r\n    { key: 'directory', label: 'Danh bạ', paths: ['/directory'], icon: HiUserGroup },\r\n    { key: 'moments', label: 'Tường', paths: ['/moments', '/timeline'], icon: HiPhoto },\r\n    { key: 'profile', label: 'Cá nhân', paths: ['/profile', '/me'], icon: HiUserCircle },\r\n  ];\r\n\r\n  const isWidgetIframe = pathname === '/chat-iframe' || pathname?.startsWith('/chat-iframe');\r\n\r\n  const [globalRoomId, setGlobalRoomId] = useState<string>('');\r\n  const [globalIsGroup, setGlobalIsGroup] = useState<boolean>(false);\r\n  const [globalSelectedChat, setGlobalSelectedChat] = useState<{\r\n    _id?: string;\r\n    members?: (string | { _id: string })[];\r\n    name?: string;\r\n    avatar?: string;\r\n  } | null>(null);\r\n\r\n  const [currentViewedRoomId, setCurrentViewedRoomId] = useState<string>('');\r\n  const normalizedRoomId = String((globalRoomId || currentViewedRoomId || '').trim());\r\n  const normalizedIsGroup = !!globalIsGroup;\r\n  const {\r\n    callActive,\r\n    callType,\r\n    callConnecting,\r\n    incomingCall,\r\n    startCall,\r\n    acceptIncomingCall,\r\n    endCall,\r\n    callStartAt,\r\n    counterpartId,\r\n    activeRoomId,\r\n    livekitToken,\r\n    livekitUrl,\r\n    roomCallActive,\r\n    roomCallType,\r\n    roomParticipants,\r\n    setIncomingCall,\r\n    joinActiveGroupCall,\r\n  } = useLiveKitSession({\r\n    socketRef,\r\n    roomId: normalizedRoomId,\r\n    currentUserId: String(currentUser?._id || ''),\r\n    currentUser: currentUser,\r\n    isGroup: normalizedIsGroup,\r\n    selectedChat: globalSelectedChat,\r\n  });\r\n  const toast = useToast();\r\n  const lastActiveRoomIdRef = React.useRef<string>('');\r\n  useEffect(() => {\r\n    if (activeRoomId) lastActiveRoomIdRef.current = String(activeRoomId);\r\n  }, [activeRoomId]);\r\n  const lastCallStartAtRef = React.useRef<number | null>(null);\r\n  useEffect(() => {\r\n    lastCallStartAtRef.current = typeof callStartAt === 'number' ? callStartAt : null;\r\n  }, [callStartAt]);\r\n  useEffect(() => {\r\n    try {\r\n      const raw = localStorage.getItem('CURRENT_ROOM_ID');\r\n      setCurrentViewedRoomId(String(raw || ''));\r\n    } catch {}\r\n    const handler = (e: Event) => {\r\n      const d = (e as unknown as { detail?: { roomId?: string } }).detail;\r\n      if (!d) return;\r\n      setCurrentViewedRoomId(String(d.roomId || ''));\r\n    };\r\n    window.addEventListener('currentRoomChanged', handler as EventListener);\r\n    return () => window.removeEventListener('currentRoomChanged', handler as EventListener);\r\n  }, []);\r\n  useEffect(() => {\r\n    const isChatPage = pathname === '/' || pathname === '/home' || pathname?.startsWith('/chat');\r\n    if (!isChatPage) return;\r\n    if (!currentViewedRoomId) return;\r\n    if (incomingCall || callActive || callConnecting) return;\r\n    if (String(globalRoomId) === String(currentViewedRoomId)) return;\r\n    setGlobalRoomId(String(currentViewedRoomId));\r\n    const parts = String(currentViewedRoomId).split('_').filter(Boolean);\r\n    setGlobalIsGroup(parts.length !== 2);\r\n  }, [currentViewedRoomId, pathname, globalRoomId, incomingCall, callActive, callConnecting]);\r\n  useEffect(() => {\r\n    if (!incomingCall) return;\r\n    const rid = String(incomingCall.roomId || '');\r\n    if (!rid) return;\r\n    const parts = rid.split('_').filter(Boolean);\r\n    const isG = parts.length !== 2;\r\n    setGlobalRoomId(rid);\r\n    setGlobalIsGroup(isG);\r\n    if (isG) {\r\n      const info = groupInfoRef.current.get(rid);\r\n      const applyInfo = (inf?: { name?: string; avatar?: string }) => {\r\n        if (inf) {\r\n          setRemoteName(String(inf.name || ''));\r\n          setRemoteAvatar(inf.avatar ? String(inf.avatar) : undefined);\r\n        }\r\n      };\r\n      if (info) {\r\n        applyInfo(info);\r\n      } else {\r\n        (async () => {\r\n          try {\r\n            const res = await fetch('/api/groups', {\r\n              method: 'POST',\r\n              headers: { 'Content-Type': 'application/json' },\r\n              body: JSON.stringify({ action: 'readGroups', _id: String(currentUser?._id || '') }),\r\n            });\r\n            const j = await res.json();\r\n            const arr = (j?.data || []) as GroupConversation[];\r\n            const m = new Map<string, Array<{ _id: string } | string>>();\r\n            arr.forEach((g) => {\r\n              const gid = String(g._id);\r\n              const members = (Array.isArray(g.members) ? g.members : []) as Array<{ _id: string } | string>;\r\n              m.set(gid, members);\r\n              groupInfoRef.current.set(gid, { name: g.name, avatar: g.avatar });\r\n            });\r\n            groupMembersRef.current = m;\r\n            applyInfo(groupInfoRef.current.get(rid));\r\n          } catch {\r\n            // ignore\r\n          }\r\n        })();\r\n      }\r\n    }\r\n  }, [incomingCall]);\r\n  useEffect(() => {\r\n    try {\r\n      const flag = incomingCall ? '1' : '';\r\n      if (flag) localStorage.setItem('GLOBAL_INCOMING_CALL', flag);\r\n      else localStorage.removeItem('GLOBAL_INCOMING_CALL');\r\n      const activeFlag = callActive ? '1' : '';\r\n      const connectingFlag = callConnecting ? '1' : '';\r\n      if (activeFlag) localStorage.setItem('GLOBAL_CALL_ACTIVE', activeFlag);\r\n      else localStorage.removeItem('GLOBAL_CALL_ACTIVE');\r\n      if (connectingFlag) localStorage.setItem('GLOBAL_CALL_CONNECTING', connectingFlag);\r\n      else localStorage.removeItem('GLOBAL_CALL_CONNECTING');\r\n      const ev = new CustomEvent('globalCallStatusChanged', {\r\n        detail: {\r\n          active: !!callActive,\r\n          connecting: !!callConnecting,\r\n          incoming: !!incomingCall,\r\n        },\r\n      });\r\n      window.dispatchEvent(ev as unknown as Event);\r\n    } catch {}\r\n  }, [incomingCall, callActive, callConnecting]);\r\n\r\n  const [globalCallPos, setGlobalCallPos] = useState<{ x: number; y: number }>({ x: 24, y: 24 });\r\n  const [globalCallSize, setGlobalCallSize] = useState<{ w: number }>({ w: 560 });\r\n  const [globalCallMin, setGlobalCallMin] = useState<boolean>(false);\r\n  const globalPrevSizeRef = React.useRef<{ w: number } | null>(null);\r\n  const [globalCallHidden, setGlobalCallHidden] = useState<boolean>(false);\r\n  const [globalIsDesktop, setGlobalIsDesktop] = useState<boolean>(false);\r\n  const [remoteName, setRemoteName] = useState<string>('');\r\n  const [remoteAvatar, setRemoteAvatar] = useState<string | undefined>(undefined);\r\n  const [callDurationSec, setCallDurationSec] = useState<number>(0);\r\n  const [activeGroupCallRooms, setActiveGroupCallRooms] = useState<\r\n    Map<string, { active: boolean; type: string | null; participants: string[]; startAt: number | null }>\r\n  >(new Map());\r\n  const activeGroupCallRoomsRef = React.useRef<\r\n    Map<string, { active: boolean; type: string | null; participants: string[]; startAt: number | null }>\r\n  >(new Map());\r\n  useEffect(() => {\r\n    activeGroupCallRoomsRef.current = new Map(activeGroupCallRooms);\r\n  }, [activeGroupCallRooms]);\r\n  const participantsZeroTimerRef = React.useRef<number | null>(null);\r\n  const prevParticipantsRef = React.useRef<Array<{ id: string; name?: string }> | null>(null);\r\n  useEffect(() => {\r\n    const apply = () => setGlobalIsDesktop(typeof window !== 'undefined' ? window.innerWidth >= 768 : false);\r\n    apply();\r\n    window.addEventListener('resize', apply);\r\n    return () => window.removeEventListener('resize', apply);\r\n  }, []);\r\n  const [openBtnPos, setOpenBtnPos] = useState<{ x: number; y: number }>({ x: 24, y: 24 });\r\n  const openBtnRef = useRef<HTMLDivElement | null>(null);\r\n  const openBtnDraggingRef = useRef<boolean>(false);\r\n  useEffect(() => {\r\n    try {\r\n      const W = typeof window !== 'undefined' ? window.innerWidth : 360;\r\n      const H = typeof window !== 'undefined' ? window.innerHeight : 640;\r\n      setOpenBtnPos({ x: Math.max(8, W - 140), y: Math.max(8, H - 80) });\r\n    } catch {}\r\n  }, []);\r\n  const handleOpenBtnDragStart = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    const rect = openBtnRef.current?.getBoundingClientRect();\r\n    const bw = rect?.width ?? 140;\r\n    const bh = rect?.height ?? 48;\r\n    const st = { sx: e.clientX, sy: e.clientY, ox: openBtnPos.x, oy: openBtnPos.y };\r\n    const onMove = (ev: MouseEvent) => {\r\n      openBtnDraggingRef.current = true;\r\n      const dx = ev.clientX - st.sx;\r\n      const dy = ev.clientY - st.sy;\r\n      const nx = Math.min(Math.max(8, st.ox + dx), Math.max(8, (window.innerWidth || 360) - bw - 8));\r\n      const ny = Math.min(Math.max(8, st.oy + dy), Math.max(8, (window.innerHeight || 640) - bh - 8));\r\n      setOpenBtnPos({ x: nx, y: ny });\r\n    };\r\n    const onUp = () => {\r\n      setTimeout(() => (openBtnDraggingRef.current = false), 0);\r\n      window.removeEventListener('mousemove', onMove);\r\n      window.removeEventListener('mouseup', onUp);\r\n    };\r\n    window.addEventListener('mousemove', onMove);\r\n    window.addEventListener('mouseup', onUp);\r\n  };\r\n  const handleOpenBtnTouchDragStart = (e: React.TouchEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    const rect = openBtnRef.current?.getBoundingClientRect();\r\n    const bw = rect?.width ?? 140;\r\n    const bh = rect?.height ?? 48;\r\n    const t = e.touches[0];\r\n    const st = { sx: t.clientX, sy: t.clientY, ox: openBtnPos.x, oy: openBtnPos.y };\r\n    const onMove = (ev: TouchEvent) => {\r\n      openBtnDraggingRef.current = true;\r\n      const tt = ev.touches[0];\r\n      const dx = tt.clientX - st.sx;\r\n      const dy = tt.clientY - st.sy;\r\n      const nx = Math.min(Math.max(8, st.ox + dx), Math.max(8, (window.innerWidth || 360) - bw - 8));\r\n      const ny = Math.min(Math.max(8, st.oy + dy), Math.max(8, (window.innerHeight || 640) - bh - 8));\r\n      setOpenBtnPos({ x: nx, y: ny });\r\n    };\r\n    const onUp = () => {\r\n      setTimeout(() => (openBtnDraggingRef.current = false), 0);\r\n      window.removeEventListener('touchmove', onMove);\r\n      window.removeEventListener('touchend', onUp);\r\n    };\r\n    window.addEventListener('touchmove', onMove, { passive: false });\r\n    window.addEventListener('touchend', onUp, { passive: false });\r\n  };\r\n  React.useEffect(() => {\r\n    const minimize = () => {\r\n      setGlobalCallHidden(false);\r\n      globalPrevSizeRef.current = { ...globalCallSize };\r\n      const w = Math.max(280, Math.min(360, globalCallSize.w));\r\n      setGlobalCallSize({ w });\r\n      try {\r\n        const W = typeof window !== 'undefined' ? window.innerWidth : 360;\r\n        const x = Math.max(8, W - w - 16);\r\n        setGlobalCallPos({ x, y: 16 });\r\n      } catch {}\r\n      setGlobalCallMin(true);\r\n    };\r\n    window.addEventListener('minimizeCallOverlay', minimize as EventListener);\r\n    return () => {\r\n      window.removeEventListener('minimizeCallOverlay', minimize as EventListener);\r\n    };\r\n  }, [globalCallSize.w]);\r\n  React.useEffect(() => {\r\n    const hide = () => {\r\n      setGlobalCallMin(false);\r\n      setGlobalCallHidden(true);\r\n    };\r\n    window.addEventListener('hideCallOverlay', hide as EventListener);\r\n    return () => window.removeEventListener('hideCallOverlay', hide as EventListener);\r\n  }, []);\r\n  useEffect(() => {\r\n    const rid = String(normalizedRoomId || '');\r\n    if (!rid) return;\r\n    if (!normalizedIsGroup) return;\r\n    const nowActive = !!callActive || !!roomCallActive;\r\n    const prev = new Map(activeGroupCallRooms);\r\n    const prevEntry = prev.get(rid) || { active: false, type: null, participants: [], startAt: null as number | null };\r\n    const parts = Array.isArray(roomParticipants) ? roomParticipants.map((x) => String(x)) : [];\r\n    const nextParts = parts.length > 0 ? parts : nowActive ? [String(currentUser?._id || '')] : [];\r\n    const nextType = (callType as string) || prevEntry.type || null;\r\n    const nextStartAt = typeof callStartAt === 'number' ? callStartAt : prevEntry.startAt;\r\n    const changed =\r\n      prevEntry.active !== nowActive ||\r\n      String(prevEntry.type || '') !== String(nextType || '') ||\r\n      (prevEntry.startAt || null) !== (nextStartAt || null);\r\n    if (changed) {\r\n      prev.set(rid, { active: nowActive, type: nextType, participants: nextParts, startAt: nextStartAt || null });\r\n      setActiveGroupCallRooms(prev);\r\n      const activeRooms = Array.from(prev.entries())\r\n        .filter(([, v]) => v.active)\r\n        .map(([k]) => k);\r\n      try {\r\n        localStorage.setItem('ACTIVE_GROUP_CALL_ROOMS', JSON.stringify(activeRooms));\r\n      } catch {}\r\n      const ev = new CustomEvent('activeGroupCallsUpdated', { detail: { rooms: activeRooms } });\r\n      window.dispatchEvent(ev as unknown as Event);\r\n    }\r\n  }, [\r\n    callActive,\r\n    roomCallActive,\r\n    normalizedIsGroup,\r\n    normalizedRoomId,\r\n    callType,\r\n    roomParticipants,\r\n    callStartAt,\r\n    activeGroupCallRooms,\r\n    currentUser,\r\n  ]);\r\n  React.useEffect(() => {\r\n    const handler = (e: Event) => {\r\n      const d = (e as unknown as { detail?: { roomId?: string } }).detail;\r\n      const rid = String(d?.roomId || '');\r\n      if (!rid) return;\r\n      setGlobalRoomId(rid);\r\n      setGlobalIsGroup(true);\r\n      void joinActiveGroupCall();\r\n    };\r\n    window.addEventListener('joinActiveGroupCallRequest', handler as EventListener);\r\n    return () => window.removeEventListener('joinActiveGroupCallRequest', handler as EventListener);\r\n  }, [joinActiveGroupCall]);\r\n  const handleGlobalDragStart = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    const state = { startX: e.clientX, startY: e.clientY, originX: globalCallPos.x, originY: globalCallPos.y };\r\n    const onMove = (ev: MouseEvent) => {\r\n      const dx = ev.clientX - state.startX;\r\n      const dy = ev.clientY - state.startY;\r\n      const x = state.originX + dx;\r\n      const y = state.originY + dy;\r\n      const maxX = Math.max(8, window.innerWidth - (globalCallSize.w + 24));\r\n      const maxY = Math.max(8, window.innerHeight - (320 + 24));\r\n      setGlobalCallPos({ x: Math.min(Math.max(8, x), maxX), y: Math.min(Math.max(8, y), maxY) });\r\n    };\r\n    const onUp = () => {\r\n      window.removeEventListener('mousemove', onMove);\r\n      window.removeEventListener('mouseup', onUp);\r\n    };\r\n    window.addEventListener('mousemove', onMove);\r\n    window.addEventListener('mouseup', onUp);\r\n  };\r\n  const handleGlobalTouchDragStart = (e: React.TouchEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    const t = e.touches[0];\r\n    const state = { startX: t.clientX, startY: t.clientY, originX: globalCallPos.x, originY: globalCallPos.y };\r\n    const onMove = (ev: TouchEvent) => {\r\n      const tt = ev.touches[0];\r\n      const dx = tt.clientX - state.startX;\r\n      const dy = tt.clientY - state.startY;\r\n      const x = state.originX + dx;\r\n      const y = state.originY + dy;\r\n      const maxX = Math.max(8, window.innerWidth - (globalCallSize.w + 24));\r\n      const maxY = Math.max(8, window.innerHeight - (320 + 24));\r\n      setGlobalCallPos({ x: Math.min(Math.max(8, x), maxX), y: Math.min(Math.max(8, y), maxY) });\r\n    };\r\n    const onUp = () => {\r\n      window.removeEventListener('touchmove', onMove);\r\n      window.removeEventListener('touchend', onUp);\r\n    };\r\n    window.addEventListener('touchmove', onMove, { passive: false });\r\n    window.addEventListener('touchend', onUp, { passive: false });\r\n  };\r\n  const handleResizeStart = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) => {\r\n    const startX = 'touches' in e ? e.touches[0].clientX : (e as React.MouseEvent<HTMLDivElement>).clientX;\r\n    const originW = globalCallSize.w;\r\n    const onMove = (ev: MouseEvent | TouchEvent) => {\r\n      const clientX = 'touches' in ev ? (ev as TouchEvent).touches[0].clientX : (ev as MouseEvent).clientX;\r\n      const dx = clientX - startX;\r\n      const nextW = Math.min(Math.max(280, originW + dx), Math.floor(window.innerWidth * 0.9));\r\n      setGlobalCallSize({ w: nextW });\r\n    };\r\n    const onUp = () => {\r\n      window.removeEventListener('mousemove', onMove as unknown as EventListener);\r\n      window.removeEventListener('mouseup', onUp);\r\n      window.removeEventListener('touchmove', onMove as unknown as EventListener);\r\n      window.removeEventListener('touchend', onUp);\r\n    };\r\n    window.addEventListener('mousemove', onMove as unknown as EventListener);\r\n    window.addEventListener('mouseup', onUp);\r\n    window.addEventListener('touchmove', onMove as unknown as EventListener);\r\n    window.addEventListener('touchend', onUp);\r\n  };\r\n  useEffect(() => {\r\n    try {\r\n      const isDesktop = typeof window !== 'undefined' && window.innerWidth >= 1024;\r\n      if (isDesktop) {\r\n        const w = Math.floor(window.innerWidth * 0.5);\r\n        setGlobalCallSize({ w: Math.max(560, w) });\r\n      }\r\n    } catch {}\r\n  }, []);\r\n  useEffect(() => {\r\n    const ridCandidate =\r\n      String(activeRoomId || '') ||\r\n      normalizedRoomId ||\r\n      String(incomingCall?.roomId || '') ||\r\n      String(globalRoomId || '');\r\n    const isGroupByRid = ridCandidate.split('_').filter(Boolean).length !== 2;\r\n    if (isGroupByRid) {\r\n      const info = ridCandidate ? groupInfoRef.current.get(String(ridCandidate)) : undefined;\r\n      if (info) {\r\n        setRemoteName(String(info.name || ''));\r\n        setRemoteAvatar(info.avatar ? String(info.avatar) : undefined);\r\n        return;\r\n      }\r\n      const gname = String(globalSelectedChat?.name || '').trim();\r\n      const gavatar = globalSelectedChat?.avatar ? String(globalSelectedChat.avatar) : undefined;\r\n      setRemoteName(gname || '');\r\n      setRemoteAvatar(gavatar);\r\n      return;\r\n    }\r\n    const id = (() => {\r\n      if (counterpartId) return String(counterpartId);\r\n      if (incomingCall?.from) return String(incomingCall.from);\r\n      if (globalSelectedChat?._id) return String(globalSelectedChat._id);\r\n      return '';\r\n    })();\r\n    if (globalSelectedChat?._id && String(globalSelectedChat._id) === String(id)) {\r\n      setRemoteName(String(globalSelectedChat?.name || ''));\r\n      setRemoteAvatar(globalSelectedChat?.avatar ? String(globalSelectedChat?.avatar) : undefined);\r\n    } else {\r\n      setRemoteName('');\r\n      setRemoteAvatar(undefined);\r\n    }\r\n    if (!id) {\r\n      setRemoteName('');\r\n      setRemoteAvatar(undefined);\r\n      return;\r\n    }\r\n    const run = async () => {\r\n      try {\r\n        const res = await fetch('/api/users', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ action: 'getById', _id: String(id) }),\r\n        });\r\n        const json = await res.json();\r\n        const row = json?.row || json?.user || json;\r\n        setRemoteName(String(row?.name || ''));\r\n        setRemoteAvatar(row?.avatar ? String(row.avatar) : undefined);\r\n      } catch {\r\n        setRemoteName('');\r\n        setRemoteAvatar(undefined);\r\n      }\r\n    };\r\n    void run();\r\n  }, [counterpartId, incomingCall, globalSelectedChat, globalIsGroup, activeRoomId, normalizedRoomId, globalRoomId]);\r\n  const callTimerRef = React.useRef<number | null>(null);\r\n  useEffect(() => {\r\n    if (callTimerRef.current) {\r\n      window.clearInterval(callTimerRef.current);\r\n      callTimerRef.current = null;\r\n    }\r\n    if (!callActive || !callStartAt) {\r\n      setCallDurationSec(0);\r\n      return;\r\n    }\r\n    setCallDurationSec(0);\r\n    callTimerRef.current = window.setInterval(() => {\r\n      setCallDurationSec(Math.max(0, Math.floor((Date.now() - Number(callStartAt)) / 1000)));\r\n    }, 1000);\r\n    return () => {\r\n      if (callTimerRef.current) {\r\n        window.clearInterval(callTimerRef.current);\r\n        callTimerRef.current = null;\r\n      }\r\n    };\r\n  }, [callActive, callStartAt]);\r\n  const sendCallNotify = async (status: 'answered' | 'rejected' | 'timeout' | 'ended') => {\r\n    try {\r\n      const rid = String(activeRoomId || lastActiveRoomIdRef.current || normalizedRoomId || currentViewedRoomId || '');\r\n      if (!rid || !currentUser?._id) return;\r\n      const parts = rid.split('_').filter(Boolean);\r\n      const isOneToOneRoom = parts.length === 2;\r\n      if (status === 'ended') {\r\n        const keyStart =\r\n          typeof lastCallStartAtRef.current === 'number' && lastCallStartAtRef.current > 0\r\n            ? String(lastCallStartAtRef.current)\r\n            : typeof callStartAt === 'number' && callStartAt > 0\r\n              ? String(callStartAt)\r\n              : 'unknown';\r\n        const key = `${rid}:${keyStart}`;\r\n        const bag = (sendCallNotify as unknown as { endedSentBag?: Set<string> }).endedSentBag || new Set<string>();\r\n        (sendCallNotify as unknown as { endedSentBag?: Set<string> }).endedSentBag = bag;\r\n        if (bag.has(key)) return;\r\n        bag.add(key);\r\n      }\r\n      const computedDurationSec =\r\n        status === 'ended'\r\n          ? (() => {\r\n              const startAt =\r\n                typeof lastCallStartAtRef.current === 'number' && lastCallStartAtRef.current > 0\r\n                  ? lastCallStartAtRef.current\r\n                  : typeof callStartAt === 'number' && callStartAt > 0\r\n                    ? callStartAt\r\n                    : undefined;\r\n              if (typeof startAt === 'number' && startAt > 0)\r\n                return Math.max(0, Math.floor((Date.now() - Number(startAt)) / 1000));\r\n              return Math.max(0, Math.floor(callDurationSec));\r\n            })()\r\n          : Math.max(0, Math.floor(callDurationSec));\r\n      const content = (() => {\r\n        if (isOneToOneRoom) {\r\n          if (status !== 'ended') return '';\r\n          const kind = callType === 'video' ? 'video' : 'thoại';\r\n          const dir = outgoingRef.current ? 'đi' : 'đến';\r\n          const m2 = Math.floor(computedDurationSec / 60);\r\n          const ss = computedDurationSec % 60;\r\n          return `Cuộc gọi ${kind} ${dir} – ${m2} phút ${ss} giây`;\r\n        }\r\n        return '';\r\n      })();\r\n      if (!content) return;\r\n      const tsNow = Date.now();\r\n      const notifyRes = await createMessageApi({\r\n        roomId: rid,\r\n        type: 'notify',\r\n        sender: String(currentUser._id),\r\n        content,\r\n        timestamp: tsNow,\r\n        callerId: String(currentUser._id),\r\n        calleeId: String(counterpartId || ''),\r\n        callType: (callType as 'voice' | 'video') || 'voice',\r\n        callStatus: status === 'ended' ? 'answered' : status,\r\n        callDurationSec: computedDurationSec,\r\n        callStartedAt: typeof callStartAt === 'number' ? callStartAt : undefined,\r\n        callEndedAt: tsNow,\r\n      });\r\n      if (notifyRes?.success && typeof notifyRes._id === 'string') {\r\n        const parts2 = rid.split('_').filter(Boolean);\r\n        const isOneToOne = parts2.length === 2;\r\n        const isGroup = !isOneToOne;\r\n        const receiver = isOneToOne ? (parts2[0] === String(currentUser._id) ? parts2[1] : parts2[0]) : null;\r\n        const members = isGroup ? groupMembersRef.current.get(rid) || [] : [];\r\n        socketRef.current?.emit('send_message', {\r\n          roomId: rid,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n          _id: notifyRes._id,\r\n          type: 'notify',\r\n          content,\r\n          timestamp: tsNow,\r\n          callerId: String(currentUser._id),\r\n          calleeId: String(counterpartId || ''),\r\n          callType: (callType as 'voice' | 'video') || 'voice',\r\n          callStatus: status === 'ended' ? 'answered' : status,\r\n          callDurationSec: computedDurationSec,\r\n        });\r\n      }\r\n    } catch {}\r\n  };\r\n  useEffect(() => {\r\n    const handler = (e: Event) => {\r\n      try {\r\n        if (callActive || incomingCall || callConnecting) {\r\n          toast({ type: 'warning', message: 'Người này đang có cuộc gọi' });\r\n          return;\r\n        }\r\n        const d = (e as CustomEvent).detail || {};\r\n        const isG = !!d?.isGroup;\r\n        const t = isG ? 'video' : d?.type === 'video' ? 'video' : 'voice';\r\n        const rid = String(d?.roomId || '');\r\n        const sel = d?.selectedChat as\r\n          | { _id?: string; members?: Array<string | { _id: string }>; name?: string; avatar?: string }\r\n          | undefined;\r\n        setGlobalRoomId(rid);\r\n        setGlobalIsGroup(isG);\r\n        const norm = (() => {\r\n          if (!sel) return isG ? { _id: '', members: [] } : { _id: '' };\r\n          const _id = String(sel._id || '');\r\n          if (isG) {\r\n            const members = Array.isArray(sel.members)\r\n              ? sel.members.map((m) =>\r\n                  typeof m === 'object' ? { _id: String((m as { _id: string })._id) } : String(m),\r\n                )\r\n              : [];\r\n            return { _id, members, name: sel.name, avatar: sel.avatar };\r\n          }\r\n          return { _id, name: sel.name, avatar: sel.avatar };\r\n        })();\r\n        setGlobalSelectedChat(norm);\r\n        if (sel?.name) setRemoteName(String(sel.name));\r\n        else setRemoteName('');\r\n        if (sel?.avatar) setRemoteAvatar(String(sel.avatar));\r\n        else setRemoteAvatar(undefined);\r\n        setCallDurationSec(0);\r\n        outgoingRef.current = true;\r\n        const overrideTargetId =\r\n          !isG && norm && typeof norm._id === 'string' && norm._id ? String(norm._id) : undefined;\r\n        void startCall(t, overrideTargetId);\r\n      } catch {}\r\n    };\r\n    window.addEventListener('startCall', handler as EventListener);\r\n    return () => window.removeEventListener('startCall', handler as EventListener);\r\n  }, [startCall, pathname]);\r\n\r\n  useEffect(() => {\r\n    const handler = (e: Event) => {\r\n      // Show toast\r\n      toast({ type: 'warning', message: 'Người này đang có cuộc gọi' });\r\n      // End call\r\n      endCall('local');\r\n    };\r\n    window.addEventListener('callBusy', handler as EventListener);\r\n    return () => window.removeEventListener('callBusy', handler as EventListener);\r\n  }, [endCall]);\r\n\r\n  const outgoingRef = React.useRef<boolean>(false);\r\n  const prevCallActiveRef = React.useRef<boolean>(false);\r\n  const endedSentRef = React.useRef<boolean>(false);\r\n  useEffect(() => {\r\n    const prev = prevCallActiveRef.current;\r\n    if (prev && !callActive && !endedSentRef.current && outgoingRef.current) {\r\n      endedSentRef.current = true;\r\n      void sendCallNotify('ended');\r\n    }\r\n    prevCallActiveRef.current = callActive;\r\n    if (callActive) {\r\n      endedSentRef.current = false;\r\n      prevParticipantsRef.current = null;\r\n    }\r\n  }, [callActive]);\r\n  // Bỏ lưu trạng thái call theo room trong localStorage cho 1-1\r\n\r\n  return (\r\n    <div className=\"flex h-screen w-screen bg-gradient-to-br from-slate-50 via-white to-indigo-50 overflow-hidden\">\r\n      {/* Sidebar Desktop */}\r\n      {isAuthed && (\r\n        <div className=\"hidden md:block\">\r\n          <SidebarMenu totalUnread={totalUnread} unreadGroups={unreadGroups} unreadContacts={unreadContacts} />\r\n        </div>\r\n      )}\r\n\r\n      {/* Trang chưa đăng nhập – Sang trọng như Zalo Premium */}\r\n      {!isAuthed && checked && isProfilePage && (\r\n        <div className=\"w-1/3 flex items-center justify-center p-6\">\r\n          <div className=\"absolute \" />\r\n          <div className=\"relative z-10 w-full max-w-md\">\r\n            <div className=\"bg-white/95 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden\">\r\n              <div className=\"p-10 text-center\">\r\n                <div className=\"w-28 h-28 mx-auto mb-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center shadow-2xl\">\r\n                  <HiSparkles className=\"w-16 h-16 text-white\" />\r\n                </div>\r\n                <h1 className=\"text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-4\">\r\n                  Hupuna\r\n                </h1>\r\n                <p className=\"text-xl text-gray-700 mb-10 leading-relaxed\">Chào mừng bạn đến với thế hệ chat mới</p>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <button\r\n                    onClick={() => router.push('/login')}\r\n                    className=\"w-full cursor-pointer py-5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold text-lg rounded-2xl shadow-xl transition-all duration-300 active:scale-95 flex items-center justify-center gap-3\"\r\n                  >\r\n                    <HiUserCircle className=\"w-7 h-7\" />\r\n                    Đăng nhập ngay\r\n                  </button>\r\n\r\n                  <button\r\n                    onClick={() => router.push('/login?mode=register')}\r\n                    className=\"w-full cursor-pointer py-5 bg-white border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-50 font-bold text-lg rounded-2xl shadow-lg transition-all duration-300 active:scale-95 flex items-center justify-center gap-3\"\r\n                  >\r\n                    <HiSparkles className=\"w-7 h-7\" />\r\n                    Tạo tài khoản mới\r\n                  </button>\r\n                </div>\r\n\r\n                <p className=\"mt-8 text-sm text-gray-500\">Bắt đầu hành trình kết nối không giới hạn</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Nội dung chính */}\r\n      <main\r\n        className={`flex-1 overflow-hidden ${isAuthed && !(hideMobileFooter || isWidgetIframe) ? 'pb-20 md:pb-0' : ''}`}\r\n      >\r\n        {showNewMsgBanner && (\r\n          <div className=\"fixed top-3 left-1/2 -translate-x-1/2 z-[200] pointer-events-auto\">\r\n            <div className=\"flex items-center gap-2 px-4 py-2 rounded-full bg-indigo-600 text-white shadow-xl animate-pulse\">\r\n              <span className=\"text-sm font-semibold\">Bạn có tin nhắn mới</span>\r\n              <button onClick={() => setShowNewMsgBanner(false)} className=\"ml-2 text-white/80 hover:text-white\">\r\n                ×\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {children}\r\n      </main>\r\n\r\n      {/* Global Call Overlay – áp dụng mọi page */}\r\n      {isAuthed && checked && currentUser && (\r\n        <>\r\n          {(incomingCall || callConnecting || callActive) && (\r\n            <div\r\n              ref={globalCallHidden && (callType === 'video' || callType === 'voice') ? openBtnRef : callOverlayRef}\r\n              className={`fixed z-[2000] ${\r\n                globalCallHidden && (callType === 'video' || callType === 'voice')\r\n                  ? 'rounded-xl overflow-hidden shadow-2xl ring-1 ring-black/20 bg-black cursor-move'\r\n                  : globalCallFullscreen\r\n                    ? 'inset-0 w-screen h-screen'\r\n                    : globalIsDesktop\r\n                      ? ''\r\n                      : globalCallMin\r\n                        ? ''\r\n                        : 'inset-0 w-full h-full'\r\n              }`}\r\n              style={\r\n                globalCallHidden\r\n                  ? callType === 'video'\r\n                    ? {\r\n                        left: openBtnPos.x,\r\n                        top: openBtnPos.y,\r\n                        width: 240,\r\n                        height: 160,\r\n                        display: 'block',\r\n                      }\r\n                    : {\r\n                        left: openBtnPos.x,\r\n                        top: openBtnPos.y,\r\n                        width: 200,\r\n                        height: 80,\r\n                        display: 'block',\r\n                      }\r\n                  : globalCallFullscreen\r\n                    ? { display: 'block' }\r\n                    : globalIsDesktop\r\n                      ? {\r\n                          left: globalCallPos.x,\r\n                          top: globalCallPos.y,\r\n                          width: globalCallSize.w,\r\n                          display: 'block',\r\n                        }\r\n                      : globalCallMin\r\n                        ? {\r\n                            left: globalCallPos.x,\r\n                            top: globalCallPos.y,\r\n                            width: globalCallSize.w,\r\n                            height: callType === 'video' ? 180 : 200,\r\n                            display: 'block',\r\n                          }\r\n                        : { display: 'block' }\r\n              }\r\n              onClick={\r\n                !globalIsDesktop && globalCallMin && !globalCallHidden\r\n                  ? () => {\r\n                      const prev = globalPrevSizeRef.current;\r\n                      if (prev) setGlobalCallSize(prev);\r\n                      setGlobalCallMin(false);\r\n                    }\r\n                  : undefined\r\n              }\r\n              onMouseDown={\r\n                globalCallHidden && (callType === 'video' || callType === 'voice')\r\n                  ? handleOpenBtnDragStart\r\n                  : !globalIsDesktop && globalCallMin\r\n                    ? handleGlobalDragStart\r\n                    : undefined\r\n              }\r\n              onTouchStart={\r\n                globalCallHidden && (callType === 'video' || callType === 'voice')\r\n                  ? handleOpenBtnTouchDragStart\r\n                  : !globalIsDesktop && globalCallMin\r\n                    ? handleGlobalTouchDragStart\r\n                    : undefined\r\n              }\r\n            >\r\n              <div\r\n                className={`absolute h-auto ${\r\n                  globalCallHidden && (callType === 'video' || callType === 'voice')\r\n                    ? 'inset-0 w-full h-full p-0 rounded-xl overflow-hidden'\r\n                    : globalCallMin\r\n                      ? ''\r\n                      : globalCallFullscreen\r\n                        ? 'inset-0 w-full h-full'\r\n                        : globalIsDesktop\r\n                          ? 'w-full md:w-[44rem] lg:w-[50rem] h-[23rem]'\r\n                          : 'inset-0 w-full h-full'\r\n                } ${globalCallHidden && (callType === 'video' || callType === 'voice') ? 'bg-black' : 'md:rounded-xl rounded-none p-0 shadow-2xl ring-1 ring-black/10 bg-white/5 backdrop-blur'}`}\r\n              >\r\n                {!globalCallHidden && (\r\n                  <div\r\n                    className=\"md:flex hidden items-center justify-between px-3 py-2 bg-black/70 text-white rounded-t-xl select-none\"\r\n                    onMouseDown={globalCallFullscreen ? undefined : handleGlobalDragStart}\r\n                    onTouchStart={globalCallFullscreen ? undefined : handleGlobalTouchDragStart}\r\n                  >\r\n                    <span className=\"text-sm\">\r\n                      {callActive\r\n                        ? remoteName ||\r\n                          groupInfoRef.current.get(String(normalizedRoomId || globalRoomId || ''))?.name ||\r\n                          'Đang gọi'\r\n                        : incomingCall\r\n                          ? (() => {\r\n                              const gname = globalIsGroup\r\n                                ? groupInfoRef.current.get(\r\n                                    String(incomingCall?.roomId || globalRoomId || normalizedRoomId || ''),\r\n                                  )?.name\r\n                                : undefined;\r\n                              return `Cuộc gọi từ ${gname || remoteName || 'Cuộc gọi đến'}`;\r\n                            })()\r\n                          : 'Đang kết nối...'}\r\n                    </span>\r\n                    <span className=\"text-xs flex items-center\">\r\n                      {callType === 'video' ? 'Video' : 'Thoại'}\r\n                      {callActive && callDurationSec > 0\r\n                        ? ` • ${Math.floor(callDurationSec / 60)\r\n                            .toString()\r\n                            .padStart(2, '0')}:${(callDurationSec % 60).toString().padStart(2, '0')}`\r\n                        : ''}\r\n                      <button\r\n                        className=\"ml-3 p-1 rounded hover:bg-white/20 cursor-pointer transition-colors\"\r\n                        onClick={() => setGlobalCallFullscreen((v) => !v)}\r\n                        title={globalCallFullscreen ? 'Thu nhỏ' : 'Phóng to'}\r\n                      >\r\n                        {globalCallFullscreen ? (\r\n                          <HiArrowsPointingIn className=\"w-5 h-5\" />\r\n                        ) : (\r\n                          <HiArrowsPointingOut className=\"w-5 h-5\" />\r\n                        )}\r\n                      </button>\r\n                      <button\r\n                        className=\"ml-2 p-1 rounded hover:bg-white/20 cursor-pointer transition-colors\"\r\n                        onClick={() => setGlobalCallHidden(true)}\r\n                        title=\"Ẩn cửa sổ gọi\"\r\n                      >\r\n                        <HiMinus className=\"w-5 h-5\" />\r\n                      </button>\r\n                      <button\r\n                        className=\"ml-2 p-1 rounded bg-red-600 hover:bg-red-500 text-white cursor-pointer transition-colors\"\r\n                        onClick={() => endCall('local')}\r\n                        title=\"Kết thúc cuộc gọi\"\r\n                      >\r\n                        <HiXMark className=\"w-5 h-5\" />\r\n                      </button>\r\n                    </span>\r\n                  </div>\r\n                )}\r\n                <div\r\n                  className={`${globalCallHidden && (callType === 'video' || callType === 'voice') ? 'w-full h-full bg-black' : globalCallMin ? 'rounded-lg overflow-hidden bg-black' : globalIsDesktop ? 'md:rounded-b-xl rounded-none md:pt-2 md:p-2 p-0 relative bg-black/20' : `rounded-none p-0 h-full ${callType === 'voice' ? 'bg-blue-500' : 'bg-black'}`}`}\r\n                >\r\n                  {/* Mini Controls for Hidden Call */}\r\n                  {globalCallHidden && (callType === 'video' || callType === 'voice') && (\r\n                    <div className=\"absolute top-1 right-1 z-[2100] flex items-center gap-1\">\r\n                      <button\r\n                        className=\"p-1 rounded bg-white/20 hover:bg-white/30 text-white cursor-pointer transition-colors\"\r\n                        onClick={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          if (openBtnDraggingRef.current) return;\r\n                          setGlobalCallHidden(false);\r\n                        }}\r\n                        title=\"Mở cửa sổ cuộc gọi\"\r\n                      >\r\n                        <HiArrowsPointingOut className=\"w-5 h-5\" />\r\n                      </button>\r\n                      <button\r\n                        className=\"p-1 rounded bg-red-600 hover:bg-red-500 text-white cursor-pointer transition-colors\"\r\n                        onClick={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          if (openBtnDraggingRef.current) return;\r\n                          endCall('local');\r\n                        }}\r\n                        title=\"Kết thúc cuộc gọi\"\r\n                      >\r\n                        <HiXMark className=\"w-5 h-5\" />\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n\r\n                  {incomingCall && !callActive && !callConnecting && (\r\n                    <IncomingCallModal\r\n                      avatar={\r\n                        (globalIsGroup\r\n                          ? groupInfoRef.current.get(\r\n                              String(incomingCall?.roomId || globalRoomId || normalizedRoomId || ''),\r\n                            )?.avatar || remoteAvatar\r\n                          : remoteAvatar) || '/logo/avata.webp'\r\n                      }\r\n                      name={\r\n                        (globalIsGroup\r\n                          ? groupInfoRef.current.get(\r\n                              String(incomingCall?.roomId || globalRoomId || normalizedRoomId || ''),\r\n                            )?.name || remoteName\r\n                          : remoteName) || 'Cuộc gọi đến'\r\n                      }\r\n                      callType={incomingCall.type}\r\n                      onAccept={async () => {\r\n                        outgoingRef.current = false;\r\n                        await acceptIncomingCall();\r\n                      }}\r\n                      onReject={() => {\r\n                        socketRef.current?.emit('call_reject', {\r\n                          roomId: String(incomingCall.roomId),\r\n                          targets: [String(incomingCall.from)],\r\n                        });\r\n                        try {\r\n                          setIncomingCall(null);\r\n                        } catch {}\r\n                        void sendCallNotify('rejected');\r\n                      }}\r\n                    />\r\n                  )}\r\n                  {!incomingCall && callConnecting && (\r\n                    <ModalCall\r\n                      avatar={remoteAvatar || '/logo/avata.webp'}\r\n                      name={remoteName || 'Đang kết nối...'}\r\n                      mode=\"connecting\"\r\n                      callType={callType === 'video' ? 'video' : 'voice'}\r\n                      onEndCall={() => {\r\n                        endCall('local');\r\n                        void sendCallNotify('timeout');\r\n                      }}\r\n                    />\r\n                  )}\r\n                  {callActive && livekitToken && livekitUrl && (\r\n                    <LiveKitCall\r\n                      serverUrl={livekitUrl}\r\n                      token={livekitToken}\r\n                      onDisconnected={() => {\r\n                        endCall('remote');\r\n                      }}\r\n                      onRequestEnd={() => {\r\n                        endCall('local');\r\n                      }}\r\n                      onParticipantsChanged={(parts) => {\r\n                        try {\r\n                          const prev = prevParticipantsRef.current;\r\n                          if (prev !== null) {\r\n                            const currentIds = new Set(parts.map((p) => p.id));\r\n                            const prevIds = new Set(prev.map((p) => p.id));\r\n                            parts.forEach((p) => {\r\n                              if (!prevIds.has(p.id)) {\r\n                                toast({ type: 'info', message: `${p.name || 'Ai đó'} đã tham gia cuộc gọi` });\r\n                              }\r\n                            });\r\n                            prev.forEach((p) => {\r\n                              if (!currentIds.has(p.id)) {\r\n                                toast({ type: 'info', message: `${p.name || 'Ai đó'} đã rời cuộc gọi` });\r\n                              }\r\n                            });\r\n                          }\r\n                          prevParticipantsRef.current = parts;\r\n                          if (participantsZeroTimerRef.current) {\r\n                            window.clearTimeout(participantsZeroTimerRef.current);\r\n                            participantsZeroTimerRef.current = null;\r\n                          }\r\n                          const isDirect = !!counterpartId;\r\n                          const isVideo = callType === 'video';\r\n                          const remoteCount = Array.isArray(parts) ? parts.length : 0;\r\n                          if (isDirect && isVideo && remoteCount === 0) {\r\n                            participantsZeroTimerRef.current = window.setTimeout(() => {\r\n                              endCall('local');\r\n                            }, 800);\r\n                          }\r\n                          if (!isDirect && isVideo) {\r\n                            const total = remoteCount + 1;\r\n                            if (total > 20) {\r\n                              toast({ type: 'warning', message: 'Cuộc gọi nhóm đã đủ 20 người (tối đa 20)' });\r\n                              endCall('local');\r\n                            }\r\n                          }\r\n                        } catch {}\r\n                      }}\r\n                      className={`${globalCallHidden && callType === 'video' ? 'w-full h-full' : globalCallMin ? '' : globalIsDesktop ? 'md:rounded-xl rounded-none overflow-hidden min-h-[46vh] md:min-h-[20rem] md:max-h-[100vh]' : 'rounded-none overflow-hidden h-full min-h-[46vh]'}`}\r\n                      titleName={remoteName || ''}\r\n                      callStartAt={callStartAt}\r\n                      avatarUrl={remoteAvatar || '/logo/avata.webp'}\r\n                      myName={currentUser.name}\r\n                      myAvatarUrl={currentUser.avatar}\r\n                      callMode={callType === 'video' ? 'video' : 'voice'}\r\n                      isGroup={normalizedIsGroup}\r\n                      localPreviewSize={\r\n                        globalCallMin\r\n                          ? { w: Math.max(120, Math.min(160, Math.floor(globalCallSize.w / 3))), h: 90 }\r\n                          : { w: Math.max(240, Math.min(300, Math.floor(globalCallSize.w / 2))), h: 160 }\r\n                      }\r\n                      offMinHeight={globalCallHidden && (callType === 'video' || callType === 'voice') ? 120 : 320}\r\n                      uiVariant={globalCallHidden && (callType === 'video' || callType === 'voice') ? 'mini' : 'full'}\r\n                    />\r\n                  )}\r\n                  {!incomingCall &&\r\n                    !callActive &&\r\n                    !callConnecting &&\r\n                    normalizedIsGroup &&\r\n                    roomCallActive &&\r\n                    !(roomParticipants || []).includes(String(currentUser?._id || '')) && (\r\n                      <div className=\"absolute top-3 right-3 z-50\">\r\n                        <button\r\n                          className=\"px-3 py-1 rounded-full bg-green-600 text-white text-xs shadow cursor-pointer hover:bg-green-700\"\r\n                          onClick={() => {\r\n                            const cur = Array.isArray(roomParticipants) ? roomParticipants.length : 0;\r\n                            if (cur >= 20) {\r\n                              toast({ type: 'warning', message: 'Cuộc gọi nhóm đã đủ 20 người (tối đa 20)' });\r\n                              return;\r\n                            }\r\n                            void joinActiveGroupCall();\r\n                          }}\r\n                          title=\"Tham gia cuộc gọi nhóm\"\r\n                        >\r\n                          Tham gia\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  {!globalCallFullscreen && !globalCallHidden && (\r\n                    <div\r\n                      className=\"absolute bottom-1 right-1 w-4 h-4 cursor-se-resize bg-white/30 hover:bg-white/50 rounded-sm\"\r\n                      onMouseDown={handleResizeStart}\r\n                      onTouchStart={handleResizeStart}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          {/* Old mini controls for voice removed to unify UI */}\r\n        </>\r\n      )}\r\n\r\n      {/* Tham gia lại – hiển thị cả khi overlay không mở */}\r\n      {!callActive &&\r\n        !callConnecting &&\r\n        normalizedIsGroup &&\r\n        roomCallActive &&\r\n        String(currentViewedRoomId || '') === String(normalizedRoomId || '') &&\r\n        !(roomParticipants || []).includes(String(currentUser?._id || '')) && (\r\n          <div className=\"fixed z-50 bottom-25 right-4 md:bottom-30 md:right-6\">\r\n            <button\r\n              className=\"px-2 py-2 rounded-full bg-green-600 text-white shadow cursor-pointer hover:bg-green-700\"\r\n              onClick={() => {\r\n                const cur = Array.isArray(roomParticipants) ? roomParticipants.length : 0;\r\n                if (cur >= 20) {\r\n                  toast({ type: 'warning', message: 'Cuộc gọi nhóm đã đủ 20 người (tối đa 20)' });\r\n                  return;\r\n                }\r\n                void joinActiveGroupCall();\r\n              }}\r\n              title=\"Tham gia lại cuộc gọi nhóm\"\r\n            >\r\n              Tham gia cuộc gọi\r\n            </button>\r\n          </div>\r\n        )}\r\n\r\n      {/* Mobile Bottom Navigation – ĐẸP NHƯ ZALO PRO 2025 */}\r\n      {isAuthed && !(hideMobileFooter || isWidgetIframe) && (\r\n        <div className=\"md:hidden fixed bottom-0 left-0 right-0 z-[100] pointer-events-none\">\r\n          <div className=\"relative pointer-events-auto bg-white border-t border-gray-200 shadow-lg\">\r\n            <div className=\"flex\">\r\n              {mobileTabs.map((tab) => {\r\n                const active = isActive(tab.paths);\r\n                const Icon = tab.icon;\r\n\r\n                return (\r\n                  <button\r\n                    key={tab.key}\r\n                    onClick={() => {\r\n                      if (tab.key === 'profile') {\r\n                        try {\r\n                          const raw = typeof window !== 'undefined' ? localStorage.getItem('info_user') : null;\r\n                          const u = raw ? (JSON.parse(raw) as Record<string, unknown>) : null;\r\n                          const id = String((u?.['username'] as string) || (u?.['_id'] as string) || '').trim();\r\n                          router.push(id ? `/profile/${id}` : '/profile');\r\n                        } catch {\r\n                          router.push('/profile');\r\n                        }\r\n                      } else {\r\n                        router.push(tab.paths[0]);\r\n                      }\r\n                    }}\r\n                    className=\"cursor-pointer flex-1 py-3 flex flex-col items-center gap-1 relative\"\r\n                  >\r\n                    <div className=\"relative\">\r\n                      <Icon className={`w-6 h-6 ${active ? 'text-indigo-600' : 'text-gray-500'}`} />\r\n                      {tab.key === 'home' && totalUnread > 0 && (\r\n                        <span className=\"absolute -top-2 -right-3 min-w-[1.5rem] px-1.5 h-5 rounded-full bg-red-600 text-white text-[10px] font-bold flex items-center justify-center\">\r\n                          {totalUnread > 99 ? '99+' : totalUnread}\r\n                        </span>\r\n                      )}\r\n                      {tab.key === 'group' && unreadGroups > 0 && (\r\n                        <span className=\"absolute -top-2 -right-3 min-w-[1.5rem] px-1.5 h-5 rounded-full bg-red-600 text-white text-[10px] font-bold flex items-center justify-center\">\r\n                          {unreadGroups > 99 ? '99+' : unreadGroups}\r\n                        </span>\r\n                      )}\r\n                      {tab.key === 'directory' && unreadContacts > 0 && (\r\n                        <span className=\"absolute -top-2 -right-3 min-w-[1.5rem] px-1.5 h-5 rounded-full bg-red-600 text-white text-[10px] font-bold flex items-center justify-center\">\r\n                          {unreadContacts > 99 ? '99+' : unreadContacts}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n\r\n                    <span className={`text-xs font-medium ${active ? 'text-indigo-600' : 'text-gray-500'}`}>\r\n                      {tab.label}\r\n                    </span>\r\n\r\n                    {active && <div className=\"absolute bottom-0 w-10 h-0.5 bg-indigo-600 rounded-full\" />}\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LayoutBase;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9760, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/app/%28zalo%29/layout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport LayoutBase from '../../components/layout/layout';\r\n\r\nexport default function ZaloLayout({ children }: { children: React.ReactNode }) {\r\n  return <LayoutBase>{children}</LayoutBase>;\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAKe,SAAS,WAAW,EAAE,QAAQ,EAAiC;IAC5E,qBAAO,6LAAC,oJAAU;kBAAE;;;;;;AACtB;KAFwB"}}]
}