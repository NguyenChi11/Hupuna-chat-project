{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/UserAvatarSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport Image from 'next/image';\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { CiEdit } from 'react-icons/ci';\r\nimport { HiPencil, HiCheck, HiX } from 'react-icons/hi';\r\n\r\ninterface UserAvatarSectionProps {\r\n  userName: string;\r\n  userAvatar?: string;\r\n  onUpdateNickname?: (name: string, options?: { silent?: boolean }) => Promise<void> | void;\r\n}\r\n\r\nexport default function UserAvatarSection({ userName, userAvatar, onUpdateNickname }: UserAvatarSectionProps) {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [editName, setEditName] = useState(userName);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  useEffect(() => {\r\n    setEditName(userName);\r\n  }, [userName]);\r\n\r\n  useEffect(() => {\r\n    if (isEditing) {\r\n      inputRef.current?.focus();\r\n    }\r\n  }, [isEditing]);\r\n\r\n  const handleSave = async () => {\r\n    const newVal = editName.trim();\r\n    const oldVal = (userName || '').trim();\r\n    if (newVal !== oldVal || newVal === '') {\r\n      try {\r\n        setIsSaving(true);\r\n        await onUpdateNickname?.(newVal, { silent: true });\r\n      } finally {\r\n        setIsSaving(false);\r\n      }\r\n    }\r\n    setIsEditing(false);\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setEditName(userName);\r\n    setIsEditing(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center\">\r\n      {/* Avatar người dùng */}\r\n      <div className=\"relative group\">\r\n        <div className=\"w-20 h-20 rounded-full overflow-hidden ring-4 ring-white shadow-2xl bg-gray-200 transition-all duration-500 group-hover:scale-105 group-hover:shadow-3xl\">\r\n          {userAvatar ? (\r\n            <Image\r\n              width={100}\r\n              height={100}\r\n              src={getProxyUrl(userAvatar)}\r\n              alt={userName}\r\n              className=\"w-full h-full object-cover\"\r\n              onError={(e) => {\r\n                e.currentTarget.style.display = 'none';\r\n                e.currentTarget.nextElementSibling?.classList.remove('hidden');\r\n              }}\r\n            />\r\n          ) : (\r\n            <Image\r\n              src=\"/logo/avata.webp\"\r\n              alt={userName}\r\n              width={40}\r\n              height={40}\r\n              className=\"w-full h-full object-cover\"\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {/* Hiệu ứng sáng nhẹ khi hover */}\r\n        <div className=\"absolute inset-0 rounded-full ring-4 ring-transparent group-hover:ring-blue-300/30 transition-all duration-500 pointer-events-none\" />\r\n      </div>\r\n\r\n      {/* Tên người dùng */}\r\n      <div className=\"mt-6 text-center relative group/name w-full flex justify-center\">\r\n        {isEditing ? (\r\n          <div className=\"flex items-center justify-center gap-2\">\r\n            <input\r\n              ref={inputRef}\r\n              value={editName}\r\n              onChange={(e) => setEditName(e.target.value)}\r\n              className=\"text-xl font-bold text-gray-900 text-center border-b-2 border-blue-500 focus:outline-none bg-transparent min-w-[9.375rem] max-w-[15.625rem]\"\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter') handleSave();\r\n                if (e.key === 'Escape') handleCancel();\r\n              }}\r\n              disabled={isSaving}\r\n            />\r\n            <button\r\n              onClick={handleSave}\r\n              disabled={isSaving}\r\n              className={`p-1 rounded-full transition-colors cursor-pointer ${isSaving ? 'bg-green-100 text-green-500 opacity-70' : 'hover:bg-green-100 text-green-500'}`}\r\n            >\r\n              {isSaving ? (\r\n                <span className=\"w-5 h-5 inline-block border-2 border-green-500 border-t-transparent rounded-full animate-spin\" />\r\n              ) : (\r\n                <HiCheck className=\"w-5 h-5\" />\r\n              )}\r\n            </button>\r\n            <button\r\n              onClick={handleCancel}\r\n              disabled={isSaving}\r\n              className=\"p-1 rounded-full hover:bg-red-100 text-red-500 transition-colors cursor-pointer\"\r\n            >\r\n              <HiX className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <div\r\n            className=\"flex items-center justify-center gap-2 group/edit cursor-pointer\"\r\n            onClick={() => onUpdateNickname && setIsEditing(true)}\r\n          >\r\n            <h3 className=\"text-xl font-bold text-gray-900 tracking-tight truncate max-w-[15.625rem]\">\r\n              {userName || 'Người dùng'}\r\n            </h3>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <p className=\"mt-1 text-sm text-gray-500 font-medium\">Đang trò chuyện riêng</p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAEpD;AACA;AACA;AAEA;;;;;;;AAQe,SAAS,kBAAkB,EAAE,QAAQ,EAAE,UAAU,EAAE,gBAAgB,EAA0B;;IAC1G,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,WAAW,IAAA,uKAAM,EAAmB;IAE1C,IAAA,0KAAS;uCAAC;YACR,YAAY;QACd;sCAAG;QAAC;KAAS;IAEb,IAAA,0KAAS;uCAAC;YACR,IAAI,WAAW;gBACb,SAAS,OAAO,EAAE;YACpB;QACF;sCAAG;QAAC;KAAU;IAEd,MAAM,aAAa;QACjB,MAAM,SAAS,SAAS,IAAI;QAC5B,MAAM,SAAS,CAAC,YAAY,EAAE,EAAE,IAAI;QACpC,IAAI,WAAW,UAAU,WAAW,IAAI;YACtC,IAAI;gBACF,YAAY;gBACZ,MAAM,mBAAmB,QAAQ;oBAAE,QAAQ;gBAAK;YAClD,SAAU;gBACR,YAAY;YACd;QACF;QACA,aAAa;IACf;IAEA,MAAM,eAAe;QACnB,YAAY;QACZ,aAAa;IACf;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;kCACZ,2BACC,6LAAC,2IAAK;4BACJ,OAAO;4BACP,QAAQ;4BACR,KAAK,IAAA,uIAAW,EAAC;4BACjB,KAAK;4BACL,WAAU;4BACV,SAAS,CAAC;gCACR,EAAE,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG;gCAChC,EAAE,aAAa,CAAC,kBAAkB,EAAE,UAAU,OAAO;4BACvD;;;;;iDAGF,6LAAC,2IAAK;4BACJ,KAAI;4BACJ,KAAK;4BACL,OAAO;4BACP,QAAQ;4BACR,WAAU;;;;;;;;;;;kCAMhB,6LAAC;wBAAI,WAAU;;;;;;;;;;;;0BAIjB,6LAAC;gBAAI,WAAU;0BACZ,0BACC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,KAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;4BAC3C,WAAU;4BACV,WAAW,CAAC;gCACV,IAAI,EAAE,GAAG,KAAK,SAAS;gCACvB,IAAI,EAAE,GAAG,KAAK,UAAU;4BAC1B;4BACA,UAAU;;;;;;sCAEZ,6LAAC;4BACC,SAAS;4BACT,UAAU;4BACV,WAAW,CAAC,kDAAkD,EAAE,WAAW,2CAA2C,qCAAqC;sCAE1J,yBACC,6LAAC;gCAAK,WAAU;;;;;qDAEhB,6LAAC,4JAAO;gCAAC,WAAU;;;;;;;;;;;sCAGvB,6LAAC;4BACC,SAAS;4BACT,UAAU;4BACV,WAAU;sCAEV,cAAA,6LAAC,wJAAG;gCAAC,WAAU;;;;;;;;;;;;;;;;yCAInB,6LAAC;oBACC,WAAU;oBACV,SAAS,IAAM,oBAAoB,aAAa;8BAEhD,cAAA,6LAAC;wBAAG,WAAU;kCACX,YAAY;;;;;;;;;;;;;;;;0BAKrB,6LAAC;gBAAE,WAAU;0BAAyC;;;;;;;;;;;;AAG5D;GAnHwB;KAAA"}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ChatQuickActions.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React from 'react';\r\nimport { CiBellOn, CiSearch, CiUser } from 'react-icons/ci';\r\nimport { HiEye, HiUserGroup } from 'react-icons/hi';\r\nimport { LuUserRoundPlus } from 'react-icons/lu';\r\nimport { HiEyeSlash, HiMapPin, HiBell, HiBellSlash, HiMagnifyingGlass, HiUserPlus, HiPhoto } from 'react-icons/hi2';\r\n\r\ninterface ChatQuickActionsProps {\r\n  isGroup?: boolean;\r\n  localIsPinned: boolean;\r\n  localIsHidden: boolean;\r\n  onPinToggle: () => void;\r\n  onHideToggle: () => void;\r\n  onCreateGroup: () => void;\r\n  onOpenMembers?: () => void;\r\n  onSearchMessages?: () => void;\r\n  onChangeWallpaper?: () => void;\r\n  isMuted?: boolean;\r\n  onToggleMute?: () => void;\r\n  onOpenProfile?: () => void;\r\n}\r\n\r\nexport default function ChatQuickActions({\r\n  isGroup,\r\n  localIsPinned,\r\n  localIsHidden,\r\n  onPinToggle,\r\n  onHideToggle,\r\n  onCreateGroup,\r\n  onOpenMembers,\r\n  onSearchMessages,\r\n  onChangeWallpaper,\r\n  isMuted,\r\n  onToggleMute,\r\n  onOpenProfile,\r\n}: ChatQuickActionsProps) {\r\n  if (isGroup) {\r\n    return (\r\n      <div className=\"flex justify-around items-center \">\r\n        <button\r\n          onClick={onSearchMessages}\r\n          className=\"cursor-pointer group flex flex-col items-center gap-3 p-2 rounded-2xl \"\r\n          title=\"Tìm tin nhắn\"\r\n        >\r\n          <div className=\"p-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-gray-200 transition-all  group-hover:shadow-lg\">\r\n            <CiSearch className=\"w-5 h-5\" />\r\n          </div>\r\n          <span className=\"text-xs font-medium text-gray-700\">Tìm tin nhắn</span>\r\n        </button>\r\n        <button\r\n          onClick={onOpenMembers}\r\n          className=\"cursor-pointer group flex flex-col items-center gap-3 p-2 rounded-2xl transition-all duration-300 active:scale-95\"\r\n          title=\"Thêm thành viên\"\r\n        >\r\n          <div className=\"p-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-gray-200 transition-all  group-hover:shadow-lg\">\r\n            <LuUserRoundPlus className=\"w-5 h-5\" />\r\n          </div>\r\n          <span className=\"text-xs font-medium text-gray-700\">Thêm thành viên</span>\r\n        </button>\r\n\r\n        <button\r\n          onClick={onToggleMute}\r\n          className=\"cursor-pointer group flex flex-col items-center gap-3 p-2 rounded-full transition-all duration-300 active:scale-95\"\r\n          title={isMuted ? 'Bật thông báo' : 'Tắt thông báo'}\r\n        >\r\n          <div\r\n            className={`p-1 rounded-3xl transition-all duration-300  group-hover:shadow-lg ${\r\n              isMuted\r\n                ? 'bg-red-100 text-red-600 ring-2 ring-red-200'\r\n                : 'bg-gray-100 text-gray-700 group-hover:bg-gray-200'\r\n            }`}\r\n          >\r\n            {isMuted ? <CiBellOn className=\"w-5 h-5\" /> : <CiBellOn className=\"w-5 h-5\" />}\r\n          </div>\r\n          <span className={`text-xs font-medium ${isMuted ? 'text-red-700' : 'text-gray-700'}`}>\r\n            {isMuted ? 'Đã tắt' : 'Tắt thông báo'}\r\n          </span>\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n  return (\r\n    <div className=\"flex justify-around items-center \">\r\n      <button\r\n        onClick={onSearchMessages}\r\n        className=\"cursor-pointer group flex flex-col items-center gap-3 p-2 rounded-2xl transition-all duration-300 hover:bg-gray-50 active:scale-95\"\r\n        title=\"Tìm tin nhắn\"\r\n      >\r\n        <div className=\"p-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-gray-200 transition-all group-hover:shadow-lg\">\r\n          <CiSearch className=\"w-5 h-5\" />\r\n        </div>\r\n        <span className=\"text-xs font-medium text-gray-700\">Tìm tin nhắn</span>\r\n      </button>\r\n      <button\r\n        onClick={onOpenProfile}\r\n        className=\"cursor-pointer group flex flex-col items-center gap-3 p-2 rounded-2xl transition-all duration-300  active:scale-95\"\r\n        title=\"Trang cá nhân\"\r\n      >\r\n        <div className=\"p-1 rounded-full bg-gray-100 text-gray-700 group-hover:bg-gray-200 transition-all group-hover:shadow-lg\">\r\n          <CiUser className=\"w-5 h-5\" />\r\n        </div>\r\n        <span className=\"text-xs font-medium text-gray-700\">Trang cá nhân</span>\r\n      </button>\r\n\r\n      <button\r\n        onClick={onToggleMute}\r\n        className=\"cursor-pointer group flex flex-col items-center gap-3 p-2 rounded-full transition-all duration-300 active:scale-95\"\r\n        title={isMuted ? 'Bật thông báo' : 'Tắt thông báo'}\r\n      >\r\n        <div\r\n          className={`p-1 rounded-full transition-all duration-300  group-hover:shadow-lg ${\r\n            isMuted\r\n              ? 'bg-red-100 text-red-600 ring-2 ring-red-200'\r\n              : 'bg-gray-100 text-gray-700 group-hover:bg-gray-200'\r\n          }`}\r\n        >\r\n          {isMuted ? <CiBellOn className=\"w-5 h-5\" /> : <CiBellOn className=\"w-5 h-5\" />}\r\n        </div>\r\n        <span className={`text-xs font-medium ${isMuted ? 'text-red-700' : 'text-gray-700'}`}>\r\n          {isMuted ? 'Đã tắt' : 'Tắt thông báo'}\r\n        </span>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAEpD;AAEA;;;;AAkBe,SAAS,iBAAiB,EACvC,OAAO,EACP,aAAa,EACb,aAAa,EACb,WAAW,EACX,YAAY,EACZ,aAAa,EACb,aAAa,EACb,gBAAgB,EAChB,iBAAiB,EACjB,OAAO,EACP,YAAY,EACZ,aAAa,EACS;IACtB,IAAI,SAAS;QACX,qBACE,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBACC,SAAS;oBACT,WAAU;oBACV,OAAM;;sCAEN,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,6JAAQ;gCAAC,WAAU;;;;;;;;;;;sCAEtB,6LAAC;4BAAK,WAAU;sCAAoC;;;;;;;;;;;;8BAEtD,6LAAC;oBACC,SAAS;oBACT,WAAU;oBACV,OAAM;;sCAEN,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,oKAAe;gCAAC,WAAU;;;;;;;;;;;sCAE7B,6LAAC;4BAAK,WAAU;sCAAoC;;;;;;;;;;;;8BAGtD,6LAAC;oBACC,SAAS;oBACT,WAAU;oBACV,OAAO,UAAU,kBAAkB;;sCAEnC,6LAAC;4BACC,WAAW,CAAC,mEAAmE,EAC7E,UACI,gDACA,qDACJ;sCAED,wBAAU,6LAAC,6JAAQ;gCAAC,WAAU;;;;;qDAAe,6LAAC,6JAAQ;gCAAC,WAAU;;;;;;;;;;;sCAEpE,6LAAC;4BAAK,WAAW,CAAC,oBAAoB,EAAE,UAAU,iBAAiB,iBAAiB;sCACjF,UAAU,WAAW;;;;;;;;;;;;;;;;;;IAKhC;IACA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBACC,SAAS;gBACT,WAAU;gBACV,OAAM;;kCAEN,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC,6JAAQ;4BAAC,WAAU;;;;;;;;;;;kCAEtB,6LAAC;wBAAK,WAAU;kCAAoC;;;;;;;;;;;;0BAEtD,6LAAC;gBACC,SAAS;gBACT,WAAU;gBACV,OAAM;;kCAEN,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC,2JAAM;4BAAC,WAAU;;;;;;;;;;;kCAEpB,6LAAC;wBAAK,WAAU;kCAAoC;;;;;;;;;;;;0BAGtD,6LAAC;gBACC,SAAS;gBACT,WAAU;gBACV,OAAO,UAAU,kBAAkB;;kCAEnC,6LAAC;wBACC,WAAW,CAAC,oEAAoE,EAC9E,UACI,gDACA,qDACJ;kCAED,wBAAU,6LAAC,6JAAQ;4BAAC,WAAU;;;;;iDAAe,6LAAC,6JAAQ;4BAAC,WAAU;;;;;;;;;;;kCAEpE,6LAAC;wBAAK,WAAW,CAAC,oBAAoB,EAAE,UAAU,iBAAiB,iBAAiB;kCACjF,UAAU,WAAW;;;;;;;;;;;;;;;;;;AAKhC;KAtGwB"}},
    {"offset": {"line": 473, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/GroupDangerZone.tsx"],"sourcesContent":["import React from 'react';\r\nimport { CiLogout, CiTrash } from 'react-icons/ci';\r\n\r\ninterface GroupDangerZoneProps {\r\n  canLeaveGroup: boolean;\r\n  canDisbandGroup: boolean;\r\n  onLeaveClick: () => void;\r\n  onDisbandClick: () => void;\r\n}\r\n\r\nexport default function GroupDangerZone({\r\n  canLeaveGroup,\r\n  canDisbandGroup,\r\n  onLeaveClick,\r\n  onDisbandClick,\r\n}: GroupDangerZoneProps) {\r\n  return (\r\n    <>\r\n      {/* Rời nhóm */}\r\n      {canLeaveGroup && (\r\n        <button\r\n          onClick={onLeaveClick}\r\n          className=\"w-full px-5 py-4 flex items-center gap-4 bg-gray-50 hover:bg-gray-100 transition-colors duration-200 group cursor-pointer mb-0\"\r\n        >\r\n          <CiLogout className=\"w-5 h-5 text-red-500 group-hover:text-red-600 transition-colors\" />\r\n          <span className=\"text-[1.125rem] md:text-[1rem] text-red-500 font-medium group-hover:text-red-600 transition-colors\">\r\n            Rời nhóm\r\n          </span>\r\n        </button>\r\n      )}\r\n\r\n      {/* Giải tán nhóm (chỉ chủ nhóm) */}\r\n      {canDisbandGroup && (\r\n        <>\r\n          <button\r\n            onClick={onDisbandClick}\r\n            className=\"w-full px-5 py-4 flex items-center gap-4 bg-gray-50 hover:bg-gray-100 transition-colors duration-200 group cursor-pointer\"\r\n          >\r\n            <CiTrash className=\"w-5 h-5 text-red-500 group-hover:text-red-600 transition-colors\" />\r\n            <span className=\"text-[1.125rem] md:text-[1rem] text-red-500 font-medium group-hover:text-red-600 transition-colors\">\r\n              Giải tán nhóm\r\n            </span>\r\n          </button>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;;;AASe,SAAS,gBAAgB,EACtC,aAAa,EACb,eAAe,EACf,YAAY,EACZ,cAAc,EACO;IACrB,qBACE;;YAEG,+BACC,6LAAC;gBACC,SAAS;gBACT,WAAU;;kCAEV,6LAAC,6JAAQ;wBAAC,WAAU;;;;;;kCACpB,6LAAC;wBAAK,WAAU;kCAAqG;;;;;;;;;;;;YAOxH,iCACC;0BACE,cAAA,6LAAC;oBACC,SAAS;oBACT,WAAU;;sCAEV,6LAAC,4JAAO;4BAAC,WAAU;;;;;;sCACnB,6LAAC;4BAAK,WAAU;sCAAqG;;;;;;;;;;;;;;;AAQjI;KArCwB"}},
    {"offset": {"line": 549, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/GroupMembersSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React from 'react';\r\n// Group members section component\r\nimport { HiOutlineArrowRight, HiUserGroup } from 'react-icons/hi';\r\nimport { HiOutlineUserGroup } from 'react-icons/hi2';\r\n\r\ninterface GroupMembersSectionProps {\r\n  isGroup: boolean;\r\n  groupName: string;\r\n  membersCount: number;\r\n  onOpenMembers: () => void;\r\n}\r\n\r\nexport default function GroupMembersSection({ isGroup, membersCount, onOpenMembers }: GroupMembersSectionProps) {\r\n  if (!isGroup) return null;\r\n\r\n  return (\r\n    <div className=\"bg-white overflow-hidden\">\r\n      <button onClick={onOpenMembers} className=\"cursor-pointer w-full px-5 py-4 flex items-center justify-between \">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"rounded-xl  text-gray-500\">\r\n            <HiOutlineUserGroup className=\"w-5 h-5\" />\r\n          </div>\r\n          <span className=\"text-[1.125rem] md:text-[1rem] text-gray-900\">\r\n            Xem thành viên <span className=\"text-gray-500\">({membersCount})</span>\r\n          </span>\r\n        </div>\r\n        <HiOutlineArrowRight className=\"w-5 h-5 text-gray-400 group-hover:text-indigo-600 transition-colors\" />\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAEpD,kCAAkC;AAClC;AACA;;;;AASe,SAAS,oBAAoB,EAAE,OAAO,EAAE,YAAY,EAAE,aAAa,EAA4B;IAC5G,IAAI,CAAC,SAAS,OAAO;IAErB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAO,SAAS;YAAe,WAAU;;8BACxC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,wKAAkB;gCAAC,WAAU;;;;;;;;;;;sCAEhC,6LAAC;4BAAK,WAAU;;gCAA+C;8CAC9C,6LAAC;oCAAK,WAAU;;wCAAgB;wCAAE;wCAAa;;;;;;;;;;;;;;;;;;;8BAGlE,6LAAC,wKAAmB;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAIvC;KAlBwB"}},
    {"offset": {"line": 642, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ReminderSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport { ICCalendar } from '@/components/svg/ICCalendar';\r\nimport React from 'react';\r\nimport { CiCalendarDate } from 'react-icons/ci';\r\nimport { HiClock } from 'react-icons/hi';\r\nimport { HiChevronRight } from 'react-icons/hi2';\r\ninterface ReminderSectionProps {\r\n  onOpen: () => void;\r\n}\r\nexport default function ReminderSection({ onOpen }: ReminderSectionProps) {\r\n  return (\r\n    <div className=\"bg-white   border border-gray-100 overflow-hidden\">\r\n      <button\r\n        className=\"cursor-pointer w-full px-5 py-4 flex items-center gap-5 hover:bg-gray-50 transition-all duration-200 group\"\r\n        onClick={onOpen}\r\n        title=\"Xem danh sách nhắc hẹn\"\r\n      >\r\n        {/* Icon với gradient + hiệu ứng */}\r\n        <div className=\" rounded-xl   \">\r\n          <CiCalendarDate className=\"w-5 h-5 text-gray-500\" />\r\n        </div>\r\n\r\n        {/* Nội dung */}\r\n        <div className=\"text-left\">\r\n          <p className=\"text-base text-[1.125rem] md:text-[1rem] text-gray-900 group-hover:text-amber-600 transition-colors\">\r\n            Lịch hẹn\r\n          </p>\r\n        </div>\r\n\r\n        {/* Mũi tên chỉ thị */}\r\n        <div className=\"ml-auto text-gray-400 group-hover:text-amber-600 transition-colors\">\r\n          <HiChevronRight className=\"w-4 h-4 text-gray-400 group-hover:text-amber-600\" />\r\n        </div>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAGpD;AAEA;;;;AAIe,SAAS,gBAAgB,EAAE,MAAM,EAAwB;IACtE,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,WAAU;YACV,SAAS;YACT,OAAM;;8BAGN,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,mKAAc;wBAAC,WAAU;;;;;;;;;;;8BAI5B,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAE,WAAU;kCAAsG;;;;;;;;;;;8BAMrH,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,oKAAc;wBAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;AAKpC;KA3BwB"}},
    {"offset": {"line": 725, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/PollSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React from 'react';\r\nimport { CiWavePulse1 } from 'react-icons/ci';\r\nimport { HiChartBar, HiChevronRight } from 'react-icons/hi2';\r\n\r\ninterface PollSectionProps {\r\n  onOpen: () => void;\r\n}\r\n\r\nexport default function PollSection({ onOpen }: PollSectionProps) {\r\n  return (\r\n    <div className=\"bg-white  border border-gray-100 overflow-hidden\">\r\n      <button\r\n        className=\"cursor-pointer w-full px-5 py-4 flex items-center gap-5 hover:bg-gray-50 transition-all duration-200 group\"\r\n        onClick={onOpen}\r\n        title=\"Xem danh sách bình chọn\"\r\n      >\r\n        <div className=\" rounded-xl  text-gray-500  \">\r\n          <CiWavePulse1 className=\"w-5 h-5\" />\r\n        </div>\r\n        <div className=\"text-left\">\r\n          <p className=\"text-base text-[1.125rem] md:text-[1rem] text-gray-900 group-hover:text-indigo-600 transition-colors\">\r\n            Bình chọn\r\n          </p>\r\n        </div>\r\n        <div className=\"ml-auto text-gray-400 group-hover:text-indigo-600 transition-colors\">\r\n          <HiChevronRight className=\"w-4 h-4 text-gray-400 group-hover:text-indigo-600\" />\r\n        </div>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAEpD;AACA;;;;AAMe,SAAS,YAAY,EAAE,MAAM,EAAoB;IAC9D,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,WAAU;YACV,SAAS;YACT,OAAM;;8BAEN,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,iKAAY;wBAAC,WAAU;;;;;;;;;;;8BAE1B,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAE,WAAU;kCAAuG;;;;;;;;;;;8BAItH,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,oKAAc;wBAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;AAKpC;KAtBwB"}},
    {"offset": {"line": 808, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ItemDropdownMenu.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React from 'react';\r\nimport { HiOutlineShare } from 'react-icons/hi';\r\n\r\ninterface ItemDropdownMenuProps {\r\n  itemUrl: string;\r\n  itemId: string;\r\n  fileName?: string;\r\n  activeMenuId: string | null;\r\n  onClose: () => void;\r\n  onJumpToMessage: (messageId: string) => void;\r\n  onRemoveFromFolder?: (messageId: string) => void;\r\n  onShareById?: (messageId: string) => void;\r\n}\r\n\r\nexport default function ItemDropdownMenu({\r\n  itemUrl,\r\n  itemId,\r\n  fileName,\r\n  activeMenuId,\r\n  onClose,\r\n  onJumpToMessage,\r\n  onRemoveFromFolder,\r\n  onShareById,\r\n}: ItemDropdownMenuProps) {\r\n  if (activeMenuId !== itemId) return null;\r\n\r\n  return (\r\n    <>\r\n      {/* Lớp phủ trong suốt để click ra ngoài thì đóng menu */}\r\n      <div\r\n        className=\"fixed inset-0 z-40 cursor-default\"\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          onClose();\r\n        }}\r\n      ></div>\r\n\r\n      {/* Dropdown Menu */}\r\n      <div className=\"absolute top-10 right-0 z-50 w-40 bg-white rounded-md shadow-xl border border-gray-200 py-1 animate-in fade-in zoom-in duration-100 origin-top-right\">\r\n        {/* Option 1: Nhảy tới tin nhắn */}\r\n        {/* <button\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            onJumpToMessage(itemId);\r\n            onClose();\r\n          }}\r\n          className=\"cursor-pointer w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2\"\r\n        >\r\n          <svg\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            viewBox=\"0 0 20 20\"\r\n            fill=\"currentColor\"\r\n            className=\"w-4 h-4 text-gray-500\"\r\n          >\r\n            <path\r\n              fillRule=\"evenodd\"\r\n              d=\"M9.293 2.293a1 1 0 011.414 0l7 7A1 1 0 0117 11h-1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-3a1 1 0 00-1-1H9a1 1 0 00-1 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-6H3a1 1 0 01-.707-1.707l7-7z\"\r\n              clipRule=\"evenodd\"\r\n            />\r\n          </svg>\r\n          Xem tin nhắn\r\n        </button> */}\r\n\r\n        {/* Option: Chia sẻ tin nhắn */}\r\n        {typeof onShareById === 'function' && (\r\n          <button\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              try {\r\n                onShareById(itemId);\r\n              } finally {\r\n                onClose();\r\n              }\r\n            }}\r\n            className=\"cursor-pointer w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2\"\r\n          >\r\n            <HiOutlineShare className=\"w-5 h-5\" />\r\n            Chia sẻ tin nhắn\r\n          </button>\r\n        )}\r\n\r\n        {/* Option 2: Tải xuống */}\r\n        {itemUrl && itemUrl.trim() && (\r\n          <a\r\n            href={itemUrl}\r\n            download={fileName || 'download'}\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              onClose();\r\n            }}\r\n            target=\"_blank\"\r\n            rel=\"noreferrer\"\r\n            className=\"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2\"\r\n          >\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              viewBox=\"0 0 20 20\"\r\n              fill=\"currentColor\"\r\n              className=\"w-4 h-4 text-gray-500\"\r\n            >\r\n              <path d=\"M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z\" />\r\n              <path d=\"M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z\" />\r\n            </svg>\r\n            Tải xuống\r\n          </a>\r\n        )}\r\n\r\n        {onRemoveFromFolder && (\r\n          <>\r\n            <hr className=\"my-1 border-gray-200\" />\r\n            <button\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                onRemoveFromFolder(itemId);\r\n                onClose();\r\n              }}\r\n              className=\"cursor-pointer w-full text-left px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 flex items-center gap-2\"\r\n            >\r\n              {/* Trash icon inline svg to avoid importing */}\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" className=\"w-4 h-4\">\r\n                <path\r\n                  fillRule=\"evenodd\"\r\n                  d=\"M8 2a1 1 0 00-1 1v1H5a1 1 0 100 2h10a1 1 0 100-2h-2V3a1 1 0 00-1-1H8zm-3 6a1 1 0 011 1v7a1 1 0 001 1h6a1 1 0 001-1V9a1 1 0 112 0v7a3 3 0 01-3 3H8a3 3 0 01-3-3V9a1 1 0 011-1zm4 1a1 1 0 10-2 0v6a1 1 0 102 0V9zm3-1a1 1 0 00-1 1v6a1 1 0 102 0V9a1 1 0 00-1-1z\"\r\n                  clipRule=\"evenodd\"\r\n                />\r\n              </svg>\r\n              Loại khỏi folder\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAEpD;;;AAae,SAAS,iBAAiB,EACvC,OAAO,EACP,MAAM,EACN,QAAQ,EACR,YAAY,EACZ,OAAO,EACP,eAAe,EACf,kBAAkB,EAClB,WAAW,EACW;IACtB,IAAI,iBAAiB,QAAQ,OAAO;IAEpC,qBACE;;0BAEE,6LAAC;gBACC,WAAU;gBACV,SAAS,CAAC;oBACR,EAAE,eAAe;oBACjB;gBACF;;;;;;0BAIF,6LAAC;gBAAI,WAAU;;oBA0BZ,OAAO,gBAAgB,4BACtB,6LAAC;wBACC,SAAS,CAAC;4BACR,EAAE,eAAe;4BACjB,IAAI;gCACF,YAAY;4BACd,SAAU;gCACR;4BACF;wBACF;wBACA,WAAU;;0CAEV,6LAAC,mKAAc;gCAAC,WAAU;;;;;;4BAAY;;;;;;;oBAMzC,WAAW,QAAQ,IAAI,oBACtB,6LAAC;wBACC,MAAM;wBACN,UAAU,YAAY;wBACtB,SAAS,CAAC;4BACR,EAAE,eAAe;4BACjB;wBACF;wBACA,QAAO;wBACP,KAAI;wBACJ,WAAU;;0CAEV,6LAAC;gCACC,OAAM;gCACN,SAAQ;gCACR,MAAK;gCACL,WAAU;;kDAEV,6LAAC;wCAAK,GAAE;;;;;;kDACR,6LAAC;wCAAK,GAAE;;;;;;;;;;;;4BACJ;;;;;;;oBAKT,oCACC;;0CACE,6LAAC;gCAAG,WAAU;;;;;;0CACd,6LAAC;gCACC,SAAS,CAAC;oCACR,EAAE,eAAe;oCACjB,mBAAmB;oCACnB;gCACF;gCACA,WAAU;;kDAGV,6LAAC;wCAAI,OAAM;wCAA6B,SAAQ;wCAAY,MAAK;wCAAe,WAAU;kDACxF,cAAA,6LAAC;4CACC,UAAS;4CACT,GAAE;4CACF,UAAS;;;;;;;;;;;oCAEP;;;;;;;;;;;;;;;;;AAQpB;KAvHwB"}},
    {"offset": {"line": 967, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/RenameGroupModal.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n\r\nimport React from 'react';\r\nimport { HiPencil, HiX, HiCheck } from 'react-icons/hi';\r\n\r\ninterface RenameGroupModalProps {\r\n  isOpen: boolean;\r\n  renameInput: string;\r\n  onChangeInput: (value: string) => void;\r\n  onClose: () => void;\r\n  onSubmit: () => void;\r\n}\r\n\r\nexport default function RenameGroupModal({\r\n  isOpen,\r\n  renameInput,\r\n  onChangeInput,\r\n  onClose,\r\n  onSubmit,\r\n}: RenameGroupModalProps) {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm px-4\">\r\n      <div\r\n        className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in-95 duration-200\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header gradient đẹp như Zalo */}\r\n        <div className=\"relative cursor-pointer px-6 pt-8 pb-6 bg-blue-400 text-white text-center\">\r\n          <div className=\"absolute top-4 right-4\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 cursor-pointer rounded-full bg-white/20 hover:bg-white/30 transition-all duration-200 active:scale-95\"\r\n            >\r\n              <HiX className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          <h3 className=\"text-2xl font-bold\">Đổi tên nhóm</h3>\r\n          <p className=\"mt-2 text-sm text-white/80\">Tất cả thành viên sẽ thấy tên nhóm mới</p>\r\n        </div>\r\n\r\n        {/* Body */}\r\n        <div className=\"p-6 pt-8\">\r\n          <div className=\"relative\">\r\n            <input\r\n              type=\"text\"\r\n              value={renameInput}\r\n              onChange={(e) => onChangeInput(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && renameInput.trim()) {\r\n                  e.preventDefault();\r\n                  onSubmit();\r\n                }\r\n              }}\r\n              autoFocus\r\n              placeholder=\"Nhập tên nhóm mới...\"\r\n              className=\"w-full pl-3 pr-12 py-2 bg-[#EAEDF0] rounded-md focus:outline-none focus:bg-white focus:ring-1 focus:ring-[#0068ff] transition-all duration-300 text-sm text-gray-900 placeholder-gray-500\"\r\n            />\r\n            {renameInput && <HiCheck className=\"absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-green-600\" />}\r\n          </div>\r\n\r\n          <p className=\"mt-3 text-xs text-gray-500 text-center\">\r\n            Nhấn <kbd className=\"px-2 py-1 bg-gray-100 rounded text-xs font-medium\">Enter</kbd> để lưu nhanh\r\n          </p>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex gap-3 px-6 pb-8\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"cursor-pointer flex-1 py-3.5 text-base font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-2xl transition-all duration-200 active:scale-95\"\r\n          >\r\n            Hủy\r\n          </button>\r\n          <button\r\n            onClick={onSubmit}\r\n            disabled={!renameInput.trim()}\r\n            className={`flex-1 py-3.5 cursor-pointer text-base font-bold text-white rounded-2xl shadow-lg transition-all duration-300 active:scale-95 flex items-center justify-center gap-2\r\n              ${\r\n                !renameInput.trim() ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600 shadow-blue-300'\r\n              }`}\r\n          >\r\n            <HiCheck className=\"w-5 h-5\" />\r\n            Lưu tên nhóm\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAGpD;;;AAUe,SAAS,iBAAiB,EACvC,MAAM,EACN,WAAW,EACX,aAAa,EACb,OAAO,EACP,QAAQ,EACc;IACtB,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAGjC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCACC,SAAS;gCACT,WAAU;0CAEV,cAAA,6LAAC,wJAAG;oCAAC,WAAU;;;;;;;;;;;;;;;;sCAInB,6LAAC;4BAAG,WAAU;sCAAqB;;;;;;sCACnC,6LAAC;4BAAE,WAAU;sCAA6B;;;;;;;;;;;;8BAI5C,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;oCAC7C,WAAW,CAAC;wCACV,IAAI,EAAE,GAAG,KAAK,WAAW,YAAY,IAAI,IAAI;4CAC3C,EAAE,cAAc;4CAChB;wCACF;oCACF;oCACA,SAAS;oCACT,aAAY;oCACZ,WAAU;;;;;;gCAEX,6BAAe,6LAAC,4JAAO;oCAAC,WAAU;;;;;;;;;;;;sCAGrC,6LAAC;4BAAE,WAAU;;gCAAyC;8CAC/C,6LAAC;oCAAI,WAAU;8CAAoD;;;;;;gCAAW;;;;;;;;;;;;;8BAKvF,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,SAAS;4BACT,WAAU;sCACX;;;;;;sCAGD,6LAAC;4BACC,SAAS;4BACT,UAAU,CAAC,YAAY,IAAI;4BAC3B,WAAW,CAAC;cACV,EACE,CAAC,YAAY,IAAI,KAAK,mCAAmC,iDACzD;;8CAEJ,6LAAC,4JAAO;oCAAC,WAAU;;;;;;gCAAY;;;;;;;;;;;;;;;;;;;;;;;;AAO3C;KA9EwB"}},
    {"offset": {"line": 1152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ConfirmGroupActionModal.tsx"],"sourcesContent":["import React from 'react';\r\nimport { HiX, HiTrash } from 'react-icons/hi';\r\nimport { HiOutlineUserMinus } from 'react-icons/hi2';\r\n\r\ntype ConfirmAction = 'leave' | 'disband' | null;\r\n\r\ninterface ConfirmGroupActionModalProps {\r\n  confirmAction: ConfirmAction;\r\n  onCancel: () => void;\r\n  onConfirmLeave: () => void;\r\n  onConfirmDisband: () => void;\r\n}\r\n\r\nexport default function ConfirmGroupActionModal({\r\n  confirmAction,\r\n  onCancel,\r\n  onConfirmLeave,\r\n  onConfirmDisband,\r\n}: ConfirmGroupActionModalProps) {\r\n  if (!confirmAction) return null;\r\n\r\n  const isLeave = confirmAction === 'leave';\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm px-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl border border-gray-100 w-full max-w-md overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\r\n        {/* Header */}\r\n        <div className=\"px-4 py-4 flex items-center justify-between\">\r\n          <h3 className=\"text-xl font-bold text-gray-900\">{isLeave ? 'Rời khỏi nhóm?' : 'Giải tán nhóm?'}</h3>\r\n          <button onClick={onCancel} className=\"text-gray-400 hover:text-gray-600 transition-colors cursor-pointer\">\r\n            <HiX className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"h-px bg-gray-100 mx-4\" />\r\n\r\n        {/* Nội dung */}\r\n        <div className=\"px-4 py-6\">\r\n          <div className=\"flex flex-col items-center text-center\">\r\n            <p className=\"text-gray-600 leading-relaxed\">\r\n              {isLeave\r\n                ? 'Bạn sẽ không còn nhận được tin nhắn từ nhóm này nữa. Bạn vẫn có thể tham gia lại nếu được mời.'\r\n                : 'Toàn bộ thành viên sẽ bị xóa khỏi nhóm và lịch sử trò chuyện sẽ bị xóa vĩnh viễn. Hành động này không thể hoàn tác.'}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"h-px bg-gray-100 mx-4 mb-4\" />\r\n\r\n        {/* Nút hành động */}\r\n        <div className=\"flex items-center justify-end gap-3 px-4 pb-4\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onCancel}\r\n            className=\"cursor-pointer px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-lg transition-colors\"\r\n          >\r\n            Hủy\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={isLeave ? onConfirmLeave : onConfirmDisband}\r\n            className=\"cursor-pointer px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg shadow-sm transition-colors flex items-center gap-2\"\r\n          >\r\n            {isLeave ? (\r\n              <>\r\n                <HiOutlineUserMinus className=\"w-4 h-4\" />\r\n                Rời nhóm\r\n              </>\r\n            ) : (\r\n              <>\r\n                <HiTrash className=\"w-4 h-4\" />\r\n                Giải tán nhóm\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAWe,SAAS,wBAAwB,EAC9C,aAAa,EACb,QAAQ,EACR,cAAc,EACd,gBAAgB,EACa;IAC7B,IAAI,CAAC,eAAe,OAAO;IAE3B,MAAM,UAAU,kBAAkB;IAElC,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BAEb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAmC,UAAU,mBAAmB;;;;;;sCAC9E,6LAAC;4BAAO,SAAS;4BAAU,WAAU;sCACnC,cAAA,6LAAC,wJAAG;gCAAC,WAAU;;;;;;;;;;;;;;;;;8BAInB,6LAAC;oBAAI,WAAU;;;;;;8BAGf,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAE,WAAU;sCACV,UACG,mGACA;;;;;;;;;;;;;;;;8BAKV,6LAAC;oBAAI,WAAU;;;;;;8BAGf,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BACC,MAAK;4BACL,SAAS;4BACT,WAAU;sCACX;;;;;;sCAGD,6LAAC;4BACC,MAAK;4BACL,SAAS,UAAU,iBAAiB;4BACpC,WAAU;sCAET,wBACC;;kDACE,6LAAC,wKAAkB;wCAAC,WAAU;;;;;;oCAAY;;6DAI5C;;kDACE,6LAAC,4JAAO;wCAAC,WAAU;;;;;;oCAAY;;;;;;;;;;;;;;;;;;;;;;;;;AAS/C;KAlEwB"}},
    {"offset": {"line": 1311, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/CreateReminderModal.tsx"],"sourcesContent":["import React, { useMemo, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { HiX } from 'react-icons/hi';\r\nimport { HiCalendarDays,  HiBellAlert, HiClock } from 'react-icons/hi2';\r\n\r\ninterface CreateReminderModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onCreate: (payload: {\r\n    content: string;\r\n    dateTime: string;\r\n    note?: string;\r\n    repeat?: 'none' | 'daily' | 'weekly' | 'monthly';\r\n  }) => Promise<void> | void;\r\n  createLoading: boolean;\r\n}\r\n\r\nexport default function CreateReminderModal({ isOpen, onClose, onCreate, createLoading }: CreateReminderModalProps) {\r\n  const [content, setContent] = useState('');\r\n  const [dateTime, setDateTime] = useState('');\r\n  const [repeat, setRepeat] = useState<'none' | 'daily' | 'weekly' | 'monthly'>('none');\r\n  const [showRepeatSheet, setShowRepeatSheet] = useState(false);\r\n  const [showDateSheet, setShowDateSheet] = useState(false);\r\nconst isDesktop = typeof window !== 'undefined' && window.matchMedia('(min-width: 1024px)').matches;\r\n  const defaultDateTime = useMemo(() => {\r\n    const now = new Date();\r\n    const pad = (n: number) => String(n).padStart(2, '0');\r\n    const y = now.getFullYear();\r\n    const m = pad(now.getMonth() + 1);\r\n    const d = pad(now.getDate());\r\n    const hh = pad(now.getHours());\r\n    const mm = pad(now.getMinutes());\r\n    return `${y}-${m}-${d}T${hh}:${mm}`;\r\n  }, []);\r\n\r\n  const dtLabel = useMemo(() => {\r\n    const raw = dateTime || defaultDateTime;\r\n    const ms = Date.parse(raw);\r\n    if (Number.isNaN(ms)) return 'Chọn thời gian';\r\n    const dateObj = new Date(ms);\r\n    return dateObj.toLocaleString('vi-VN', { hour12: false });\r\n  }, [dateTime, defaultDateTime]);\r\n\r\n  const repeatLabel = useMemo(() => {\r\n    switch (repeat) {\r\n      case 'daily':\r\n        return 'Hàng ngày';\r\n      case 'weekly':\r\n        return 'Hàng tuần';\r\n      case 'monthly':\r\n        return 'Hàng tháng';\r\n      default:\r\n        return 'Không lặp lại';\r\n    }\r\n  }, [repeat]);\r\n\r\n  const canSubmit = content.trim().length > 0 && (dateTime || defaultDateTime).trim().length > 0;\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const modalNode = (\r\n    <div\r\n      className={`${isDesktop ? 'absolute inset-0' : 'fixed inset-0'} z-[50] flex items-stretch justify-center ${\r\n        isDesktop ? 'bg-black/20' : 'bg-black/50'\r\n      } backdrop-blur-sm`}\r\n    >\r\n      <div className=\"bg-white w-full h-full rounded-none overflow-hidden animate-in fade-in duration-200 flex flex-col\">\r\n        <div className=\"p-3 pb-3 bg-gray-100 text-black w-full\">\r\n          <div className=\"flex items-center justify-between w-full\">\r\n            <div className=\"flex items-center \">\r\n              <button onClick={onClose} className=\" cursor-pointer top-3 left-3 p-2 \">\r\n                <HiX className=\"w-5 h-5\" />\r\n              </button>\r\n              <h3 className=\"text-xl \">Tạo nhắc hẹn mới</h3>\r\n            </div>\r\n\r\n            <button\r\n              onClick={() => {\r\n                const finalDt = dateTime || defaultDateTime;\r\n                onCreate({ content, dateTime: finalDt, repeat });\r\n                setContent('');\r\n                setDateTime('');\r\n                setRepeat('none');\r\n              }}\r\n              disabled={createLoading}\r\n              className={`px-4 py-2 font-bold transition-all duration-200 \r\n                ${\r\n                  canSubmit && !createLoading\r\n                    ? 'text-blue-500 cursor-pointer active:opacity-70'\r\n                    : 'text-gray-400 cursor-not-allowed opacity-50'\r\n                }`}\r\n            >\r\n              <div className=\"flex items-center gap-2 text-blue-500 justify-end \">Xong</div>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"px-4 sm:px-6 py-4 space-y-2 flex-1 overflow-y-auto\">\r\n          <div className=\"flex items-center gap-3 px-3 py-3  border-b border-gray-300 \">\r\n            <div className=\"text-rose-600\">\r\n              <HiBellAlert className=\"w-6 h-6\" />\r\n            </div>\r\n            <input\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              className=\"flex-1 bg-transparent outline-none text-lg\"\r\n              placeholder=\"Nhập tiêu đề nhắc hẹn...\"\r\n              type=\"text\"\r\n            />\r\n          </div>\r\n\r\n          <button\r\n            className=\"w-full text-left px-3 py-3 border-b border-gray-300  flex items-center gap-3 cursor-pointer active:scale-[0.99]\"\r\n            onClick={() => setShowDateSheet(true)}\r\n          >\r\n            <div className=\"text-gray-700\">\r\n              <HiClock className=\"w-6 h-6\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <p className=\"text-gray-800 text-[15px]\">{dtLabel}</p>\r\n            </div>\r\n          </button>\r\n\r\n          <button\r\n            className=\"w-full text-left px-3 py-3 border-b border-gray-300 flex items-center gap-3 cursor-pointer active:scale-[0.99]\"\r\n            onClick={() => setShowRepeatSheet(true)}\r\n          >\r\n            <div className=\"text-gray-700\">\r\n              <HiCalendarDays className=\"w-6 h-6\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <p className=\"text-gray-800 text-[15px]\">Chọn kiểu lặp lại</p>\r\n              <p className=\"text-gray-500 text-xs\">{repeatLabel}</p>\r\n            </div>\r\n          </button>\r\n        </div>\r\n\r\n        {showRepeatSheet && (\r\n          <div className=\"fixed inset-0 z-[10000] flex items-end bg-black/40\" onClick={() => setShowRepeatSheet(false)}>\r\n            <div\r\n              className=\"w-full bg-white rounded-t-2xl p-4\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n              }}\r\n            >\r\n              <div className=\"flex items-center justify-between pb-2\">\r\n                <p className=\"font-semibold\">Chọn kiểu lặp lại</p>\r\n                <button\r\n                  onClick={() => setShowRepeatSheet(false)}\r\n                  className=\"px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200 cursor-pointer\"\r\n                >\r\n                  Xong\r\n                </button>\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                {[\r\n                  { key: 'none', label: 'Không lặp lại' },\r\n                  { key: 'daily', label: 'Hàng ngày' },\r\n                  { key: 'weekly', label: 'Hàng tuần' },\r\n                  { key: 'monthly', label: 'Hàng tháng' },\r\n                ].map((opt) => (\r\n                  <label\r\n                    key={opt.key}\r\n                    className=\"flex items-center gap-3 px-3 py-2 rounded-xl border border-gray-200 cursor-pointer\"\r\n                  >\r\n                    <input\r\n                      type=\"radio\"\r\n                      name=\"repeat\"\r\n                      checked={repeat === (opt.key as 'none' | 'daily' | 'weekly' | 'monthly')}\r\n                      onChange={() => setRepeat(opt.key as 'none' | 'daily' | 'weekly' | 'monthly')}\r\n                    />\r\n                    <span>{opt.label}</span>\r\n                  </label>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {showDateSheet && (\r\n          <div className=\"fixed inset-0 z-[10000] flex items-end bg-black/40\" onClick={() => setShowDateSheet(false)}>\r\n            <div\r\n              className=\"w-full bg-white rounded-t-2xl p-4 space-y-3\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n              }}\r\n            >\r\n              <div className=\"px-1\">\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  value={dateTime || defaultDateTime}\r\n                  onChange={(e) => setDateTime(e.target.value)}\r\n                  className=\"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl\"\r\n                />\r\n              </div>\r\n              <div className=\"flex justify-end\">\r\n                <button\r\n                  onClick={() => setShowDateSheet(false)}\r\n                  className=\"px-3 py-2 rounded-xl bg-blue-600 text-white font-semibold cursor-pointer\"\r\n                >\r\n                  Chọn\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n\r\nconst target =\r\n    isDesktop && typeof document !== 'undefined' ? document.getElementById('right-sidebar-container') : null;\r\n  return isDesktop && target ? createPortal(modalNode, target) : modalNode;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1766, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ReminderDetailModal.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { HiOutlinePencil, HiOutlineClock, HiBellAlert, HiEllipsisVertical } from 'react-icons/hi2';\r\nimport type { Message } from '@/types/Message';\r\nimport { useChatContext } from '@/context/ChatContext';\r\nimport { updateMessageApi, deleteMessageApi, createMessageApi } from '@/fetch/messages';\r\nimport { io } from 'socket.io-client';\r\nimport { resolveSocketUrl, getProxyUrl } from '@/utils/utils';\r\nimport type { GroupConversation } from '@/types/Group';\r\nimport type { User } from '@/types/User';\r\nimport { HiX } from 'react-icons/hi';\r\nimport Image from 'next/image';\r\n\r\ninterface ReminderDetailModalProps {\r\n  isOpen: boolean;\r\n  message: Message | null;\r\n  onClose: () => void;\r\n  onRefresh?: () => void;\r\n}\r\n\r\nexport default function ReminderDetailModal({ isOpen, message, onClose, onRefresh }: ReminderDetailModalProps) {\r\n  const { selectedChat, currentUser, isGroup, allUsers } = useChatContext();\r\n  const roomId = (() => {\r\n    const me = String(currentUser._id);\r\n    const other = String((selectedChat as unknown as { _id: string })._id);\r\n    return isGroup ? other : [me, other].sort().join('_');\r\n  })();\r\n  const [content, setContent] = useState('');\r\n  const [dateTime, setDateTime] = useState('');\r\n  const [repeat, setRepeat] = useState<'none' | 'daily' | 'weekly' | 'monthly'>('none');\r\n  const [editing, setEditing] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const [showRepeatSheet, setShowRepeatSheet] = useState(false);\r\n  const [showDateSheet, setShowDateSheet] = useState(false);\r\n  const isDesktop = typeof window !== 'undefined' && window.matchMedia('(min-width: 1024px)').matches;\r\n\r\n  const originalContent = useMemo(() => String(message?.content || ''), [message]);\r\n  const originalDateTimeISO = useMemo(() => {\r\n    if (!message) return '';\r\n    const at = (message as Message & { reminderAt?: number }).reminderAt || message.timestamp;\r\n    return new Date(at - new Date().getTimezoneOffset() * 60000).toISOString().slice(0, 16);\r\n  }, [message]);\r\n  const originalRepeat = useMemo(() => {\r\n    if (!message) return 'none';\r\n    return (message as Message & { reminderRepeat?: 'none' | 'daily' | 'weekly' | 'monthly' }).reminderRepeat || 'none';\r\n  }, [message]);\r\n  const isValid = useMemo(() => {\r\n    const dt = Date.parse(dateTime);\r\n    return Boolean(content.trim()) && !Number.isNaN(dt);\r\n  }, [content, dateTime]);\r\n  const isDirty = useMemo(() => {\r\n    return content.trim() !== originalContent.trim() || dateTime !== originalDateTimeISO || repeat !== originalRepeat;\r\n  }, [content, dateTime, repeat, originalContent, originalDateTimeISO, originalRepeat]);\r\n\r\n  useEffect(() => {\r\n    if (!message) return;\r\n    setContent(String(message.content || ''));\r\n    const at = (message as Message & { reminderAt?: number }).reminderAt || message.timestamp;\r\n    const isoLocal = new Date(at - new Date().getTimezoneOffset() * 60000).toISOString().slice(0, 16);\r\n    setDateTime(isoLocal);\r\n    setRepeat(\r\n      (message as Message & { reminderRepeat?: 'none' | 'daily' | 'weekly' | 'monthly' }).reminderRepeat || 'none',\r\n    );\r\n    setEditing(false);\r\n    setMenuOpen(false);\r\n  }, [message]);\r\n\r\n  const dtLabel = useMemo(() => {\r\n    const ms = Date.parse(dateTime);\r\n    if (Number.isNaN(ms)) return '';\r\n    const dateObj = new Date(ms);\r\n    return dateObj.toLocaleString('vi-VN', { hour12: false });\r\n  }, [dateTime]);\r\n  const repeatLabel = useMemo(() => {\r\n    switch (repeat) {\r\n      case 'daily':\r\n        return 'Hàng ngày';\r\n      case 'weekly':\r\n        return 'Hàng tuần';\r\n      case 'monthly':\r\n        return 'Hàng tháng';\r\n      default:\r\n        return 'Không lặp lại';\r\n    }\r\n  }, [repeat]);\r\n  const creatorInfo = useMemo(() => {\r\n    if (!message) return { name: '', avatar: null as string | null };\r\n    const raw = message.sender as User | string;\r\n    const sid =\r\n      typeof raw === 'object' && raw\r\n        ? String(\r\n            (raw as unknown as { _id?: string; id?: string })._id ||\r\n              (raw as unknown as { _id?: string; id?: string }).id ||\r\n              '',\r\n          )\r\n        : String(raw || '');\r\n    const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n    const member = members.find(\r\n      (m) =>\r\n        String(\r\n          (m as unknown as { _id?: string; id?: string })._id ||\r\n            (m as unknown as { _id?: string; id?: string }).id ||\r\n            '',\r\n        ) === sid,\r\n    );\r\n    const userAll = (allUsers || []).find(\r\n      (u) =>\r\n        String(\r\n          (u as unknown as { _id?: string; id?: string })._id ||\r\n            (u as unknown as { _id?: string; id?: string }).id ||\r\n            '',\r\n        ) === sid,\r\n    );\r\n    const senderObj = typeof raw === 'object' && raw ? (raw as User) : undefined;\r\n    const finalAvatar =\r\n      (member as unknown as { avatar?: string })?.avatar || userAll?.avatar || senderObj?.avatar || null;\r\n    const finalNameRaw = senderObj?.name || (member as unknown as { name?: string })?.name || userAll?.name || '';\r\n    const finalName = sid && String(currentUser._id) === sid ? 'Bạn' : finalNameRaw || 'Người dùng';\r\n    return { name: finalName, avatar: finalAvatar };\r\n  }, [message, isGroup, selectedChat, allUsers, currentUser._id]);\r\n\r\n  if (!isOpen || !message) return null;\r\n\r\n  const handleSave = async () => {\r\n    const dt = Date.parse(dateTime);\r\n    if (!content.trim() || Number.isNaN(dt)) return;\r\n    setSaving(true);\r\n    try {\r\n      await updateMessageApi(String(message._id), {\r\n        content: content.trim(),\r\n        reminderAt: dt,\r\n        reminderFired: false,\r\n        reminderRepeat: repeat,\r\n      });\r\n\r\n      const socket = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n      const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n      const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n      socket.emit('edit_message', {\r\n        _id: message._id,\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        senderName: currentUser.name,\r\n        isGroup,\r\n        receiver,\r\n        members,\r\n        content: content.trim(),\r\n        newContent: content.trim(),\r\n        editedAt: Date.now(),\r\n        originalContent: message.content,\r\n        reminderAt: dt,\r\n        reminderFired: false,\r\n        reminderRepeat: repeat,\r\n      });\r\n      const name = currentUser.name;\r\n      const timeStr = new Date(dt).toLocaleString('vi-VN');\r\n      const notifyRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'notify',\r\n        content: `${name} đã chỉnh sửa lịch hẹn: \"${content.trim()}\" lúc ${timeStr}`,\r\n        timestamp: Date.now(),\r\n        replyToMessageId: String(message._id),\r\n      });\r\n      if (notifyRes?.success && typeof notifyRes._id === 'string') {\r\n        socket.emit('send_message', {\r\n          _id: notifyRes._id,\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n          type: 'notify',\r\n          content: `${name} đã chỉnh sửa lịch hẹn: \"${content.trim()}\" lúc ${timeStr}`,\r\n          timestamp: Date.now(),\r\n          replyToMessageId: String(message._id),\r\n        });\r\n      }\r\n      socket.disconnect();\r\n      if (onRefresh) {\r\n        onRefresh();\r\n      }\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('❌ Lỗi khi lưu lịch hẹn:', error);\r\n      alert('Không thể lưu lịch hẹn. Vui lòng thử lại.');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleRecall = async () => {\r\n    const ok = confirm('Bạn có chắc muốn xóa vĩnh viễn lịch hẹn này?');\r\n    if (!ok) return;\r\n\r\n    setSaving(true);\r\n    try {\r\n      await deleteMessageApi(String(message._id));\r\n      const socket = io(resolveSocketUrl(), {\r\n        transports: ['websocket'],\r\n        withCredentials: false,\r\n      });\r\n      const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n      const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n      socket.emit('message_deleted', {\r\n        _id: message._id,\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        senderName: currentUser.name,\r\n        isGroup,\r\n        receiver,\r\n        members,\r\n        type: 'delete',\r\n        timestamp: Date.now(),\r\n      });\r\n      const name = currentUser.name;\r\n      const notifyRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'notify',\r\n        content: `${name} đã xóa lịch hẹn: \"${String(message.content || '')}\"`,\r\n        timestamp: Date.now(),\r\n        replyToMessageId: String(message._id),\r\n      });\r\n      if (notifyRes?.success && typeof notifyRes._id === 'string') {\r\n        socket.emit('send_message', {\r\n          _id: notifyRes._id,\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n          type: 'notify',\r\n          content: `${name} đã xóa lịch hẹn: \"${String(message.content || '')}\"`,\r\n          timestamp: Date.now(),\r\n          replyToMessageId: String(message._id),\r\n        });\r\n      }\r\n      socket.disconnect();\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('❌ Lỗi khi xóa lịch hẹn:', error);\r\n      alert('Không thể xóa lịch hẹn. Vui lòng thử lại.');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const modalNode = (\r\n    <div\r\n      className={`${isDesktop ? 'absolute inset-0' : 'fixed inset-0'} z-[50] flex items-stretch justify-center ${\r\n        isDesktop ? 'bg-black/20' : 'bg-black/50'\r\n      } backdrop-blur-sm`}\r\n    >\r\n      <div className=\"bg-white w-full h-full rounded-none overflow-hidden flex flex-col\">\r\n        <div className=\"p-3 bg-gray-100 text-black w-full\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center \">\r\n              <button onClick={onClose} disabled={saving} className=\"p-2 cursor-pointer\">\r\n                <HiX className=\"w-5 h-5 md:w-6 md:h-6\" />\r\n              </button>\r\n              <h3 className=\"text-lg md:text-2xl \">{editing ? 'Sửa nhắc hẹn' : 'Chi tiết nhắc hẹn'}</h3>\r\n            </div>\r\n            {!editing ? (\r\n              <div className=\"flex items-center gap-1\">\r\n                <button\r\n                  onClick={() => setEditing(true)}\r\n                  className=\"p-2 rounded-xl hover:bg-gray-200 cursor-pointer\"\r\n                  title=\"Sửa\"\r\n                >\r\n                  <HiOutlinePencil className=\"w-5 h-5\" />\r\n                </button>\r\n                <div className=\"relative\">\r\n                  <button\r\n                    onClick={() => setMenuOpen((v) => !v)}\r\n                    className=\"p-2 rounded-xl hover:bg-gray-200 cursor-pointer\"\r\n                    title=\"Thêm\"\r\n                  >\r\n                    <HiEllipsisVertical className=\"w-5 h-5\" />\r\n                  </button>\r\n                  {menuOpen && (\r\n                    <div className=\"absolute right-0 top-full mt-1 w-36 bg-white rounded-xl shadow-lg border border-gray-200 py-1 z-10\">\r\n                      <button\r\n                        onClick={() => {\r\n                          setMenuOpen(false);\r\n                          setEditing(true);\r\n                        }}\r\n                        className=\"w-full px-4 py-2 text-left hover:bg-gray-50\"\r\n                      >\r\n                        Sửa\r\n                      </button>\r\n                      <button\r\n                        onClick={() => {\r\n                          setMenuOpen(false);\r\n                          handleRecall();\r\n                        }}\r\n                        className=\"w-full px-4 py-2 text-left text-red-600 hover:bg-red-50\"\r\n                      >\r\n                        Xóa\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <button\r\n                onClick={handleSave}\r\n                disabled={saving || !isDirty || !isValid}\r\n                className={`px-4 py-1.5 font-bold cursor-pointer ${\r\n                  saving || !isDirty || !isValid ? 'text-gray-400' : 'text-blue-600'\r\n                }`}\r\n              >\r\n                Xong\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {!editing ? (\r\n          <div className=\"flex-1 overflow-y-auto\">\r\n            <div className=\"flex items-center gap-3 px-4 py-4\">\r\n              <div className=\"w-10 h-10 rounded-3xl overflow-hidden ring-4 ring-white shadow-2xl\">\r\n                {creatorInfo.avatar ? (\r\n                  <Image\r\n                    width={32}\r\n                    height={32}\r\n                    src={getProxyUrl(creatorInfo.avatar)}\r\n                    alt={creatorInfo.name}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <div className=\"w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold text-xl flex items-center justify-center\">\r\n                    <Image\r\n                      src=\"/logo/avata.webp\"\r\n                      alt={creatorInfo.name || 'User'}\r\n                      width={38}\r\n                      height={38}\r\n                      className=\"w-full h-full rounded-full object-cover\"\r\n                    />\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <div className=\"text-gray-800 text-xl\">{creatorInfo.name}</div>\r\n              </div>\r\n            </div>\r\n            <div className=\"divide-y divide-gray-200\">\r\n              <div className=\"flex items-start gap-3 px-4 py-4\">\r\n                <HiBellAlert className=\"w-6 h-6 text-rose-600 shrink-0\" />\r\n                <p className=\"flex-1 min-w-0 text-xl text-gray-800 whitespace-pre-wrap break-words\">{content}</p>\r\n              </div>\r\n              <div className=\"flex items-center gap-3 px-4 py-4\">\r\n                <HiOutlineClock className=\"w-6 h-6 text-gray-700\" />\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-gray-800 text-xl\">{dtLabel}</div>\r\n                  <div className=\"text-gray-500 text-lg\">Lặp: {repeatLabel}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex-1 overflow-y-auto\">\r\n            <div className=\"divide-y divide-gray-200\">\r\n              <div className=\"flex items-center gap-3 px-4 py-4\">\r\n                <div className=\"w-10 h-10 rounded-3xl overflow-hidden ring-4 ring-white shadow-2xl\">\r\n                  {creatorInfo.avatar ? (\r\n                    <Image\r\n                      width={32}\r\n                      height={32}\r\n                      src={getProxyUrl(creatorInfo.avatar)}\r\n                      alt={creatorInfo.name}\r\n                      className=\"w-full h-full object-cover\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold text-xs flex items-center justify-center\">\r\n                      {(creatorInfo.name || 'N').charAt(0).toUpperCase()}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-gray-800 text-xl\">{creatorInfo.name}</div>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center gap-3 px-4 py-4\">\r\n                <HiBellAlert className=\"w-6 h-6 text-rose-600\" />\r\n                <input\r\n                  value={content}\r\n                  onChange={(e) => setContent(e.target.value)}\r\n                  className=\"flex-1 bg-transparent outline-none text-[15px]\"\r\n                  placeholder=\"Nhập tiêu đề nhắc hẹn...\"\r\n                  type=\"text\"\r\n                />\r\n              </div>\r\n              <button\r\n                className=\"w-full text-left flex items-center gap-3 px-4 py-4 cursor-pointer\"\r\n                onClick={() => setShowDateSheet(true)}\r\n              >\r\n                <HiOutlineClock className=\"w-6 h-6 text-gray-700\" />\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-gray-800 text-xl\">{dtLabel}</div>\r\n                </div>\r\n              </button>\r\n              <button\r\n                className=\"w-full text-left flex items-center gap-3 px-4 py-4 cursor-pointer\"\r\n                onClick={() => setShowRepeatSheet(true)}\r\n              >\r\n                <HiOutlineClock className=\"w-6 h-6 text-gray-700\" />\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-gray-800 text-[15px]\">Chọn kiểu lặp lại</div>\r\n                  <div className=\"text-gray-500 text-xs\">{repeatLabel}</div>\r\n                </div>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {showRepeatSheet && (\r\n          <div className=\"fixed inset-0 z-[10000] flex items-end bg-black/40\" onClick={() => setShowRepeatSheet(false)}>\r\n            <div\r\n              className=\"w-full bg-white rounded-t-2xl p-4\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n              }}\r\n            >\r\n              <div className=\"flex items-center justify-between pb-2\">\r\n                <p className=\"font-semibold\">Chọn kiểu lặp lại</p>\r\n                <button\r\n                  onClick={() => setShowRepeatSheet(false)}\r\n                  className=\"px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200 cursor-pointer\"\r\n                >\r\n                  Xong\r\n                </button>\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                {[\r\n                  { key: 'none', label: 'Không lặp lại' },\r\n                  { key: 'daily', label: 'Hàng ngày' },\r\n                  { key: 'weekly', label: 'Hàng tuần' },\r\n                  { key: 'monthly', label: 'Hàng tháng' },\r\n                ].map((opt) => (\r\n                  <label\r\n                    key={opt.key}\r\n                    className=\"flex items-center gap-3 px-3 py-2 rounded-xl border border-gray-200 cursor-pointer\"\r\n                  >\r\n                    <input\r\n                      type=\"radio\"\r\n                      name=\"repeat\"\r\n                      checked={repeat === (opt.key as 'none' | 'daily' | 'weekly' | 'monthly')}\r\n                      onChange={() => setRepeat(opt.key as 'none' | 'daily' | 'weekly' | 'monthly')}\r\n                    />\r\n                    <span>{opt.label}</span>\r\n                  </label>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {showDateSheet && (\r\n          <div className=\"fixed inset-0 z-[10000] flex items-end bg:black/40\" onClick={() => setShowDateSheet(false)}>\r\n            <div\r\n              className=\"w-full bg-white rounded-t-2xl p-4 space-y-3\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n              }}\r\n            >\r\n              <div className=\"px-1\">\r\n                <input\r\n                  type=\"datetime-local\"\r\n                  value={dateTime}\r\n                  onChange={(e) => setDateTime(e.target.value)}\r\n                  className=\"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl\"\r\n                />\r\n              </div>\r\n              <div className=\"flex justify-end\">\r\n                <button\r\n                  onClick={() => setShowDateSheet(false)}\r\n                  className=\"px-3 py-2 rounded-xl bg-blue-600 text-white font-semibold cursor-pointer\"\r\n                >\r\n                  Chọn\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n  const target =\r\n    isDesktop && typeof document !== 'undefined' ? document.getElementById('right-sidebar-container') : null;\r\n  return isDesktop && target ? createPortal(modalNode, target) : modalNode;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2692, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ReminderList.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState, useRef } from 'react';\r\nimport { FaRegClock } from 'react-icons/fa6';\r\nimport { HiX } from 'react-icons/hi';\r\nimport { IoCalendarOutline } from 'react-icons/io5';\r\nimport { useChatContext } from '@/context/ChatContext';\r\nimport type { GroupConversation } from '@/types/Group';\r\nimport { readMessagesApi, createMessageApi, deleteMessageApi } from '@/fetch/messages';\r\nimport type { Message } from '@/types/Message';\r\nimport type { User } from '@/types/User';\r\nimport CreateReminderModal from './CreateReminderModal';\r\nimport ReminderDetailModal from './ReminderDetailModal';\r\nimport { io } from 'socket.io-client';\r\nimport { HiEllipsisVertical } from 'react-icons/hi2';\r\nimport { resolveSocketUrl } from '@/utils/utils';\r\n\r\ninterface ReminderListProps {\r\n  onClose: () => void;\r\n  embedded?: boolean;\r\n}\r\n\r\nexport default function ReminderList({ onClose, embedded = false }: ReminderListProps) {\r\n  const { selectedChat, currentUser, isGroup } = useChatContext();\r\n  const roomId = useMemo(() => {\r\n    const me = String(currentUser._id);\r\n    const other = String((selectedChat as unknown as { _id: string })._id);\r\n    return isGroup ? other : [me, other].sort().join('_');\r\n  }, [isGroup, selectedChat, currentUser]);\r\n  const [items, setItems] = useState<Message[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showCreate, setShowCreate] = useState(false);\r\n  const [detailMsg, setDetailMsg] = useState<Message | null>(null);\r\n  const [openMenuId, setOpenMenuId] = useState<string | null>(null); // 🔥 Track ID của menu đang mở\r\n  const menuRefs = useRef<Map<string, HTMLDivElement>>(new Map()); // 🔥 Refs cho các menu\r\n  const [create, setCreate] = useState(false);\r\n  const load = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await readMessagesApi(roomId, {\r\n        limit: 200,\r\n        sortOrder: 'desc',\r\n        extraFilters: { type: 'reminder', isRecalled: { $ne: true } },\r\n      });\r\n      const data = Array.isArray(res.data) ? (res.data as Message[]) : [];\r\n      setItems(data);\r\n    } catch (error) {\r\n      console.error('❌ Lỗi khi tải danh sách lịch hẹn:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [roomId]);\r\n\r\n  useEffect(() => {\r\n    void load();\r\n  }, [load]);\r\n\r\n  // 🔥 CLOSE MENU KHI CLICK BÊN NGOÀI\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (!openMenuId) return;\r\n\r\n      const menuElement = menuRefs.current.get(openMenuId);\r\n      if (menuElement && !menuElement.contains(event.target as Node)) {\r\n        setOpenMenuId(null);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [openMenuId]);\r\n\r\n  useEffect(() => {\r\n    const socket = io(resolveSocketUrl(), {\r\n      transports: ['websocket'],\r\n      withCredentials: false,\r\n    });\r\n    socket.emit('join_room', roomId);\r\n\r\n    socket.on('receive_message', (data: Message) => {\r\n      if (data.roomId !== roomId || data.type !== 'reminder') return;\r\n      setItems((prev) => {\r\n        const map = new Map<string, Message>();\r\n        [...prev, data].forEach((m) => map.set(String(m._id), m));\r\n        return Array.from(map.values()).sort((a, b) => Number(b.timestamp) - Number(a.timestamp));\r\n      });\r\n    });\r\n\r\n    socket.on(\r\n      'message_edited',\r\n      (data: {\r\n        _id: string;\r\n        roomId: string;\r\n        content: string;\r\n        editedAt: number;\r\n        originalContent?: string;\r\n        reminderAt?: number;\r\n        reminderNote?: string;\r\n      }) => {\r\n        if (data.roomId !== roomId) return;\r\n        setItems((prev) =>\r\n          prev.map((m) =>\r\n            String(m._id) === String(data._id)\r\n              ? {\r\n                  ...m,\r\n                  content: data.content,\r\n                  editedAt: data.editedAt,\r\n                  originalContent: data.originalContent || m.originalContent || m.content,\r\n                  reminderAt: data.reminderAt ?? m.reminderAt,\r\n                  reminderNote: data.reminderNote ?? m.reminderNote,\r\n                }\r\n              : m,\r\n          ),\r\n        );\r\n        void load();\r\n      },\r\n    );\r\n\r\n    socket.on(\r\n      'edit_message',\r\n      (data: { _id: string; roomId: string; newContent: string; editedAt: number; originalContent?: string }) => {\r\n        if (data.roomId !== roomId) return;\r\n        setItems((prev) =>\r\n          prev.map((m) =>\r\n            String(m._id) === String(data._id)\r\n              ? {\r\n                  ...m,\r\n                  content: data.newContent,\r\n                  editedAt: data.editedAt,\r\n                  originalContent: data.originalContent || m.originalContent || m.content,\r\n                }\r\n              : m,\r\n          ),\r\n        );\r\n        void load();\r\n      },\r\n    );\r\n\r\n    socket.on('message_recalled', (data: { _id: string; roomId: string }) => {\r\n      if (data.roomId !== roomId) return;\r\n      setItems((prev) => prev.filter((m) => String(m._id) !== String(data._id)));\r\n      void load();\r\n    });\r\n\r\n    socket.on('message_deleted', (data: { _id: string; roomId: string }) => {\r\n      if (data.roomId !== roomId) return;\r\n      setItems((prev) => prev.filter((m) => String(m._id) !== String(data._id)));\r\n      void load();\r\n    });\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n    };\r\n  }, [roomId, load]);\r\n\r\n  const handleCreate = async ({\r\n    content,\r\n    dateTime,\r\n    note,\r\n    repeat,\r\n  }: {\r\n    content: string;\r\n    dateTime: string;\r\n    note?: string;\r\n    repeat?: 'none' | 'daily' | 'weekly' | 'monthly';\r\n  }) => {\r\n    setCreate(true);\r\n    const dt = Date.parse(dateTime);\r\n    if (!content.trim() || Number.isNaN(dt)) {\r\n      alert('Vui lòng nhập đầy đủ thông tin hợp lệ');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const createRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'reminder',\r\n        content: content.trim(),\r\n        timestamp: Date.now(),\r\n        reminderAt: dt,\r\n        reminderNote: note?.trim() || '',\r\n        reminderFired: false,\r\n        reminderRepeat: repeat || 'none',\r\n      });\r\n\r\n      if (createRes?.success) {\r\n        const socket = io(resolveSocketUrl(), {\r\n          transports: ['websocket'],\r\n          withCredentials: false,\r\n        });\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const sockBase = {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n        };\r\n\r\n        if (typeof createRes._id === 'string') {\r\n          socket.emit('send_message', {\r\n            ...sockBase,\r\n            _id: createRes._id,\r\n            type: 'reminder',\r\n            content: content.trim(),\r\n            timestamp: Date.now(),\r\n            reminderAt: dt,\r\n            reminderNote: note?.trim() || '',\r\n            reminderFired: false,\r\n            reminderRepeat: repeat || 'none',\r\n          });\r\n        }\r\n\r\n        const timeStr = new Date(dt).toLocaleString('vi-VN');\r\n        const myName = currentUser.name;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: `${myName} đã tạo lịch hẹn: \"${content.trim()}\" lúc ${timeStr}`,\r\n          timestamp: Date.now(),\r\n        });\r\n\r\n        if (notifyRes?.success && typeof notifyRes._id === 'string') {\r\n          socket.emit('send_message', {\r\n            ...sockBase,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: `${myName} đã tạo lịch hẹn: \"${content.trim()}\" lúc ${timeStr}`,\r\n            timestamp: Date.now(),\r\n          });\r\n        }\r\n        socket.disconnect();\r\n        await load();\r\n      } else {\r\n        alert('Tạo lịch hẹn thất bại. Vui lòng kiểm tra kết nối máy chủ.');\r\n      }\r\n      setCreate(false);\r\n    } catch (error) {\r\n      console.error('❌ Lỗi khi tạo lịch hẹn:', error);\r\n      alert('Không thể tạo lịch hẹn. Vui lòng thử lại.');\r\n    }\r\n\r\n    setShowCreate(false);\r\n  };\r\n\r\n  const handleDelete = async (item: Message) => {\r\n    const ok = confirm('Xóa vĩnh viễn lịch hẹn này?');\r\n    if (!ok) return;\r\n\r\n    try {\r\n      await deleteMessageApi(String(item._id));\r\n      const socket = io(resolveSocketUrl(), {\r\n        transports: ['websocket'],\r\n        withCredentials: false,\r\n      });\r\n      socket.emit('message_deleted', { _id: item._id, roomId });\r\n      socket.disconnect();\r\n      setOpenMenuId(null); // 🔥 Đóng menu sau khi xóa\r\n      await load();\r\n    } catch (error) {\r\n      console.error('❌ Lỗi khi xóa lịch hẹn:', error);\r\n      alert('Không thể xóa lịch hẹn. Vui lòng thử lại.');\r\n    }\r\n  };\r\n\r\n  const handleEdit = (item: Message) => {\r\n    setDetailMsg(item);\r\n    setOpenMenuId(null); // 🔥 Đóng menu khi mở modal edit\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"relative flex flex-col h-full bg-gray-50 overflow-hidden\">\r\n        {!embedded && (\r\n          <div className=\"bg-blue-400 text-white p-3 flex items-center justify-between shadow-lg\">\r\n            <h2 className=\"text-lg font-semibold\">Danh sách lịch hẹn</h2>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => setShowCreate(true)}\r\n                className=\"px-3 py-2 cursor-pointer rounded-xl bg-white/20 hover:bg-white/30 transition-all duration-200 flex items-center gap-2\"\r\n              >\r\n                <FaRegClock />\r\n              </button>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 cursor-pointer rounded-full hover:bg-white/20 transition-all duration-200\"\r\n              >\r\n                <HiX className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300\">\r\n          <div className=\"space-y-5 p-5\">\r\n            {loading ? (\r\n              <div className=\"text-center text-gray-500 py-10\">\r\n                <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent\"></div>\r\n                <p className=\"mt-2\">Đang tải...</p>\r\n              </div>\r\n            ) : items.length === 0 ? (\r\n              <>\r\n                <div className=\"flex items-center justify-center\">\r\n                  <IoCalendarOutline className=\"w-[8.125rem] h-[8.125rem] text-blue-300\" />\r\n                </div>\r\n                <p className=\"text-center text-sm text-gray-500\">\r\n                  Chưa có lịch hẹn nào được chia sẻ trong cuộc hội thoại này\r\n                </p>\r\n                <div className=\"flex items-center justify-center\">\r\n                  <button\r\n                    onClick={() => setShowCreate(true)}\r\n                    className=\"px-3 py-2 cursor-pointer hover:bg-blue-400 transition-all duration-200 flex items-center gap-2 bg-blue-300 rounded-lg \"\r\n                  >\r\n                    <FaRegClock /> Tạo lịch hẹn mới\r\n                  </button>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              items.map((it) => {\r\n                const itemId = String(it._id);\r\n                const at = typeof it.reminderAt === 'number' ? it.reminderAt : it.timestamp;\r\n                const timeStr = new Date(at).toLocaleString('vi-VN');\r\n                const sender = it.sender as User | string;\r\n                const senderName = typeof sender === 'object' && sender ? sender.name || '' : '';\r\n                const repeat =\r\n                  (it as Message & { reminderRepeat?: 'none' | 'daily' | 'weekly' | 'monthly' }).reminderRepeat ||\r\n                  'none';\r\n                const repeatLabel =\r\n                  repeat === 'daily'\r\n                    ? 'Hàng ngày'\r\n                    : repeat === 'weekly'\r\n                      ? 'Hàng tuần'\r\n                      : repeat === 'monthly'\r\n                        ? 'Hàng tháng'\r\n                        : 'Không lặp lại';\r\n                const isMenuOpen = openMenuId === itemId;\r\n\r\n                return (\r\n                  <div\r\n                    key={itemId}\r\n                    className=\"relative p-4 rounded-2xl bg-white border border-gray-100 shadow-sm hover:shadow-md transition-shadow\"\r\n                  >\r\n                    <div className=\"flex items-start justify-between gap-3\">\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className=\"text-base font-semibold text-gray-900 truncate\">{it.content || 'Lịch hẹn'}</p>\r\n                        <p className=\"text-sm text-gray-500 mt-1 flex items-center gap-1\">\r\n                          <FaRegClock className=\"w-3 h-3\" /> {timeStr}\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-500 mt-1\">Lặp: {repeatLabel}</p>\r\n                        {it.reminderNote ? (\r\n                          <p className=\"text-sm text-gray-600 mt-2 bg-gray-50 p-2 rounded-lg truncate\">\r\n                            {String(it.reminderNote)}\r\n                          </p>\r\n                        ) : null}\r\n                        {senderName ? <p className=\"text-xs text-gray-400 mt-2\">Tạo bởi {senderName}</p> : null}\r\n                      </div>\r\n\r\n                      {/* 🔥 MENU BUTTON */}\r\n                      <div\r\n                        className=\"relative\"\r\n                        ref={(el) => {\r\n                          if (el) menuRefs.current.set(itemId, el);\r\n                          else menuRefs.current.delete(itemId);\r\n                        }}\r\n                      >\r\n                        <button\r\n                          onClick={() => setOpenMenuId(isMenuOpen ? null : itemId)}\r\n                          className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer\"\r\n                          aria-label=\"Mở menu\"\r\n                          title=\"Thêm\"\r\n                        >\r\n                          <HiEllipsisVertical className=\"w-5 h-5 text-gray-600\" />\r\n                        </button>\r\n\r\n                        {/* 🔥 DROPDOWN MENU */}\r\n                        {isMenuOpen && (\r\n                          <div className=\"absolute right-0 top-full mt-1 w-40 bg-white rounded-xl shadow-lg border border-gray-200 py-1 z-10 animate-in fade-in slide-in-from-top-2 duration-200\">\r\n                            <button\r\n                              onClick={() => handleEdit(it)}\r\n                              className=\"w-full px-4 py-2.5 text-left text-sm text-gray-700 hover:bg-gray-50 transition-colors cursor-pointer flex items-center gap-2\"\r\n                            >\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path\r\n                                  strokeLinecap=\"round\"\r\n                                  strokeLinejoin=\"round\"\r\n                                  strokeWidth={2}\r\n                                  d=\"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                                />\r\n                              </svg>\r\n                              Xem chi tiết\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleEdit(it)}\r\n                              className=\"w-full px-4 py-2.5 text-left text-sm text-blue-600 hover:bg-blue-50 transition-colors cursor-pointer flex items-center gap-2\"\r\n                            >\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path\r\n                                  strokeLinecap=\"round\"\r\n                                  strokeLinejoin=\"round\"\r\n                                  strokeWidth={2}\r\n                                  d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"\r\n                                />\r\n                              </svg>\r\n                              Chỉnh sửa\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleDelete(it)}\r\n                              className=\"w-full px-4 py-2.5 text-left text-sm text-red-600 hover:bg-red-50 transition-colors cursor-pointer flex items-center gap-2\"\r\n                            >\r\n                              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path\r\n                                  strokeLinecap=\"round\"\r\n                                  strokeLinejoin=\"round\"\r\n                                  strokeWidth={2}\r\n                                  d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\r\n                                />\r\n                              </svg>\r\n                              Xóa\r\n                            </button>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })\r\n            )}\r\n          </div>\r\n        </div>\r\n        <CreateReminderModal\r\n          isOpen={showCreate}\r\n          onClose={() => setShowCreate(false)}\r\n          onCreate={handleCreate}\r\n          createLoading={create}\r\n        />\r\n        <ReminderDetailModal\r\n          isOpen={!!detailMsg}\r\n          message={detailMsg}\r\n          onClose={() => setDetailMsg(null)}\r\n          onRefresh={load}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3406, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/CreatePollModal.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { useEffect, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { HiX } from 'react-icons/hi';\r\nimport { HiCheck } from 'react-icons/hi2';\r\n\r\ninterface CreatePollModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onCreate: (payload: {\r\n    question: string;\r\n    options: string[];\r\n    pollAllowMultiple?: boolean;\r\n    pollAllowAddOptions?: boolean;\r\n    pollHideVoters?: boolean;\r\n    pollHideResultsUntilVote?: boolean;\r\n    pollEndAt?: number | null;\r\n  }) => Promise<void> | void;\r\n}\r\n\r\nexport default function CreatePollModal({ isOpen, onClose, onCreate }: CreatePollModalProps) {\r\n  const [question, setQuestion] = useState('');\r\n  const [options, setOptions] = useState<string[]>(['', '']);\r\n  const [saving, setSaving] = useState(false);\r\n  const maxOptions = 10;\r\n  const isDesktop = typeof window !== 'undefined' && window.matchMedia('(min-width: 768px)').matches;\r\n  const [allowMultiple, setAllowMultiple] = useState(true);\r\n  const [allowAddOptions, setAllowAddOptions] = useState(true);\r\n  const [hideVoters, setHideVoters] = useState(false);\r\n  const [hideResultsUntilVote, setHideResultsUntilVote] = useState(false);\r\n  const [endAt, setEndAt] = useState<number | null>(null);\r\n  const [deadlineOpen, setDeadlineOpen] = useState(false);\r\n  const [deadlineMode, setDeadlineMode] = useState<'none' | 'time'>(endAt ? 'time' : 'none');\r\n  const [deadlineInput, setDeadlineInput] = useState<string>('');\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleAddOption = () => {\r\n    setOptions((prev) => (prev.length >= maxOptions ? prev : [...prev, '']));\r\n  };\r\n\r\n  const handleChangeOption = (index: number, value: string) => {\r\n    setOptions((prev) => prev.map((o, i) => (i === index ? value : o)));\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    const trimmedQuestion = question.trim();\r\n    const raw = options.map((o) => o.trim()).filter((o) => o);\r\n    const lowerSet = Array.from(new Set(raw.map((o) => o.toLowerCase())));\r\n    const unique = lowerSet.map((lo) => raw.find((x) => x.toLowerCase() === lo) as string);\r\n    if (!trimmedQuestion || unique.length < 2) return;\r\n    setSaving(true);\r\n    try {\r\n      await onCreate({\r\n        question: trimmedQuestion,\r\n        options: unique,\r\n        pollAllowMultiple: allowMultiple,\r\n        pollAllowAddOptions: allowAddOptions,\r\n        pollHideVoters: hideVoters,\r\n        pollHideResultsUntilVote: hideResultsUntilVote,\r\n        pollEndAt: endAt ?? null,\r\n      });\r\n      setQuestion('');\r\n      setOptions(['', '']);\r\n      setAllowMultiple(true);\r\n      setAllowAddOptions(true);\r\n      setHideVoters(false);\r\n      setHideResultsUntilVote(false);\r\n      setEndAt(null);\r\n      setDeadlineMode('none');\r\n      setDeadlineInput('');\r\n      setDeadlineOpen(false);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n  const modalNode = (\r\n    <div\r\n      className={`${isDesktop ? 'absolute inset-0' : 'fixed inset-0'} z-[50] flex items-stretch justify-center ${\r\n        isDesktop ? 'bg-black/20' : 'bg-black/50'\r\n      } backdrop-blur-sm`}\r\n    >\r\n      <div className=\"bg-white w-full h-full rounded-none overflow-hidden flex flex-col\">\r\n        <div className=\" px-4 pt-3 pb-2  text-black bg-gray-50 flex-shrink-0 border-b border-gray-200\">\r\n          <div className=\"flex gap-3 items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <button onClick={onClose} disabled={saving} className=\" cursor-pointer  \">\r\n                <HiX className=\"w-5 h-5\" />\r\n              </button>\r\n              <div className=\"flex items-center gap-3 \">\r\n                <h3 className=\"text-xl \">Tạo bình chọn</h3>\r\n              </div>\r\n            </div>\r\n\r\n            <button\r\n              onClick={handleSubmit}\r\n              disabled={\r\n                saving ||\r\n                !question.trim() ||\r\n                new Set(\r\n                  options\r\n                    .map((o) => o.trim())\r\n                    .filter((o) => o)\r\n                    .map((o) => o.toLowerCase()),\r\n                ).size < 2\r\n              }\r\n              className=\" cursor-pointer hover:text-blue-700 text-blue-500 font-semibold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              <span className=\" justify-end gap-2\">{saving ? 'Đang tạo...' : 'Tạo'}</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div className=\"px-4 py-4 space-y-4 flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100\">\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Câu hỏi *</label>\r\n          <textarea\r\n            value={question}\r\n            onChange={(e) => setQuestion(e.target.value)}\r\n            rows={3}\r\n            placeholder=\"Đặt câu hỏi bình chọn\"\r\n            className=\"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:bg-white\"\r\n          />\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tùy chọn *</label>\r\n          <div className=\"space-y-2\">\r\n            {options.map((opt, idx) => (\r\n              <input\r\n                placeholder={`Phương án ${idx + 1}`}\r\n                key={idx}\r\n                type=\"text\"\r\n                value={opt}\r\n                onChange={(e) => handleChangeOption(idx, e.target.value)}\r\n                className=\"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:bg-white\"\r\n              />\r\n            ))}\r\n          </div>\r\n          <div className=\"\">\r\n            <button\r\n              onClick={handleAddOption}\r\n              disabled={options.length >= maxOptions}\r\n              className=\"cursor-pointer px-4 py-2 mb-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              Thêm lựa chọn\r\n            </button>\r\n            <p className=\"text-xs px-4 text-gray-500\">Cần tối thiểu 2 lựa chọn. Tối đa {maxOptions} lựa chọn.</p>\r\n          </div>\r\n          {(() => {\r\n            const raw = options.map((o) => o.trim()).filter((o) => o);\r\n            const uniqueCount = new Set(raw.map((o) => o.toLowerCase())).size;\r\n            const notEnough = uniqueCount < 2;\r\n            const hasDup = uniqueCount !== raw.length;\r\n            return (\r\n              <>\r\n                {notEnough && <p className=\"text-xs px-4 text-gray-500\">Cần ít nhất 2 lựa chọn hợp lệ</p>}\r\n                {hasDup && <p className=\"text-xs px-4 text-gray-500\">Các lựa chọn trùng lặp sẽ được tự loại bỏ</p>}\r\n              </>\r\n            );\r\n          })()}\r\n\r\n          <div className=\"mt-4 pt-4 border-t border-gray-200 space-y-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-700\">Đặt thời hạn</p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {endAt ? new Date(endAt).toLocaleString('vi-VN') : 'Không có thời hạn'}\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={() => {\r\n                  setDeadlineOpen(true);\r\n                  setDeadlineMode(endAt ? 'time' : 'none');\r\n                  setDeadlineInput(\r\n                    endAt\r\n                      ? new Date(endAt).toISOString().slice(0, 16)\r\n                      : new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString().slice(0, 16),\r\n                  );\r\n                }}\r\n                className=\"cursor-pointer px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-xl text-sm font-semibold\"\r\n              >\r\n                Thiết lập\r\n              </button>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm text-gray-700\">Ẩn người bình chọn</span>\r\n              <button\r\n                onClick={() => setHideVoters((v) => !v)}\r\n                className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                  hideVoters ? 'bg-blue-600' : 'bg-gray-300'\r\n                }`}\r\n                aria-pressed={hideVoters}\r\n              >\r\n                <span\r\n                  className={`block ml-0.5  w-5 h-5 bg-white rounded-full transform transition ${\r\n                    hideVoters ? 'translate-x-6' : 'translate-x-0'\r\n                  }`}\r\n                />\r\n              </button>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm text-gray-700\">Ẩn kết quả khi chưa bình chọn</span>\r\n              <button\r\n                onClick={() => setHideResultsUntilVote((v) => !v)}\r\n                className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                  hideResultsUntilVote ? 'bg-blue-600' : 'bg-gray-300'\r\n                }`}\r\n                aria-pressed={hideResultsUntilVote}\r\n              >\r\n                <span\r\n                  className={`block ml-0.5 w-5 h-5 bg-white rounded-full transform transition ${\r\n                    hideResultsUntilVote ? 'translate-x-6' : 'translate-x-0'\r\n                  }`}\r\n                />\r\n              </button>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm text-gray-700\">Chọn nhiều phương án</span>\r\n              <button\r\n                onClick={() => setAllowMultiple((v) => !v)}\r\n                className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                  allowMultiple ? 'bg-blue-600' : 'bg-gray-300'\r\n                }`}\r\n                aria-pressed={allowMultiple}\r\n              >\r\n                <span\r\n                  className={`block ml-0.5 w-5 h-5 bg-white rounded-full transform transition ${\r\n                    allowMultiple ? 'translate-x-6' : 'translate-x-0'\r\n                  }`}\r\n                />\r\n              </button>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm text-gray-700\">Có thể thêm phương án</span>\r\n              <button\r\n                onClick={() => setAllowAddOptions((v) => !v)}\r\n                className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                  allowAddOptions ? 'bg-blue-600' : 'bg-gray-300'\r\n                }`}\r\n                aria-pressed={allowAddOptions}\r\n              >\r\n                <span\r\n                  className={`block ml-0.5 w-5 h-5 bg-white rounded-full transform transition ${\r\n                    allowAddOptions ? 'translate-x-6' : 'translate-x-0'\r\n                  }`}\r\n                />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        {deadlineOpen && (\r\n          <>\r\n            <div className=\"absolute inset-0 bg-black/10\" onClick={() => setDeadlineOpen(false)} />\r\n            <div className=\"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl border-t border-gray-200 p-4\">\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <p className=\"text-sm font-medium text-gray-800\">Đặt thời hạn</p>\r\n                <button onClick={() => setDeadlineOpen(false)} className=\"cursor-pointer text-gray-500\">\r\n                  <HiX className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n              <div className=\"space-y-3\">\r\n                <label className=\"cursor-pointer flex items-center gap-2 text-sm\">\r\n                  <input type=\"radio\" checked={deadlineMode === 'none'} onChange={() => setDeadlineMode('none')} />\r\n                  Không giới hạn thời gian\r\n                </label>\r\n                <label className=\"cursor-pointer flex items-center gap-2 text-sm\">\r\n                  <input type=\"radio\" checked={deadlineMode === 'time'} onChange={() => setDeadlineMode('time')} />\r\n                  Chọn thời điểm kết thúc\r\n                </label>\r\n                {deadlineMode === 'time' && (\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    value={deadlineInput}\r\n                    onChange={(e) => setDeadlineInput(e.target.value)}\r\n                    className=\"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-xl\"\r\n                  />\r\n                )}\r\n                <div className=\"flex gap-3 pt-2\">\r\n                  <button\r\n                    onClick={() => {\r\n                      if (deadlineMode === 'none') {\r\n                        setEndAt(null);\r\n                        setDeadlineOpen(false);\r\n                        return;\r\n                      }\r\n                      const dt = Date.parse(deadlineInput);\r\n                      if (!Number.isNaN(dt)) {\r\n                        setEndAt(dt);\r\n                        setDeadlineOpen(false);\r\n                      }\r\n                    }}\r\n                    className=\"flex-1 cursor-pointer py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold text-sm\"\r\n                  >\r\n                    Xong\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setDeadlineOpen(false)}\r\n                    className=\"flex-1 cursor-pointer py-2 bg-gray-100 hover:bg-gray-200 rounded-xl font-semibold text-sm\"\r\n                  >\r\n                    Hủy\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n  const target =\r\n    isDesktop && typeof document !== 'undefined' ? document.getElementById('right-sidebar-container') : null;\r\n  return isDesktop && target ? createPortal(modalNode, target) : modalNode;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4030, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/PollDetailModal.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { useEffect, useMemo, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { HiX } from 'react-icons/hi';\r\nimport {\r\n  HiCheck,\r\n  HiOutlinePencil,\r\n  HiEllipsisVertical,\r\n  HiListBullet,\r\n  HiUser,\r\n  HiEyeSlash,\r\n  HiCheckCircle,\r\n  HiPlus,\r\n  HiLockClosed,\r\n} from 'react-icons/hi2';\r\nimport type { Message } from '@/types/Message';\r\nimport type { GroupConversation } from '@/types/Group';\r\nimport type { User } from '@/types/User';\r\nimport { updateMessageApi, createMessageApi } from '@/fetch/messages';\r\nimport { useChatContext } from '@/context/ChatContext';\r\nimport { io } from 'socket.io-client';\r\nimport { resolveSocketUrl } from '@/utils/utils';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport Image from 'next/image';\r\nimport ICTrash from '@/components/svg/ICTrash';\r\n\r\ninterface PollDetailModalProps {\r\n  isOpen: boolean;\r\n  message: Message | null;\r\n  onClose: () => void;\r\n  onRefresh?: () => void;\r\n}\r\n\r\nexport default function PollDetailModal({ isOpen, message, onClose, onRefresh }: PollDetailModalProps) {\r\n  const { selectedChat, currentUser, isGroup } = useChatContext();\r\n  const roomId = (() => {\r\n    const me = String(currentUser._id);\r\n    const other = String((selectedChat as unknown as { _id: string })._id);\r\n    return isGroup ? other : [me, other].sort().join('_');\r\n  })();\r\n  const [question, setQuestion] = useState('');\r\n  const [options, setOptions] = useState<string[]>([]);\r\n  const [editing, setEditing] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const myId = String(currentUser._id);\r\n  const isDesktop = typeof window !== 'undefined' && window.matchMedia('(min-width: 768px)').matches;\r\n  const votesMap = useMemo(() => (message?.pollVotes || {}) as Record<string, string[]>, [message]);\r\n  const mySelected = useMemo(() => {\r\n    const arr: string[] = [];\r\n    (message?.pollOptions || []).forEach((opt) => {\r\n      const vs = Array.isArray(votesMap[opt]) ? (votesMap[opt] as string[]) : [];\r\n      if (vs.includes(myId)) arr.push(opt);\r\n    });\r\n    return arr;\r\n  }, [votesMap, message, myId]);\r\n  const [selected, setSelected] = useState<string[]>([]);\r\n  const [adding, setAdding] = useState(false);\r\n  const [newOption, setNewOption] = useState('');\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const [showVotersPanel, setShowVotersPanel] = useState(false);\r\n  const [activeTab, setActiveTab] = useState<string>('');\r\n\r\n  const [allowMultiple, setAllowMultiple] = useState(false);\r\n  const [allowAddOptions, setAllowAddOptions] = useState(false);\r\n  const [hideVoters, setHideVoters] = useState(false);\r\n  const [hideResultsUntilVote, setHideResultsUntilVote] = useState(false);\r\n  const [editEndAt, setEditEndAt] = useState<number | null>(null);\r\n  const [deadlineOpen, setDeadlineOpen] = useState(false);\r\n  const [deadlineMode, setDeadlineMode] = useState<'none' | 'time'>('none');\r\n  const [deadlineInput, setDeadlineInput] = useState<string>('');\r\n\r\n  const canLock = useMemo(() => {\r\n    if (!message) return false;\r\n    const sender = message.sender as User | string;\r\n    const senderId = typeof sender === 'object' && sender ? String(sender._id) : String(sender);\r\n    return senderId === String(currentUser._id);\r\n  }, [message, currentUser._id]);\r\n  const endAt = useMemo(() => (message?.pollEndAt ? Number(message.pollEndAt) : null), [message]);\r\n  const isEnded = useMemo(() => (endAt ? Date.now() >= endAt : false), [endAt]);\r\n  const isLocked = useMemo(() => !!(message?.isPollLocked || isEnded), [message?.isPollLocked, isEnded]);\r\n  const members = useMemo(\r\n    () => (isGroup ? (selectedChat as GroupConversation).members || [] : []),\r\n    [isGroup, selectedChat],\r\n  );\r\n  const memberMap = useMemo(() => {\r\n    const map = new Map<string, { name?: string; avatar?: string }>();\r\n    (members as Array<{ _id?: string; id?: string; name?: string; avatar?: string }>).forEach((m) => {\r\n      const id = String(m._id || m.id || '');\r\n      if (id) map.set(id, { name: m.name, avatar: m.avatar });\r\n    });\r\n    return map;\r\n  }, [members]);\r\n\r\n  useEffect(() => {\r\n    if (!message) return;\r\n    const q = String(message.content || message.pollQuestion || '');\r\n    const opts = Array.isArray(message.pollOptions) ? (message.pollOptions as string[]) : [];\r\n    setQuestion(q);\r\n    setOptions(opts);\r\n    setEditing(false);\r\n    setSelected(mySelected);\r\n    setAdding(false);\r\n    setNewOption('');\r\n\r\n    setAllowMultiple(!!message.pollAllowMultiple);\r\n    setAllowAddOptions(!!message.pollAllowAddOptions);\r\n    setHideVoters(!!message.pollHideVoters);\r\n    setHideResultsUntilVote(!!message.pollHideResultsUntilVote);\r\n    setEditEndAt(message.pollEndAt ? Number(message.pollEndAt) : null);\r\n  }, [message, mySelected]);\r\n\r\n  const handleAddOption = () => {\r\n    setAdding(true);\r\n  };\r\n\r\n  const handleAddOptionEditing = () => {\r\n    setOptions((prev) => [...prev, '']);\r\n  };\r\n\r\n  const handleRemoveOptionEditing = (index: number) => {\r\n    setOptions((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleChangeOption = (index: number, value: string) => {\r\n    setOptions((prev) => prev.map((o, i) => (i === index ? value : o)));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!message) return;\r\n    if (!canLock) return;\r\n    const cleanOptions = options.map((o) => o.trim()).filter((o) => o);\r\n    if (!question.trim() || cleanOptions.length < 2) return;\r\n    setSaving(true);\r\n    try {\r\n      const now = Date.now();\r\n      const prevVotes = (message.pollVotes || {}) as Record<string, string[]>;\r\n      const nextVotes: Record<string, string[]> = {};\r\n      cleanOptions.forEach((opt) => {\r\n        const arr = Array.isArray(prevVotes[opt]) ? prevVotes[opt] : [];\r\n        nextVotes[opt] = arr;\r\n      });\r\n\r\n      const updatePayload = {\r\n        content: question.trim(),\r\n        pollQuestion: question.trim(),\r\n        pollOptions: cleanOptions,\r\n        pollVotes: nextVotes,\r\n        pollAllowMultiple: allowMultiple,\r\n        pollAllowAddOptions: allowAddOptions,\r\n        pollHideVoters: hideVoters,\r\n        pollHideResultsUntilVote: hideResultsUntilVote,\r\n        pollEndAt: editEndAt,\r\n        editedAt: now,\r\n        timestamp: now,\r\n      };\r\n\r\n      await updateMessageApi(String(message._id), updatePayload);\r\n      const socket = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n      socket.once('connect', async () => {\r\n        socket.emit('join_room', roomId);\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        socket.emit('edit_message', {\r\n          _id: message._id,\r\n          roomId,\r\n          ...updatePayload,\r\n          originalContent: message.content,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          members,\r\n          receiver,\r\n        });\r\n        socket.emit('message_edited', {\r\n          _id: message._id,\r\n          roomId,\r\n          ...updatePayload,\r\n          originalContent: message.content,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          members,\r\n          receiver,\r\n        });\r\n        const who = currentUser.name || 'Ai đó';\r\n        const notifyText = `${who} đã chỉnh sửa bình chọn: \"${question.trim()}\"`;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(message._id),\r\n        });\r\n        if (notifyRes?.success) {\r\n          socket.emit('send_message', {\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            senderName: currentUser.name,\r\n            isGroup,\r\n            receiver,\r\n            members,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: notifyText,\r\n            timestamp: now,\r\n            replyToMessageId: String(message._id),\r\n          });\r\n        }\r\n        setTimeout(() => socket.disconnect(), 300);\r\n      });\r\n      if (onRefresh) {\r\n        await onRefresh();\r\n      }\r\n      onClose();\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const toggleSelect = (opt: string) => {\r\n    if (isLocked) return;\r\n    const allowMultiple = !!message?.pollAllowMultiple;\r\n    setSelected((prev) => {\r\n      const has = prev.includes(opt);\r\n      if (allowMultiple) return has ? prev.filter((o) => o !== opt) : [...prev, opt];\r\n      return has ? [] : [opt];\r\n    });\r\n  };\r\n\r\n  const previewVotesMap = useMemo(() => {\r\n    const out: Record<string, string[]> = {};\r\n    (message?.pollOptions || []).forEach((opt) => {\r\n      const base = Array.isArray(votesMap[opt]) ? [...(votesMap[opt] as string[])] : [];\r\n      const withoutMe = base.filter((u) => u !== myId);\r\n      const nowSelected = selected.includes(opt);\r\n      out[opt] = nowSelected ? [...withoutMe, myId] : withoutMe;\r\n    });\r\n    return out;\r\n  }, [message, votesMap, selected, myId]);\r\n  const votersSet = useMemo(() => {\r\n    const s = new Set<string>();\r\n    (message?.pollOptions || []).forEach((opt) => {\r\n      const arr = Array.isArray(previewVotesMap[opt]) ? (previewVotesMap[opt] as string[]) : [];\r\n      arr.forEach((id) => s.add(String(id)));\r\n    });\r\n    return s;\r\n  }, [message, previewVotesMap]);\r\n  const totalVotes = useMemo(() => {\r\n    let total = 0;\r\n    (message?.pollOptions || []).forEach((opt) => {\r\n      const arr = Array.isArray(previewVotesMap[opt]) ? (previewVotesMap[opt] as string[]) : [];\r\n      total += arr.length;\r\n    });\r\n    return total;\r\n  }, [message, previewVotesMap]);\r\n  const notVotedIds = useMemo(() => {\r\n    const s = new Set<string>();\r\n    (members as Array<{ _id?: string; id?: string }>).forEach((m) => {\r\n      const id = String(m._id || m.id || '');\r\n      if (id) s.add(id);\r\n    });\r\n    votersSet.forEach((id) => s.delete(id));\r\n    return Array.from(s);\r\n  }, [members, votersSet]);\r\n\r\n  const handleConfirmVote = async () => {\r\n    if (!message) return;\r\n    if (isLocked) return;\r\n    const prevVotes = (message.pollVotes || {}) as Record<string, string[]>;\r\n    const nextVotes: Record<string, string[]> = {};\r\n    (message.pollOptions || []).forEach((opt) => {\r\n      const arr = Array.isArray(prevVotes[opt]) ? [...prevVotes[opt]] : [];\r\n      const filtered = arr.filter((u) => u !== myId);\r\n      nextVotes[opt] = filtered;\r\n    });\r\n    selected.forEach((opt) => {\r\n      const arr = Array.isArray(nextVotes[opt]) ? nextVotes[opt] : [];\r\n      if (!arr.includes(myId)) nextVotes[opt] = [...arr, myId];\r\n    });\r\n    setSaving(true);\r\n    try {\r\n      const now = Date.now();\r\n      await updateMessageApi(String(message._id), { pollVotes: nextVotes, editedAt: now, timestamp: now });\r\n\r\n      // 🔥 EMIT SOCKET EVENT ĐỂ CẬP NHẬT REALTIME\r\n      const socket = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n      socket.once('connect', async () => {\r\n        socket.emit('join_room', roomId);\r\n        socket.emit('edit_message', {\r\n          _id: message._id,\r\n          roomId,\r\n          pollVotes: nextVotes,\r\n          editedAt: now,\r\n          timestamp: now,\r\n        });\r\n\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const who = message.pollHideVoters ? 'Một thành viên' : currentUser.name || 'Ai đó';\r\n        const opted = selected.join(', ');\r\n        const notifyText = `${who} đã bình chọn:  ${opted} trong bình chọn: \"${question}\"`;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: myId,\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(message._id),\r\n        });\r\n\r\n        if (notifyRes?.success) {\r\n          socket.emit('send_message', {\r\n            roomId,\r\n            sender: myId,\r\n            senderName: currentUser.name,\r\n            isGroup,\r\n            receiver,\r\n            members,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: notifyText,\r\n            timestamp: now,\r\n            replyToMessageId: String(message._id),\r\n          });\r\n        }\r\n        setTimeout(() => socket.disconnect(), 300);\r\n      });\r\n\r\n      if (onRefresh) {\r\n        await onRefresh();\r\n      }\r\n      onClose();\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleAddOptionConfirm = async () => {\r\n    if (!message) return;\r\n    if (isLocked) return;\r\n    const text = newOption.trim();\r\n    if (!text) return;\r\n    if (options.map((o) => o.toLowerCase()).includes(text.toLowerCase())) {\r\n      setAdding(false);\r\n      setNewOption('');\r\n      return;\r\n    }\r\n    const nextOptions = [...options, text];\r\n    setSaving(true);\r\n    try {\r\n      const now = Date.now();\r\n      await updateMessageApi(String(message._id), { pollOptions: nextOptions, editedAt: now, timestamp: now });\r\n      const socket = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n      socket.once('connect', async () => {\r\n        socket.emit('join_room', roomId);\r\n        socket.emit('edit_message', {\r\n          _id: message._id,\r\n          roomId,\r\n          pollOptions: nextOptions,\r\n          editedAt: now,\r\n          timestamp: now,\r\n        });\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const who = message.pollHideVoters ? 'Một thành viên' : currentUser.name || 'Ai đó';\r\n        const notifyText = `${who} đã thêm lựa chọn \"${text}\" trong bình chọn: \"${question}\"`;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(message._id),\r\n        });\r\n        if (notifyRes?.success) {\r\n          socket.emit('send_message', {\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            senderName: currentUser.name,\r\n            isGroup,\r\n            receiver,\r\n            members,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: notifyText,\r\n            timestamp: now,\r\n            replyToMessageId: String(message._id),\r\n          });\r\n        }\r\n        setTimeout(() => socket.disconnect(), 300);\r\n      });\r\n      if (onRefresh) {\r\n        await onRefresh();\r\n      }\r\n      setOptions(nextOptions);\r\n      setAdding(false);\r\n      setNewOption('');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleToggleLock = async () => {\r\n    if (!message || !canLock) return;\r\n    const currentlyLocked = message.isPollLocked || isEnded;\r\n    const nextLockedState = !currentlyLocked;\r\n    if (!nextLockedState && message.pollEndAt != null) return;\r\n\r\n    setSaving(true);\r\n    try {\r\n      const now = Date.now();\r\n      const updateData = nextLockedState\r\n        ? { isPollLocked: true, pollLockedAt: now, editedAt: now, timestamp: now }\r\n        : {\r\n            isPollLocked: false,\r\n            editedAt: now,\r\n            timestamp: now,\r\n          };\r\n\r\n      await updateMessageApi(String(message._id), updateData);\r\n      const socket = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n      socket.emit('edit_message', { _id: message._id, roomId, ...updateData });\r\n      const name = currentUser.name;\r\n\r\n      if (nextLockedState) {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members2 = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const endStr = new Date(now).toLocaleString('vi-VN');\r\n        const notifyText = `${name} đã khóa bình chọn: \"${String(message.content || message.pollQuestion || '')}\" (kết thúc lúc ${endStr})`;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(message._id),\r\n        });\r\n        if (notifyRes?.success) {\r\n          socket.emit('send_message', {\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            senderName: currentUser.name,\r\n            isGroup,\r\n            receiver,\r\n            members: members2,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: notifyText,\r\n            timestamp: now,\r\n            replyToMessageId: String(message._id),\r\n          });\r\n        }\r\n      } else {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members2 = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const notifyText = `${name} đã mở khóa bình chọn: \"${String(message.content || message.pollQuestion || '')}\"`;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(message._id),\r\n        });\r\n        if (notifyRes?.success) {\r\n          socket.emit('send_message', {\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            senderName: currentUser.name,\r\n            isGroup,\r\n            receiver,\r\n            members: members2,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: notifyText,\r\n            timestamp: now,\r\n            replyToMessageId: String(message._id),\r\n          });\r\n        }\r\n      }\r\n      socket.disconnect();\r\n      if (onRefresh) {\r\n        await onRefresh();\r\n      }\r\n      onClose();\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen || !message) return null;\r\n\r\n  const modalNode = (\r\n    <div\r\n      className={`${isDesktop ? 'absolute inset-0' : 'fixed inset-0'} z-[50] flex items-stretch justify-center ${\r\n        isDesktop ? 'bg-black/20' : 'bg-black/50'\r\n      } backdrop-blur-sm`}\r\n    >\r\n      <div className=\"bg-white w-full h-full rounded-none overflow-hidden flex flex-col relative\">\r\n        <div className=\"px-3 pt-3 pb-2 bg-white text-black border-b border-gray-200 relative\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center\">\r\n              <button onClick={onClose} disabled={saving} className=\"cursor-pointer p-2\">\r\n                <HiX className=\"w-5 h-5\" />\r\n              </button>\r\n              <div className=\"flex items-center gap-3\">\r\n                <h3 className=\"text-xl\">Bình chọn</h3>\r\n              </div>\r\n            </div>\r\n            <div className=\"relative\">\r\n              <button\r\n                onClick={() => setMenuOpen((v) => !v)}\r\n                className=\"p-2 rounded-xl hover:bg-gray-100 cursor-pointer\"\r\n              >\r\n                <HiEllipsisVertical className=\"w-5 h-5\" />\r\n              </button>\r\n              {menuOpen && (\r\n                <div className=\"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-2xl shadow-2xl z-[100]\">\r\n                  {canLock && !(message.pollEndAt != null && isEnded) && (\r\n                    <div className=\"\">\r\n                      <button\r\n                        onClick={() => {\r\n                          setMenuOpen(false);\r\n                          setEditing(true);\r\n                        }}\r\n                        className=\"w-full text-left px-4 py-2 hover:bg-gray-50 text-gray-800 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        Chỉnh sửa bình chọn\r\n                      </button>\r\n                      <button\r\n                        onClick={() => {\r\n                          setMenuOpen(false);\r\n                          handleToggleLock();\r\n                        }}\r\n                        className=\"w-full text-left px-4 py-2 hover:bg-gray-50 text-gray-800 cursor-pointer\"\r\n                      >\r\n                        {message.isPollLocked || isEnded ? 'Mở khóa bình chọn' : 'Khóa bình chọn'}\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"px-6 py-5 space-y-4 overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100\">\r\n          {(() => {\r\n            const showResults = !(message?.pollHideResultsUntilVote && mySelected.length === 0);\r\n            return !editing ? (\r\n              <>\r\n                <p className=\"text-[1rem] text-gray-800 whitespace-pre-wrap break-words\">{question}</p>\r\n                {isLocked && (\r\n                  <p className=\"text-[1rem] text-gray-500 mt-1\">\r\n                    Kết thúc lúc{' '}\r\n                    {new Date(endAt || message.pollLockedAt || message.editedAt || message.timestamp).toLocaleString(\r\n                      'vi-VN',\r\n                    )}\r\n                  </p>\r\n                )}\r\n                <p className=\"text-sm text-gray-500 mt-2 space-y-2\">\r\n                  <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                    {message.pollAllowMultiple ? (\r\n                      <>\r\n                        <HiListBullet className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                        <span>Chọn nhiều phương án</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <HiCheckCircle className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                        <span>Chọn 1 phương án</span>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                  {message.pollHideVoters && (\r\n                    <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                      <HiEyeSlash className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                      <span>Ẩn người bình chọn</span>\r\n                    </div>\r\n                  )}\r\n                  {message.pollAllowAddOptions && (\r\n                    <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                      <HiPlus className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                      <span>Cho phép thêm phương án</span>\r\n                    </div>\r\n                  )}\r\n                  {message.pollHideResultsUntilVote && (\r\n                    <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                      <HiLockClosed className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                      <span>Ẩn kết quả khi chưa bình chọn</span>\r\n                    </div>\r\n                  )}\r\n                </p>\r\n                <div className=\"border-t border-gray-200\" />\r\n                {message?.pollHideVoters || !showResults ? null : (\r\n                  <button\r\n                    onClick={() => setShowVotersPanel(true)}\r\n                    className=\"cursor-pointer text-sm text-blue-600 hover:underline mt-2\"\r\n                  >\r\n                    {`${votersSet.size} người đã bình chọn`}\r\n                  </button>\r\n                )}\r\n                {!showResults && <p className=\"text-sm text-gray-500 mt-2\">Bình chọn để xem kết quả</p>}\r\n                <div className=\"space-y-2 mt-2\">\r\n                  {options.map((opt, idx) => {\r\n                    const votedCount = Array.isArray(previewVotesMap[opt])\r\n                      ? (previewVotesMap[opt] as string[]).length\r\n                      : 0;\r\n                    const active = selected.includes(opt);\r\n                    const arr = Array.isArray(previewVotesMap[opt]) ? (previewVotesMap[opt] as string[]) : [];\r\n                    const lastUid = arr.length ? String(arr[arr.length - 1]) : '';\r\n                    const lastInfo = lastUid ? memberMap.get(lastUid) : undefined;\r\n                    // const showResults = ... (already defined in outer scope)\r\n                    const percent = showResults && totalVotes > 0 ? (votedCount / totalVotes) * 100 : 0;\r\n\r\n                    return (\r\n                      <button\r\n                        key={idx}\r\n                        onClick={() => toggleSelect(opt)}\r\n                        disabled={isLocked}\r\n                        className={`w-full cursor-pointer relative bg-gray-100 overflow-hidden px-4 py-3 rounded-xl  text-left transition-colors ${isLocked ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                      >\r\n                        <div\r\n                          className={`absolute top-0 left-0 bottom-0 transition-all duration-500 ease-out ${active ? 'bg-blue-200' : 'bg-blue-200'}`}\r\n                          style={{ width: `${percent}%` }}\r\n                        />\r\n                        <div className=\"flex items-center gap-3 relative z-10 w-full\">\r\n                          <span\r\n                            className={`inline-flex items-center justify-center w-5 h-5 rounded-full border ${\r\n                              active ? 'bg-blue-600 text-white border-blue-600' : 'border-gray-400'\r\n                            }`}\r\n                          >\r\n                            {active && <HiCheck className=\"w-3 h-3\" />}\r\n                          </span>\r\n                          <span className=\"flex-1 min-w-0 text-[1rem] leading-relaxed break-words whitespace-pre-wrap\">\r\n                            {opt}\r\n                          </span>\r\n                          {showResults && (\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <span className=\"text-xs text-gray-500\">{votedCount}</span>\r\n                              {!message?.pollHideVoters && lastUid ? (\r\n                                lastInfo?.avatar ? (\r\n                                  <div\r\n                                    className=\"w-6 h-6 rounded-full border-2 border-white overflow-hidden bg-gray-200\"\r\n                                    title={lastInfo?.name}\r\n                                  >\r\n                                    <Image\r\n                                      src={getProxyUrl(lastInfo.avatar)}\r\n                                      alt=\"\"\r\n                                      width={24}\r\n                                      height={24}\r\n                                      className=\"w-full h-full object-cover\"\r\n                                    />\r\n                                  </div>\r\n                                ) : (\r\n                                  <div\r\n                                    title={lastInfo?.name}\r\n                                    className=\"w-6 h-6 rounded-full border-2 border-white bg-blue-500 text-white flex items-center justify-center font-bold text-[10px]\"\r\n                                  >\r\n                                    <Image\r\n                                      src=\"/logo/avata.webp\"\r\n                                      alt=\"\"\r\n                                      width={64}\r\n                                      height={64}\r\n                                      className=\"w-full h-full object-cover\"\r\n                                    />\r\n                                  </div>\r\n                                )\r\n                              ) : null}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n                <div className=\"mt-3\">\r\n                  {!adding ? (\r\n                    message?.pollAllowAddOptions && !isLocked ? (\r\n                      <button\r\n                        onClick={handleAddOption}\r\n                        className=\"cursor-pointer px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-xl font-semibold text-sm\"\r\n                      >\r\n                        + Thêm phương án\r\n                      </button>\r\n                    ) : null\r\n                  ) : (\r\n                    <div className=\"flex gap-2\">\r\n                      <input\r\n                        value={newOption}\r\n                        onChange={(e) => setNewOption(e.target.value)}\r\n                        onKeyDown={(e) => {\r\n                          if (e.key === 'Enter') {\r\n                            e.preventDefault();\r\n                            handleAddOptionConfirm();\r\n                          }\r\n                        }}\r\n                        className=\"flex-1 px-3 py-2 bg-gray-50 outline-none border-2 border-gray-200 rounded-2xl\"\r\n                        placeholder=\"Nhập lựa chọn\"\r\n                      />\r\n                      <button\r\n                        onClick={handleAddOptionConfirm}\r\n                        disabled={isLocked}\r\n                        className=\"px-2 py-2 cursor-pointer bg-blue-600 text-white rounded-2xl disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        +\r\n                      </button>\r\n                      <button\r\n                        onClick={() => {\r\n                          setAdding(false);\r\n                          setNewOption('');\r\n                        }}\r\n                        className=\"px-2 py-2 text-red-600 cursor-pointer bg-red-50 rounded-2xl\"\r\n                      >\r\n                        <ICTrash className=\"text-red-600\" />\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Câu hỏi *</label>\r\n                <textarea\r\n                  value={question}\r\n                  onChange={(e) => setQuestion(e.target.value)}\r\n                  rows={3}\r\n                  className=\"w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-blue-500 focus:bg-white\"\r\n                />\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Tùy chọn *</label>\r\n                <div className=\"space-y-2\">\r\n                  {options.map((opt, idx) => (\r\n                    <div key={idx} className=\"flex items-center gap-2\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={opt}\r\n                        onChange={(e) => handleChangeOption(idx, e.target.value)}\r\n                        className=\"flex-1 px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-blue-500 focus:bg-white\"\r\n                      />\r\n                      <button\r\n                        onClick={() => handleRemoveOptionEditing(idx)}\r\n                        className=\"px-3 py-2 cursor-pointer  text-red-600  disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        <ICTrash className=\"w-10 h-10\" />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n\r\n                <button\r\n                  onClick={handleAddOptionEditing}\r\n                  className=\"cursor-pointer px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-xl font-semibold text-sm\"\r\n                >\r\n                  + Thêm lựa chọn\r\n                </button>\r\n\r\n                {/* <div className=\"mt-4 pt-4 border-t border-gray-200 space-y-3\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm font-medium text-gray-700\">Đặt thời hạn</p>\r\n                      <p className=\"text-xs text-gray-500\">\r\n                        {editEndAt ? new Date(editEndAt).toLocaleString('vi-VN') : 'Không có thời hạn'}\r\n                      </p>\r\n                    </div>\r\n                    <button\r\n                      onClick={() => {\r\n                        setDeadlineOpen(true);\r\n                        setDeadlineMode(editEndAt ? 'time' : 'none');\r\n                        setDeadlineInput(\r\n                          editEndAt\r\n                            ? new Date(editEndAt).toISOString().slice(0, 16)\r\n                            : new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString().slice(0, 16),\r\n                        );\r\n                      }}\r\n                      className=\"cursor-pointer px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-xl text-sm font-semibold\"\r\n                    >\r\n                      Thiết lập\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-700\">Ẩn người bình chọn</span>\r\n                    <button\r\n                      onClick={() => setHideVoters((v) => !v)}\r\n                      className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                        hideVoters ? 'bg-blue-600' : 'bg-gray-300'\r\n                      }`}\r\n                      aria-pressed={hideVoters}\r\n                    >\r\n                      <span\r\n                        className={`block w-6 h-6 bg-white rounded-full transform transition ${\r\n                          hideVoters ? 'translate-x-6' : 'translate-x-0'\r\n                        }`}\r\n                      />\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-700\">Ẩn kết quả khi chưa bình chọn</span>\r\n                    <button\r\n                      onClick={() => setHideResultsUntilVote((v) => !v)}\r\n                      className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                        hideResultsUntilVote ? 'bg-blue-600' : 'bg-gray-300'\r\n                      }`}\r\n                      aria-pressed={hideResultsUntilVote}\r\n                    >\r\n                      <span\r\n                        className={`block w-6 h-6 bg-white rounded-full transform transition ${\r\n                          hideResultsUntilVote ? 'translate-x-6' : 'translate-x-0'\r\n                        }`}\r\n                      />\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-700\">Chọn nhiều phương án</span>\r\n                    <button\r\n                      onClick={() => setAllowMultiple((v) => !v)}\r\n                      className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                        allowMultiple ? 'bg-blue-600' : 'bg-gray-300'\r\n                      }`}\r\n                      aria-pressed={allowMultiple}\r\n                    >\r\n                      <span\r\n                        className={`block w-6 h-6 bg-white rounded-full transform transition ${\r\n                          allowMultiple ? 'translate-x-6' : 'translate-x-0'\r\n                        }`}\r\n                      />\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-700\">Có thể thêm phương án</span>\r\n                    <button\r\n                      onClick={() => setAllowAddOptions((v) => !v)}\r\n                      className={`cursor-pointer w-12 h-6 rounded-full transition ${\r\n                        allowAddOptions ? 'bg-blue-600' : 'bg-gray-300'\r\n                      }`}\r\n                      aria-pressed={allowAddOptions}\r\n                    >\r\n                      <span\r\n                        className={`block w-6 h-6 bg-white rounded-full transform transition ${\r\n                          allowAddOptions ? 'translate-x-6' : 'translate-x-0'\r\n                        }`}\r\n                      />\r\n                    </button>\r\n                  </div>\r\n                </div> */}\r\n              </>\r\n            );\r\n          })()}\r\n        </div>\r\n        <div className=\"px-6 pb-6 pt-2 border-t border-gray-200 flex-shrink-0\">\r\n          {!editing ? (\r\n            <button\r\n              onClick={handleConfirmVote}\r\n              disabled={saving || isLocked}\r\n              className={`w-full cursor-pointer py-3.5 rounded-2xl font-semibold ${\r\n                selected.length > 0 && !isLocked\r\n                  ? 'bg-blue-600 hover:bg-blue-700 text-white'\r\n                  : 'bg-gray-200 text-gray-500 cursor-not-allowed'\r\n              }`}\r\n            >\r\n              Bình chọn\r\n            </button>\r\n          ) : (\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => {\r\n                  setEditing(false);\r\n                  if (message) {\r\n                    const q = String(message.content || message.pollQuestion || '');\r\n                    const opts = Array.isArray(message.pollOptions) ? (message.pollOptions as string[]) : [];\r\n                    setQuestion(q);\r\n                    setOptions(opts);\r\n                  }\r\n                }}\r\n                disabled={saving}\r\n                className=\"flex-1 cursor-pointer py-3.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-2xl\"\r\n              >\r\n                Hủy\r\n              </button>\r\n              <button\r\n                onClick={handleSave}\r\n                disabled={saving}\r\n                className=\"flex-1 cursor-pointer py-3.5 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-2xl\"\r\n              >\r\n                Lưu\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n        {showVotersPanel && (\r\n          <>\r\n            <div\r\n              className=\"absolute inset-0 bg-black/10\"\r\n              onClick={() => {\r\n                setShowVotersPanel(false);\r\n                setActiveTab('');\r\n              }}\r\n            />\r\n            <div className=\"absolute bottom-0 left-0 right-0 bg-white h-[50vh] rounded-t-2xl shadow-2xl border-t border-gray-200 z-[100] \">\r\n              <div className=\"px-4 pt-3 pb-2 flex gap-2 overflow-x-auto whitespace-nowrap custom-scrollbar\">\r\n                {(message.pollOptions || []).map((opt) => {\r\n                  const cnt = Array.isArray(previewVotesMap[opt]) ? (previewVotesMap[opt] as string[]).length : 0;\r\n                  const active = activeTab === opt || (!activeTab && opt === (message.pollOptions || [])[0]);\r\n\r\n                  return (\r\n                    <button\r\n                      key={opt}\r\n                      onClick={() => setActiveTab(opt)}\r\n                      className={`flex items-center shrink-0 text-sm cursor-pointer px-2 ${\r\n                        active ? 'border-b border-black text-black' : 'text-black'\r\n                      }`}\r\n                    >\r\n                      <span className=\"truncate\">{opt}</span>\r\n                      <span className=\"ml-1\">({cnt})</span>\r\n                    </button>\r\n                  );\r\n                })}\r\n\r\n                <button\r\n                  onClick={() => setActiveTab('__none__')}\r\n                  className={`shrink-0 px-3 py-2 text-sm cursor-pointer whitespace-nowrap ${\r\n                    activeTab === '__none__' ? 'border-b border-black text-black' : 'text-black'\r\n                  }`}\r\n                >\r\n                  Chưa bình chọn\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"p-4 max-h-[40vh] overflow-y-auto\">\r\n                {(() => {\r\n                  const ids =\r\n                    activeTab === '__none__'\r\n                      ? notVotedIds\r\n                      : (Array.isArray(previewVotesMap[activeTab]) ? (previewVotesMap[activeTab] as string[]) : []).map(\r\n                          (x) => String(x),\r\n                        );\r\n                  if (ids.length === 0) return <p className=\"px-1 text-sm text-gray-500\">Chưa có ai</p>;\r\n                  return ids.map((uid) => {\r\n                    const info = memberMap.get(String(uid));\r\n                    return (\r\n                      <div key={uid} className=\"flex items-center gap-3 px-2 py-2\">\r\n                        {info?.avatar ? (\r\n                          <div className=\"w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-sm text-gray-600\">\r\n                            <Image\r\n                              width={25}\r\n                              height={25}\r\n                              src={getProxyUrl(info.avatar)}\r\n                              alt={info?.name || String(uid)}\r\n                              className=\" w-full h-full object-cover rounded-full\"\r\n                            />\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"w-7 h-7 rounded-full bg-gray-200 flex items-center justify-center text-sm text-gray-600\">\r\n                            <Image\r\n                              src=\"/logo/avata.webp\"\r\n                              alt={info?.name || 'User'}\r\n                              width={56}\r\n                              height={56}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          </div>\r\n                        )}\r\n                        <span className=\"text-sm\">{info?.name || String(uid)}</span>\r\n                      </div>\r\n                    );\r\n                  });\r\n                })()}\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n        {deadlineOpen && (\r\n          <>\r\n            <div className=\"absolute inset-0 bg-black/10\" onClick={() => setDeadlineOpen(false)} />\r\n            <div className=\"absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl border-t border-gray-200 p-4 z-[110]\">\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <p className=\"text-sm font-medium text-gray-800\">Đặt thời hạn</p>\r\n                <button onClick={() => setDeadlineOpen(false)} className=\"cursor-pointer text-gray-500\">\r\n                  <HiX className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n              <div className=\"space-y-3\">\r\n                <label className=\"flex items-center gap-2 text-sm\">\r\n                  <input type=\"radio\" checked={deadlineMode === 'none'} onChange={() => setDeadlineMode('none')} />\r\n                  Không giới hạn thời gian\r\n                </label>\r\n                <label className=\"flex items-center gap-2 text-sm\">\r\n                  <input type=\"radio\" checked={deadlineMode === 'time'} onChange={() => setDeadlineMode('time')} />\r\n                  Chọn thời điểm kết thúc\r\n                </label>\r\n                {deadlineMode === 'time' && (\r\n                  <input\r\n                    type=\"datetime-local\"\r\n                    value={deadlineInput}\r\n                    onChange={(e) => setDeadlineInput(e.target.value)}\r\n                    className=\"w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-xl\"\r\n                  />\r\n                )}\r\n                <div className=\"flex gap-3 pt-2\">\r\n                  <button\r\n                    onClick={() => {\r\n                      if (deadlineMode === 'none') {\r\n                        setEditEndAt(null);\r\n                        setDeadlineOpen(false);\r\n                        return;\r\n                      }\r\n                      const dt = Date.parse(deadlineInput);\r\n                      if (!Number.isNaN(dt)) {\r\n                        setEditEndAt(dt);\r\n                        setDeadlineOpen(false);\r\n                      }\r\n                    }}\r\n                    className=\"flex-1 cursor-pointer py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold text-sm\"\r\n                  >\r\n                    Xong\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setDeadlineOpen(false)}\r\n                    className=\"flex-1 cursor-pointer py-2 bg-gray-100 hover:bg-gray-200 rounded-xl font-semibold text-sm\"\r\n                  >\r\n                    Hủy\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n  const target =\r\n    isDesktop && typeof document !== 'undefined' ? document.getElementById('right-sidebar-container') : null;\r\n  return isDesktop && target ? createPortal(modalNode, target) : modalNode;\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AACpD;AACA;AACA;AACA;AAcA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;AASe,SAAS,gBAAgB,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,SAAS,EAAwB;;IACnG,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,OAAO,EAAE,GAAG,IAAA,mJAAc;IAC7D,MAAM,SAAS,CAAC;QACd,MAAM,KAAK,OAAO,YAAY,GAAG;QACjC,MAAM,QAAQ,OAAO,AAAC,aAA4C,GAAG;QACrE,OAAO,UAAU,QAAQ;YAAC;YAAI;SAAM,CAAC,IAAI,GAAG,IAAI,CAAC;IACnD,CAAC;IACD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAW,EAAE;IACnD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,OAAO,OAAO,YAAY,GAAG;IACnC,MAAM,YAAY,+CAAkB,eAAe,OAAO,UAAU,CAAC,sBAAsB,OAAO;IAClG,MAAM,WAAW,IAAA,wKAAO;6CAAC,IAAO,SAAS,aAAa,CAAC;4CAAgC;QAAC;KAAQ;IAChG,MAAM,aAAa,IAAA,wKAAO;+CAAC;YACzB,MAAM,MAAgB,EAAE;YACxB,CAAC,SAAS,eAAe,EAAE,EAAE,OAAO;uDAAC,CAAC;oBACpC,MAAM,KAAK,MAAM,OAAO,CAAC,QAAQ,CAAC,IAAI,IAAK,QAAQ,CAAC,IAAI,GAAgB,EAAE;oBAC1E,IAAI,GAAG,QAAQ,CAAC,OAAO,IAAI,IAAI,CAAC;gBAClC;;YACA,OAAO;QACT;8CAAG;QAAC;QAAU;QAAS;KAAK;IAC5B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAW,EAAE;IACrD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IACvD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAS;IAEnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IACvD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,yKAAQ,EAAC;IACjE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAgB;IAC1D,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IACjD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAkB;IAClE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAS;IAE3D,MAAM,UAAU,IAAA,wKAAO;4CAAC;YACtB,IAAI,CAAC,SAAS,OAAO;YACrB,MAAM,SAAS,QAAQ,MAAM;YAC7B,MAAM,WAAW,OAAO,WAAW,YAAY,SAAS,OAAO,OAAO,GAAG,IAAI,OAAO;YACpF,OAAO,aAAa,OAAO,YAAY,GAAG;QAC5C;2CAAG;QAAC;QAAS,YAAY,GAAG;KAAC;IAC7B,MAAM,QAAQ,IAAA,wKAAO;0CAAC,IAAO,SAAS,YAAY,OAAO,QAAQ,SAAS,IAAI;yCAAO;QAAC;KAAQ;IAC9F,MAAM,UAAU,IAAA,wKAAO;4CAAC,IAAO,QAAQ,KAAK,GAAG,MAAM,QAAQ;2CAAQ;QAAC;KAAM;IAC5E,MAAM,WAAW,IAAA,wKAAO;6CAAC,IAAM,CAAC,CAAC,CAAC,SAAS,gBAAgB,OAAO;4CAAG;QAAC,SAAS;QAAc;KAAQ;IACrG,MAAM,UAAU,IAAA,wKAAO;4CACrB,IAAO,UAAU,AAAC,aAAmC,OAAO,IAAI,EAAE,GAAG,EAAE;2CACvE;QAAC;QAAS;KAAa;IAEzB,MAAM,YAAY,IAAA,wKAAO;8CAAC;YACxB,MAAM,MAAM,IAAI;YACf,QAAiF,OAAO;sDAAC,CAAC;oBACzF,MAAM,KAAK,OAAO,EAAE,GAAG,IAAI,EAAE,EAAE,IAAI;oBACnC,IAAI,IAAI,IAAI,GAAG,CAAC,IAAI;wBAAE,MAAM,EAAE,IAAI;wBAAE,QAAQ,EAAE,MAAM;oBAAC;gBACvD;;YACA,OAAO;QACT;6CAAG;QAAC;KAAQ;IAEZ,IAAA,0KAAS;qCAAC;YACR,IAAI,CAAC,SAAS;YACd,MAAM,IAAI,OAAO,QAAQ,OAAO,IAAI,QAAQ,YAAY,IAAI;YAC5D,MAAM,OAAO,MAAM,OAAO,CAAC,QAAQ,WAAW,IAAK,QAAQ,WAAW,GAAgB,EAAE;YACxF,YAAY;YACZ,WAAW;YACX,WAAW;YACX,YAAY;YACZ,UAAU;YACV,aAAa;YAEb,iBAAiB,CAAC,CAAC,QAAQ,iBAAiB;YAC5C,mBAAmB,CAAC,CAAC,QAAQ,mBAAmB;YAChD,cAAc,CAAC,CAAC,QAAQ,cAAc;YACtC,wBAAwB,CAAC,CAAC,QAAQ,wBAAwB;YAC1D,aAAa,QAAQ,SAAS,GAAG,OAAO,QAAQ,SAAS,IAAI;QAC/D;oCAAG;QAAC;QAAS;KAAW;IAExB,MAAM,kBAAkB;QACtB,UAAU;IACZ;IAEA,MAAM,yBAAyB;QAC7B,WAAW,CAAC,OAAS;mBAAI;gBAAM;aAAG;IACpC;IAEA,MAAM,4BAA4B,CAAC;QACjC,WAAW,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,GAAG,IAAM,MAAM;IACnD;IAEA,MAAM,qBAAqB,CAAC,OAAe;QACzC,WAAW,CAAC,OAAS,KAAK,GAAG,CAAC,CAAC,GAAG,IAAO,MAAM,QAAQ,QAAQ;IACjE;IAEA,MAAM,aAAa;QACjB,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,SAAS;QACd,MAAM,eAAe,QAAQ,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI,IAAI,MAAM,CAAC,CAAC,IAAM;QAChE,IAAI,CAAC,SAAS,IAAI,MAAM,aAAa,MAAM,GAAG,GAAG;QACjD,UAAU;QACV,IAAI;YACF,MAAM,MAAM,KAAK,GAAG;YACpB,MAAM,YAAa,QAAQ,SAAS,IAAI,CAAC;YACzC,MAAM,YAAsC,CAAC;YAC7C,aAAa,OAAO,CAAC,CAAC;gBACpB,MAAM,MAAM,MAAM,OAAO,CAAC,SAAS,CAAC,IAAI,IAAI,SAAS,CAAC,IAAI,GAAG,EAAE;gBAC/D,SAAS,CAAC,IAAI,GAAG;YACnB;YAEA,MAAM,gBAAgB;gBACpB,SAAS,SAAS,IAAI;gBACtB,cAAc,SAAS,IAAI;gBAC3B,aAAa;gBACb,WAAW;gBACX,mBAAmB;gBACnB,qBAAqB;gBACrB,gBAAgB;gBAChB,0BAA0B;gBAC1B,WAAW;gBACX,UAAU;gBACV,WAAW;YACb;YAEA,MAAM,IAAA,+IAAgB,EAAC,OAAO,QAAQ,GAAG,GAAG;YAC5C,MAAM,SAAS,IAAA,wLAAE,EAAC,IAAA,4IAAgB,KAAI;gBAAE,YAAY;oBAAC;iBAAY;gBAAE,iBAAiB;YAAM;YAC1F,OAAO,IAAI,CAAC,WAAW;gBACrB,OAAO,IAAI,CAAC,aAAa;gBACzB,MAAM,WAAW,UAAU,OAAO,OAAO,AAAC,aAAsB,GAAG;gBACnE,MAAM,UAAU,UAAU,AAAC,aAAmC,OAAO,IAAI,EAAE,GAAG,EAAE;gBAChF,OAAO,IAAI,CAAC,gBAAgB;oBAC1B,KAAK,QAAQ,GAAG;oBAChB;oBACA,GAAG,aAAa;oBAChB,iBAAiB,QAAQ,OAAO;oBAChC,QAAQ,OAAO,YAAY,GAAG;oBAC9B,YAAY,YAAY,IAAI;oBAC5B;oBACA;oBACA;gBACF;gBACA,OAAO,IAAI,CAAC,kBAAkB;oBAC5B,KAAK,QAAQ,GAAG;oBAChB;oBACA,GAAG,aAAa;oBAChB,iBAAiB,QAAQ,OAAO;oBAChC,QAAQ,OAAO,YAAY,GAAG;oBAC9B,YAAY,YAAY,IAAI;oBAC5B;oBACA;oBACA;gBACF;gBACA,MAAM,MAAM,YAAY,IAAI,IAAI;gBAChC,MAAM,aAAa,GAAG,IAAI,0BAA0B,EAAE,SAAS,IAAI,GAAG,CAAC,CAAC;gBACxE,MAAM,YAAY,MAAM,IAAA,+IAAgB,EAAC;oBACvC;oBACA,QAAQ,OAAO,YAAY,GAAG;oBAC9B,MAAM;oBACN,SAAS;oBACT,WAAW;oBACX,kBAAkB,OAAO,QAAQ,GAAG;gBACtC;gBACA,IAAI,WAAW,SAAS;oBACtB,OAAO,IAAI,CAAC,gBAAgB;wBAC1B;wBACA,QAAQ,OAAO,YAAY,GAAG;wBAC9B,YAAY,YAAY,IAAI;wBAC5B;wBACA;wBACA;wBACA,KAAK,UAAU,GAAG;wBAClB,MAAM;wBACN,SAAS;wBACT,WAAW;wBACX,kBAAkB,OAAO,QAAQ,GAAG;oBACtC;gBACF;gBACA,WAAW,IAAM,OAAO,UAAU,IAAI;YACxC;YACA,IAAI,WAAW;gBACb,MAAM;YACR;YACA;QACF,SAAU;YACR,UAAU;QACZ;IACF;IAEA,MAAM,eAAe,CAAC;QACpB,IAAI,UAAU;QACd,MAAM,gBAAgB,CAAC,CAAC,SAAS;QACjC,YAAY,CAAC;YACX,MAAM,MAAM,KAAK,QAAQ,CAAC;YAC1B,IAAI,eAAe,OAAO,MAAM,KAAK,MAAM,CAAC,CAAC,IAAM,MAAM,OAAO;mBAAI;gBAAM;aAAI;YAC9E,OAAO,MAAM,EAAE,GAAG;gBAAC;aAAI;QACzB;IACF;IAEA,MAAM,kBAAkB,IAAA,wKAAO;oDAAC;YAC9B,MAAM,MAAgC,CAAC;YACvC,CAAC,SAAS,eAAe,EAAE,EAAE,OAAO;4DAAC,CAAC;oBACpC,MAAM,OAAO,MAAM,OAAO,CAAC,QAAQ,CAAC,IAAI,IAAI;2BAAK,QAAQ,CAAC,IAAI;qBAAc,GAAG,EAAE;oBACjF,MAAM,YAAY,KAAK,MAAM;8EAAC,CAAC,IAAM,MAAM;;oBAC3C,MAAM,cAAc,SAAS,QAAQ,CAAC;oBACtC,GAAG,CAAC,IAAI,GAAG,cAAc;2BAAI;wBAAW;qBAAK,GAAG;gBAClD;;YACA,OAAO;QACT;mDAAG;QAAC;QAAS;QAAU;QAAU;KAAK;IACtC,MAAM,YAAY,IAAA,wKAAO;8CAAC;YACxB,MAAM,IAAI,IAAI;YACd,CAAC,SAAS,eAAe,EAAE,EAAE,OAAO;sDAAC,CAAC;oBACpC,MAAM,MAAM,MAAM,OAAO,CAAC,eAAe,CAAC,IAAI,IAAK,eAAe,CAAC,IAAI,GAAgB,EAAE;oBACzF,IAAI,OAAO;8DAAC,CAAC,KAAO,EAAE,GAAG,CAAC,OAAO;;gBACnC;;YACA,OAAO;QACT;6CAAG;QAAC;QAAS;KAAgB;IAC7B,MAAM,aAAa,IAAA,wKAAO;+CAAC;YACzB,IAAI,QAAQ;YACZ,CAAC,SAAS,eAAe,EAAE,EAAE,OAAO;uDAAC,CAAC;oBACpC,MAAM,MAAM,MAAM,OAAO,CAAC,eAAe,CAAC,IAAI,IAAK,eAAe,CAAC,IAAI,GAAgB,EAAE;oBACzF,SAAS,IAAI,MAAM;gBACrB;;YACA,OAAO;QACT;8CAAG;QAAC;QAAS;KAAgB;IAC7B,MAAM,cAAc,IAAA,wKAAO;gDAAC;YAC1B,MAAM,IAAI,IAAI;YACb,QAAiD,OAAO;wDAAC,CAAC;oBACzD,MAAM,KAAK,OAAO,EAAE,GAAG,IAAI,EAAE,EAAE,IAAI;oBACnC,IAAI,IAAI,EAAE,GAAG,CAAC;gBAChB;;YACA,UAAU,OAAO;wDAAC,CAAC,KAAO,EAAE,MAAM,CAAC;;YACnC,OAAO,MAAM,IAAI,CAAC;QACpB;+CAAG;QAAC;QAAS;KAAU;IAEvB,MAAM,oBAAoB;QACxB,IAAI,CAAC,SAAS;QACd,IAAI,UAAU;QACd,MAAM,YAAa,QAAQ,SAAS,IAAI,CAAC;QACzC,MAAM,YAAsC,CAAC;QAC7C,CAAC,QAAQ,WAAW,IAAI,EAAE,EAAE,OAAO,CAAC,CAAC;YACnC,MAAM,MAAM,MAAM,OAAO,CAAC,SAAS,CAAC,IAAI,IAAI;mBAAI,SAAS,CAAC,IAAI;aAAC,GAAG,EAAE;YACpE,MAAM,WAAW,IAAI,MAAM,CAAC,CAAC,IAAM,MAAM;YACzC,SAAS,CAAC,IAAI,GAAG;QACnB;QACA,SAAS,OAAO,CAAC,CAAC;YAChB,MAAM,MAAM,MAAM,OAAO,CAAC,SAAS,CAAC,IAAI,IAAI,SAAS,CAAC,IAAI,GAAG,EAAE;YAC/D,IAAI,CAAC,IAAI,QAAQ,CAAC,OAAO,SAAS,CAAC,IAAI,GAAG;mBAAI;gBAAK;aAAK;QAC1D;QACA,UAAU;QACV,IAAI;YACF,MAAM,MAAM,KAAK,GAAG;YACpB,MAAM,IAAA,+IAAgB,EAAC,OAAO,QAAQ,GAAG,GAAG;gBAAE,WAAW;gBAAW,UAAU;gBAAK,WAAW;YAAI;YAElG,4CAA4C;YAC5C,MAAM,SAAS,IAAA,wLAAE,EAAC,IAAA,4IAAgB,KAAI;gBAAE,YAAY;oBAAC;iBAAY;gBAAE,iBAAiB;YAAM;YAC1F,OAAO,IAAI,CAAC,WAAW;gBACrB,OAAO,IAAI,CAAC,aAAa;gBACzB,OAAO,IAAI,CAAC,gBAAgB;oBAC1B,KAAK,QAAQ,GAAG;oBAChB;oBACA,WAAW;oBACX,UAAU;oBACV,WAAW;gBACb;gBAEA,MAAM,WAAW,UAAU,OAAO,OAAO,AAAC,aAAsB,GAAG;gBACnE,MAAM,UAAU,UAAU,AAAC,aAAmC,OAAO,IAAI,EAAE,GAAG,EAAE;gBAChF,MAAM,MAAM,QAAQ,cAAc,GAAG,mBAAmB,YAAY,IAAI,IAAI;gBAC5E,MAAM,QAAQ,SAAS,IAAI,CAAC;gBAC5B,MAAM,aAAa,GAAG,IAAI,gBAAgB,EAAE,MAAM,mBAAmB,EAAE,SAAS,CAAC,CAAC;gBAClF,MAAM,YAAY,MAAM,IAAA,+IAAgB,EAAC;oBACvC;oBACA,QAAQ;oBACR,MAAM;oBACN,SAAS;oBACT,WAAW;oBACX,kBAAkB,OAAO,QAAQ,GAAG;gBACtC;gBAEA,IAAI,WAAW,SAAS;oBACtB,OAAO,IAAI,CAAC,gBAAgB;wBAC1B;wBACA,QAAQ;wBACR,YAAY,YAAY,IAAI;wBAC5B;wBACA;wBACA;wBACA,KAAK,UAAU,GAAG;wBAClB,MAAM;wBACN,SAAS;wBACT,WAAW;wBACX,kBAAkB,OAAO,QAAQ,GAAG;oBACtC;gBACF;gBACA,WAAW,IAAM,OAAO,UAAU,IAAI;YACxC;YAEA,IAAI,WAAW;gBACb,MAAM;YACR;YACA;QACF,SAAU;YACR,UAAU;QACZ;IACF;IAEA,MAAM,yBAAyB;QAC7B,IAAI,CAAC,SAAS;QACd,IAAI,UAAU;QACd,MAAM,OAAO,UAAU,IAAI;QAC3B,IAAI,CAAC,MAAM;QACX,IAAI,QAAQ,GAAG,CAAC,CAAC,IAAM,EAAE,WAAW,IAAI,QAAQ,CAAC,KAAK,WAAW,KAAK;YACpE,UAAU;YACV,aAAa;YACb;QACF;QACA,MAAM,cAAc;eAAI;YAAS;SAAK;QACtC,UAAU;QACV,IAAI;YACF,MAAM,MAAM,KAAK,GAAG;YACpB,MAAM,IAAA,+IAAgB,EAAC,OAAO,QAAQ,GAAG,GAAG;gBAAE,aAAa;gBAAa,UAAU;gBAAK,WAAW;YAAI;YACtG,MAAM,SAAS,IAAA,wLAAE,EAAC,IAAA,4IAAgB,KAAI;gBAAE,YAAY;oBAAC;iBAAY;gBAAE,iBAAiB;YAAM;YAC1F,OAAO,IAAI,CAAC,WAAW;gBACrB,OAAO,IAAI,CAAC,aAAa;gBACzB,OAAO,IAAI,CAAC,gBAAgB;oBAC1B,KAAK,QAAQ,GAAG;oBAChB;oBACA,aAAa;oBACb,UAAU;oBACV,WAAW;gBACb;gBACA,MAAM,WAAW,UAAU,OAAO,OAAO,AAAC,aAAsB,GAAG;gBACnE,MAAM,UAAU,UAAU,AAAC,aAAmC,OAAO,IAAI,EAAE,GAAG,EAAE;gBAChF,MAAM,MAAM,QAAQ,cAAc,GAAG,mBAAmB,YAAY,IAAI,IAAI;gBAC5E,MAAM,aAAa,GAAG,IAAI,mBAAmB,EAAE,KAAK,oBAAoB,EAAE,SAAS,CAAC,CAAC;gBACrF,MAAM,YAAY,MAAM,IAAA,+IAAgB,EAAC;oBACvC;oBACA,QAAQ,OAAO,YAAY,GAAG;oBAC9B,MAAM;oBACN,SAAS;oBACT,WAAW;oBACX,kBAAkB,OAAO,QAAQ,GAAG;gBACtC;gBACA,IAAI,WAAW,SAAS;oBACtB,OAAO,IAAI,CAAC,gBAAgB;wBAC1B;wBACA,QAAQ,OAAO,YAAY,GAAG;wBAC9B,YAAY,YAAY,IAAI;wBAC5B;wBACA;wBACA;wBACA,KAAK,UAAU,GAAG;wBAClB,MAAM;wBACN,SAAS;wBACT,WAAW;wBACX,kBAAkB,OAAO,QAAQ,GAAG;oBACtC;gBACF;gBACA,WAAW,IAAM,OAAO,UAAU,IAAI;YACxC;YACA,IAAI,WAAW;gBACb,MAAM;YACR;YACA,WAAW;YACX,UAAU;YACV,aAAa;QACf,SAAU;YACR,UAAU;QACZ;IACF;IAEA,MAAM,mBAAmB;QACvB,IAAI,CAAC,WAAW,CAAC,SAAS;QAC1B,MAAM,kBAAkB,QAAQ,YAAY,IAAI;QAChD,MAAM,kBAAkB,CAAC;QACzB,IAAI,CAAC,mBAAmB,QAAQ,SAAS,IAAI,MAAM;QAEnD,UAAU;QACV,IAAI;YACF,MAAM,MAAM,KAAK,GAAG;YACpB,MAAM,aAAa,kBACf;gBAAE,cAAc;gBAAM,cAAc;gBAAK,UAAU;gBAAK,WAAW;YAAI,IACvE;gBACE,cAAc;gBACd,UAAU;gBACV,WAAW;YACb;YAEJ,MAAM,IAAA,+IAAgB,EAAC,OAAO,QAAQ,GAAG,GAAG;YAC5C,MAAM,SAAS,IAAA,wLAAE,EAAC,IAAA,4IAAgB,KAAI;gBAAE,YAAY;oBAAC;iBAAY;gBAAE,iBAAiB;YAAM;YAC1F,OAAO,IAAI,CAAC,gBAAgB;gBAAE,KAAK,QAAQ,GAAG;gBAAE;gBAAQ,GAAG,UAAU;YAAC;YACtE,MAAM,OAAO,YAAY,IAAI;YAE7B,IAAI,iBAAiB;gBACnB,MAAM,WAAW,UAAU,OAAO,OAAO,AAAC,aAAsB,GAAG;gBACnE,MAAM,WAAW,UAAU,AAAC,aAAmC,OAAO,IAAI,EAAE,GAAG,EAAE;gBACjF,MAAM,SAAS,IAAI,KAAK,KAAK,cAAc,CAAC;gBAC5C,MAAM,aAAa,GAAG,KAAK,qBAAqB,EAAE,OAAO,QAAQ,OAAO,IAAI,QAAQ,YAAY,IAAI,IAAI,gBAAgB,EAAE,OAAO,CAAC,CAAC;gBACnI,MAAM,YAAY,MAAM,IAAA,+IAAgB,EAAC;oBACvC;oBACA,QAAQ,OAAO,YAAY,GAAG;oBAC9B,MAAM;oBACN,SAAS;oBACT,WAAW;oBACX,kBAAkB,OAAO,QAAQ,GAAG;gBACtC;gBACA,IAAI,WAAW,SAAS;oBACtB,OAAO,IAAI,CAAC,gBAAgB;wBAC1B;wBACA,QAAQ,OAAO,YAAY,GAAG;wBAC9B,YAAY,YAAY,IAAI;wBAC5B;wBACA;wBACA,SAAS;wBACT,KAAK,UAAU,GAAG;wBAClB,MAAM;wBACN,SAAS;wBACT,WAAW;wBACX,kBAAkB,OAAO,QAAQ,GAAG;oBACtC;gBACF;YACF,OAAO;gBACL,MAAM,WAAW,UAAU,OAAO,OAAO,AAAC,aAAsB,GAAG;gBACnE,MAAM,WAAW,UAAU,AAAC,aAAmC,OAAO,IAAI,EAAE,GAAG,EAAE;gBACjF,MAAM,aAAa,GAAG,KAAK,wBAAwB,EAAE,OAAO,QAAQ,OAAO,IAAI,QAAQ,YAAY,IAAI,IAAI,CAAC,CAAC;gBAC7G,MAAM,YAAY,MAAM,IAAA,+IAAgB,EAAC;oBACvC;oBACA,QAAQ,OAAO,YAAY,GAAG;oBAC9B,MAAM;oBACN,SAAS;oBACT,WAAW;oBACX,kBAAkB,OAAO,QAAQ,GAAG;gBACtC;gBACA,IAAI,WAAW,SAAS;oBACtB,OAAO,IAAI,CAAC,gBAAgB;wBAC1B;wBACA,QAAQ,OAAO,YAAY,GAAG;wBAC9B,YAAY,YAAY,IAAI;wBAC5B;wBACA;wBACA,SAAS;wBACT,KAAK,UAAU,GAAG;wBAClB,MAAM;wBACN,SAAS;wBACT,WAAW;wBACX,kBAAkB,OAAO,QAAQ,GAAG;oBACtC;gBACF;YACF;YACA,OAAO,UAAU;YACjB,IAAI,WAAW;gBACb,MAAM;YACR;YACA;QACF,SAAU;YACR,UAAU;QACZ;IACF;IAEA,IAAI,CAAC,UAAU,CAAC,SAAS,OAAO;IAEhC,MAAM,0BACJ,6LAAC;QACC,WAAW,GAAG,YAAY,qBAAqB,gBAAgB,0CAA0C,EACvG,YAAY,gBAAgB,cAC7B,iBAAiB,CAAC;kBAEnB,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAO,SAAS;wCAAS,UAAU;wCAAQ,WAAU;kDACpD,cAAA,6LAAC,wJAAG;4CAAC,WAAU;;;;;;;;;;;kDAEjB,6LAAC;wCAAI,WAAU;kDACb,cAAA,6LAAC;4CAAG,WAAU;sDAAU;;;;;;;;;;;;;;;;;0CAG5B,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,SAAS,IAAM,YAAY,CAAC,IAAM,CAAC;wCACnC,WAAU;kDAEV,cAAA,6LAAC,wKAAkB;4CAAC,WAAU;;;;;;;;;;;oCAE/B,0BACC,6LAAC;wCAAI,WAAU;kDACZ,WAAW,CAAC,CAAC,QAAQ,SAAS,IAAI,QAAQ,OAAO,mBAChD,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDACC,SAAS;wDACP,YAAY;wDACZ,WAAW;oDACb;oDACA,WAAU;8DACX;;;;;;8DAGD,6LAAC;oDACC,SAAS;wDACP,YAAY;wDACZ;oDACF;oDACA,WAAU;8DAET,QAAQ,YAAY,IAAI,UAAU,sBAAsB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BASzE,6LAAC;oBAAI,WAAU;8BACZ,CAAC;wBACA,MAAM,cAAc,CAAC,CAAC,SAAS,4BAA4B,WAAW,MAAM,KAAK,CAAC;wBAClF,OAAO,CAAC,wBACN;;8CACE,6LAAC;oCAAE,WAAU;8CAA6D;;;;;;gCACzE,0BACC,6LAAC;oCAAE,WAAU;;wCAAiC;wCAC/B;wCACZ,IAAI,KAAK,SAAS,QAAQ,YAAY,IAAI,QAAQ,QAAQ,IAAI,QAAQ,SAAS,EAAE,cAAc,CAC9F;;;;;;;8CAIN,6LAAC;oCAAE,WAAU;;sDACX,6LAAC;4CAAI,WAAU;sDACZ,QAAQ,iBAAiB,iBACxB;;kEACE,6LAAC,kKAAY;wDAAC,WAAU;;;;;;kEACxB,6LAAC;kEAAK;;;;;;;6EAGR;;kEACE,6LAAC,mKAAa;wDAAC,WAAU;;;;;;kEACzB,6LAAC;kEAAK;;;;;;;;;;;;;wCAIX,QAAQ,cAAc,kBACrB,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,gKAAU;oDAAC,WAAU;;;;;;8DACtB,6LAAC;8DAAK;;;;;;;;;;;;wCAGT,QAAQ,mBAAmB,kBAC1B,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,4JAAM;oDAAC,WAAU;;;;;;8DAClB,6LAAC;8DAAK;;;;;;;;;;;;wCAGT,QAAQ,wBAAwB,kBAC/B,6LAAC;4CAAI,WAAU;;8DACb,6LAAC,kKAAY;oDAAC,WAAU;;;;;;8DACxB,6LAAC;8DAAK;;;;;;;;;;;;;;;;;;8CAIZ,6LAAC;oCAAI,WAAU;;;;;;gCACd,SAAS,kBAAkB,CAAC,cAAc,qBACzC,6LAAC;oCACC,SAAS,IAAM,mBAAmB;oCAClC,WAAU;8CAET,GAAG,UAAU,IAAI,CAAC,mBAAmB,CAAC;;;;;;gCAG1C,CAAC,6BAAe,6LAAC;oCAAE,WAAU;8CAA6B;;;;;;8CAC3D,6LAAC;oCAAI,WAAU;8CACZ,QAAQ,GAAG,CAAC,CAAC,KAAK;wCACjB,MAAM,aAAa,MAAM,OAAO,CAAC,eAAe,CAAC,IAAI,IACjD,AAAC,eAAe,CAAC,IAAI,CAAc,MAAM,GACzC;wCACJ,MAAM,SAAS,SAAS,QAAQ,CAAC;wCACjC,MAAM,MAAM,MAAM,OAAO,CAAC,eAAe,CAAC,IAAI,IAAK,eAAe,CAAC,IAAI,GAAgB,EAAE;wCACzF,MAAM,UAAU,IAAI,MAAM,GAAG,OAAO,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,IAAI;wCAC3D,MAAM,WAAW,UAAU,UAAU,GAAG,CAAC,WAAW;wCACpD,2DAA2D;wCAC3D,MAAM,UAAU,eAAe,aAAa,IAAI,AAAC,aAAa,aAAc,MAAM;wCAElF,qBACE,6LAAC;4CAEC,SAAS,IAAM,aAAa;4CAC5B,UAAU;4CACV,WAAW,CAAC,6GAA6G,EAAE,WAAW,kCAAkC,IAAI;;8DAE5K,6LAAC;oDACC,WAAW,CAAC,oEAAoE,EAAE,SAAS,gBAAgB,eAAe;oDAC1H,OAAO;wDAAE,OAAO,GAAG,QAAQ,CAAC,CAAC;oDAAC;;;;;;8DAEhC,6LAAC;oDAAI,WAAU;;sEACb,6LAAC;4DACC,WAAW,CAAC,oEAAoE,EAC9E,SAAS,2CAA2C,mBACpD;sEAED,wBAAU,6LAAC,6JAAO;gEAAC,WAAU;;;;;;;;;;;sEAEhC,6LAAC;4DAAK,WAAU;sEACb;;;;;;wDAEF,6BACC,6LAAC;4DAAI,WAAU;;8EACb,6LAAC;oEAAK,WAAU;8EAAyB;;;;;;gEACxC,CAAC,SAAS,kBAAkB,UAC3B,UAAU,uBACR,6LAAC;oEACC,WAAU;oEACV,OAAO,UAAU;8EAEjB,cAAA,6LAAC,2IAAK;wEACJ,KAAK,IAAA,uIAAW,EAAC,SAAS,MAAM;wEAChC,KAAI;wEACJ,OAAO;wEACP,QAAQ;wEACR,WAAU;;;;;;;;;;yFAId,6LAAC;oEACC,OAAO,UAAU;oEACjB,WAAU;8EAEV,cAAA,6LAAC,2IAAK;wEACJ,KAAI;wEACJ,KAAI;wEACJ,OAAO;wEACP,QAAQ;wEACR,WAAU;;;;;;;;;;2EAId;;;;;;;;;;;;;;2CAnDL;;;;;oCAyDX;;;;;;8CAEF,6LAAC;oCAAI,WAAU;8CACZ,CAAC,SACA,SAAS,uBAAuB,CAAC,yBAC/B,6LAAC;wCACC,SAAS;wCACT,WAAU;kDACX;;;;;+CAGC,qBAEJ,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDACC,OAAO;gDACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;gDAC5C,WAAW,CAAC;oDACV,IAAI,EAAE,GAAG,KAAK,SAAS;wDACrB,EAAE,cAAc;wDAChB;oDACF;gDACF;gDACA,WAAU;gDACV,aAAY;;;;;;0DAEd,6LAAC;gDACC,SAAS;gDACT,UAAU;gDACV,WAAU;0DACX;;;;;;0DAGD,6LAAC;gDACC,SAAS;oDACP,UAAU;oDACV,aAAa;gDACf;gDACA,WAAU;0DAEV,cAAA,6LAAC,kJAAO;oDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;yDAO7B;;8CACE,6LAAC;oCAAM,WAAU;8CAA+C;;;;;;8CAChE,6LAAC;oCACC,OAAO;oCACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;oCAC3C,MAAM;oCACN,WAAU;;;;;;8CAEZ,6LAAC;oCAAM,WAAU;8CAA+C;;;;;;8CAChE,6LAAC;oCAAI,WAAU;8CACZ,QAAQ,GAAG,CAAC,CAAC,KAAK,oBACjB,6LAAC;4CAAc,WAAU;;8DACvB,6LAAC;oDACC,MAAK;oDACL,OAAO;oDACP,UAAU,CAAC,IAAM,mBAAmB,KAAK,EAAE,MAAM,CAAC,KAAK;oDACvD,WAAU;;;;;;8DAEZ,6LAAC;oDACC,SAAS,IAAM,0BAA0B;oDACzC,WAAU;8DAEV,cAAA,6LAAC,kJAAO;wDAAC,WAAU;;;;;;;;;;;;2CAXb;;;;;;;;;;8CAiBd,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;;;oBAkGP,CAAC;;;;;;8BAEH,6LAAC;oBAAI,WAAU;8BACZ,CAAC,wBACA,6LAAC;wBACC,SAAS;wBACT,UAAU,UAAU;wBACpB,WAAW,CAAC,uDAAuD,EACjE,SAAS,MAAM,GAAG,KAAK,CAAC,WACpB,6CACA,gDACJ;kCACH;;;;;6CAID,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,SAAS;oCACP,WAAW;oCACX,IAAI,SAAS;wCACX,MAAM,IAAI,OAAO,QAAQ,OAAO,IAAI,QAAQ,YAAY,IAAI;wCAC5D,MAAM,OAAO,MAAM,OAAO,CAAC,QAAQ,WAAW,IAAK,QAAQ,WAAW,GAAgB,EAAE;wCACxF,YAAY;wCACZ,WAAW;oCACb;gCACF;gCACA,UAAU;gCACV,WAAU;0CACX;;;;;;0CAGD,6LAAC;gCACC,SAAS;gCACT,UAAU;gCACV,WAAU;0CACX;;;;;;;;;;;;;;;;;gBAMN,iCACC;;sCACE,6LAAC;4BACC,WAAU;4BACV,SAAS;gCACP,mBAAmB;gCACnB,aAAa;4BACf;;;;;;sCAEF,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;wCACZ,CAAC,QAAQ,WAAW,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC;4CAChC,MAAM,MAAM,MAAM,OAAO,CAAC,eAAe,CAAC,IAAI,IAAI,AAAC,eAAe,CAAC,IAAI,CAAc,MAAM,GAAG;4CAC9F,MAAM,SAAS,cAAc,OAAQ,CAAC,aAAa,QAAQ,CAAC,QAAQ,WAAW,IAAI,EAAE,CAAC,CAAC,EAAE;4CAEzF,qBACE,6LAAC;gDAEC,SAAS,IAAM,aAAa;gDAC5B,WAAW,CAAC,uDAAuD,EACjE,SAAS,qCAAqC,cAC9C;;kEAEF,6LAAC;wDAAK,WAAU;kEAAY;;;;;;kEAC5B,6LAAC;wDAAK,WAAU;;4DAAO;4DAAE;4DAAI;;;;;;;;+CAPxB;;;;;wCAUX;sDAEA,6LAAC;4CACC,SAAS,IAAM,aAAa;4CAC5B,WAAW,CAAC,4DAA4D,EACtE,cAAc,aAAa,qCAAqC,cAChE;sDACH;;;;;;;;;;;;8CAKH,6LAAC;oCAAI,WAAU;8CACZ,CAAC;wCACA,MAAM,MACJ,cAAc,aACV,cACA,CAAC,MAAM,OAAO,CAAC,eAAe,CAAC,UAAU,IAAK,eAAe,CAAC,UAAU,GAAgB,EAAE,EAAE,GAAG,CAC7F,CAAC,IAAM,OAAO;wCAEtB,IAAI,IAAI,MAAM,KAAK,GAAG,qBAAO,6LAAC;4CAAE,WAAU;sDAA6B;;;;;;wCACvE,OAAO,IAAI,GAAG,CAAC,CAAC;4CACd,MAAM,OAAO,UAAU,GAAG,CAAC,OAAO;4CAClC,qBACE,6LAAC;gDAAc,WAAU;;oDACtB,MAAM,uBACL,6LAAC;wDAAI,WAAU;kEACb,cAAA,6LAAC,2IAAK;4DACJ,OAAO;4DACP,QAAQ;4DACR,KAAK,IAAA,uIAAW,EAAC,KAAK,MAAM;4DAC5B,KAAK,MAAM,QAAQ,OAAO;4DAC1B,WAAU;;;;;;;;;;6EAId,6LAAC;wDAAI,WAAU;kEACb,cAAA,6LAAC,2IAAK;4DACJ,KAAI;4DACJ,KAAK,MAAM,QAAQ;4DACnB,OAAO;4DACP,QAAQ;4DACR,WAAU;;;;;;;;;;;kEAIhB,6LAAC;wDAAK,WAAU;kEAAW,MAAM,QAAQ,OAAO;;;;;;;+CAtBxC;;;;;wCAyBd;oCACF,CAAC;;;;;;;;;;;;;;gBAKR,8BACC;;sCACE,6LAAC;4BAAI,WAAU;4BAA+B,SAAS,IAAM,gBAAgB;;;;;;sCAC7E,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAE,WAAU;sDAAoC;;;;;;sDACjD,6LAAC;4CAAO,SAAS,IAAM,gBAAgB;4CAAQ,WAAU;sDACvD,cAAA,6LAAC,wJAAG;gDAAC,WAAU;;;;;;;;;;;;;;;;;8CAGnB,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAM,WAAU;;8DACf,6LAAC;oDAAM,MAAK;oDAAQ,SAAS,iBAAiB;oDAAQ,UAAU,IAAM,gBAAgB;;;;;;gDAAW;;;;;;;sDAGnG,6LAAC;4CAAM,WAAU;;8DACf,6LAAC;oDAAM,MAAK;oDAAQ,SAAS,iBAAiB;oDAAQ,UAAU,IAAM,gBAAgB;;;;;;gDAAW;;;;;;;wCAGlG,iBAAiB,wBAChB,6LAAC;4CACC,MAAK;4CACL,OAAO;4CACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;4CAChD,WAAU;;;;;;sDAGd,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDACC,SAAS;wDACP,IAAI,iBAAiB,QAAQ;4DAC3B,aAAa;4DACb,gBAAgB;4DAChB;wDACF;wDACA,MAAM,KAAK,KAAK,KAAK,CAAC;wDACtB,IAAI,CAAC,OAAO,KAAK,CAAC,KAAK;4DACrB,aAAa;4DACb,gBAAgB;wDAClB;oDACF;oDACA,WAAU;8DACX;;;;;;8DAGD,6LAAC;oDACC,SAAS,IAAM,gBAAgB;oDAC/B,WAAU;8DACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAWjB,MAAM,SACJ,aAAa,OAAO,aAAa,cAAc,SAAS,cAAc,CAAC,6BAA6B;IACtG,OAAO,aAAa,uBAAS,IAAA,oLAAY,EAAC,WAAW,UAAU;AACjE;GA3+BwB;;QACyB,mJAAc;;;KADvC"}},
    {"offset": {"line": 5586, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/PollList.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { HiX } from 'react-icons/hi';\r\nimport {\r\n  HiCheckCircle,\r\n  HiEllipsisVertical,\r\n  HiEyeSlash,\r\n  HiListBullet,\r\n  HiLockClosed,\r\n  HiLockOpen,\r\n  HiPlus,\r\n} from 'react-icons/hi2';\r\nimport { useChatContext } from '@/context/ChatContext';\r\nimport type { Message } from '@/types/Message';\r\nimport type { GroupConversation, MemberInfo } from '@/types/Group';\r\nimport type { User } from '@/types/User';\r\nimport { readMessagesApi, createMessageApi, updateMessageApi } from '@/fetch/messages';\r\nimport { io } from 'socket.io-client';\r\nimport { resolveSocketUrl, getProxyUrl } from '@/utils/utils';\r\nimport CreatePollModal from './CreatePollModal';\r\nimport PollDetailModal from './PollDetailModal';\r\nimport Image from 'next/image';\r\n\r\ninterface PollListProps {\r\n  onClose: () => void;\r\n  onRefresh?: () => void;\r\n  embedded?: boolean;\r\n}\r\n\r\nexport default function PollList({ onClose, onRefresh, embedded = false }: PollListProps) {\r\n  // ✅ BỎ DÒNG NÀY - Không cần nữa\r\n  // const SOCKET_URL = process.env.NEXT_PUBLIC_SOCKET_URL as string | undefined;\r\n\r\n  const { selectedChat, currentUser, isGroup } = useChatContext();\r\n  const roomId = useMemo(() => {\r\n    const me = String(currentUser._id);\r\n    const other = String((selectedChat as unknown as { _id: string })._id);\r\n    return isGroup ? other : [me, other].sort().join('_');\r\n  }, [isGroup, selectedChat, currentUser]);\r\n  const [items, setItems] = useState<Message[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showCreate, setShowCreate] = useState(false);\r\n  const [detailMsg, setDetailMsg] = useState<Message | null>(null);\r\n  const [openMenuId, setOpenMenuId] = useState<string | null>(null);\r\n  const menuRefs = useRef<Map<string, HTMLDivElement>>(new Map());\r\n  const socketRef = useRef<ReturnType<typeof io> | null>(null);\r\n\r\n  const load = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await readMessagesApi(roomId, {\r\n        limit: 200,\r\n        sortOrder: 'desc',\r\n        extraFilters: { type: 'poll', isRecalled: { $ne: true } },\r\n      });\r\n      const data = Array.isArray(res.data) ? (res.data as Message[]) : [];\r\n      setItems(data);\r\n    } catch {\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [roomId]);\r\n\r\n  useEffect(() => {\r\n    void load();\r\n  }, [load]);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (!openMenuId) return;\r\n      const menuElement = menuRefs.current.get(openMenuId);\r\n      if (menuElement && !menuElement.contains(event.target as Node)) {\r\n        setOpenMenuId(null);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [openMenuId]);\r\n\r\n  useEffect(() => {\r\n    socketRef.current?.disconnect();\r\n\r\n    // ✅ DÙNG resolveSocketUrl() thống nhất\r\n    socketRef.current = io(resolveSocketUrl(), {\r\n      transports: ['websocket'],\r\n      withCredentials: false,\r\n    });\r\n\r\n    socketRef.current.emit('join_room', roomId);\r\n    socketRef.current.on('receive_message', (data: Message) => {\r\n      if (String(data.roomId) !== String(roomId) || data.type !== 'poll') return;\r\n      setItems((prev) => {\r\n        const map = new Map<string, Message>();\r\n        [...prev, data].forEach((m) => map.set(String(m._id), m));\r\n        return Array.from(map.values()).sort((a, b) => Number(b.timestamp) - Number(a.timestamp));\r\n      });\r\n    });\r\n    socketRef.current.on(\r\n      'message_edited',\r\n      (data: {\r\n        _id: string;\r\n        roomId: string;\r\n        content?: string;\r\n        editedAt?: number;\r\n        pollQuestion?: string;\r\n        pollOptions?: string[];\r\n        pollVotes?: Record<string, string[]>;\r\n        isPollLocked?: boolean;\r\n        pollLockedAt?: number;\r\n        pollAllowMultiple?: boolean;\r\n        pollAllowAddOptions?: boolean;\r\n        pollHideVoters?: boolean;\r\n        pollHideResultsUntilVote?: boolean;\r\n        pollEndAt?: number | null;\r\n        timestamp?: number;\r\n        isPinned?: boolean;\r\n      }) => {\r\n        if (String(data.roomId) !== String(roomId)) return;\r\n        setItems((prev) => {\r\n          const updated = prev.map((m) =>\r\n            String(m._id) === String(data._id)\r\n              ? {\r\n                  ...m,\r\n                  content: data.content ?? m.content,\r\n                  editedAt: data.editedAt ?? m.editedAt,\r\n                  pollQuestion: data.pollQuestion ?? m.pollQuestion,\r\n                  pollOptions: data.pollOptions ?? m.pollOptions,\r\n                  pollVotes: data.pollVotes ?? m.pollVotes,\r\n                  isPollLocked: data.isPollLocked ?? m.isPollLocked,\r\n                  pollLockedAt: data.pollLockedAt ?? m.pollLockedAt,\r\n                  pollAllowMultiple: data.pollAllowMultiple ?? m.pollAllowMultiple,\r\n                  pollAllowAddOptions: data.pollAllowAddOptions ?? m.pollAllowAddOptions,\r\n                  pollHideVoters: data.pollHideVoters ?? m.pollHideVoters,\r\n                  pollHideResultsUntilVote: data.pollHideResultsUntilVote ?? m.pollHideResultsUntilVote,\r\n                  pollEndAt: typeof data.pollEndAt !== 'undefined' ? data.pollEndAt : m.pollEndAt,\r\n                  timestamp: data.timestamp ?? m.timestamp,\r\n                  isPinned: typeof data.isPinned === 'boolean' ? data.isPinned : m.isPinned,\r\n                }\r\n              : m,\r\n          );\r\n          return updated.sort((a, b) => Number(b.timestamp) - Number(a.timestamp));\r\n        });\r\n      },\r\n    );\r\n    socketRef.current.on(\r\n      'edit_message',\r\n      (data: Partial<Message> & { _id: string; roomId: string; newContent?: string; originalContent?: string }) => {\r\n        if (String(data.roomId) !== String(roomId)) return;\r\n        setItems((prev) =>\r\n          prev.map((m) =>\r\n            String(m._id) === String(data._id)\r\n              ? {\r\n                  ...m,\r\n                  ...data,\r\n                  content: data.newContent || data.content || m.content,\r\n                  editedAt: data.editedAt,\r\n                  originalContent: m.originalContent || m.content,\r\n                }\r\n              : m,\r\n          ),\r\n        );\r\n      },\r\n    );\r\n    socketRef.current.on('message_deleted', (data: { _id: string; roomId: string }) => {\r\n      if (String(data.roomId) !== String(roomId)) return;\r\n      setItems((prev) => prev.filter((m) => String(m._id) !== String(data._id)));\r\n    });\r\n    socketRef.current.on('message_pinned', (data: { _id: string; roomId: string; isPinned: boolean }) => {\r\n      if (String(data.roomId) !== String(roomId)) return;\r\n      setItems((prev) =>\r\n        prev.map((m) => (String(m._id) === String(data._id) ? { ...m, isPinned: !!data.isPinned } : m)),\r\n      );\r\n    });\r\n    return () => {\r\n      socketRef.current?.disconnect();\r\n      socketRef.current = null;\r\n    };\r\n  }, [roomId, load]); // ✅ BỎ SOCKET_URL khỏi dependencies\r\n\r\n  const handleCreate = async ({\r\n    question,\r\n    options,\r\n    pollAllowMultiple,\r\n    pollAllowAddOptions,\r\n    pollHideVoters,\r\n    pollHideResultsUntilVote,\r\n    pollEndAt,\r\n  }: {\r\n    question: string;\r\n    options: string[];\r\n    pollAllowMultiple?: boolean;\r\n    pollAllowAddOptions?: boolean;\r\n    pollHideVoters?: boolean;\r\n    pollHideResultsUntilVote?: boolean;\r\n    pollEndAt?: number | null;\r\n  }) => {\r\n    const q = question.trim();\r\n    const raw = options.map((o) => o.trim()).filter((o) => o);\r\n    const lowers = Array.from(new Set(raw.map((o) => o.toLowerCase())));\r\n    const unique = lowers.map((lo) => raw.find((x) => x.toLowerCase() === lo) as string);\r\n    if (!q || unique.length < 2) return;\r\n    try {\r\n      const createRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'poll',\r\n        content: q,\r\n        timestamp: Date.now(),\r\n        pollQuestion: q,\r\n        pollOptions: unique,\r\n        pollVotes: {},\r\n        isPollLocked: false,\r\n        pollAllowMultiple,\r\n        pollAllowAddOptions,\r\n        pollHideVoters,\r\n        pollHideResultsUntilVote,\r\n        pollEndAt: pollEndAt ?? null,\r\n      });\r\n      if (createRes?.success) {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const sockBase = {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n        };\r\n        const name = currentUser.name;\r\n        if (typeof createRes._id === 'string') {\r\n          socketRef.current?.emit('send_message', {\r\n            ...sockBase,\r\n            _id: createRes._id,\r\n            type: 'poll',\r\n            content: q,\r\n            timestamp: Date.now(),\r\n            pollQuestion: q,\r\n            pollOptions: unique,\r\n            pollVotes: {},\r\n            isPollLocked: false,\r\n            pollAllowMultiple,\r\n            pollAllowAddOptions,\r\n            pollHideVoters,\r\n            pollHideResultsUntilVote,\r\n            pollEndAt: pollEndAt ?? null,\r\n          });\r\n          const notify = await createMessageApi({\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            type: 'notify',\r\n            content: `${name} tạo cuộc bình chọn mới: \"${q}\"`,\r\n            timestamp: Date.now(),\r\n            replyToMessageId: createRes._id,\r\n          });\r\n          if (notify?.success) {\r\n            socketRef.current?.emit('send_message', {\r\n              ...sockBase,\r\n              _id: notify._id,\r\n              type: 'notify',\r\n              content: `${name} tạo cuộc bình chọn mới: \"${q}\"`,\r\n              timestamp: Date.now(),\r\n              replyToMessageId: createRes._id,\r\n            });\r\n          }\r\n        }\r\n      }\r\n    } catch {}\r\n    setShowCreate(false);\r\n  };\r\n\r\n  const canLock = (item: Message) => {\r\n    const sender = item.sender as User | string;\r\n    const senderId = typeof sender === 'object' && sender ? String(sender._id) : String(sender);\r\n    const isCreator = senderId === String(currentUser._id);\r\n    return isCreator;\r\n  };\r\n\r\n  const handleToggleLock = async (item: Message) => {\r\n    if (!canLock(item)) return;\r\n    const next = !item.isPollLocked;\r\n    if (!next && item.pollEndAt != null) return;\r\n    try {\r\n      const now = Date.now();\r\n      const name = currentUser.name;\r\n      const updateData = next\r\n        ? { isPollLocked: true, pollLockedAt: now, editedAt: now, timestamp: now }\r\n        : { isPollLocked: false, editedAt: now, timestamp: now };\r\n      await updateMessageApi(String(item._id), updateData);\r\n      socketRef.current?.emit('edit_message', { _id: item._id, roomId, ...updateData });\r\n      if (next) {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const endStr = new Date(now).toLocaleString('vi-VN');\r\n        const notifyText = `${name} đã khóa bình chọn: \"${String(item.content || item.pollQuestion || '')}\" (kết thúc lúc ${endStr})`;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(item._id),\r\n        });\r\n        if (notifyRes?.success) {\r\n          socketRef.current?.emit('send_message', {\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            senderName: currentUser.name,\r\n            isGroup,\r\n            receiver,\r\n            members,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: notifyText,\r\n            timestamp: now,\r\n            replyToMessageId: String(item._id),\r\n          });\r\n        }\r\n      } else {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const notifyText = `${name} đã mở khóa bình chọn: \"${String(item.content || item.pollQuestion || '')}\"`;\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(item._id),\r\n        });\r\n        if (notifyRes?.success) {\r\n          socketRef.current?.emit('send_message', {\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            senderName: currentUser.name,\r\n            isGroup,\r\n            receiver,\r\n            members,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: notifyText,\r\n            timestamp: now,\r\n            replyToMessageId: String(item._id),\r\n          });\r\n        }\r\n      }\r\n\r\n      if (onRefresh) {\r\n        await onRefresh();\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  const handleTogglePin = async (item: Message) => {\r\n    const next = !item.isPinned;\r\n    setItems((prev) => prev.map((m) => (String(m._id) === String(item._id) ? { ...m, isPinned: next } : m)));\r\n    try {\r\n      const now = Date.now();\r\n      await updateMessageApi(String(item._id), { isPinned: next, editedAt: now });\r\n      socketRef.current?.emit('edit_message', { _id: item._id, roomId, isPinned: next, editedAt: now });\r\n      await updateMessageApi(String(item._id), { isPinned: next });\r\n      socketRef.current?.emit('pin_message', { _id: item._id, roomId, isPinned: next });\r\n\r\n      const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n      const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n      const who = currentUser.name || 'Ai đó';\r\n      const action = next ? 'đã ghim' : 'đã bỏ ghim';\r\n      const notifyText = `${who} ${action} một bình chọn: \"${String(item.content || item.pollQuestion || '')}\"`;\r\n      const notifyRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'notify',\r\n        content: notifyText,\r\n        timestamp: now,\r\n        replyToMessageId: String(item._id),\r\n      });\r\n      if (notifyRes?.success) {\r\n        socketRef.current?.emit('send_message', {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n          _id: notifyRes._id,\r\n          type: 'notify',\r\n          content: notifyText,\r\n          timestamp: now,\r\n          replyToMessageId: String(item._id),\r\n        });\r\n      }\r\n    } catch {\r\n      setItems((prev) => prev.map((m) => (String(m._id) === String(item._id) ? { ...m, isPinned: !next } : m)));\r\n    }\r\n  };\r\n\r\n  const handleEdit = (item: Message) => {\r\n    setDetailMsg(item);\r\n    setOpenMenuId(null);\r\n  };\r\n\r\n  const getUserInfo = useCallback(\r\n    (userId: string) => {\r\n      if (String(userId) === String(currentUser._id)) return currentUser;\r\n      if (isGroup) {\r\n        const members = (selectedChat as GroupConversation).members || [];\r\n        const member = members.find((m) => {\r\n          const typed = m as MemberInfo;\r\n          return String(typed._id || typed.id) === String(userId);\r\n        });\r\n        if (member) return member as unknown as User;\r\n      } else {\r\n        const other = selectedChat as User;\r\n        if (String(other._id) === String(userId)) return other;\r\n      }\r\n      return null;\r\n    },\r\n    [currentUser, isGroup, selectedChat],\r\n  );\r\n\r\n  const formatTime = (ts: number) => {\r\n    try {\r\n      // Format: 21/10 lúc 09:39\r\n      const d = new Date(ts);\r\n      const day = String(d.getDate()).padStart(2, '0');\r\n      const month = String(d.getMonth() + 1).padStart(2, '0');\r\n      const hour = String(d.getHours()).padStart(2, '0');\r\n      const minute = String(d.getMinutes()).padStart(2, '0');\r\n      return `${day}/${month} lúc ${hour}:${minute}`;\r\n    } catch {\r\n      return '';\r\n    }\r\n  };\r\n\r\n  const getVotesCount = (item: Message, option: string) => {\r\n    const v = item.pollVotes || {};\r\n    const arr = (v[option] || []) as string[];\r\n    return arr.length;\r\n  };\r\n\r\n  const getVotersForOption = (item: Message, option: string) => {\r\n    const v = item.pollVotes || {};\r\n    const arr = (v[option] || []) as string[];\r\n    return arr;\r\n  };\r\n\r\n  const didIVote = (item: Message, option: string) => {\r\n    const myId = String(currentUser._id);\r\n    const v = item.pollVotes || {};\r\n    const arr = (v[option] || []) as string[];\r\n    return arr.includes(myId);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex flex-col h-full bg-gray-50 overflow-hidden\">\r\n        {!embedded && (\r\n          <div className=\"bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between shadow-sm z-10\">\r\n            <h2 className=\"text-lg font-bold text-gray-800\">Bình chọn</h2>\r\n            <div className=\"flex items-center gap-3\">\r\n              {isGroup && (\r\n                <button\r\n                  onClick={() => setShowCreate(true)}\r\n                  className=\"p-2 cursor-pointer rounded-full hover:bg-gray-100 text-blue-600 transition-all duration-200\"\r\n                  title=\"Tạo bình chọn mới\"\r\n                >\r\n                  <svg\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    fill=\"none\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    strokeWidth={2}\r\n                    stroke=\"currentColor\"\r\n                    className=\"w-6 h-6\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 4.5v15m7.5-7.5h-15\" />\r\n                  </svg>\r\n                </button>\r\n              )}\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 cursor-pointer rounded-full hover:bg-gray-100 text-gray-500 transition-all duration-200\"\r\n              >\r\n                <HiX className=\"w-6 h-6\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Tabs giả lập (để giống ảnh) */}\r\n\r\n        <div className=\"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 bg-gray-100 p-3\">\r\n          <div className=\"space-y-4 max-w-2xl mx-auto\">\r\n            {loading ? (\r\n              <div className=\"text-center text-gray-500 py-10\">\r\n                <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent\"></div>\r\n                <p className=\"mt-2\">Đang tải...</p>\r\n              </div>\r\n            ) : items.length === 0 ? (\r\n              <div className=\"flex flex-col items-center justify-center py-20 text-gray-400\">\r\n                <svg className=\"w-16 h-16 mb-4 opacity-50\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={1.5}\r\n                    d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\"\r\n                  />\r\n                </svg>\r\n                <p className=\"text-sm\">Chưa có bình chọn nào</p>\r\n              </div>\r\n            ) : (\r\n              items.map((it) => {\r\n                const itemId = String(it._id);\r\n                const sender = it.sender as User | string;\r\n                const senderId = typeof sender === 'object' ? String(sender._id) : String(sender);\r\n                const senderInfo = getUserInfo(senderId) || (typeof sender === 'object' ? sender : null);\r\n                const senderName = senderInfo?.name || 'Ai đó';\r\n                const senderAvatar = senderInfo?.avatar;\r\n\r\n                const isMenuOpen = openMenuId === itemId;\r\n                const locked = !!it.isPollLocked;\r\n                const totalVotes = Object.values(it.pollVotes || {}).flat().length;\r\n                const uniqueVoters = new Set(Object.values(it.pollVotes || {}).flat()).size;\r\n                const hasVoted = Object.values(it.pollVotes || {}).some((arr) => arr.includes(String(currentUser._id)));\r\n                const showResults = !(it.pollHideResultsUntilVote && !hasVoted);\r\n\r\n                return (\r\n                  <div\r\n                    key={itemId}\r\n                    className=\"relative bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\"\r\n                  >\r\n                    {/* Header Card */}\r\n                    <div className=\"p-4 pb-2\">\r\n                      <div className=\"flex items-start gap-3\">\r\n                        <div className=\"flex-shrink-0 w-10 h-10 rounded-full overflow-hidden bg-gray-200\">\r\n                          {senderAvatar ? (\r\n                            <Image\r\n                              src={getProxyUrl(senderAvatar)}\r\n                              alt={senderName}\r\n                              width={40}\r\n                              height={40}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          ) : (\r\n                            <Image\r\n                              src=\"/logo/avata.webp\"\r\n                              alt={senderName}\r\n                              width={40}\r\n                              height={40}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex justify-between items-start\">\r\n                            <div>\r\n                              <p className=\"text-sm font-semibold text-gray-900 flex items-center gap-2\">\r\n                                <span>\r\n                                  {senderName} <span className=\"font-normal text-gray-500\">tạo một bình chọn</span>\r\n                                </span>\r\n                                {locked && (\r\n                                  <span className=\"inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[10px] font-medium bg-gray-100 text-gray-500 border border-gray-200\">\r\n                                    <HiLockClosed className=\"w-3 h-3\" />\r\n                                    Đã khóa\r\n                                  </span>\r\n                                )}\r\n                              </p>\r\n                              <p className=\"text-xs text-gray-400 mt-0.5\">{formatTime(it.timestamp)}</p>\r\n                            </div>\r\n                            <div className=\"relative\">\r\n                              <button\r\n                                onClick={() => setOpenMenuId(isMenuOpen ? null : itemId)}\r\n                                className=\"p-1 cursor-pointer text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100\"\r\n                              >\r\n                                <HiEllipsisVertical className=\"w-5 h-5\" />\r\n                              </button>\r\n\r\n                              {/* Dropdown Menu */}\r\n                              {isMenuOpen && (\r\n                                <div\r\n                                  ref={(el) => {\r\n                                    if (el) menuRefs.current.set(itemId, el);\r\n                                    else menuRefs.current.delete(itemId);\r\n                                  }}\r\n                                  className=\"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-xl border border-gray-100 z-20 py-1\"\r\n                                >\r\n                                  <button\r\n                                    onClick={() => handleEdit(it)}\r\n                                    className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50\"\r\n                                  >\r\n                                    Xem chi tiết\r\n                                  </button>\r\n                                  <button\r\n                                    onClick={() => handleTogglePin(it)}\r\n                                    className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50\"\r\n                                  >\r\n                                    {it.isPinned ? 'Bỏ ghim' : 'Ghim bình chọn'}\r\n                                  </button>\r\n                                  {canLock(it) && !(it.pollEndAt != null && Date.now() >= Number(it.pollEndAt)) && (\r\n                                    <button\r\n                                      onClick={() => handleToggleLock(it)}\r\n                                      className=\"cursor-pointer w-full px-4 py-2 text-left text-sm hover:bg-gray-50 text-red-600\"\r\n                                    >\r\n                                      {locked ? 'Mở khóa bình chọn' : 'Khóa bình chọn'}\r\n                                    </button>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Content */}\r\n                      <div className=\"mt-3\">\r\n                        <p className=\"text-base font-medium text-gray-900 mb-2 leading-snug truncate\">\r\n                          {it.content || it.pollQuestion || 'Bình chọn'}\r\n                        </p>\r\n\r\n                        <div className=\"flex flex-col gap-0.5 mb-2\">\r\n                          <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                            {it.pollAllowMultiple ? (\r\n                              <>\r\n                                <HiListBullet className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                                <span>Chọn nhiều phương án</span>\r\n                              </>\r\n                            ) : (\r\n                              <>\r\n                                <HiCheckCircle className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                                <span>Chọn 1 phương án</span>\r\n                              </>\r\n                            )}\r\n                          </div>\r\n                          {it.pollHideVoters && (\r\n                            <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                              <HiEyeSlash className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                              <span>Ẩn người bình chọn</span>\r\n                            </div>\r\n                          )}\r\n                          {it.pollAllowAddOptions && (\r\n                            <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                              <HiPlus className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                              <span>Cho phép thêm phương án</span>\r\n                            </div>\r\n                          )}\r\n                          {it.pollHideResultsUntilVote && (\r\n                            <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                              <HiLockClosed className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                              <span>Ẩn kết quả khi chưa bình chọn</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-1 mb-3 cursor-pointer\" onClick={() => handleEdit(it)}>\r\n                          <span className=\"text-sm text-blue-500 font-medium hover:underline\">\r\n                            {showResults ? `${uniqueVoters} người đã bình chọn` : 'Bình chọn để xem kết quả'}\r\n                          </span>\r\n                          <svg className=\"w-4 h-4 text-blue-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                          </svg>\r\n                        </div>\r\n\r\n                        {/* Options List */}\r\n                        <div className=\"space-y-2\">\r\n                          {(it.pollOptions || []).map((opt, idx) => {\r\n                            const voters = getVotersForOption(it, opt);\r\n                            const count = voters.length;\r\n                            const voted = didIVote(it, opt);\r\n                            const percent = showResults && totalVotes > 0 ? (count / totalVotes) * 100 : 0;\r\n\r\n                            // Get avatars of voters (max 3)\r\n                            const voterAvatars = voters.slice(0, 3).map((uid) => {\r\n                              const u = getUserInfo(uid);\r\n                              return u\r\n                                ? { id: uid, avatar: u.avatar, name: u.name }\r\n                                : { id: uid, avatar: null, name: 'User' };\r\n                            });\r\n\r\n                            return (\r\n                              <div\r\n                                key={`${itemId}-${idx}`}\r\n                                onClick={() => handleEdit(it)}\r\n                                className={`group relative overflow-hidden bg-gray-100 rounded-lg p-3 cursor-pointer transition-all duration-200\r\n                                               \r\n                                             \r\n                                            `}\r\n                              >\r\n                                {/* Progress Bar Background */}\r\n                                <div\r\n                                  className={`absolute top-0 left-0 bottom-0 transition-all duration-500 ease-out ${voted ? 'bg-blue-200' : 'bg-blue-200'}`}\r\n                                  style={{ width: `${percent}%` }}\r\n                                />\r\n\r\n                                <div className=\"relative flex items-center justify-between gap-3 z-10\">\r\n                                  <span className={`text-sm  `}>{opt}</span>\r\n\r\n                                  {/* Voter Avatars */}\r\n                                  {!it.pollHideVoters && showResults && (\r\n                                    <div className=\"flex items-center -space-x-2\">\r\n                                      {voterAvatars.map((u, i) => (\r\n                                        <div\r\n                                          key={i}\r\n                                          className=\"w-6 h-6 rounded-full border-2 border-white overflow-hidden bg-gray-200\"\r\n                                          title={u.name}\r\n                                        >\r\n                                          {u.avatar ? (\r\n                                            <Image\r\n                                              src={getProxyUrl(u.avatar)}\r\n                                              alt=\"\"\r\n                                              width={24}\r\n                                              height={24}\r\n                                              className=\"w-full h-full object-cover\"\r\n                                            />\r\n                                          ) : (\r\n                                            <Image\r\n                                              src=\"/logo/avata.webp\"\r\n                                              alt=\"\"\r\n                                              width={24}\r\n                                              height={24}\r\n                                              className=\"w-full h-full object-cover\"\r\n                                            />\r\n                                          )}\r\n                                        </div>\r\n                                      ))}\r\n                                      {count > 3 && (\r\n                                        <div className=\"w-6 h-6 rounded-full border-2 border-white bg-gray-700 text-white text-[10px] flex items-center justify-center font-bold\">\r\n                                          +{count - 3}\r\n                                        </div>\r\n                                      )}\r\n                                      {count > 0 && count <= 3 && voterAvatars.length < count && (\r\n                                        // Fallback if we can't find users for all votes\r\n                                        <div className=\"w-6 h-6 rounded-full border-2 border-white bg-gray-300 text-gray-600 text-[10px] flex items-center justify-center font-bold\">\r\n                                          {count}\r\n                                        </div>\r\n                                      )}\r\n                                    </div>\r\n                                  )}\r\n                                  {it.pollHideVoters && showResults && count > 0 && (\r\n                                    <div className=\"text-xs text-gray-500 font-medium\">{count} lượt</div>\r\n                                  )}\r\n                                </div>\r\n                              </div>\r\n                            );\r\n                          })}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Action Footer */}\r\n                    <div className=\"p-4 pt-2\">\r\n                      <button\r\n                        onClick={() => handleEdit(it)}\r\n                        disabled={false}\r\n                        className={`w-full cursor-pointer py-2.5 rounded-lg font-medium transition-colors text-sm\r\n                                ${\r\n                                  locked\r\n                                    ? 'bg-gray-100 text-gray-500 cursor-default'\r\n                                    : 'bg-blue-50 text-blue-600 hover:bg-blue-100 active:bg-blue-200'\r\n                                }`}\r\n                      >\r\n                        {locked\r\n                          ? 'Đã khóa bình chọn'\r\n                          : it.pollVotes &&\r\n                              Object.values(it.pollVotes).some((arr) => arr.includes(String(currentUser._id)))\r\n                            ? 'Đổi bình chọn'\r\n                            : 'Bình chọn'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <CreatePollModal isOpen={showCreate} onClose={() => setShowCreate(false)} onCreate={handleCreate} />\r\n      <PollDetailModal isOpen={!!detailMsg} message={detailMsg} onClose={() => setDetailMsg(null)} />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6809, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/PinnedMessagesList.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { HiChevronLeft, HiPlus, HiDotsHorizontal } from 'react-icons/hi';\r\nimport { useChatContext } from '@/context/ChatContext';\r\nimport { readMessagesApi, createMessageApi, togglePinMessageApi } from '@/fetch/messages';\r\nimport type { Message } from '@/types/Message';\r\nimport type { User } from '@/types/User';\r\nimport type { GroupConversation } from '@/types/Group';\r\nimport ICPin from '@/components/svg/ICPin';\r\nimport Image from 'next/image';\r\nimport { getProxyUrl, resolveSocketUrl } from '@/utils/utils';\r\nimport PollList from './PollList';\r\nimport ReminderList from './ReminderList';\r\nimport CreatePollModal from './CreatePollModal';\r\nimport CreateReminderModal from './CreateReminderModal';\r\nimport { io } from 'socket.io-client';\r\n\r\ninterface PinnedMessagesListProps {\r\n  onClose: () => void;\r\n  onJumpToMessage?: (messageId: string) => void;\r\n}\r\n\r\ntype TabType = 'pinned' | 'poll' | 'note';\r\n\r\nexport default function PinnedMessagesList({ onClose, onJumpToMessage }: PinnedMessagesListProps) {\r\n  const { selectedChat, currentUser, isGroup, allUsers } = useChatContext();\r\n  const roomId = useMemo(() => {\r\n    const me = String(currentUser._id);\r\n    const other = String((selectedChat as unknown as { _id: string })._id);\r\n    return isGroup ? other : [me, other].sort().join('_');\r\n  }, [isGroup, selectedChat, currentUser]);\r\n\r\n  const [activeTab, setActiveTab] = useState<TabType>('pinned');\r\n  const [items, setItems] = useState<Message[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showCreateMenu, setShowCreateMenu] = useState(false);\r\n  const [showCreatePoll, setShowCreatePoll] = useState(false);\r\n  const [showCreateNote, setShowCreateNote] = useState(false);\r\n  const [createLoading, setCreateLoading] = useState(false);\r\n  const [activeMenuId, setActiveMenuId] = useState<string | null>(null);\r\n\r\n  const socketRef = useRef<ReturnType<typeof io> | null>(null);\r\n\r\n  // --- Socket Connection (for sending messages) ---\r\n  useEffect(() => {\r\n    socketRef.current = io(resolveSocketUrl(), {\r\n      transports: ['websocket'],\r\n      withCredentials: false,\r\n    });\r\n    return () => {\r\n      socketRef.current?.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  // --- Load Pinned Messages ---\r\n  const loadPinned = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await readMessagesApi(roomId, {\r\n        limit: 200,\r\n        sortOrder: 'desc',\r\n        extraFilters: { isPinned: true, isRecalled: { $ne: true } },\r\n      });\r\n      const data = Array.isArray(res.data) ? (res.data as Message[]) : [];\r\n      setItems(data);\r\n    } catch (error) {\r\n      console.error('❌ Lỗi khi tải danh sách tin nhắn đã ghim:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [roomId]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab === 'pinned') {\r\n      void loadPinned();\r\n    }\r\n  }, [loadPinned, activeTab]);\r\n\r\n  const getSender = (msg: Message) => {\r\n    if (typeof msg.sender === 'object') return msg.sender as User;\r\n    return allUsers.find((u) => String(u._id) === String(msg.sender)) || ({} as User);\r\n  };\r\n\r\n  // --- Handlers ---\r\n  const handleCreatePoll = async ({\r\n    question,\r\n    options,\r\n    pollAllowMultiple,\r\n    pollAllowAddOptions,\r\n    pollHideVoters,\r\n    pollHideResultsUntilVote,\r\n    pollEndAt,\r\n  }: {\r\n    question: string;\r\n    options: string[];\r\n    pollAllowMultiple?: boolean;\r\n    pollAllowAddOptions?: boolean;\r\n    pollHideVoters?: boolean;\r\n    pollHideResultsUntilVote?: boolean;\r\n    pollEndAt?: number | null;\r\n  }) => {\r\n    const q = question.trim();\r\n    if (!q) return;\r\n\r\n    try {\r\n      const createRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'poll',\r\n        content: q,\r\n        timestamp: Date.now(),\r\n        pollQuestion: q,\r\n        pollOptions: options,\r\n        pollVotes: {},\r\n        isPollLocked: false,\r\n        pollAllowMultiple,\r\n        pollAllowAddOptions,\r\n        pollHideVoters,\r\n        pollHideResultsUntilVote,\r\n        pollEndAt: pollEndAt ?? null,\r\n      });\r\n\r\n      if (createRes?.success) {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const sockBase = {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n        };\r\n\r\n        if (typeof createRes._id === 'string') {\r\n          socketRef.current?.emit('send_message', {\r\n            ...sockBase,\r\n            _id: createRes._id,\r\n            type: 'poll',\r\n            content: q,\r\n            timestamp: Date.now(),\r\n            pollQuestion: q,\r\n            pollOptions: options,\r\n            pollVotes: {},\r\n            isPollLocked: false,\r\n            pollAllowMultiple,\r\n            pollAllowAddOptions,\r\n            pollHideVoters,\r\n            pollHideResultsUntilVote,\r\n            pollEndAt: pollEndAt ?? null,\r\n          });\r\n\r\n          // Notify\r\n          const notify = await createMessageApi({\r\n            roomId,\r\n            sender: String(currentUser._id),\r\n            type: 'notify',\r\n            content: `${currentUser.name} tạo cuộc bình chọn mới: \"${q}\"`,\r\n            timestamp: Date.now(),\r\n            replyToMessageId: createRes._id,\r\n          });\r\n          if (notify?.success) {\r\n            socketRef.current?.emit('send_message', {\r\n              ...sockBase,\r\n              _id: notify._id,\r\n              type: 'notify',\r\n              content: `${currentUser.name} tạo cuộc bình chọn mới: \"${q}\"`,\r\n              timestamp: Date.now(),\r\n              replyToMessageId: createRes._id,\r\n            });\r\n          }\r\n        }\r\n        setShowCreatePoll(false);\r\n        if (activeTab !== 'poll') setActiveTab('poll');\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to create poll:', error);\r\n    }\r\n  };\r\n\r\n  const handleCreateNote = async ({\r\n    content,\r\n    dateTime,\r\n    note,\r\n    repeat,\r\n  }: {\r\n    content: string;\r\n    dateTime: string;\r\n    note?: string;\r\n    repeat?: 'none' | 'daily' | 'weekly' | 'monthly';\r\n  }) => {\r\n    setCreateLoading(true);\r\n    const dt = Date.parse(dateTime);\r\n    if (!content.trim() || Number.isNaN(dt)) {\r\n      alert('Vui lòng nhập đầy đủ thông tin hợp lệ');\r\n      setCreateLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const createRes = await createMessageApi({\r\n        roomId,\r\n        sender: String(currentUser._id),\r\n        type: 'reminder',\r\n        content: content.trim(),\r\n        timestamp: Date.now(),\r\n        reminderAt: dt,\r\n        reminderNote: note?.trim() || '',\r\n        reminderFired: false,\r\n        reminderRepeat: repeat || 'none',\r\n      });\r\n\r\n      if (createRes?.success) {\r\n        const receiver = isGroup ? null : String((selectedChat as User)._id);\r\n        const members = isGroup ? (selectedChat as GroupConversation).members || [] : [];\r\n        const sockBase = {\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          senderName: currentUser.name,\r\n          isGroup,\r\n          receiver,\r\n          members,\r\n        };\r\n\r\n        if (typeof createRes._id === 'string') {\r\n          socketRef.current?.emit('send_message', {\r\n            ...sockBase,\r\n            _id: createRes._id,\r\n            type: 'reminder',\r\n            content: content.trim(),\r\n            timestamp: Date.now(),\r\n            reminderAt: dt,\r\n            reminderNote: note?.trim() || '',\r\n            reminderFired: false,\r\n            reminderRepeat: repeat || 'none',\r\n          });\r\n        }\r\n\r\n        // Notify\r\n        const timeStr = new Date(dt).toLocaleString('vi-VN');\r\n        const notifyRes = await createMessageApi({\r\n          roomId,\r\n          sender: String(currentUser._id),\r\n          type: 'notify',\r\n          content: `${currentUser.name} đã tạo lịch hẹn: \"${content.trim()}\" lúc ${timeStr}`,\r\n          timestamp: Date.now(),\r\n        });\r\n\r\n        if (notifyRes?.success && typeof notifyRes._id === 'string') {\r\n          socketRef.current?.emit('send_message', {\r\n            ...sockBase,\r\n            _id: notifyRes._id,\r\n            type: 'notify',\r\n            content: `${currentUser.name} đã tạo lịch hẹn: \"${content.trim()}\" lúc ${timeStr}`,\r\n            timestamp: Date.now(),\r\n          });\r\n        }\r\n        setShowCreateNote(false);\r\n        if (activeTab !== 'note') setActiveTab('note');\r\n      } else {\r\n        alert('Tạo lịch hẹn thất bại. Vui lòng kiểm tra kết nối máy chủ.');\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ Lỗi khi tạo lịch hẹn:', error);\r\n      alert('Không thể tạo lịch hẹn. Vui lòng thử lại.');\r\n    } finally {\r\n      setCreateLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUnpin = async (messageId: string) => {\r\n    try {\r\n      await togglePinMessageApi(messageId, false);\r\n      setItems((prev) => prev.filter((item) => item._id !== messageId));\r\n      setActiveMenuId(null);\r\n    } catch (error) {\r\n      console.error('Failed to unpin message:', error);\r\n    }\r\n  };\r\n\r\n  const handleJump = (messageId: string) => {\r\n    if (onJumpToMessage) {\r\n      onJumpToMessage(messageId);\r\n      onClose();\r\n    }\r\n    setActiveMenuId(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-gray-50 relative\">\r\n      {/* Header */}\r\n      <div className=\"bg-blue-500 text-white p-3 flex items-center justify-between shadow-sm sticky top-0 z-20\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <button onClick={onClose} className=\"p-1 cursor-pointer hover:bg-white/20 rounded-full transition-colors\">\r\n            <HiChevronLeft className=\"w-6 h-6\" />\r\n          </button>\r\n          <h3 className=\"font-medium text-lg\">Bảng tin nhóm</h3>\r\n        </div>\r\n        <div className=\"relative\">\r\n          <button\r\n            onClick={() => setShowCreateMenu(!showCreateMenu)}\r\n            className=\"p-1 hover:bg-white/20 rounded-full transition-colors cursor-pointer\"\r\n          >\r\n            <HiPlus className=\"w-6 h-6\" />\r\n          </button>\r\n          {showCreateMenu && (\r\n            <div className=\"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 text-gray-800 z-50 animate-fade-in\">\r\n              {isGroup && (\r\n              <button\r\n                onClick={() => {\r\n                  setShowCreateMenu(false);\r\n                  setShowCreatePoll(true);\r\n                }}\r\n                className=\"cursor-pointer block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n              >\r\n                Tạo bình chọn\r\n              </button>\r\n              )}\r\n              <button\r\n                onClick={() => {\r\n                  setShowCreateMenu(false);\r\n                  setShowCreateNote(true);\r\n                }}\r\n                className=\"cursor-pointer block w-full text-left px-4 py-2 hover:bg-gray-100 text-sm\"\r\n              >\r\n                Tạo ghi chú\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"bg-white px-1 flex items-center border-b border-gray-200 sticky top-[0] z-10\">\r\n        <div\r\n          onClick={() => setActiveTab('pinned')}\r\n          className={`flex-1 text-center py-3 border-b-2 font-medium text-sm cursor-pointer transition-colors ${\r\n            activeTab === 'pinned'\r\n              ? 'border-blue-500 text-blue-600'\r\n              : 'border-transparent text-gray-500 hover:bg-gray-50'\r\n          }`}\r\n        >\r\n          Tin nhắn đã ghim\r\n        </div>\r\n       \r\n       {isGroup && (\r\n        <div\r\n          onClick={() => setActiveTab('poll')}\r\n          className={`flex-1 text-center py-3 border-b-2 font-medium text-sm cursor-pointer transition-colors ${\r\n            activeTab === 'poll' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:bg-gray-50'\r\n          }`}\r\n        >\r\n          Bình chọn\r\n        </div>\r\n       )}\r\n        <div\r\n          onClick={() => setActiveTab('note')}\r\n          className={`flex-1 text-center py-3 border-b-2 font-medium text-sm cursor-pointer transition-colors ${\r\n            activeTab === 'note' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:bg-gray-50'\r\n          }`}\r\n        >\r\n          Ghi chú\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-hidden relative\">\r\n        {activeTab === 'pinned' && (\r\n          <div className=\"absolute inset-0 overflow-y-auto p-4 space-y-4 custom-scrollbar\">\r\n            {loading ? (\r\n              <div className=\"text-center py-10 text-gray-500\">Đang tải...</div>\r\n            ) : items.length === 0 ? (\r\n              <div className=\"flex flex-col items-center justify-center h-full gap-4 text-center p-8 opacity-70\">\r\n                <div className=\"relative\">\r\n                  <ICPin className=\"w-16 h-16 text-blue-200\" />\r\n                  <div className=\"absolute -bottom-2 -right-2 bg-white rounded-full p-1 shadow-sm\">\r\n                    <div className=\"w-4 h-4 bg-blue-500 rounded-full\"></div>\r\n                  </div>\r\n                </div>\r\n                <p className=\"text-gray-500 text-sm\">Bấm giữ một tin nhắn và chọn Ghim để gây chú ý cho cả nhóm</p>\r\n              </div>\r\n            ) : (\r\n              items.map((msg) => {\r\n                const sender = getSender(msg);\r\n                const pinnedAt = msg.pinnedAt || msg.timestamp;\r\n\r\n                return (\r\n                  <div key={msg._id} className=\"bg-white rounded-lg p-3 shadow-sm border border-gray-100 space-y-3\">\r\n                    {/* Header Card */}\r\n                    <div className=\"flex items-start justify-between\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600\">\r\n                          <ICPin className=\"w-4 h-4\" />\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-sm text-gray-700\">\r\n                            <span className=\"font-semibold text-gray-900\">Tin nhắn đã ghim</span>\r\n                          </p>\r\n                          <p className=\"text-xs text-gray-400\">\r\n                            {pinnedAt\r\n                              ? new Date(pinnedAt).toLocaleString('vi-VN', {\r\n                                  day: '2-digit',\r\n                                  month: '2-digit',\r\n                                  hour: '2-digit',\r\n                                  minute: '2-digit',\r\n                                })\r\n                              : ''}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"relative\">\r\n                        <button\r\n                          className=\"cursor-pointer text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            setActiveMenuId(activeMenuId === msg._id ? null : msg._id);\r\n                          }}\r\n                        >\r\n                          <HiDotsHorizontal className=\"w-5 h-5\" />\r\n                        </button>\r\n                        {activeMenuId === msg._id && (\r\n                          <>\r\n                            <div className=\"fixed inset-0 z-10\" onClick={() => setActiveMenuId(null)} />\r\n                            <div className=\"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-100 z-20 overflow-hidden py-1\">\r\n                              <button\r\n                                className=\"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2\"\r\n                                onClick={(e) => {\r\n                                  e.stopPropagation();\r\n                                  handleJump(msg._id);\r\n                                }}\r\n                              >\r\n                                <span>Di chuyển đến tin nhắn</span>\r\n                              </button>\r\n                              <button\r\n                                className=\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2\"\r\n                                onClick={(e) => {\r\n                                  e.stopPropagation();\r\n                                  handleUnpin(msg._id);\r\n                                }}\r\n                              >\r\n                                <span>Xóa ghim</span>\r\n                              </button>\r\n                            </div>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Content Card */}\r\n                    <div className=\"pl-3 border-l-[3px] border-blue-500 py-1\">\r\n                      <div className=\"mb-1\">\r\n                        <span className=\"font-semibold text-sm text-gray-900\">{sender.name || 'Người gửi'}</span>\r\n                      </div>\r\n\r\n                      {/* Render Content based on type */}\r\n                      {msg.type === 'image' ? (\r\n                        <div className=\"mt-1\">\r\n                          <div className=\" w-20 h-20 rounded-md overflow-hidden relative bg-gray-100\">\r\n                            <Image\r\n                              src={getProxyUrl(String(msg.fileUrl || msg.content)) || '/imgs/img1.JPEG'}\r\n                              alt=\"Image\"\r\n                              width={200}\r\n                              height={200}\r\n                              className=\"object-cover w-auto h-auto\"\r\n                              unoptimized={String(msg.fileUrl || msg.content).includes('mega.nz')}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      ) : msg.type === 'video' ? (\r\n                        <div className=\"mt-1\">\r\n                          <video\r\n                            src={\r\n                              getProxyUrl(String(msg.fileUrl || msg.content)) ||\r\n                              'https://www.w3schools.com/html/mov_bbb.mp4'\r\n                            }\r\n                            controls\r\n                            className=\"w-full max-w-[200px] rounded-md bg-black\"\r\n                          />\r\n                        </div>\r\n                      ) : msg.type === 'file' ? (\r\n                        <div className=\"mt-1 flex items-center gap-2 p-2 bg-gray-50 rounded-md border border-gray-200\">\r\n                          <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600\">\r\n                            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                              <path\r\n                                strokeLinecap=\"round\"\r\n                                strokeLinejoin=\"round\"\r\n                                strokeWidth={2}\r\n                                d=\"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z\"\r\n                              />\r\n                            </svg>\r\n                          </div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"text-sm font-medium text-gray-700 truncate\">\r\n                              {msg.fileName || 'File đính kèm'}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        <p className=\"text-sm text-gray-800 line-clamp-3 whitespace-pre-wrap\">\r\n                          {msg.content || 'Tin nhắn không có nội dung'}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {activeTab === 'poll' && <PollList embedded onClose={onClose} />}\r\n\r\n        {activeTab === 'note' && <ReminderList embedded onClose={onClose} />}\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      <CreatePollModal isOpen={showCreatePoll} onClose={() => setShowCreatePoll(false)} onCreate={handleCreatePoll} />\r\n      <CreateReminderModal\r\n        isOpen={showCreateNote}\r\n        onClose={() => setShowCreateNote(false)}\r\n        onCreate={handleCreateNote}\r\n        createLoading={createLoading}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7638, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/GroupInviteLinkSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { useState } from 'react';\r\nimport { CiFloppyDisk, CiLink } from 'react-icons/ci';\r\nimport { HiLink, HiClipboardCopy, HiRefresh, HiCheck, HiX, HiExclamationCircle, HiCheckCircle } from 'react-icons/hi';\r\n\r\ninterface GroupInviteLinkSectionProps {\r\n  groupId: string;\r\n  inviteCode?: string;\r\n  onGenerateLink: () => Promise<string>;\r\n  onRegenerateLink: () => Promise<string>;\r\n}\r\n\r\ninterface ModalProps {\r\n  show: boolean;\r\n  type: 'confirm' | 'success' | 'error';\r\n  message: string;\r\n  onClose: () => void;\r\n  onConfirm?: () => void;\r\n}\r\n\r\nfunction Modal({ show, type, message, onClose, onConfirm }: ModalProps) {\r\n  if (!show) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-white/30 bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full animate-[scale-in_0.2s_ease-out]\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-300\">\r\n          <div className=\"flex items-center gap-2\">\r\n            {type === 'success' && (\r\n              <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\r\n                <HiCheckCircle className=\"w-5 h-5 text-green-600\" />\r\n              </div>\r\n            )}\r\n            {type === 'error' && (\r\n              <div className=\"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center\">\r\n                <HiX className=\"w-5 h-5 text-red-600\" />\r\n              </div>\r\n            )}\r\n            {type === 'confirm' && (\r\n              <div className=\"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center\">\r\n                <HiExclamationCircle className=\"w-5 h-5 text-yellow-600\" />\r\n              </div>\r\n            )}\r\n            <h3 className=\"text-lg font-semibold\">\r\n              {type === 'success' && 'Thành công'}\r\n              {type === 'error' && 'Lỗi'}\r\n              {type === 'confirm' && 'Xác nhận'}\r\n            </h3>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors hover:cursor-pointer\"\r\n          >\r\n            <HiX className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Body */}\r\n        <div className=\"p-6\">\r\n          <p className=\"text-gray-700\">{message}</p>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex gap-2 p-4 border-t border-gray-300 bg-gray-50\">\r\n          {type === 'confirm' ? (\r\n            <>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-100 transition-colors\"\r\n              >\r\n                Hủy\r\n              </button>\r\n              <button\r\n                onClick={onConfirm}\r\n                className=\"flex-1 px-4 py-2 hover:cursor-pointer bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\r\n              >\r\n                Xác nhận\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <button\r\n              onClick={onClose}\r\n              className=\"flex-1 px-4 py-2 bg-blue-600 hover:cursor-pointer text-white rounded hover:bg-blue-700 transition-colors\"\r\n            >\r\n              Đóng\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <style jsx>{`\r\n        @keyframes scale-in {\r\n          from {\r\n            transform: scale(0.95);\r\n            opacity: 0;\r\n          }\r\n          to {\r\n            transform: scale(1);\r\n            opacity: 1;\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function GroupInviteLinkSection({\r\n  inviteCode: initialCode,\r\n  onGenerateLink,\r\n  onRegenerateLink,\r\n}: GroupInviteLinkSectionProps) {\r\n  const [inviteCode, setInviteCode] = useState(initialCode || '');\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [isCopied, setIsCopied] = useState(false);\r\n  const [modal, setModal] = useState<{ show: boolean; type: 'confirm' | 'success' | 'error'; message: string }>({\r\n    show: false,\r\n    type: 'success',\r\n    message: '',\r\n  });\r\n\r\n  const inviteLink = inviteCode ? `${window.location.origin}/invite/${inviteCode}` : '';\r\n\r\n  const showModal = (type: 'confirm' | 'success' | 'error', message: string) => {\r\n    setModal({ show: true, type, message });\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setModal({ show: false, type: 'success', message: '' });\r\n  };\r\n\r\n  const handleGenerateLink = async () => {\r\n    setIsGenerating(true);\r\n    try {\r\n      const code = await onGenerateLink();\r\n      setInviteCode(code);\r\n    } catch (error) {\r\n      console.error('Generate link error:', error);\r\n      showModal('error', 'Tạo link mời thất bại');\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleRegenerateLink = async () => {\r\n    setIsGenerating(true);\r\n    try {\r\n      const code = await onRegenerateLink();\r\n      setInviteCode(code);\r\n      showModal('success', 'Đã tạo link mời mới');\r\n    } catch (error) {\r\n      console.error('Regenerate link error:', error);\r\n      showModal('error', 'Tạo link mới thất bại');\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleConfirmRegenerate = () => {\r\n    closeModal();\r\n    handleRegenerateLink();\r\n  };\r\n\r\n  const handleCopyLink = async () => {\r\n    if (!inviteLink) return;\r\n\r\n    try {\r\n      await navigator.clipboard.writeText(inviteLink);\r\n      setIsCopied(true);\r\n      setTimeout(() => setIsCopied(false), 2000);\r\n    } catch {\r\n      // Fallback\r\n      const input = document.createElement('input');\r\n      input.value = inviteLink;\r\n      document.body.appendChild(input);\r\n      input.select();\r\n      document.execCommand('copy');\r\n      document.body.removeChild(input);\r\n      setIsCopied(true);\r\n      setTimeout(() => setIsCopied(false), 2000);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"bg-white  border border-gray-200 overflow-hidden\">\r\n        <div className=\"px-5 py-4 border-b border-gray-100 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <CiLink className=\"w-5 h-5 text-gray-600\" />\r\n            <span className=\"text-[1.125rem] md:text-[1rem] text-gray-800\">Link nhóm</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-4 space-y-3\">\r\n          {!inviteCode ? (\r\n            // Chưa có link\r\n            <div className=\"text-center py-4\">\r\n              <p className=\"text-sm text-gray-600 mb-4\">Tạo link mời để chia sẻ với bạn bè</p>\r\n              <button\r\n                onClick={handleGenerateLink}\r\n                disabled={isGenerating}\r\n                className=\"px-4 py-2 hover:cursor-pointer bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                {isGenerating ? 'Đang tạo...' : 'Tạo link mời'}\r\n              </button>\r\n            </div>\r\n          ) : (\r\n            // Đã có link\r\n            <>\r\n              <div className=\"flex items-center gap-0.5\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={inviteLink}\r\n                  readOnly\r\n                  className=\"flex-1 px-3 py-2 border-none outline-none rounded-lg bg-gray-50 text-sm text-gray-700 select-all\"\r\n                />\r\n                <button\r\n                  onClick={handleCopyLink}\r\n                  className=\"p-2 hover:bg-gray-100 hover:cursor-pointer rounded-lg transition flex-shrink-0\"\r\n                  title=\"Sao chép link\"\r\n                >\r\n                  {isCopied ? (\r\n                    <HiCheck className=\"w-5 h-5 text-green-600\" />\r\n                  ) : (\r\n                    <CiFloppyDisk className=\"w-5 h-5 text-gray-600\" />\r\n                  )}\r\n                </button>\r\n                <button\r\n                  onClick={() => showModal('confirm', 'Tạo link mới sẽ vô hiệu hóa link cũ. Bạn có chắc chắn?')}\r\n                  disabled={isGenerating}\r\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition flex-shrink-0 hover:cursor-pointer disabled:opacity-50\"\r\n                  title=\"Tạo link mới\"\r\n                >\r\n                  <HiRefresh className={`w-5 h-5 text-gray-600 ${isGenerating ? 'animate-spin' : ''}`} />\r\n                </button>\r\n              </div>\r\n\r\n              <p className=\"text-xs text-gray-500\">💡 Mọi người có link này có thể tham gia nhóm</p>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <Modal\r\n        show={modal.show}\r\n        type={modal.type}\r\n        message={modal.message}\r\n        onClose={closeModal}\r\n        onConfirm={modal.type === 'confirm' ? handleConfirmRegenerate : undefined}\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8063, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/PinnedMessagesSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { useEffect, useState, useMemo } from 'react';\r\nimport ICPin from '@/components/svg/ICPin';\r\nimport { useChatContext } from '@/context/ChatContext';\r\nimport { readPinnedMessagesApi } from '@/fetch/messages';\r\nimport type { Message } from '@/types/Message';\r\nimport { CiMapPin } from 'react-icons/ci';\r\nimport { HiChevronRight } from 'react-icons/hi2';\r\n\r\ninterface PinnedMessagesSectionProps {\r\n  onOpen: () => void;\r\n}\r\n\r\nexport default function PinnedMessagesSection({ onOpen }: PinnedMessagesSectionProps) {\r\n  const { selectedChat, currentUser, isGroup } = useChatContext();\r\n  const roomId = useMemo(() => {\r\n    const me = String(currentUser._id);\r\n    const other = String((selectedChat as unknown as { _id: string })._id);\r\n    return isGroup ? other : [me, other].sort().join('_');\r\n  }, [isGroup, selectedChat, currentUser]);\r\n\r\n  const [latestPinned, setLatestPinned] = useState<Message | null>(null);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      try {\r\n        const res = await readPinnedMessagesApi(roomId, { limit: 1 });\r\n        if (res.data && res.data.length > 0) {\r\n          setLatestPinned(res.data[0]);\r\n        } else {\r\n          setLatestPinned(null);\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to load pinned message preview:', error);\r\n      }\r\n    };\r\n    void load();\r\n  }, [roomId]);\r\n\r\n  const getPreviewContent = (msg: Message) => {\r\n    if (msg.type === 'image') return '[Hình ảnh]';\r\n    if (msg.type === 'video') return '[Video]';\r\n    if (msg.type === 'file') return '[File] ' + (msg.fileName || '');\r\n    if (msg.type === 'poll') return '[Bình chọn] ' + (msg.pollQuestion || msg.content);\r\n    return msg.content || 'Tin nhắn đã ghim';\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white border border-gray-100 overflow-hidden\">\r\n      <button\r\n        className=\"cursor-pointer w-full px-5 py-4 flex items-center gap-5 hover:bg-gray-50 transition-all duration-200 group\"\r\n        onClick={onOpen}\r\n        title=\"Xem danh sách tin nhắn đã ghim\"\r\n      >\r\n        <div className=\" rounded-xl\">\r\n          <CiMapPin className=\"w-5 h-5 text-gray-500\" />\r\n        </div>\r\n        <div className=\"text-left flex-1 min-w-0\">\r\n          <p className=\"text-base text-[1.125rem] md:text-[1rem] text-gray-900 group-hover:text-amber-600 transition-colors\">\r\n            Tin nhắn đã ghim\r\n          </p>\r\n          {latestPinned && (\r\n            <p className=\"text-sm text-gray-500 truncate mt-0.5 max-w-[200px]\">{getPreviewContent(latestPinned)}</p>\r\n          )}\r\n        </div>\r\n        <div className=\"ml-auto text-gray-400 group-hover:text-amber-600 transition-colors\">\r\n          <HiChevronRight className=\"w-4 h-4 text-gray-400 group-hover:text-amber-600\" />\r\n        </div>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AACpD;AAEA;AACA;AAEA;AACA;;;;;;;;AAMe,SAAS,sBAAsB,EAAE,MAAM,EAA8B;;IAClF,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,OAAO,EAAE,GAAG,IAAA,mJAAc;IAC7D,MAAM,SAAS,IAAA,wKAAO;iDAAC;YACrB,MAAM,KAAK,OAAO,YAAY,GAAG;YACjC,MAAM,QAAQ,OAAO,AAAC,aAA4C,GAAG;YACrE,OAAO,UAAU,QAAQ;gBAAC;gBAAI;aAAM,CAAC,IAAI,GAAG,IAAI,CAAC;QACnD;gDAAG;QAAC;QAAS;QAAc;KAAY;IAEvC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAiB;IAEjE,IAAA,0KAAS;2CAAC;YACR,MAAM;wDAAO;oBACX,IAAI;wBACF,MAAM,MAAM,MAAM,IAAA,oJAAqB,EAAC,QAAQ;4BAAE,OAAO;wBAAE;wBAC3D,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,GAAG;4BACnC,gBAAgB,IAAI,IAAI,CAAC,EAAE;wBAC7B,OAAO;4BACL,gBAAgB;wBAClB;oBACF,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,0CAA0C;oBAC1D;gBACF;;YACA,KAAK;QACP;0CAAG;QAAC;KAAO;IAEX,MAAM,oBAAoB,CAAC;QACzB,IAAI,IAAI,IAAI,KAAK,SAAS,OAAO;QACjC,IAAI,IAAI,IAAI,KAAK,SAAS,OAAO;QACjC,IAAI,IAAI,IAAI,KAAK,QAAQ,OAAO,YAAY,CAAC,IAAI,QAAQ,IAAI,EAAE;QAC/D,IAAI,IAAI,IAAI,KAAK,QAAQ,OAAO,iBAAiB,CAAC,IAAI,YAAY,IAAI,IAAI,OAAO;QACjF,OAAO,IAAI,OAAO,IAAI;IACxB;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YACC,WAAU;YACV,SAAS;YACT,OAAM;;8BAEN,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,6JAAQ;wBAAC,WAAU;;;;;;;;;;;8BAEtB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAE,WAAU;sCAAsG;;;;;;wBAGlH,8BACC,6LAAC;4BAAE,WAAU;sCAAuD,kBAAkB;;;;;;;;;;;;8BAG1F,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,oKAAc;wBAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;AAKpC;GA1DwB;;QACyB,mJAAc;;;KADvC"}},
    {"offset": {"line": 8215, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/AddToGroupModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { HiX } from 'react-icons/hi';\r\nimport { HiPlus, HiChevronRight } from 'react-icons/hi2';\r\nimport Image from 'next/image';\r\nimport { User } from '@/types/User';\r\nimport { GroupConversation } from '@/types/Group';\r\nimport { getProxyUrl, resolveSocketUrl, normalizeNoAccent, hasDiacritics, accentAwareIncludes } from '@/utils/utils';\r\nimport SuccessModal from '@/components/modal/SuccessModal';\r\nimport io from 'socket.io-client';\r\n\r\ninterface AddToGroupModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  currentUser: User;\r\n  selectedChat: User;\r\n  onShowCreateGroup: () => void;\r\n  reLoad?: () => void;\r\n}\r\n\r\nexport default function AddToGroupModal({\r\n  isOpen,\r\n  onClose,\r\n  currentUser,\r\n  selectedChat,\r\n  onShowCreateGroup,\r\n  reLoad,\r\n}: AddToGroupModalProps) {\r\n  const [myGroupsQuick, setMyGroupsQuick] = useState<GroupConversation[]>([]);\r\n  const [addToGroupLoading, setAddToGroupLoading] = useState(false);\r\n  const [addToGroupError, setAddToGroupError] = useState('');\r\n  const [groupSearch, setGroupSearch] = useState('');\r\n  const [selectedGroupIds, setSelectedGroupIds] = useState<string[]>([]);\r\n  const [showSuccessModal, setShowSuccessModal] = useState(false);\r\n\r\n  const maxSelectGroups = 5;\r\n\r\n  const fetchMyGroupsQuick = useCallback(async () => {\r\n    try {\r\n      const res = await fetch('/api/groups', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ action: 'readGroups', _id: currentUser._id }),\r\n      });\r\n      const data = await res.json();\r\n      const list = Array.isArray(data.data) ? (data.data as GroupConversation[]) : [];\r\n      setMyGroupsQuick(list);\r\n    } catch {}\r\n  }, [currentUser]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setAddToGroupError('');\r\n      setGroupSearch('');\r\n      setSelectedGroupIds([]);\r\n      void fetchMyGroupsQuick();\r\n    }\r\n  }, [isOpen, fetchMyGroupsQuick]);\r\n\r\n  const filteredGroups = useMemo(() => {\r\n    const q = normalizeNoAccent(groupSearch.trim());\r\n    if (!q) return myGroupsQuick;\r\n    const hasDia = hasDiacritics(groupSearch.trim());\r\n    return myGroupsQuick.filter((g) => accentAwareIncludes(String(g.name || ''), groupSearch.trim()));\r\n  }, [groupSearch, myGroupsQuick]);\r\n\r\n  const toggleSelectGroup = useCallback(\r\n    (groupId: string) => {\r\n      setAddToGroupError('');\r\n      setSelectedGroupIds((prev) => {\r\n        if (prev.includes(groupId)) return prev.filter((id) => id !== groupId);\r\n        if (prev.length >= maxSelectGroups) {\r\n          setAddToGroupError(`Chỉ chọn tối đa ${maxSelectGroups} nhóm`);\r\n          return prev;\r\n        }\r\n        return [...prev, groupId];\r\n      });\r\n    },\r\n    [maxSelectGroups],\r\n  );\r\n\r\n  const handleBatchAddToSelectedGroups = useCallback(async () => {\r\n    if (selectedGroupIds.length === 0) return;\r\n    setAddToGroupLoading(true);\r\n    setAddToGroupError('');\r\n    try {\r\n      const sock = io(resolveSocketUrl(), { transports: ['websocket'], withCredentials: false });\r\n      const targetId = String((selectedChat as User)._id);\r\n      for (const gid of selectedGroupIds) {\r\n        const res = await fetch('/api/groups', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            action: 'addMembers',\r\n            conversationId: gid,\r\n            newMembers: [targetId],\r\n            _id: currentUser._id,\r\n          }),\r\n        });\r\n        const json = await res.json();\r\n        if (!json.success) {\r\n          setAddToGroupError('Một số nhóm thêm thất bại');\r\n        } else {\r\n          const g = myGroupsQuick.find((x) => String(x._id) === String(gid)) || null;\r\n          const prevRaw = Array.isArray(g?.members)\r\n            ? (g!.members as Array<{ _id?: string; id?: string } | string>)\r\n            : [];\r\n          const prevIds = prevRaw\r\n            .map((m) => (typeof m === 'string' ? String(m) : String(m._id || m.id || '')))\r\n            .filter((v) => !!v);\r\n          const nextIds = Array.from(new Set([...prevIds, targetId]));\r\n          const prevMembersPayload = prevIds.map((id) => ({ _id: id }));\r\n          const nextMembersPayload = nextIds.map((id) => ({ _id: id }));\r\n          sock.emit('group_members_updated', {\r\n            roomId: String(gid),\r\n            members: nextMembersPayload,\r\n            prevMembers: prevMembersPayload,\r\n            sender: String(currentUser._id),\r\n            senderName: currentUser.name,\r\n            groupName: g?.name,\r\n          });\r\n        }\r\n      }\r\n      setTimeout(() => sock.disconnect(), 500);\r\n      setShowSuccessModal(true);\r\n      reLoad?.();\r\n      onClose();\r\n    } catch {\r\n      setAddToGroupError('Lỗi kết nối');\r\n    } finally {\r\n      setAddToGroupLoading(false);\r\n    }\r\n  }, [selectedGroupIds, selectedChat, reLoad, onClose, currentUser._id, currentUser.name, myGroupsQuick]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <>\r\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-white md:bg-black/50 md:px-4\">\r\n        <div className=\"bg-white md:rounded-2xl shadow-2xl w-full h-full md:h-[45rem] md:max-w-md overflow-hidden flex flex-col\">\r\n          <div className=\"p-4 border-b border-gray-100 bg-gray-50 flex-none\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <h3 className=\"font-bold text-gray-800\">Thêm vào nhóm</h3>\r\n              <button onClick={onClose} className=\"p-2 hover:bg-gray-200 rounded-full cursor-pointer transition-colors\">\r\n                <HiX className=\"w-5 h-5 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"text-xs text-gray-500 mt-1\">\r\n              Đã chọn: {selectedGroupIds.length}/{maxSelectGroups}\r\n            </div>\r\n          </div>\r\n          <div className=\"p-3 border-b border-gray-100 flex-none\">\r\n            <input\r\n              value={groupSearch}\r\n              onChange={(e) => setGroupSearch(e.target.value)}\r\n              placeholder=\"Nhập tên nhóm\"\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n            />\r\n          </div>\r\n          <button\r\n            onClick={() => {\r\n              try {\r\n                const w = window as Window & { __createGroupInitialMemberIds?: string[] };\r\n                w.__createGroupInitialMemberIds = [String((selectedChat as User)._id)];\r\n              } catch {}\r\n              onShowCreateGroup();\r\n              onClose();\r\n            }}\r\n            className=\"cursor-pointer w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-all flex-none\"\r\n          >\r\n            <div className=\"flex items-center gap-2\">\r\n              <HiPlus className=\"w-5 h-5 text-blue-600\" />\r\n              <span className=\"text-sm text-gray-800\">\r\n                Tạo nhóm với {(selectedChat as User).name || (selectedChat as User).username || 'Người dùng'}\r\n              </span>\r\n            </div>\r\n            <HiChevronRight className=\"w-4 h-4 text-gray-400\" />\r\n          </button>\r\n          <div className=\"p-4 space-y-2 overflow-y-auto flex-1 custom-scrollbar\">\r\n            {filteredGroups.length === 0 ? (\r\n              <div className=\"text-sm text-gray-600\">Chưa có nhóm nào</div>\r\n            ) : (\r\n              filteredGroups.map((g) => {\r\n                const isAlreadyMember =\r\n                  Array.isArray(g.members) &&\r\n                  g.members.some((m: { _id?: string; id?: string } | string) => {\r\n                    const mId = typeof m === 'string' ? m : m._id || m.id;\r\n                    return String(mId) === String((selectedChat as User)._id);\r\n                  });\r\n                const selected = selectedGroupIds.includes(String(g._id));\r\n                return (\r\n                  <button\r\n                    key={g._id}\r\n                    onClick={() => {\r\n                      if (isAlreadyMember || addToGroupLoading) return;\r\n                      toggleSelectGroup(String(g._id));\r\n                    }}\r\n                    disabled={addToGroupLoading || isAlreadyMember}\r\n                    className={`w-full flex items-center justify-between px-3 py-2 rounded-xl transition-colors cursor-pointer ${\r\n                      isAlreadyMember\r\n                        ? 'opacity-50 cursor-not-allowed bg-gray-50'\r\n                        : selected\r\n                          ? 'bg-blue-50'\r\n                          : 'hover:bg-gray-50'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div\r\n                        className={`w-6 h-6 rounded-full border flex items-center justify-center ${\r\n                          isAlreadyMember\r\n                            ? 'bg-blue-400 border-blue-400'\r\n                            : selected\r\n                              ? 'bg-blue-600 border-blue-600'\r\n                              : 'border-gray-300 bg-white'\r\n                        }`}\r\n                      >\r\n                        {(selected || isAlreadyMember) && (\r\n                          <svg className=\"w-5 h-5 text-white\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                            <path d=\"M20 6L9 17l-5-5\" />\r\n                          </svg>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"w-12 h-12 rounded-full overflow-hidden bg-gray-100\">\r\n                        {g.avatar ? (\r\n                          <Image\r\n                            src={getProxyUrl(g.avatar)}\r\n                            alt=\"\"\r\n                            width={36}\r\n                            height={36}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        ) : (\r\n                          <div className=\"w-full h-full flex items-center justify-center bg-gray-200 text-gray-700 font-bold\">\r\n                            {String(g.name || 'N')\r\n                              .charAt(0)\r\n                              .toUpperCase()}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"flex flex-col justify-center items-start min-w-0\">\r\n                        <span className=\"text-[1.3rem]  text-gray-800 truncate max-w-[15rem]\">{g.name || 'Nhóm'}</span>\r\n                        <span className=\"text-[1rem] text-gray-500\">\r\n                          {isAlreadyMember\r\n                            ? 'Đã tham gia'\r\n                            : `${Array.isArray(g.members) ? (g.members as unknown[]).length : 0} tv`}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })\r\n            )}\r\n            {addToGroupError && <div className=\"text-xs text-red-600\">{addToGroupError}</div>}\r\n          </div>\r\n          <div className=\"p-4 border-t border-gray-100 flex-none\">\r\n            <button\r\n              disabled={selectedGroupIds.length === 0 || addToGroupLoading}\r\n              onClick={handleBatchAddToSelectedGroups}\r\n              className={`w-full px-4 py-2 rounded-xl font-bold ${\r\n                selectedGroupIds.length === 0 || addToGroupLoading\r\n                  ? 'bg-gray-300 text-gray-600 cursor-not-allowed'\r\n                  : 'bg-indigo-600 text-white hover:bg-indigo-700'\r\n              }`}\r\n            >\r\n              {addToGroupLoading ? 'Đang thêm...' : 'Thêm vào nhóm'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <SuccessModal\r\n        isOpen={showSuccessModal}\r\n        onClose={() => setShowSuccessModal(false)}\r\n        title=\"Thành công\"\r\n        description=\"Đã thêm thành viên vào nhóm thành công.\"\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8709, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/CommonGroupsModal.tsx"],"sourcesContent":["import React from 'react';\r\nimport CommonGroupsMobile from '@/components/(group)/CommonGroupsMobile';\r\nimport { User } from '@/types/User';\r\nimport { GroupConversation } from '@/types/Group';\r\n\r\ninterface CommonGroupsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  groups: GroupConversation[];\r\n  partner: User;\r\n  onShowCreateGroup: () => void;\r\n  onShowAddToGroup: () => void;\r\n}\r\n\r\nexport default function CommonGroupsModal({\r\n  isOpen,\r\n  onClose,\r\n  groups,\r\n  partner,\r\n  onShowCreateGroup,\r\n  onShowAddToGroup,\r\n}: CommonGroupsModalProps) {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[100] bg-white md:bg-black/50 md:flex md:items-center md:justify-center\">\r\n      <div className=\"bg-white md:rounded-2xl shadow-2xl w-full h-full md:h-[45rem] md:max-w-md overflow-hidden flex flex-col\">\r\n        <CommonGroupsMobile\r\n           groups={groups}\r\n           partner={partner}\r\n           onBack={onClose}\r\n           onShowCreateGroup={onShowCreateGroup}\r\n           onShowAddToGroup={onShowAddToGroup}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;;;AAae,SAAS,kBAAkB,EACxC,MAAM,EACN,OAAO,EACP,MAAM,EACN,OAAO,EACP,iBAAiB,EACjB,gBAAgB,EACO;IACvB,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC,mKAAkB;gBAChB,QAAQ;gBACR,SAAS;gBACT,QAAQ;gBACR,mBAAmB;gBACnB,kBAAkB;;;;;;;;;;;;;;;;AAK7B;KAvBwB"}},
    {"offset": {"line": 8755, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/GroupAvatarSection.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { ChangeEvent, RefObject } from 'react';\r\nimport { HiPencil } from 'react-icons/hi';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport Image from 'next/image';\r\nimport { CiEdit } from 'react-icons/ci';\r\nimport { GroupRole } from '@/types/Group';\r\nimport RoleBadge from '@/components/base/RoleBadge';\r\n\r\ninterface GroupAvatarSectionProps {\r\n  isGroup: boolean;\r\n  groupAvatar?: string;\r\n  groupName: string;\r\n  chatName?: string;\r\n  isGroupAvatarUploading: boolean;\r\n  avatarInputRef: RefObject<HTMLInputElement | null>;\r\n  onChangeGroupAvatar: (e: ChangeEvent<HTMLInputElement>) => void;\r\n  onRenameGroup: () => void;\r\n  myRole?: GroupRole;\r\n}\r\n\r\nexport default function GroupAvatarSection({\r\n  isGroup,\r\n  groupAvatar,\r\n  groupName,\r\n  chatName,\r\n  isGroupAvatarUploading,\r\n  avatarInputRef,\r\n  onChangeGroupAvatar,\r\n  onRenameGroup,\r\n  myRole,\r\n}: GroupAvatarSectionProps) {\r\n  // if (!isGroup) return null;\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center mb-2 \">\r\n      {/* Avatar lớn + hiệu ứng đổi ảnh */}\r\n      <div className=\"relative group\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => avatarInputRef.current?.click()}\r\n          className=\"cursor-pointer relative block focus:outline-none focus:ring-4 focus:ring-blue-300 rounded-full transition-all duration-300\"\r\n          disabled={isGroupAvatarUploading}\r\n          title=\"Nhấn để thay đổi ảnh nhóm\"\r\n        >\r\n          <div className=\"w-20 h-20 rounded-full overflow-hidden shadow-2xl p-1\">\r\n            <div className=\"w-full h-full rounded-full overflow-hidden bg-gray-200\">\r\n              {groupAvatar ? (\r\n                <Image\r\n                  width={100}\r\n                  height={100}\r\n                  src={getProxyUrl(groupAvatar)}\r\n                  alt={chatName || 'Avatar nhóm'}\r\n                  className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\r\n                  onError={(e) => {\r\n                    e.currentTarget.style.display = 'none';\r\n                    e.currentTarget.nextElementSibling?.classList.remove('hidden');\r\n                  }}\r\n                />\r\n              ) : null}\r\n\r\n              {/* Fallback: chữ cái đầu */}\r\n              <div\r\n                className={`w-full h-full flex items-center justify-center text-4xl font-bold text-white ${\r\n                  groupAvatar ? 'hidden' : ''\r\n                }`}\r\n              >\r\n                <Image\r\n                  width={40}\r\n                  height={40}\r\n                  src=\"/logo/avata.webp\"\r\n                  alt={chatName || 'Avatar nhóm'}\r\n                  className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Overlay khi hover hoặc đang upload */}\r\n          <div\r\n            className={`absolute inset-0 rounded-full flex flex-col items-center justify-center transition-all duration-300\r\n              ${\r\n                isGroupAvatarUploading\r\n                  ? 'bg-black/70 backdrop-blur-sm'\r\n                  : 'bg-black/50 backdrop-blur-sm opacity-0 group-hover:opacity-100'\r\n              }`}\r\n          >\r\n            {isGroupAvatarUploading ? (\r\n              <div className=\"flex flex-col items-center gap-2\">\r\n                <div className=\"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin\" />\r\n                <span className=\"text-white text-sm font-medium\">Đang cập nhật...</span>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex flex-col items-center gap-1\">\r\n                <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"\r\n                  />\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"\r\n                  />\r\n                </svg>\r\n                <span className=\"text-white text-xs font-medium\">Đổi ảnh</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </button>\r\n\r\n        {/* Nút camera nhỏ giống ảnh minh họa */}\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => avatarInputRef.current?.click()}\r\n          className=\"absolute -bottom-1 -right-1 p-1.5 rounded-full bg-white shadow-lg  hover:bg-gray-50 transition\"\r\n          title=\"Đổi ảnh nhóm\"\r\n        >\r\n          <svg className=\"w-4 h-4 text-gray-700\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"\r\n            />\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n          </svg>\r\n        </button>\r\n\r\n        <input type=\"file\" accept=\"image/*\" ref={avatarInputRef} className=\"hidden\" onChange={onChangeGroupAvatar} />\r\n      </div>\r\n\r\n      {/* Tên nhóm + nút đổi tên */}\r\n      <div className=\"mt-6 flex items-center gap-3 \">\r\n        <h3 className=\"text-xl font-medium text-gray-900 tracking-tight truncate max-w-[10rem]\">\r\n          {groupName || 'Nhóm chat'}\r\n        </h3>\r\n        <button\r\n          onClick={onRenameGroup}\r\n          className=\"cursor-pointer p-1 rounded-xl  bg-gray-100 hover:bg-gray-200 text-gray-600 hover:text-gray-800 transition-all duration-200 hover:shadow-md active:scale-95\"\r\n          title=\"Đổi tên nhóm\"\r\n        >\r\n          <CiEdit className=\"w-4 h-4\" />\r\n        </button>\r\n      </div>\r\n\r\n      {isGroup && myRole && myRole !== 'MEMBER' && (\r\n        <div className=\"mt-2\">\r\n          <RoleBadge role={myRole} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAGpD;AACA;AACA;AAEA;;;;;;AAce,SAAS,mBAAmB,EACzC,OAAO,EACP,WAAW,EACX,SAAS,EACT,QAAQ,EACR,sBAAsB,EACtB,cAAc,EACd,mBAAmB,EACnB,aAAa,EACb,MAAM,EACkB;IACxB,6BAA6B;IAE7B,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,eAAe,OAAO,EAAE;wBACvC,WAAU;wBACV,UAAU;wBACV,OAAM;;0CAEN,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC;oCAAI,WAAU;;wCACZ,4BACC,6LAAC,2IAAK;4CACJ,OAAO;4CACP,QAAQ;4CACR,KAAK,IAAA,uIAAW,EAAC;4CACjB,KAAK,YAAY;4CACjB,WAAU;4CACV,SAAS,CAAC;gDACR,EAAE,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG;gDAChC,EAAE,aAAa,CAAC,kBAAkB,EAAE,UAAU,OAAO;4CACvD;;;;;mDAEA;sDAGJ,6LAAC;4CACC,WAAW,CAAC,6EAA6E,EACvF,cAAc,WAAW,IACzB;sDAEF,cAAA,6LAAC,2IAAK;gDACJ,OAAO;gDACP,QAAQ;gDACR,KAAI;gDACJ,KAAK,YAAY;gDACjB,WAAU;;;;;;;;;;;;;;;;;;;;;;0CAOlB,6LAAC;gCACC,WAAW,CAAC;cACV,EACE,yBACI,iCACA,kEACJ;0CAEH,uCACC,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;;;;;;sDACf,6LAAC;4CAAK,WAAU;sDAAiC;;;;;;;;;;;yDAGnD,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;4CAAqB,MAAK;4CAAO,QAAO;4CAAe,SAAQ;;8DAC5E,6LAAC;oDACC,eAAc;oDACd,gBAAe;oDACf,aAAa;oDACb,GAAE;;;;;;8DAEJ,6LAAC;oDACC,eAAc;oDACd,gBAAe;oDACf,aAAa;oDACb,GAAE;;;;;;;;;;;;sDAGN,6LAAC;4CAAK,WAAU;sDAAiC;;;;;;;;;;;;;;;;;;;;;;;kCAOzD,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,eAAe,OAAO,EAAE;wBACvC,WAAU;wBACV,OAAM;kCAEN,cAAA,6LAAC;4BAAI,WAAU;4BAAwB,MAAK;4BAAO,QAAO;4BAAe,SAAQ;;8CAC/E,6LAAC;oCACC,eAAc;oCACd,gBAAe;oCACf,aAAa;oCACb,GAAE;;;;;;8CAEJ,6LAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa;oCAAG,GAAE;;;;;;;;;;;;;;;;;kCAIzE,6LAAC;wBAAM,MAAK;wBAAO,QAAO;wBAAU,KAAK;wBAAgB,WAAU;wBAAS,UAAU;;;;;;;;;;;;0BAIxF,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;kCACX,aAAa;;;;;;kCAEhB,6LAAC;wBACC,SAAS;wBACT,WAAU;wBACV,OAAM;kCAEN,cAAA,6LAAC,2JAAM;4BAAC,WAAU;;;;;;;;;;;;;;;;;YAIrB,WAAW,UAAU,WAAW,0BAC/B,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,qJAAS;oBAAC,MAAM;;;;;;;;;;;;;;;;;AAK3B;KAvIwB"}},
    {"offset": {"line": 9042, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/RichTextEditor.tsx"],"sourcesContent":["'use client';\n\nimport React, { useMemo } from 'react';\nimport dynamic from 'next/dynamic';\nimport 'react-quill-new/dist/quill.snow.css';\nimport { HiX } from 'react-icons/hi';\n\n// Dynamic import to avoid SSR issues\nconst ReactQuill = dynamic(() => import('react-quill-new'), { ssr: false });\n\ninterface RichTextEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  onClose?: () => void;\n  onSend?: () => void;\n}\n\nexport default function RichTextEditor({ value, onChange, onClose, onSend }: RichTextEditorProps) {\n  const modules = useMemo(\n    () => ({\n      toolbar: {\n        container: '#quill-toolbar-container',\n      },\n    }),\n    [],\n  );\n\n  return (\n    <div className=\"flex flex-col h-full w-full bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden relative\">\n      {/* Close button absolute positioned */}\n      <div className=\"absolute top-2 right-2 z-10\">\n        <button onClick={onClose} className=\"p-1 hover:bg-gray-100 rounded-full text-gray-500 transition-colors\">\n          <HiX className=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      {/* Editor Area */}\n      <div className=\"flex-1 overflow-hidden relative quill-custom-wrapper\">\n        <ReactQuill\n          theme=\"snow\"\n          value={value}\n          onChange={onChange}\n          modules={modules}\n          placeholder=\"Nhấn Ctrl + Shift + X để định dạng tin nhắn\"\n          className=\"h-full\"\n        />\n      </div>\n\n      {/* Custom Toolbar at Bottom */}\n      <div id=\"quill-toolbar-container\" className=\"flex items-center gap-0.5 p-2 border-t border-gray-200 bg-white\">\n        <span className=\"ql-formats\">\n          <button className=\"ql-bold\" aria-label=\"Bold\"></button>\n          <button className=\"ql-italic\" aria-label=\"Italic\"></button>\n          <button className=\"ql-underline\" aria-label=\"Underline\"></button>\n          <button className=\"ql-strike\" aria-label=\"Strike\"></button>\n        </span>\n\n        {/* <span className=\"ql-formats\">\n          <select className=\"ql-color\"></select>\n          <select className=\"ql-background\"></select>\n        </span>\n\n        <span className=\"ql-formats\">\n          <button className=\"ql-clean\" aria-label=\"Clear Formatting\"></button>\n        </span> */}\n\n        <span className=\"ql-formats\">\n          <button className=\"ql-list\" value=\"ordered\" aria-label=\"Ordered List\"></button>\n          <button className=\"ql-list\" value=\"bullet\" aria-label=\"Bullet List\"></button>\n          <button className=\"ql-indent\" value=\"-1\" aria-label=\"Indent Less\"></button>\n          <button className=\"ql-indent\" value=\"+1\" aria-label=\"Indent More\"></button>\n        </span>\n\n        <div className=\"flex-1\"></div>\n\n        {/* Right side icons */}\n        <div className=\"flex items-center gap-2 ml-2\">\n          <button className=\"p-1.5 hover:bg-gray-100 rounded-full transition-colors\" onClick={onSend} aria-label=\"Send\">\n            <span className=\"text-blue-600 font-semibold text-sm\">GỬI</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Custom CSS overrides for Quill to match the design */}\n      <style jsx global>{`\n        .quill-custom-wrapper .ql-container.ql-snow {\n          border: none;\n          height: 100%;\n          font-family: inherit;\n          font-size: 1rem;\n        }\n        .quill-custom-wrapper .ql-editor {\n          height: 100%;\n          padding: 1rem;\n          font-size: 1rem;\n          color: #374151; /* text-gray-700 */\n        }\n        .quill-custom-wrapper .ql-editor.ql-blank::before {\n          font-style: normal;\n          color: #9ca3af; /* text-gray-400 */\n          font-size: 0.875rem;\n        }\n        /* Hide the default toolbar border if any */\n        #quill-toolbar-container.ql-toolbar.ql-snow {\n          border: none;\n          border-top: 1px solid #e5e7eb;\n          padding: 8px;\n        }\n      `}</style>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAEA;AACA;AAEA;;;;AALA;;;;;;AAOA,qCAAqC;AACrC,MAAM,aAAa,IAAA,6KAAO,EAAC;;;;;;IAAmC,KAAK;;KAA7D;AASS,SAAS,eAAe,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,EAAuB;;IAC9F,MAAM,UAAU,IAAA,wKAAO;2CACrB,IAAM,CAAC;gBACL,SAAS;oBACP,WAAW;gBACb;YACF,CAAC;0CACD,EAAE;IAGJ,qBACE,6LAAC;kDAAc;;0BAEb,6LAAC;0DAAc;0BACb,cAAA,6LAAC;oBAAO,SAAS;8DAAmB;8BAClC,cAAA,6LAAC,wJAAG;wBAAC,WAAU;;;;;;;;;;;;;;;;0BAKnB,6LAAC;0DAAc;0BACb,cAAA,6LAAC;oBACC,OAAM;oBACN,OAAO;oBACP,UAAU;oBACV,SAAS;oBACT,aAAY;oBACZ,WAAU;;;;;;;;;;;0BAKd,6LAAC;gBAAI,IAAG;0DAAoC;;kCAC1C,6LAAC;kEAAe;;0CACd,6LAAC;gCAA2B,cAAW;0EAArB;;;;;;0CAClB,6LAAC;gCAA6B,cAAW;0EAAvB;;;;;;0CAClB,6LAAC;gCAAgC,cAAW;0EAA1B;;;;;;0CAClB,6LAAC;gCAA6B,cAAW;0EAAvB;;;;;;;;;;;;kCAYpB,6LAAC;kEAAe;;0CACd,6LAAC;gCAA2B,OAAM;gCAAU,cAAW;0EAArC;;;;;;0CAClB,6LAAC;gCAA2B,OAAM;gCAAS,cAAW;0EAApC;;;;;;0CAClB,6LAAC;gCAA6B,OAAM;gCAAK,cAAW;0EAAlC;;;;;;0CAClB,6LAAC;gCAA6B,OAAM;gCAAK,cAAW;0EAAlC;;;;;;;;;;;;kCAGpB,6LAAC;kEAAc;;;;;;kCAGf,6LAAC;kEAAc;kCACb,cAAA,6LAAC;4BAA0E,SAAS;4BAAQ,cAAW;sEAArF;sCAChB,cAAA,6LAAC;0EAAe;0CAAsC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiClE;GA9FwB;MAAA"}},
    {"offset": {"line": 9273, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ReactionButton.tsx"],"sourcesContent":["import ICSmile from '@/components/svg/ICSmile';\r\nimport React, { useState } from 'react';\r\n\r\ntype Props = {\r\n  isMine: boolean;\r\n  onPick: (emoji: string) => void;\r\n  visible?: boolean;\r\n  className?: string;\r\n};\r\n\r\nconst EMOJIS = ['👍', '❤️', '😂', '😮', '😢', '😡'];\r\n\r\nexport default function ReactionButton({ isMine, onPick, visible, className = '' }: Props) {\r\n  const [open, setOpen] = useState(false);\r\n  const sideCls = isMine ? 'right-full mr-3' : 'left-full ml-3';\r\n  const pickerSideCls = isMine ? 'left-1/2 -translate-x-1/2' : 'left-1/2 -translate-x-3/4';\r\n  // const pickerSideCls = isMine ? 'right-0' : 'left-0 -translate-x-';\r\n\r\n  return (\r\n    <div\r\n      className={`\r\n        absolute top-1/2 -translate-y-1/2 z-20 ${sideCls}\r\n        ${visible ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}\r\n        transition-opacity duration-150\r\n        ${className}\r\n      `}\r\n    >\r\n      <div className=\"relative inline-flex\">\r\n        <button\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setOpen((v) => !v);\r\n          }}\r\n          className=\"w-8 h-8 hover:cursor-pointer rounded-full bg-white border border-gray-300 shadow-sm flex items-center justify-center text-base hover:scale-110 active:scale-95 transition-all\"\r\n          aria-label=\"Thả cảm xúc\"\r\n        >\r\n          <ICSmile className='w-4 h-4'/>\r\n        </button>\r\n        <div\r\n          className={`absolute ${pickerSideCls} z-50 bottom-full mb-2 flex items-center gap-1 px-3 py-2 bg-white rounded-full shadow-xl border border-gray-200 transition-all ${open ? 'opacity-100 visible pointer-events-auto scale-100' : 'opacity-0 invisible pointer-events-none scale-95'} origin-bottom whitespace-nowrap overflow-x-auto no-scrollbar max-w-[calc(100vw-64px)] sm:max-w-[20rem]`}\r\n        >\r\n          {EMOJIS.map((emoji) => (\r\n            <button\r\n              key={emoji}\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                setOpen(false);\r\n                onPick(emoji);\r\n              }}\r\n              className=\"w-9 h-9 flex items-center justify-center text-xl rounded-full hover:bg-gray-100 active:scale-90 transition-transform\"\r\n              aria-label={emoji}\r\n            >\r\n              {emoji}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;AASA,MAAM,SAAS;IAAC;IAAM;IAAM;IAAM;IAAM;IAAM;CAAK;AAEpC,SAAS,eAAe,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,YAAY,EAAE,EAAS;;IACvF,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,UAAU,SAAS,oBAAoB;IAC7C,MAAM,gBAAgB,SAAS,8BAA8B;IAC7D,qEAAqE;IAErE,qBACE,6LAAC;QACC,WAAW,CAAC;+CAC6B,EAAE,QAAQ;QACjD,EAAE,UAAU,oCAAoC,gCAAgC;;QAEhF,EAAE,UAAU;MACd,CAAC;kBAED,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBACC,SAAS,CAAC;wBACR,EAAE,eAAe;wBACjB,QAAQ,CAAC,IAAM,CAAC;oBAClB;oBACA,WAAU;oBACV,cAAW;8BAEX,cAAA,6LAAC,kJAAO;wBAAC,WAAU;;;;;;;;;;;8BAErB,6LAAC;oBACC,WAAW,CAAC,SAAS,EAAE,cAAc,+HAA+H,EAAE,OAAO,sDAAsD,mDAAmD,uGAAuG,CAAC;8BAE7X,OAAO,GAAG,CAAC,CAAC,sBACX,6LAAC;4BAEC,SAAS,CAAC;gCACR,EAAE,eAAe;gCACjB,QAAQ;gCACR,OAAO;4BACT;4BACA,WAAU;4BACV,cAAY;sCAEX;2BATI;;;;;;;;;;;;;;;;;;;;;AAgBnB;GA/CwB;KAAA"}},
    {"offset": {"line": 9371, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ReadStatus.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport React, { useState } from 'react';\r\nimport Image from 'next/image';\r\nimport type { Message } from '@/types/Message';\r\nimport type { User } from '@/types/User';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport ICTickDouble from '@/components/svg/ICTickDouble';\r\n\r\ninterface SenderInfo {\r\n  _id: string;\r\n  name: string;\r\n  avatar: string | null;\r\n}\r\n\r\ninterface ReadStatusProps {\r\n  message: Message;\r\n  isGroup: boolean;\r\n  isRecalled?: boolean;\r\n  isMine: boolean;\r\n  isLast: boolean;\r\n  myId: string;\r\n  allUsersMap: Map<string, string>;\r\n  getSenderInfo: (sender: User | string) => SenderInfo;\r\n  isMobile?: boolean;\r\n  isUploading?: boolean;\r\n}\r\n\r\nexport default function ReadStatus({\r\n  message,\r\n  isGroup,\r\n  isRecalled,\r\n  isMine,\r\n  isLast,\r\n  myId,\r\n  allUsersMap,\r\n  getSenderInfo,\r\n  isMobile,\r\n  isUploading,\r\n}: ReadStatusProps) {\r\n  const [open, setOpen] = useState(false);\r\n  //   const shouldOpen = !!isMobile || (typeof window !== 'undefined' && window.innerWidth <= 1024);\r\n\r\n  if (!isMine || !isLast || isRecalled) return null;\r\n  if (isUploading) return null;\r\n\r\n  const readBy = (message.readBy || []) as string[];\r\n\r\n  if (!isGroup) {\r\n    const seen = readBy.some((id) => String(id) !== String(myId));\r\n    return (\r\n      <span className=\"flex items-center bg-gray-400 text-[0.75rem] mt-2 text-white px-2 py-0.5 rounded-full\">\r\n        <ICTickDouble className=\" w-4 h-4\" />\r\n        {seen ? 'Đã xem' : 'Đã gửi'}\r\n      </span>\r\n    );\r\n  }\r\n\r\n  const readers = readBy.filter((id) => String(id) !== String(myId));\r\n\r\n  const names = readers.map((id) => allUsersMap.get(String(id)) || 'Người dùng');\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        className=\"flex mt-2 cursor-pointer\"\r\n        title={readers.length > 0 ? names.join(', ') : undefined}\r\n        onClick={() => {\r\n          setOpen(true);\r\n        }}\r\n      >\r\n        <div className=\"flex items-center justify-center gap-1\">\r\n          {readers.length === 0 ? (\r\n            <span className=\"flex items-center gap-1 bg-gray-400 text-[0.75rem] text-white px-2 py-0.5 rounded-full\">\r\n              <ICTickDouble className=\"w-4 h-4 flex-shrink-0\" />\r\n              Đã gửi\r\n            </span>\r\n          ) : (\r\n            <>\r\n              {readers.slice(0, 6).map((id, idx) => {\r\n                const info = getSenderInfo(id);\r\n                const key = `${message._id}-reader-${idx}`;\r\n                return (\r\n                  <div\r\n                    key={key}\r\n                    className=\"w-4 h-4 rounded-full bg-gray-300 overflow-hidden ring-1 ring-white flex-shrink-0\"\r\n                  >\r\n                    <Image\r\n                      src={info.avatar ? getProxyUrl(info.avatar) : '/logo/avata.webp'}\r\n                      alt={info.name}\r\n                      width={16}\r\n                      height={16}\r\n                      className=\"w-full h-full object-cover\"\r\n                    />\r\n                  </div>\r\n                );\r\n              })}\r\n              {readers.length > 6 && (\r\n                <div className=\"w-4 h-4 rounded-full bg-gray-200 text-gray-700 text-[0.625rem] flex items-center justify-center ring-1 ring-white flex-shrink-0\">\r\n                  +{readers.length - 6}\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {open && readers.length > 0 && (\r\n        <>\r\n          {/* Backdrop - đóng khi click */}\r\n          <div className=\"fixed inset-0 z-[9998]\" onClick={() => setOpen(false)} />\r\n\r\n          {/* Popup modal */}\r\n          <div className=\"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-none\">\r\n            <div\r\n              className=\"min-w-[11.25rem] max-w-[18rem] px-3 py-2.5 bg-white rounded-xl border border-gray-200 shadow-xl pointer-events-auto\"\r\n              onClick={(e) => e.stopPropagation()}\r\n            >\r\n              <div className=\"flex items-center gap-2 mb-2 pb-2 border-b border-gray-100\">\r\n                <span className=\"text-sm font-semibold text-gray-700\">Đã xem</span>\r\n                <span className=\"text-xs text-gray-500\">{readers.length} người</span>\r\n              </div>\r\n              <ul className=\"space-y-1.5 max-h-48 overflow-y-auto\">\r\n                {readers.map((id, idx) => {\r\n                  const info = getSenderInfo(id);\r\n                  const displayName = info.name || allUsersMap.get(String(id)) || 'Người dùng';\r\n                  return (\r\n                    <li key={`${message._id}-reader-name-${idx}`} className=\"flex items-center gap-2 py-1\">\r\n                      <div className=\"w-4 h-4 rounded-full bg-gray-300 overflow-hidden ring-1 ring-white flex-shrink-0\">\r\n                        <Image\r\n                          src={info.avatar ? getProxyUrl(info.avatar) : '/logo/avata.webp'}\r\n                          alt={displayName}\r\n                          width={16}\r\n                          height={16}\r\n                          className=\"w-full h-full object-cover\"\r\n                        />\r\n                      </div>\r\n                      <span className=\"text-sm text-gray-700\">{displayName}</span>\r\n                    </li>\r\n                  );\r\n                })}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AACpD;AACA;AAGA;AACA;;;;;;;AAqBe,SAAS,WAAW,EACjC,OAAO,EACP,OAAO,EACP,UAAU,EACV,MAAM,EACN,MAAM,EACN,IAAI,EACJ,WAAW,EACX,aAAa,EACb,QAAQ,EACR,WAAW,EACK;;IAChB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,mGAAmG;IAEnG,IAAI,CAAC,UAAU,CAAC,UAAU,YAAY,OAAO;IAC7C,IAAI,aAAa,OAAO;IAExB,MAAM,SAAU,QAAQ,MAAM,IAAI,EAAE;IAEpC,IAAI,CAAC,SAAS;QACZ,MAAM,OAAO,OAAO,IAAI,CAAC,CAAC,KAAO,OAAO,QAAQ,OAAO;QACvD,qBACE,6LAAC;YAAK,WAAU;;8BACd,6LAAC,uJAAY;oBAAC,WAAU;;;;;;gBACvB,OAAO,WAAW;;;;;;;IAGzB;IAEA,MAAM,UAAU,OAAO,MAAM,CAAC,CAAC,KAAO,OAAO,QAAQ,OAAO;IAE5D,MAAM,QAAQ,QAAQ,GAAG,CAAC,CAAC,KAAO,YAAY,GAAG,CAAC,OAAO,QAAQ;IAEjE,qBACE;;0BACE,6LAAC;gBACC,WAAU;gBACV,OAAO,QAAQ,MAAM,GAAG,IAAI,MAAM,IAAI,CAAC,QAAQ;gBAC/C,SAAS;oBACP,QAAQ;gBACV;0BAEA,cAAA,6LAAC;oBAAI,WAAU;8BACZ,QAAQ,MAAM,KAAK,kBAClB,6LAAC;wBAAK,WAAU;;0CACd,6LAAC,uJAAY;gCAAC,WAAU;;;;;;4BAA0B;;;;;;6CAIpD;;4BACG,QAAQ,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAI;gCAC5B,MAAM,OAAO,cAAc;gCAC3B,MAAM,MAAM,GAAG,QAAQ,GAAG,CAAC,QAAQ,EAAE,KAAK;gCAC1C,qBACE,6LAAC;oCAEC,WAAU;8CAEV,cAAA,6LAAC,2IAAK;wCACJ,KAAK,KAAK,MAAM,GAAG,6IAAY,KAAK,MAAM,IAAI;wCAC9C,KAAK,KAAK,IAAI;wCACd,OAAO;wCACP,QAAQ;wCACR,WAAU;;;;;;mCARP;;;;;4BAYX;4BACC,QAAQ,MAAM,GAAG,mBAChB,6LAAC;gCAAI,WAAU;;oCAAkI;oCAC7I,QAAQ,MAAM,GAAG;;;;;;;;;;;;;;;;;;;YAQ9B,QAAQ,QAAQ,MAAM,GAAG,mBACxB;;kCAEE,6LAAC;wBAAI,WAAU;wBAAyB,SAAS,IAAM,QAAQ;;;;;;kCAG/D,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BACC,WAAU;4BACV,SAAS,CAAC,IAAM,EAAE,eAAe;;8CAEjC,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAK,WAAU;sDAAsC;;;;;;sDACtD,6LAAC;4CAAK,WAAU;;gDAAyB,QAAQ,MAAM;gDAAC;;;;;;;;;;;;;8CAE1D,6LAAC;oCAAG,WAAU;8CACX,QAAQ,GAAG,CAAC,CAAC,IAAI;wCAChB,MAAM,OAAO,cAAc;wCAC3B,MAAM,cAAc,KAAK,IAAI,IAAI,YAAY,GAAG,CAAC,OAAO,QAAQ;wCAChE,qBACE,6LAAC;4CAA6C,WAAU;;8DACtD,6LAAC;oDAAI,WAAU;8DACb,cAAA,6LAAC,2IAAK;wDACJ,KAAK,KAAK,MAAM,GAAG,6IAAY,KAAK,MAAM,IAAI;wDAC9C,KAAK;wDACL,OAAO;wDACP,QAAQ;wDACR,WAAU;;;;;;;;;;;8DAGd,6LAAC;oDAAK,WAAU;8DAAyB;;;;;;;2CAVlC,GAAG,QAAQ,GAAG,CAAC,aAAa,EAAE,KAAK;;;;;oCAahD;;;;;;;;;;;;;;;;;;;;;AAQhB;GAxHwB;KAAA"}},
    {"offset": {"line": 9605, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/components/ReminderCard.tsx"],"sourcesContent":["import Image from 'next/image';\r\nimport { getProxyUrl } from '@/utils/utils';\r\nimport { HiOutlineClock } from 'react-icons/hi2';\r\n\r\ntype Variant = 'create' | 'due' | 'message';\r\n\r\ninterface ReminderCardProps {\r\n  variant: Variant;\r\n  title: string;\r\n  date: Date;\r\n  senderName?: string;\r\n  senderAvatar?: string | null;\r\n  isMe?: boolean;\r\n  highlighted?: boolean;\r\n  onOpen?: () => void;\r\n}\r\n\r\nfunction timeDisplay(date: Date) {\r\n  const today = new Date();\r\n  const sameDay =\r\n    today.getFullYear() === date.getFullYear() &&\r\n    today.getMonth() === date.getMonth() &&\r\n    today.getDate() === date.getDate();\r\n  const timeStr = date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });\r\n  const dateStr = date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n  return sameDay ? `Hôm nay lúc ${timeStr}` : `${dateStr} lúc ${timeStr}`;\r\n}\r\n\r\nexport default function ReminderCard({\r\n  variant,\r\n  title,\r\n  date,\r\n  senderName,\r\n  senderAvatar,\r\n  isMe = false,\r\n  highlighted = false,\r\n  onOpen,\r\n}: ReminderCardProps) {\r\n  const month = date.getMonth() + 1;\r\n  const day = date.getDate();\r\n  if (variant === 'due') {\r\n    return (\r\n      <div\r\n        className={`w-full max-w-[18rem] p-4 bg-white rounded-2xl border border-gray-200 shadow-sm text-center ${\r\n          highlighted ? 'ring-2 ring-yellow-300' : ''\r\n        }`}\r\n      >\r\n        <div className=\"flex justify-center mb-2\">\r\n          <HiOutlineClock className=\"w-7 h-7 text-red-500\" />\r\n        </div>\r\n        <p className=\"text-base font-semibold text-gray-900 truncate\">Nhắc hẹn: {title || ''}</p>\r\n        <p className=\"text-sm text-gray-500 mt-0.5\">{timeDisplay(date)}</p>\r\n        <div className=\"pt-2\">\r\n          <button\r\n            onClick={onOpen}\r\n            className=\"w-[10rem] cursor-pointer px-4 py-1 text-gray-700 bg-gray-100 border border-gray-300 rounded-full hover:bg-gray-200 font-bold text-sm uppercase transition-all\"\r\n          >\r\n            MỞ LỊCH\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  return (\r\n    <div\r\n      className={`bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden w-full max-w-[18rem] ${\r\n        highlighted ? 'ring-2 ring-yellow-300' : ''\r\n      }`}\r\n    >\r\n      <div className=\"flex items-center gap-2 p-3 border-b border-gray-100 bg-white\">\r\n        <div className=\"w-6 h-6 rounded-full overflow-hidden flex-shrink-0\">\r\n          {senderAvatar ? (\r\n            <Image\r\n              src={getProxyUrl(senderAvatar)}\r\n              width={24}\r\n              height={24}\r\n              className=\"object-cover w-full h-full\"\r\n              alt=\"\"\r\n            />\r\n          ) : (\r\n            <div className=\"w-full h-full bg-blue-500 text-white flex items-center justify-center text-[10px] font-bold\">\r\n              <Image\r\n                src=\"/logo/avata.webp\"\r\n                alt=\"\"\r\n                width={64}\r\n                height={64}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            </div>\r\n          )}\r\n        </div>\r\n        <span className=\"text-sm text-gray-700\">{isMe ? 'Bạn' : senderName} đã tạo một nhắc hẹn</span>\r\n      </div>\r\n      <div className=\"flex p-4 gap-4 items-center cursor-pointer\">\r\n        <div className=\"flex flex-col items-center justify-center min-w-[50px]\">\r\n          <span className=\"text-red-500 text-xs font-bold uppercase tracking-wider\">THG {month}</span>\r\n          <span className=\"text-3xl text-gray-800 font-normal leading-none mt-1\">{day}</span>\r\n        </div>\r\n        <div className=\"flex flex-col overflow-hidden\">\r\n          <p className=\"text-lg font-semibold text-gray-900 truncate\">{title || 'Không có tiêu đề'}</p>\r\n          <p className=\"text-sm text-gray-500 mt-0.5\">{timeDisplay(date)}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAeA,SAAS,YAAY,IAAU;IAC7B,MAAM,QAAQ,IAAI;IAClB,MAAM,UACJ,MAAM,WAAW,OAAO,KAAK,WAAW,MACxC,MAAM,QAAQ,OAAO,KAAK,QAAQ,MAClC,MAAM,OAAO,OAAO,KAAK,OAAO;IAClC,MAAM,UAAU,KAAK,kBAAkB,CAAC,SAAS;QAAE,MAAM;QAAW,QAAQ;IAAU;IACtF,MAAM,UAAU,KAAK,kBAAkB,CAAC,SAAS;QAAE,KAAK;QAAW,OAAO;QAAW,MAAM;IAAU;IACrG,OAAO,UAAU,CAAC,YAAY,EAAE,SAAS,GAAG,GAAG,QAAQ,KAAK,EAAE,SAAS;AACzE;AAEe,SAAS,aAAa,EACnC,OAAO,EACP,KAAK,EACL,IAAI,EACJ,UAAU,EACV,YAAY,EACZ,OAAO,KAAK,EACZ,cAAc,KAAK,EACnB,MAAM,EACY;IAClB,MAAM,QAAQ,KAAK,QAAQ,KAAK;IAChC,MAAM,MAAM,KAAK,OAAO;IACxB,IAAI,YAAY,OAAO;QACrB,qBACE,6LAAC;YACC,WAAW,CAAC,2FAA2F,EACrG,cAAc,2BAA2B,IACzC;;8BAEF,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,oKAAc;wBAAC,WAAU;;;;;;;;;;;8BAE5B,6LAAC;oBAAE,WAAU;;wBAAiD;wBAAW,SAAS;;;;;;;8BAClF,6LAAC;oBAAE,WAAU;8BAAgC,YAAY;;;;;;8BACzD,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;;;;;;IAMT;IACA,qBACE,6LAAC;QACC,WAAW,CAAC,2FAA2F,EACrG,cAAc,2BAA2B,IACzC;;0BAEF,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;kCACZ,6BACC,6LAAC,2IAAK;4BACJ,KAAK,IAAA,uIAAW,EAAC;4BACjB,OAAO;4BACP,QAAQ;4BACR,WAAU;4BACV,KAAI;;;;;iDAGN,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,2IAAK;gCACJ,KAAI;gCACJ,KAAI;gCACJ,OAAO;gCACP,QAAQ;gCACR,WAAU;;;;;;;;;;;;;;;;kCAKlB,6LAAC;wBAAK,WAAU;;4BAAyB,OAAO,QAAQ;4BAAW;;;;;;;;;;;;;0BAErE,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;;oCAA0D;oCAAK;;;;;;;0CAC/E,6LAAC;gCAAK,WAAU;0CAAwD;;;;;;;;;;;;kCAE1E,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAE,WAAU;0CAAgD,SAAS;;;;;;0CACtE,6LAAC;gCAAE,WAAU;0CAAgC,YAAY;;;;;;;;;;;;;;;;;;;;;;;;AAKnE;KA7EwB"}}]
}