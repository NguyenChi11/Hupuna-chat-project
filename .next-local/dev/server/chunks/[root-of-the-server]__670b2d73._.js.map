{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28mongodb%29/connectToDatabase.tsx"],"sourcesContent":["// app\\lib\\monggodb\\connectToDatabase.tsx\r\n\r\nimport { MongoClient, Db } from 'mongodb';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/';\r\nconst MONGODB_DB = process.env.MONGODB_DB || 'hupuna-price';\r\n\r\n// Cache client khi hot-reload (Next.js dev mode)\r\nlet cachedClient: MongoClient | null = null;\r\nlet cachedDb: Db | null = null;\r\n\r\nexport async function connectToDatabase(): Promise<{ client: MongoClient; db: Db }> {\r\n  if (cachedClient && cachedDb) {\r\n    return { client: cachedClient, db: cachedDb };\r\n  }\r\n\r\n  if (process.env.NODE_ENV === 'production' && (MONGODB_URI.includes('localhost') || MONGODB_URI.includes('127.0.0.1'))) {\r\n    console.error('‚ùå ERROR: You are using a localhost MongoDB URI in production. Please set MONGODB_URI in your Vercel project settings to a remote database (e.g., MongoDB Atlas).');\r\n  }\r\n\r\n  const client = new MongoClient(MONGODB_URI);\r\n  await client.connect();\r\n\r\n  const db = client.db(MONGODB_DB);\r\n\r\n  cachedClient = client;\r\n  cachedDb = db;\r\n\r\n  return { client, db };\r\n}\r\n"],"names":[],"mappings":"AAAA,yCAAyC;;;;;AAEzC;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC/C,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE7C,iDAAiD;AACjD,IAAI,eAAmC;AACvC,IAAI,WAAsB;AAEnB,eAAe;IACpB,IAAI,gBAAgB,UAAU;QAC5B,OAAO;YAAE,QAAQ;YAAc,IAAI;QAAS;IAC9C;IAEA,IAAI,oDAAyB,gBAAgB,CAAC,YAAY,QAAQ,CAAC,gBAAgB,YAAY,QAAQ,CAAC,YAAY;;IAIpH,MAAM,SAAS,IAAI,sHAAW,CAAC;IAC/B,MAAM,OAAO,OAAO;IAEpB,MAAM,KAAK,OAAO,EAAE,CAAC;IAErB,eAAe;IACf,WAAW;IAEX,OAAO;QAAE;QAAQ;IAAG;AACtB"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/lib/mongoDBCRUD.ts"],"sourcesContent":["// app\\lib\\monggodb\\mongoDBCRUD.ts\r\n\r\nimport { Collection, Filter, ObjectId, OptionalUnlessRequiredId, UpdateFilter, type CollationOptions } from 'mongodb';\r\nimport { connectToDatabase } from '../components/(mongodb)/connectToDatabase';\r\n\r\n// ========== Helper ====================\r\nexport function safeParse(value: unknown): unknown {\r\n  if (typeof value !== 'string') return value;\r\n  const firstChar = value.trim().charAt(0);\r\n  if (firstChar !== '[' && firstChar !== '{') return value;\r\n  try {\r\n    return JSON.parse(value);\r\n  } catch {\r\n    return value;\r\n  }\r\n}\r\n\r\n// ========== READ HEADERS (Mongo ko c√≥ headers n√™n tr·∫£ key t·ª´ document) ==========\r\nexport const getHeaders = async (collectionName: string): Promise<string[]> => {\r\n  const { db } = await connectToDatabase();\r\n  const doc = await db.collection(collectionName).findOne({});\r\n  return doc ? Object.keys(doc) : [];\r\n};\r\n\r\n// ========== FIND BY FIELD ==========\r\nexport const findByField = async <T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  field: keyof T,\r\n  value: string | number,\r\n): Promise<{ data: T } | null> => {\r\n  const { db } = await connectToDatabase();\r\n  const item = await db\r\n    .collection(collectionName)\r\n    .find({ [field]: value })\r\n    .toArray();\r\n  if (!item) return null;\r\n\r\n  return { data: item as unknown as T };\r\n};\r\n\r\n// ========== GET BY ID OR CODE ==========\r\nexport const getRowByIdOrCode = async <T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  { id, code, _id }: { id?: string | number; code?: string; _id?: string },\r\n): Promise<{ rowIndex: number; row: T } | null> => {\r\n  const { db } = await connectToDatabase();\r\n  const filter: Record<string, unknown> = {};\r\n\r\n  if (_id) {\r\n    if (ObjectId.isValid(_id)) {\r\n      filter['_id'] = new ObjectId(_id);\r\n    } else if (!isNaN(Number(_id))) {\r\n      filter['_id'] = Number(_id);\r\n    }\r\n\r\n  }\r\n\r\n  if (id) filter['id'] = id;\r\n  if (code) filter['code'] = code;\r\n\r\n  const row = await db.collection(collectionName).findOne(filter);\r\n  return row ? { rowIndex: 0, row: row as unknown as T } : null;\r\n};\r\n\r\n// ========== GET ALL (search, filter, sort, pagination) ==========\r\nexport const getAllRows = async <T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  {\r\n    search,\r\n    skip = 0,\r\n    limit,\r\n    field,\r\n    value,\r\n    filters,\r\n    sort,\r\n    collation,\r\n  }: {\r\n    search?: string;\r\n    skip?: number;\r\n    limit?: number;\r\n    field?: keyof T;\r\n    value?: unknown;\r\n    filters?: Record<string, unknown>;\r\n    sort?: { field: keyof T; order?: 'asc' | 'desc' } | Array<{ field: keyof T; order?: 'asc' | 'desc' }>;\r\n    collation?: CollationOptions;\r\n  } = {},\r\n): Promise<{ total: number; data: T[] }> => {\r\n  const { db } = await connectToDatabase();\r\n  const collection = db.collection(collectionName);\r\n\r\n  const query: Record<string, unknown> = {};\r\n\r\n  // Filter field=value\r\n  if (field && value !== undefined) {\r\n    query[field as string] = value;\r\n  }\r\n\r\n  // ====== 2. Filter n√¢ng cao ======\r\n  if (filters && Object.keys(filters).length > 0) {\r\n    for (const [key, rawVal] of Object.entries(filters)) {\r\n      if (rawVal === undefined || rawVal === null) continue;\r\n\r\n      // --- N·∫øu l√† m·ªánh ƒë·ªÅ $or ho·∫∑c $and ---\r\n      // Tr∆∞·ªùng h·ª£p t√¨m ki·∫øm c√≥ ƒëi·ªÅu ki·ªán k·∫øt h·ª£p\r\n      if (key === '$or' || key === '$and') {\r\n        query[key] = rawVal;\r\n        continue;\r\n      }\r\n\r\n      // --- N·∫øu l√† object c√≥ $gte / $lte (l·ªçc kho·∫£ng th·ªùi gian ho·∫∑c kho·∫£ng s·ªë) ---\r\n      if (\r\n        typeof rawVal === 'object' &&\r\n        rawVal !== null &&\r\n        ('$gte' in (rawVal as Record<string, unknown>) || '$lte' in (rawVal as Record<string, unknown>))\r\n      ) {\r\n        (query as Record<string, unknown>)[key] = rawVal;\r\n        continue;\r\n      }\r\n      // --- N·∫øu l√† object c√≥ to√°n t·ª≠ MongoDB ---\r\n      // Tr∆∞·ªùng h·ª£p t√¨m ki·∫øm c√≥ ƒëi·ªÅu ki·ªán\r\n      // $in ‚Äì ch·ª©a trong danh s√°ch gi√° tr·ªã (gi·ªëng WHERE field IN (...))\r\n      // $nin ‚Äì kh√¥ng ch·ª©a trong danh s√°ch gi√° tr·ªã\r\n      // $gte ‚Äì l·ªõn h∆°n ho·∫∑c b·∫±ng (>=)\r\n      // $lte ‚Äì nh·ªè h∆°n ho·∫∑c b·∫±ng (<=)\r\n      // $gt ‚Äì l·ªõn h∆°n (>)\r\n      // $lt ‚Äì nh·ªè h∆°n (<)\r\n      // $ne ‚Äì kh√°c (!=)\r\n      if (\r\n        typeof rawVal === 'object' &&\r\n        rawVal !== null &&\r\n        Object.keys(rawVal as Record<string, unknown>).some((k) =>\r\n          ['$in', '$nin', '$gte', '$lte', '$gt', '$lt', '$ne'].includes(k),\r\n        )\r\n      ) {\r\n        query[key] = rawVal;\r\n        continue;\r\n      }\r\n\r\n      // --- N·∫øu l√† chu·ªói b·∫Øt ƒë·∫ßu b·∫±ng \"#\" => regex ---\r\n      if (typeof rawVal === 'string' && rawVal.trim().startsWith('#')) {\r\n        // Tr∆∞·ªùng h·ª£p t√¨m ki·∫øm g·∫ßn ƒë√∫ng (regex)\r\n        query[key] = {\r\n          $regex: rawVal.trim().slice(1),\r\n          $options: 'i',\r\n        };\r\n        continue;\r\n      }\r\n\r\n      // Tr∆∞·ªùng h·ª£p so s√°nh ch√≠nh x√°c (exact match)\r\n      query[key] = rawVal;\r\n    }\r\n  }\r\n\r\n  // Search to√†n b·ªô text - c√°ch c≈© - ch·ªâ l·∫•y key 1 c·∫•p\r\n  // if (search) {\r\n  //     const sampleDoc = await collection.findOne();\r\n  //     if (sampleDoc) {\r\n  //         const textFields = Object.keys(sampleDoc).filter(\r\n  //             (k) => typeof sampleDoc[k] === \"string\"\r\n  //         );\r\n\r\n  //         if (textFields.length > 0) {\r\n  //             query[\"$or\"] = textFields.map((key) => ({\r\n  //                 [key]: { $regex: search, $options: \"i\" },\r\n  //             }));\r\n  //         }\r\n  //     }\r\n  // }\r\n\r\n  // Search to√†n b·ªô text - c·∫£i ti·∫øn ƒë·ªÉ l·∫•y c·∫£ c√°c key trong object con - nhi·ªÅu c·∫•p\r\n  if (search) {\r\n    const sampleDoc = await collection.findOne();\r\n    if (sampleDoc) {\r\n      // üëâ H√†m ƒë·ªá quy l·∫•y t·∫•t c·∫£ key string (k·ªÉ c·∫£ nested)\r\n      const getStringPaths = (obj: unknown, prefix = ''): string[] => {\r\n        let keys: string[] = [];\r\n        for (const [k, v] of Object.entries(obj as Record<string, unknown>)) {\r\n          const path = prefix ? `${prefix}.${k}` : k;\r\n          if (typeof v === 'string') keys.push(path);\r\n          else if (v && typeof v === 'object' && !Array.isArray(v)) keys = keys.concat(getStringPaths(v, path));\r\n        }\r\n        return keys;\r\n      };\r\n\r\n      const textFields = getStringPaths(sampleDoc);\r\n\r\n      if (textFields.length > 0) {\r\n        query['$or'] = textFields.map((path) => ({\r\n          [path]: { $regex: search, $options: 'i' },\r\n        }));\r\n      }\r\n    }\r\n  }\r\n\r\n  // Sort\r\n  let sortOption: Record<string, 1 | -1> = {};\r\n  if (sort) {\r\n    const sortArr = Array.isArray(sort) ? sort : [sort];\r\n    sortOption = sortArr.reduce(\r\n      (acc, s) => {\r\n        acc[s.field as string] = s.order === 'desc' ? -1 : 1;\r\n        return acc;\r\n      },\r\n      {} as Record<string, 1 | -1>,\r\n    );\r\n  }\r\n\r\n  const total = await collection.countDocuments(query, collation ? { collation } : undefined);\r\n\r\n  let cursor = collection.find(query);\r\n  if (collation) {\r\n    cursor = cursor.collation(collation);\r\n  }\r\n  const data = await cursor.sort(sortOption).skip(skip).limit(limit ?? 0).toArray();\r\n\r\n  return { total, data: data as unknown as T[] };\r\n};\r\n\r\n// ========== CREATE ==========\r\nexport const addRow = async <T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  newData: T,\r\n): Promise<string> => {\r\n  const { db } = await connectToDatabase();\r\n  const result = await db.collection(collectionName).insertOne(newData);\r\n  return result.insertedId.toString();\r\n};\r\nexport async function getCollection<T extends Record<string, unknown>>(name: string): Promise<Collection<T>> {\r\n  const { db } = await connectToDatabase();\r\n  return db.collection<T>(name);\r\n}\r\n// CREATE MANY\r\nexport async function createMany<T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  docs: OptionalUnlessRequiredId<T>[],\r\n) {\r\n  const collection = await getCollection<T>(collectionName);\r\n  return collection.insertMany(docs);\r\n}\r\n\r\n\r\n// UPDATE BY FIELD\r\nexport const updateByField = async <T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  field: keyof T,\r\n  value: string | number,\r\n  updateData: Partial<T>,\r\n): Promise<boolean> => {\r\n  const { db } = await connectToDatabase();\r\n  if ('_id' in updateData) delete updateData._id;\r\n\r\n  let queryValue: string | number | ObjectId = value;\r\n\r\n  if (field === '_id' && typeof value === 'string') {\r\n    if (ObjectId.isValid(value)) {\r\n      // N·∫øu l√† ObjectId h·ª£p l·ªá\r\n      queryValue = new ObjectId(value);\r\n    } else if (!isNaN(Number(value))) {\r\n      // N·∫øu l√† s·ªë\r\n      queryValue = Number(value);\r\n    }\r\n    // N·∫øu l√† string kh√¥ng ph·∫£i ObjectId v√† kh√¥ng ph·∫£i s·ªë, queryValue v·∫´n l√† string\r\n  }\r\n  const result = await db.collection(collectionName).updateOne({ [field]: queryValue }, { $set: updateData });\r\n\r\n  return result.modifiedCount > 0;\r\n};\r\n\r\n// UPDATE MANY\r\nexport async function updateMany<T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  filter: Filter<T>, // ch√≠nh l√† Filter<T>, kh√¥ng ph·∫£i Filter<Document>\r\n  update: UpdateFilter<T> | Partial<T>,\r\n) {\r\n  const collection = await getCollection<T>(collectionName);\r\n  const isOperatorUpdate =\r\n    typeof update === 'object' &&\r\n    update !== null &&\r\n    Object.keys(update as Record<string, unknown>).some((key) => key.startsWith('$'));\r\n\r\n  const updateDoc: UpdateFilter<T> = isOperatorUpdate\r\n    ? (update as UpdateFilter<T>) // n·∫øu ƒë√£ c√≥ $set, $inc,... th√¨ gi·ªØ nguy√™n\r\n    : ({ $set: update as Partial<T> } as UpdateFilter<T>);\r\n\r\n  return collection.updateMany(filter, updateDoc);\r\n}\r\n\r\n// ========== DELETE BY FIELD ==========\r\nexport const deleteByField = async <T extends Record<string, unknown>>(\r\n  collectionName: string,\r\n  field: keyof T,\r\n  value: string | number,\r\n): Promise<boolean> => {\r\n  const { db } = await connectToDatabase();\r\n  const result = await db.collection(collectionName).deleteOne({ [field]: value });\r\n  return result.deletedCount > 0;\r\n};\r\n\r\n// ========== DELETE BY ID ==========\r\nexport const deleteById = async (collectionName: string, id: string): Promise<boolean> => {\r\n  const { db } = await connectToDatabase();\r\n  const result = await db.collection(collectionName).deleteOne({ _id: new ObjectId(id) });\r\n  return result.deletedCount > 0;\r\n};\r\n\r\n// DELETE MANY\r\nexport async function deleteManyRows<T extends Record<string, unknown>>(collectionName: string, filter: Filter<T>) {\r\n  const collection = await getCollection<T>(collectionName);\r\n  return collection.deleteMany(filter);\r\n}\r\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAElC;AACA;;;AAGO,SAAS,UAAU,KAAc;IACtC,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,MAAM,YAAY,MAAM,IAAI,GAAG,MAAM,CAAC;IACtC,IAAI,cAAc,OAAO,cAAc,KAAK,OAAO;IACnD,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAGO,MAAM,aAAa,OAAO;IAC/B,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,MAAM,MAAM,MAAM,GAAG,UAAU,CAAC,gBAAgB,OAAO,CAAC,CAAC;IACzD,OAAO,MAAM,OAAO,IAAI,CAAC,OAAO,EAAE;AACpC;AAGO,MAAM,cAAc,OACzB,gBACA,OACA;IAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,MAAM,OAAO,MAAM,GAChB,UAAU,CAAC,gBACX,IAAI,CAAC;QAAE,CAAC,MAAM,EAAE;IAAM,GACtB,OAAO;IACV,IAAI,CAAC,MAAM,OAAO;IAElB,OAAO;QAAE,MAAM;IAAqB;AACtC;AAGO,MAAM,mBAAmB,OAC9B,gBACA,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,EAAyD;IAExE,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,MAAM,SAAkC,CAAC;IAEzC,IAAI,KAAK;QACP,IAAI,mHAAQ,CAAC,OAAO,CAAC,MAAM;YACzB,MAAM,CAAC,MAAM,GAAG,IAAI,mHAAQ,CAAC;QAC/B,OAAO,IAAI,CAAC,MAAM,OAAO,OAAO;YAC9B,MAAM,CAAC,MAAM,GAAG,OAAO;QACzB;IAEF;IAEA,IAAI,IAAI,MAAM,CAAC,KAAK,GAAG;IACvB,IAAI,MAAM,MAAM,CAAC,OAAO,GAAG;IAE3B,MAAM,MAAM,MAAM,GAAG,UAAU,CAAC,gBAAgB,OAAO,CAAC;IACxD,OAAO,MAAM;QAAE,UAAU;QAAG,KAAK;IAAoB,IAAI;AAC3D;AAGO,MAAM,aAAa,OACxB,gBACA,EACE,MAAM,EACN,OAAO,CAAC,EACR,KAAK,EACL,KAAK,EACL,KAAK,EACL,OAAO,EACP,IAAI,EACJ,SAAS,EAUV,GAAG,CAAC,CAAC;IAEN,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,MAAM,aAAa,GAAG,UAAU,CAAC;IAEjC,MAAM,QAAiC,CAAC;IAExC,qBAAqB;IACrB,IAAI,SAAS,UAAU,WAAW;QAChC,KAAK,CAAC,MAAgB,GAAG;IAC3B;IAEA,mCAAmC;IACnC,IAAI,WAAW,OAAO,IAAI,CAAC,SAAS,MAAM,GAAG,GAAG;QAC9C,KAAK,MAAM,CAAC,KAAK,OAAO,IAAI,OAAO,OAAO,CAAC,SAAU;YACnD,IAAI,WAAW,aAAa,WAAW,MAAM;YAE7C,uCAAuC;YACvC,2CAA2C;YAC3C,IAAI,QAAQ,SAAS,QAAQ,QAAQ;gBACnC,KAAK,CAAC,IAAI,GAAG;gBACb;YACF;YAEA,6EAA6E;YAC7E,IACE,OAAO,WAAW,YAClB,WAAW,QACX,CAAC,UAAW,UAAsC,UAAW,MAAkC,GAC/F;gBACC,KAAiC,CAAC,IAAI,GAAG;gBAC1C;YACF;YACA,2CAA2C;YAC3C,mCAAmC;YACnC,kEAAkE;YAClE,4CAA4C;YAC5C,gCAAgC;YAChC,gCAAgC;YAChC,oBAAoB;YACpB,oBAAoB;YACpB,kBAAkB;YAClB,IACE,OAAO,WAAW,YAClB,WAAW,QACX,OAAO,IAAI,CAAC,QAAmC,IAAI,CAAC,CAAC,IACnD;oBAAC;oBAAO;oBAAQ;oBAAQ;oBAAQ;oBAAO;oBAAO;iBAAM,CAAC,QAAQ,CAAC,KAEhE;gBACA,KAAK,CAAC,IAAI,GAAG;gBACb;YACF;YAEA,iDAAiD;YACjD,IAAI,OAAO,WAAW,YAAY,OAAO,IAAI,GAAG,UAAU,CAAC,MAAM;gBAC/D,uCAAuC;gBACvC,KAAK,CAAC,IAAI,GAAG;oBACX,QAAQ,OAAO,IAAI,GAAG,KAAK,CAAC;oBAC5B,UAAU;gBACZ;gBACA;YACF;YAEA,6CAA6C;YAC7C,KAAK,CAAC,IAAI,GAAG;QACf;IACF;IAEA,oDAAoD;IACpD,gBAAgB;IAChB,oDAAoD;IACpD,uBAAuB;IACvB,4DAA4D;IAC5D,sDAAsD;IACtD,aAAa;IAEb,uCAAuC;IACvC,wDAAwD;IACxD,4DAA4D;IAC5D,mBAAmB;IACnB,YAAY;IACZ,QAAQ;IACR,IAAI;IAEJ,gFAAgF;IAChF,IAAI,QAAQ;QACV,MAAM,YAAY,MAAM,WAAW,OAAO;QAC1C,IAAI,WAAW;YACb,qDAAqD;YACrD,MAAM,iBAAiB,CAAC,KAAc,SAAS,EAAE;gBAC/C,IAAI,OAAiB,EAAE;gBACvB,KAAK,MAAM,CAAC,GAAG,EAAE,IAAI,OAAO,OAAO,CAAC,KAAiC;oBACnE,MAAM,OAAO,SAAS,GAAG,OAAO,CAAC,EAAE,GAAG,GAAG;oBACzC,IAAI,OAAO,MAAM,UAAU,KAAK,IAAI,CAAC;yBAChC,IAAI,KAAK,OAAO,MAAM,YAAY,CAAC,MAAM,OAAO,CAAC,IAAI,OAAO,KAAK,MAAM,CAAC,eAAe,GAAG;gBACjG;gBACA,OAAO;YACT;YAEA,MAAM,aAAa,eAAe;YAElC,IAAI,WAAW,MAAM,GAAG,GAAG;gBACzB,KAAK,CAAC,MAAM,GAAG,WAAW,GAAG,CAAC,CAAC,OAAS,CAAC;wBACvC,CAAC,KAAK,EAAE;4BAAE,QAAQ;4BAAQ,UAAU;wBAAI;oBAC1C,CAAC;YACH;QACF;IACF;IAEA,OAAO;IACP,IAAI,aAAqC,CAAC;IAC1C,IAAI,MAAM;QACR,MAAM,UAAU,MAAM,OAAO,CAAC,QAAQ,OAAO;YAAC;SAAK;QACnD,aAAa,QAAQ,MAAM,CACzB,CAAC,KAAK;YACJ,GAAG,CAAC,EAAE,KAAK,CAAW,GAAG,EAAE,KAAK,KAAK,SAAS,CAAC,IAAI;YACnD,OAAO;QACT,GACA,CAAC;IAEL;IAEA,MAAM,QAAQ,MAAM,WAAW,cAAc,CAAC,OAAO,YAAY;QAAE;IAAU,IAAI;IAEjF,IAAI,SAAS,WAAW,IAAI,CAAC;IAC7B,IAAI,WAAW;QACb,SAAS,OAAO,SAAS,CAAC;IAC5B;IACA,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,YAAY,IAAI,CAAC,MAAM,KAAK,CAAC,SAAS,GAAG,OAAO;IAE/E,OAAO;QAAE;QAAO,MAAM;IAAuB;AAC/C;AAGO,MAAM,SAAS,OACpB,gBACA;IAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAAC;IAC7D,OAAO,OAAO,UAAU,CAAC,QAAQ;AACnC;AACO,eAAe,cAAiD,IAAY;IACjF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,OAAO,GAAG,UAAU,CAAI;AAC1B;AAEO,eAAe,WACpB,cAAsB,EACtB,IAAmC;IAEnC,MAAM,aAAa,MAAM,cAAiB;IAC1C,OAAO,WAAW,UAAU,CAAC;AAC/B;AAIO,MAAM,gBAAgB,OAC3B,gBACA,OACA,OACA;IAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,IAAI,SAAS,YAAY,OAAO,WAAW,GAAG;IAE9C,IAAI,aAAyC;IAE7C,IAAI,UAAU,SAAS,OAAO,UAAU,UAAU;QAChD,IAAI,mHAAQ,CAAC,OAAO,CAAC,QAAQ;YAC3B,yBAAyB;YACzB,aAAa,IAAI,mHAAQ,CAAC;QAC5B,OAAO,IAAI,CAAC,MAAM,OAAO,SAAS;YAChC,YAAY;YACZ,aAAa,OAAO;QACtB;IACA,+EAA+E;IACjF;IACA,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAAC;QAAE,CAAC,MAAM,EAAE;IAAW,GAAG;QAAE,MAAM;IAAW;IAEzG,OAAO,OAAO,aAAa,GAAG;AAChC;AAGO,eAAe,WACpB,cAAsB,EACtB,MAAiB,EACjB,MAAoC;IAEpC,MAAM,aAAa,MAAM,cAAiB;IAC1C,MAAM,mBACJ,OAAO,WAAW,YAClB,WAAW,QACX,OAAO,IAAI,CAAC,QAAmC,IAAI,CAAC,CAAC,MAAQ,IAAI,UAAU,CAAC;IAE9E,MAAM,YAA6B,mBAC9B,SACA;QAAE,MAAM;IAAqB;IAElC,OAAO,WAAW,UAAU,CAAC,QAAQ;AACvC;AAGO,MAAM,gBAAgB,OAC3B,gBACA,OACA;IAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAAC;QAAE,CAAC,MAAM,EAAE;IAAM;IAC9E,OAAO,OAAO,YAAY,GAAG;AAC/B;AAGO,MAAM,aAAa,OAAO,gBAAwB;IACvD,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,6KAAiB;IACtC,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAAC;QAAE,KAAK,IAAI,mHAAQ,CAAC;IAAI;IACrF,OAAO,OAAO,YAAY,GAAG;AAC/B;AAGO,eAAe,eAAkD,cAAsB,EAAE,MAAiB;IAC/G,MAAM,aAAa,MAAM,cAAiB;IAC1C,OAAO,WAAW,UAAU,CAAC;AAC/B"}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/app/api/posts/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { addRow, getAllRows, getRowByIdOrCode, updateByField, deleteById, getCollection } from '@/lib/mongoDBCRUD';\r\nimport { ObjectId, Document } from 'mongodb';\r\n\r\nconst POSTS_COLLECTION_NAME = 'Posts';\r\n\r\nexport interface PostDoc {\r\n  _id?: string | ObjectId;\r\n  authorId: string;\r\n  authorName?: string;\r\n  authorAvatar?: string;\r\n  content: string;\r\n  images?: string[];\r\n  videos?: string[];\r\n  files?: string[];\r\n  createdAt: number;\r\n  likedBy?: string[];\r\n  commentsCount?: number;\r\n  visibility?: 'public' | 'friends' | 'private';\r\n}\r\n\r\nexport interface PostCommentDoc {\r\n  _id?: string | ObjectId;\r\n  postId: string;\r\n  userId: string;\r\n  username?: string;\r\n  avatar?: string;\r\n  content: string;\r\n  createdAt: number;\r\n  parentId?: string;\r\n  reactions?: Record<string, string[]>;\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                               POST HANDLERS                                */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nexport async function POST(req: NextRequest) {\r\n  const body = await req.json();\r\n  const {\r\n    action,\r\n    collectionName = POSTS_COLLECTION_NAME,\r\n    data,\r\n    filters,\r\n    field,\r\n    value,\r\n    skip,\r\n    limit,\r\n    sort,\r\n    postId,\r\n    userId,\r\n  } = body;\r\n\r\n  try {\r\n    switch (action) {\r\n      /* ------------------------------- CREATE POST ------------------------------- */\r\n      case 'create': {\r\n        const payload = data as Partial<PostDoc>;\r\n\r\n        if (!payload?.authorId || !payload?.content) {\r\n          return NextResponse.json({ error: 'Missing authorId or content' }, { status: 400 });\r\n        }\r\n\r\n        const newData: PostDoc = {\r\n          authorId: String(payload.authorId),\r\n          authorName: payload.authorName ? String(payload.authorName) : undefined,\r\n          authorAvatar: payload.authorAvatar ? String(payload.authorAvatar) : undefined,\r\n          content: String(payload.content || ''),\r\n          images: Array.isArray(payload.images) ? payload.images.map(String) : [],\r\n          videos: Array.isArray(payload.videos) ? payload.videos.map(String) : [],\r\n          files: Array.isArray(payload.files) ? payload.files.map(String) : [],\r\n          createdAt: Date.now(),\r\n          likedBy: [],\r\n          commentsCount: 0,\r\n          visibility: payload.visibility || 'public',\r\n        };\r\n\r\n        const newId = await addRow(collectionName, newData as PostDoc & Record<string, unknown>);\r\n        return NextResponse.json({ success: true, _id: newId });\r\n      }\r\n\r\n      /* ------------------------------- READ POSTS ------------------------------- */\r\n      case 'read': {\r\n        const result = await getAllRows<PostDoc & Record<string, unknown>>(collectionName, {\r\n          filters: filters || {},\r\n          skip: typeof skip === 'number' ? skip : 0,\r\n          limit: typeof limit === 'number' ? limit : 20,\r\n          sort: sort || { field: 'createdAt', order: 'desc' },\r\n        });\r\n\r\n        return NextResponse.json({ success: true, ...result });\r\n      }\r\n\r\n      /* ------------------------------ GET BY ID ------------------------------ */\r\n      case 'getById': {\r\n        const idStr = typeof postId === 'string' ? postId : String(value || '');\r\n        if (!idStr) return NextResponse.json({ error: 'Missing postId' }, { status: 400 });\r\n\r\n        const row = await getRowByIdOrCode<PostDoc & Record<string, unknown>>(collectionName, { _id: idStr });\r\n        return NextResponse.json(row);\r\n      }\r\n\r\n      /* ------------------------------- UPDATE POST ------------------------------- */\r\n      case 'update': {\r\n        if (!field || value === undefined) {\r\n          return NextResponse.json({ error: 'Missing field or value' }, { status: 400 });\r\n        }\r\n\r\n        const key = String(field) as keyof PostDoc;\r\n        const val = typeof value === 'string' || typeof value === 'number' ? value : String(value);\r\n\r\n        const ok = await updateByField<PostDoc & Record<string, unknown>>(\r\n          collectionName,\r\n          key,\r\n          val,\r\n          data as Partial<PostDoc>,\r\n        );\r\n        return NextResponse.json({ success: ok });\r\n      }\r\n\r\n      /* ------------------------------ DELETE POST ------------------------------ */\r\n      case 'delete': {\r\n        const idStr = typeof postId === 'string' ? postId : String(value || '');\r\n        if (!idStr) return NextResponse.json({ error: 'Missing postId' }, { status: 400 });\r\n\r\n        const ok = await deleteById(collectionName, idStr);\r\n        return NextResponse.json({ success: ok });\r\n      }\r\n\r\n      /* ----------------------------- TOGGLE LIKE ----------------------------- */\r\n      case 'toggleLike': {\r\n        const idStr = typeof postId === 'string' ? postId : String(value || '');\r\n        const uid = typeof userId === 'string' ? userId : String(data?.userId || '');\r\n        const like = !!(data && (data.like === true || data.like === 'true'));\r\n\r\n        if (!idStr || !uid) {\r\n          return NextResponse.json({ error: 'Missing postId or userId' }, { status: 400 });\r\n        }\r\n\r\n        const collection = await getCollection<PostDoc & Record<string, unknown>>(collectionName);\r\n\r\n        const updatePipeline: Document[] = like\r\n          ? [\r\n              {\r\n                $set: {\r\n                  likedBy: {\r\n                    $cond: [\r\n                      { $in: [uid, { $ifNull: ['$likedBy', []] }] },\r\n                      { $ifNull: ['$likedBy', []] },\r\n                      { $concatArrays: [{ $ifNull: ['$likedBy', []] }, [uid]] },\r\n                    ],\r\n                  },\r\n                },\r\n              },\r\n            ]\r\n          : [\r\n              {\r\n                $set: {\r\n                  likedBy: {\r\n                    $filter: {\r\n                      input: { $ifNull: ['$likedBy', []] },\r\n                      cond: { $ne: ['$$this', uid] },\r\n                    },\r\n                  },\r\n                },\r\n              },\r\n            ];\r\n\r\n        const filter = ObjectId.isValid(idStr) ? { _id: new ObjectId(idStr) } : { _id: idStr };\r\n\r\n        const result = await collection.updateOne(filter, updatePipeline);\r\n\r\n        return NextResponse.json({ success: result.modifiedCount > 0 });\r\n      }\r\n\r\n      case 'addComment': {\r\n        const idStr = typeof postId === 'string' ? postId : String(value || '');\r\n        const payload = data as Partial<PostCommentDoc>;\r\n        if (!idStr || !payload?.userId || !payload?.content) {\r\n          return NextResponse.json({ error: 'Missing postId, userId or content' }, { status: 400 });\r\n        }\r\n\r\n        const newData: PostCommentDoc = {\r\n          postId: String(idStr),\r\n          userId: String(payload.userId),\r\n          username: payload.username ? String(payload.username) : undefined,\r\n          avatar: payload.avatar ? String(payload.avatar) : undefined,\r\n          content: String(payload.content || ''),\r\n          createdAt: Date.now(),\r\n          parentId: payload.parentId ? String(payload.parentId) : undefined,\r\n          reactions: {},\r\n        };\r\n\r\n        const newId = await addRow<PostCommentDoc & Record<string, unknown>>(\r\n          'PostComments',\r\n          newData as PostCommentDoc & Record<string, unknown>,\r\n        );\r\n\r\n        const posts = await getCollection<PostDoc & Record<string, unknown>>(collectionName);\r\n        const filter = ObjectId.isValid(idStr) ? { _id: new ObjectId(idStr) } : { _id: idStr };\r\n        const pipeline: Document[] = [\r\n          {\r\n            $set: {\r\n              commentsCount: { $add: [{ $ifNull: ['$commentsCount', 0] }, 1] },\r\n            },\r\n          },\r\n        ];\r\n        await posts.updateOne(filter, pipeline);\r\n\r\n        return NextResponse.json({ success: true, _id: newId });\r\n      }\r\n\r\n      case 'readComments': {\r\n        const idStr = typeof postId === 'string' ? postId : String(value || '');\r\n        const skipNum = typeof skip === 'number' ? skip : 0;\r\n        const limitNum = typeof limit === 'number' ? limit : 50;\r\n        if (!idStr) return NextResponse.json({ error: 'Missing postId' }, { status: 400 });\r\n\r\n        const result = await getAllRows<PostCommentDoc & Record<string, unknown>>('PostComments', {\r\n          filters: { postId: String(idStr) },\r\n          skip: skipNum,\r\n          limit: limitNum,\r\n          sort: sort || { field: 'createdAt', order: 'asc' },\r\n        });\r\n        return NextResponse.json({ success: true, ...result });\r\n      }\r\n\r\n      case 'toggleCommentReaction': {\r\n        const commentId = typeof body.commentId === 'string' ? body.commentId : String(body.commentId || '');\r\n        const uid = typeof userId === 'string' ? userId : String(body?.userId || body?.data?.userId || '');\r\n        const emoji = String(body?.emoji || body?.data?.emoji || '');\r\n        const like = !!(body && (body.like === true || body.like === 'true' || body?.data?.like === true));\r\n\r\n        if (!commentId || !uid || !emoji) {\r\n          return NextResponse.json({ error: 'Missing commentId, userId or emoji' }, { status: 400 });\r\n        }\r\n\r\n        const comments = await getCollection<PostCommentDoc & Record<string, unknown>>('PostComments');\r\n        const filter = ObjectId.isValid(commentId) ? { _id: new ObjectId(commentId) } : { _id: commentId };\r\n        const doc = await comments.findOne(filter);\r\n        const existing: Record<string, string[]> = (doc?.reactions as Record<string, string[]>) || {};\r\n\r\n        const arr = Array.isArray(existing[emoji]) ? existing[emoji] : [];\r\n        const set = new Set(arr);\r\n        if (like) set.add(uid);\r\n        else set.delete(uid);\r\n        const next = { ...existing, [emoji]: Array.from(set) };\r\n        await comments.updateOne(filter, { $set: { reactions: next } });\r\n        return NextResponse.json({ success: true, reactions: next });\r\n      }\r\n\r\n      default:\r\n        return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\r\n    }\r\n  } catch (err) {\r\n    console.error('POST /posts error:', err);\r\n    return NextResponse.json({ error: 'Server error' }, { status: 500 });\r\n  }\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                                GET HANDLER                                 */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const url = req.nextUrl;\r\n\r\n  const skip = Number(url.searchParams.get('skip') || 0);\r\n  const limit = Number(url.searchParams.get('limit') || 20);\r\n\r\n  const authorId = url.searchParams.get('authorId') || undefined;\r\n  const visibility = url.searchParams.get('visibility') || undefined;\r\n  const likedBy = url.searchParams.get('likedBy') || undefined;\r\n\r\n  const beforeStr = url.searchParams.get('before') || undefined;\r\n  const afterStr = url.searchParams.get('after') || undefined;\r\n\r\n  const search = url.searchParams.get('search') || url.searchParams.get('q') || undefined;\r\n\r\n  const filters: Record<string, unknown> = {};\r\n\r\n  if (authorId) filters.authorId = authorId;\r\n  if (visibility) filters.visibility = visibility;\r\n\r\n  if (likedBy) {\r\n    filters.likedBy = { $in: [likedBy] };\r\n  }\r\n\r\n  const range: Record<string, number> = {};\r\n\r\n  if (beforeStr && !isNaN(Number(beforeStr))) range.$lt = Number(beforeStr);\r\n  if (afterStr && !isNaN(Number(afterStr))) range.$gt = Number(afterStr);\r\n\r\n  if (Object.keys(range).length) {\r\n    filters.createdAt = range;\r\n  }\r\n\r\n  const result = await getAllRows<PostDoc & Record<string, unknown>>(POSTS_COLLECTION_NAME, {\r\n    filters,\r\n    skip,\r\n    limit,\r\n    sort: { field: 'createdAt', order: 'desc' },\r\n    search: search || undefined,\r\n  });\r\n\r\n  return NextResponse.json({ success: true, ...result });\r\n}\r\n"],"names":[],"mappings":"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"}}]
}