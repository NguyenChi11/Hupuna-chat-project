{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ching/OneDrive/Desktop/Chat-Hupuna/hupuna-chat/src/components/%28chatPopup%29/MessageList.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useMemo, useRef } from 'react';\r\nimport Image from 'next/image';\r\nimport { useRouter } from 'next/navigation';\r\nimport type { Message } from '@/types/Message';\r\nimport type { User } from '@/types/User';\r\nimport { isVideoFile, getProxyUrl } from '@/utils/utils';\r\nimport QRCode from 'qrcode';\r\n\r\n// Icons\r\nimport {\r\n  HiOutlineDocumentText,\r\n  HiPlay,\r\n  HiEllipsisVertical,\r\n  HiOutlineClock,\r\n  HiMapPin,\r\n  HiChartBar,\r\n  HiUserPlus,\r\n  HiUserMinus,\r\n  HiShieldCheck,\r\n  HiUserGroup,\r\n  HiArrowUturnLeft,\r\n  HiArrowUturnRight,\r\n  HiPencil,\r\n  HiPhoto,\r\n  HiListBullet,\r\n  HiCheckCircle,\r\n  HiEyeSlash,\r\n  HiPlus,\r\n  HiLockClosed,\r\n  HiChatBubbleLeftRight,\r\n} from 'react-icons/hi2';\r\nimport { HiPhone, HiVideoCamera, HiArrowDown, HiArrowUp } from 'react-icons/hi2';\r\nimport { HiLink, HiOutlineLogout } from 'react-icons/hi';\r\nimport ReminderDetailModal from './components/ReminderDetailModal';\r\nimport PollDetailModal from './components/PollDetailModal';\r\nimport ReactionButton from './components/ReactionButton';\r\nimport { ContextMenuState } from './MessageContextMenu';\r\nimport ICShareMessage from '../svg/ICShareMessage';\r\nimport ReadStatus from './components/ReadStatus';\r\nimport ReminderCard from './components/ReminderCard';\r\n\r\ninterface SenderInfo {\r\n  _id: string;\r\n  name: string;\r\n  avatar: string | null;\r\n}\r\n\r\ninterface MessageListProps {\r\n  messagesGrouped: Map<string, Message[]>;\r\n  messages: Message[];\r\n  currentUser: User;\r\n  allUsersMap: Map<string, string>;\r\n  uploadingFiles: Record<string, number>;\r\n  highlightedMsgId: string | null;\r\n  isGroup: boolean;\r\n  onContextMenu: (e: React.MouseEvent, msg: Message) => void;\r\n  onReplyMessage?: (msg: Message) => void;\r\n  onJumpToMessage: (id: string) => void;\r\n  getSenderInfo: (sender: User | string) => SenderInfo;\r\n  renderMessageContent: (content: string, mentionedUserIds?: string[], isMe?: boolean) => React.ReactNode;\r\n  onOpenMedia: (url: string, type: 'image' | 'video') => void;\r\n  editingMessageId: string | null;\r\n  setEditingMessageId?: (id: string | null) => void;\r\n  editContent?: string;\r\n  setEditContent?: (content: string) => void;\r\n  onSaveEdit?: (id: string, content: string) => void;\r\n  onRefresh?: () => Promise<void>;\r\n  onPinMessage?: (msg: Message) => void;\r\n  onToggleReaction?: (msg: Message, emoji: string) => void;\r\n  contextMenu: ContextMenuState | null;\r\n  scrollManagedExternally?: boolean;\r\n  isSidebarOpen?: boolean;\r\n  onMobileLongPress?: (msg: Message, el: HTMLElement, startX: number, startY: number) => void;\r\n  isMobile?: boolean;\r\n  onShareMessage: (msg: Message) => void;\r\n  onOpenChatInfoSection?: (section: 'reminder' | 'poll') => void;\r\n}\r\n\r\nfunction ContactCardBubble({\r\n  contact,\r\n  currentUserId,\r\n}: {\r\n  contact: { _id?: string; name?: string; username?: string; avatar?: string } | undefined;\r\n  currentUserId: string;\r\n}) {\r\n  const router = useRouter();\r\n  const contactId = String(contact?._id || '');\r\n  const name = String(contact?.name || 'Người dùng');\r\n  const username = String(contact?.username || '');\r\n  const avatar = String(contact?.avatar || '');\r\n\r\n  const profilePath = useMemo(() => {\r\n    const slug = String(username || contactId || '').trim();\r\n    if (!slug) return '';\r\n    return `/profile/${encodeURIComponent(slug)}`;\r\n  }, [contactId, username]);\r\n\r\n  const qrValue = useMemo(() => {\r\n    if (!profilePath) return '';\r\n    if (typeof window === 'undefined') return '';\r\n    const origin = window.location.origin;\r\n    return `${origin}${profilePath}`;\r\n  }, [profilePath]);\r\n\r\n  const [qrDataUrl, setQrDataUrl] = useState<string>('');\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    if (!qrValue) {\r\n      setQrDataUrl('');\r\n      return;\r\n    }\r\n    QRCode.toDataURL(qrValue, { errorCorrectionLevel: 'M', margin: 1, width: 240 })\r\n      .then((url: string) => {\r\n        if (!cancelled) setQrDataUrl(url);\r\n      })\r\n      .catch(() => {\r\n        if (!cancelled) setQrDataUrl('');\r\n      });\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [qrValue]);\r\n\r\n  const oneToOneRoomId = useMemo(() => {\r\n    if (!currentUserId || !contactId) return '';\r\n    return [String(currentUserId), String(contactId)].sort().join('_');\r\n  }, [currentUserId, contactId]);\r\n\r\n  const handleVoiceCall = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!contactId || !oneToOneRoomId) return;\r\n    try {\r\n      window.dispatchEvent(\r\n        new CustomEvent('startCall', {\r\n          detail: {\r\n            type: 'voice',\r\n            roomId: oneToOneRoomId,\r\n            isGroup: false,\r\n            selectedChat: { _id: contactId, name, username, avatar: avatar || undefined },\r\n          },\r\n        }),\r\n      );\r\n    } catch {}\r\n  };\r\n\r\n  const handleOpenChat = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!contactId) return;\r\n    try {\r\n      window.dispatchEvent(\r\n        new CustomEvent('openDirectChat', {\r\n          detail: { userId: contactId, name, username, avatar: avatar || undefined },\r\n        }),\r\n      );\r\n    } catch {}\r\n  };\r\n\r\n  const handleOpenProfile = (e: React.MouseEvent) => {\r\n    if (!profilePath) return;\r\n    e.preventDefault();\r\n    router.push(profilePath);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      role={profilePath ? 'button' : undefined}\r\n      tabIndex={profilePath ? 0 : undefined}\r\n      onClick={handleOpenProfile}\r\n      onKeyDown={(e) => {\r\n        if (!profilePath) return;\r\n        if (e.key !== 'Enter' && e.key !== ' ') return;\r\n        e.preventDefault();\r\n        router.push(profilePath);\r\n      }}\r\n      className={`max-w-[70vw] w-[22rem] sm:max-w-[22rem] bg-white border border-gray-200 rounded-2xl overflow-hidden shadow-sm select-none lg:select-text ${\r\n        profilePath ? 'cursor-pointer hover:border-gray-300' : ''\r\n      }`}\r\n    >\r\n      <div className=\"px-3 py-2 bg-gray-50 border-b border-gray-100 text-xs font-semibold text-gray-600\">\r\n        Danh thiếp\r\n      </div>\r\n      <div className=\"p-3 flex items-center justify-between gap-3\">\r\n        <div className=\"flex items-center gap-3 min-w-0\">\r\n          <div className=\"w-11 h-11 rounded-full overflow-hidden bg-gray-200 shrink-0\">\r\n            {avatar ? (\r\n              <Image src={getProxyUrl(avatar)} alt=\"\" width={44} height={44} className=\"w-full h-full object-cover\" />\r\n            ) : (\r\n              <Image src=\"/logo/avata.webp\" alt=\"\" width={44} height={44} className=\"w-full h-full object-cover\" />\r\n            )}\r\n          </div>\r\n          <div className=\"min-w-0\">\r\n            <p className=\"text-sm font-semibold text-gray-900 truncate\">{name}</p>\r\n            {username ? <p className=\"text-sm text-gray-500 truncate\">{username}</p> : null}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"w-16 h-16 bg-white rounded-xl flex items-center justify-center border border-gray-200 shrink-0\">\r\n          {qrDataUrl ? (\r\n            <Image width={240} height={240} src={qrDataUrl} alt=\"Mã QR\" className=\"w-full h-full rounded-xl\" />\r\n          ) : (\r\n            <span className=\"text-[10px] text-gray-400\">QR</span>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"border-t border-gray-100 bg-gray-50 grid grid-cols-2\">\r\n        <button\r\n          onClick={handleVoiceCall}\r\n          className=\"cursor-pointer flex items-center justify-center gap-2 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-100 active:scale-[0.99] transition\"\r\n        >\r\n          <HiPhone className=\"w-4 h-4 text-blue-600\" />\r\n          Gọi điện\r\n        </button>\r\n        <button\r\n          onClick={handleOpenChat}\r\n          className=\"cursor-pointer flex items-center justify-center gap-2 py-2.5 text-sm font-semibold text-gray-700 hover:bg-gray-100 active:scale-[0.99] transition border-l border-gray-200\"\r\n        >\r\n          <HiChatBubbleLeftRight className=\"w-4 h-4 text-emerald-600\" />\r\n          Nhắn tin\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function MessageList({\r\n  messagesGrouped,\r\n  messages,\r\n  currentUser,\r\n  allUsersMap,\r\n  uploadingFiles,\r\n  highlightedMsgId,\r\n  isGroup,\r\n  onContextMenu,\r\n  onMobileLongPress,\r\n  onReplyMessage,\r\n  onJumpToMessage,\r\n  getSenderInfo,\r\n  renderMessageContent,\r\n  onOpenMedia,\r\n  editingMessageId,\r\n  setEditingMessageId,\r\n  editContent,\r\n  setEditContent,\r\n  onSaveEdit,\r\n  onRefresh,\r\n  onPinMessage,\r\n  onToggleReaction,\r\n  contextMenu,\r\n  scrollManagedExternally = false,\r\n  isSidebarOpen = false,\r\n  isMobile = false,\r\n  onShareMessage,\r\n  onOpenChatInfoSection,\r\n}: MessageListProps) {\r\n  const [, setTimeVisibleId] = useState<string | null>(null);\r\n  const [expandedOriginalId, setExpandedOriginalId] = useState<string | null>(null);\r\n  const [activeMoreId, setActiveMoreId] = useState<string | null>(null);\r\n  const [detailMsg, setDetailMsg] = useState<Message | null>(null);\r\n  const [reactionDetail, setReactionDetail] = useState<{ msgId: string; emoji: string } | null>(null);\r\n  const longPressTimerRef = useRef<number | null>(null);\r\n  const longPressTriggeredRef = useRef(false);\r\n  const [mobileCollapsedId, setMobileCollapsedId] = useState<string | null>(null);\r\n  const [swipeState, setSwipeState] = useState<{ id: string | null; dx: number }>({ id: null, dx: 0 });\r\n  const [longPressActiveId, setLongPressActiveId] = useState<string | null>(null);\r\n  const [expandedNotifyGroups, setExpandedNotifyGroups] = useState<Set<string>>(new Set());\r\n  const swipeStartRef = useRef<{ x: number; y: number; id: string | null; isMe: boolean }>({\r\n    x: 0,\r\n    y: 0,\r\n    id: null,\r\n    isMe: false,\r\n  });\r\n\r\n  // Đóng menu reaction/folder khi click ra ngoài\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (activeMoreId) {\r\n        const activeWrapper = document.getElementById(`msg-${activeMoreId}`);\r\n        if (activeWrapper && !activeWrapper.contains(event.target as Node)) {\r\n          setActiveMoreId(null);\r\n        }\r\n      }\r\n    };\r\n    const handleVisibilityChange = () => {\r\n      if (document.hidden) setActiveMoreId(null);\r\n    };\r\n    const handleWindowBlur = () => {\r\n      setActiveMoreId(null);\r\n    };\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') setActiveMoreId(null);\r\n    };\r\n\r\n    document.addEventListener('click', handleClickOutside);\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    window.addEventListener('blur', handleWindowBlur);\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      document.removeEventListener('click', handleClickOutside);\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      window.removeEventListener('blur', handleWindowBlur);\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [activeMoreId]);\r\n  useEffect(() => {\r\n    if (!contextMenu?.visible) setMobileCollapsedId(null);\r\n  }, [contextMenu]);\r\n\r\n  const formatTimestamp = (ts: number) => {\r\n    const d = new Date(ts);\r\n    const now = new Date();\r\n    const sameDay = d.toDateString() === now.toDateString();\r\n    return sameDay\r\n      ? d.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })\r\n      : d.toLocaleString('vi-VN', {\r\n          hour: '2-digit',\r\n          minute: '2-digit',\r\n          day: '2-digit',\r\n          month: '2-digit',\r\n          year: 'numeric',\r\n        });\r\n  };\r\n  const formatTimeMarker = (ts: number) => {\r\n    const d = new Date(ts);\r\n    const today = new Date();\r\n    const yesterday = new Date();\r\n    yesterday.setDate(today.getDate() - 1);\r\n    const sameDate = (a: Date, b: Date) =>\r\n      a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate();\r\n    const timeLabel = d.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });\r\n    const dateLabel = sameDate(d, today)\r\n      ? 'Hôm nay'\r\n      : sameDate(d, yesterday)\r\n        ? 'Hôm qua'\r\n        : d.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n    return `${timeLabel} ${dateLabel}`;\r\n  };\r\n  useEffect(() => {\r\n    if (scrollManagedExternally || !highlightedMsgId) return;\r\n\r\n    // Đợi DOM render xong\r\n    setTimeout(() => {\r\n      const element = document.getElementById(`msg-${highlightedMsgId}`);\r\n      if (element) {\r\n        // Scroll với nhiều fallback\r\n        element.scrollIntoView({\r\n          behavior: 'smooth',\r\n          block: 'center',\r\n          inline: 'nearest',\r\n        });\r\n\r\n        // Fallback cho mobile\r\n        setTimeout(() => {\r\n          element.scrollIntoView({\r\n            behavior: 'auto', // Dùng auto thay vì smooth cho mobile\r\n            block: 'center',\r\n          });\r\n        }, 100);\r\n      }\r\n    }, 100);\r\n  }, [highlightedMsgId, scrollManagedExternally]);\r\n\r\n  return (\r\n    <>\r\n      {Array.from(messagesGrouped.entries()).map(([dateKey, msgs]) => {\r\n        return (\r\n          <React.Fragment key={dateKey}>\r\n            {/* Date row */}\r\n            <div className=\"flex justify-center my-4 sticky top-1 z-10\">\r\n              <span className=\"px-4 py-1 text-xs font-medium text-gray-600 bg-gray-50/90 rounded-full shadow\">\r\n                {dateKey}\r\n              </span>\r\n            </div>\r\n            {(() => {\r\n              const consumedIds = new Set<string>();\r\n              return (\r\n                <>\r\n                  {msgs.map((msg, index) => {\r\n                    if (consumedIds.has(msg._id)) return null;\r\n                    const isLastMsg = msg._id === messages[messages.length - 1]?._id;\r\n                    const senderInfo = getSenderInfo(msg.sender);\r\n                    const isMe = String(senderInfo._id) === String(currentUser._id);\r\n                    const repliedToMsg = msg.replyToMessageId\r\n                      ? messages.find((m) => m._id === msg.replyToMessageId)\r\n                      : null;\r\n\r\n                    const uploadProgress = uploadingFiles[msg._id];\r\n                    const sendingFlag = !!(msg as unknown as { isSending?: boolean }).isSending;\r\n                    const blobFlag = typeof msg.fileUrl === 'string' && msg.fileUrl.startsWith('blob:');\r\n                    const isEditing = msg._id === editingMessageId;\r\n                    const isEdited = msg.editedAt && !isEditing;\r\n                    const isRecalled = msg.isRecalled;\r\n                    const isVideo = msg.type === 'video' || (msg.fileUrl && isVideoFile(msg.fileUrl));\r\n                    const isMediaOrFile =\r\n                      msg.type === 'image' || msg.type === 'video' || (msg.type === 'file' && !isVideo);\r\n                    const isUploading = isMediaOrFile && (uploadProgress !== undefined || sendingFlag || blobFlag);\r\n                    const reactions = (msg.reactions || {}) as Record<string, string[]>;\r\n                    const myId = String(currentUser._id);\r\n                    const hasReactions = Object.values(reactions).some((arr) => (arr || []).length > 0);\r\n\r\n                    // Group detection\r\n                    const prevMsg = index > 0 ? msgs[index - 1] : null;\r\n                    let isGrouped = false;\r\n                    if (prevMsg && prevMsg.type !== 'notify') {\r\n                      const prevSender = getSenderInfo(prevMsg.sender);\r\n                      const now =\r\n                        Number((msg as unknown as { serverTimestamp?: number }).serverTimestamp ?? msg.timestamp) || 0;\r\n                      const prev =\r\n                        Number(\r\n                          (prevMsg as unknown as { serverTimestamp?: number }).serverTimestamp ?? prevMsg.timestamp,\r\n                        ) || 0;\r\n                      if (prevSender._id === senderInfo._id && now - prev < 5 * 60 * 1000) {\r\n                        isGrouped = true;\r\n                      }\r\n                    }\r\n                    const nowTs =\r\n                      Number((msg as unknown as { serverTimestamp?: number }).serverTimestamp ?? msg.timestamp) || 0;\r\n                    const prevTs =\r\n                      prevMsg != null\r\n                        ? Number(\r\n                            (prevMsg as unknown as { serverTimestamp?: number }).serverTimestamp ?? prevMsg.timestamp,\r\n                          ) || 0\r\n                        : null;\r\n                    const showTimeMarker = prevTs != null && nowTs - (prevTs as number) >= 30 * 60 * 1000;\r\n                    const timeMarkerNode = showTimeMarker ? (\r\n                      <div className=\"flex justify-center my-4\">\r\n                        <span className=\"px-4 py-2 text-white  text-xs font-medium  bg-gray-400/60 rounded-full shadow\">\r\n                          {formatTimeMarker(nowTs)}\r\n                        </span>\r\n                      </div>\r\n                    ) : null;\r\n                    const unreadDividerNode = null;\r\n\r\n                    const nextMsg = index < msgs.length - 1 ? msgs[index + 1] : null;\r\n                    let isEndOfGroup = true;\r\n                    if (nextMsg && nextMsg.type !== 'notify') {\r\n                      const nextSender = getSenderInfo(nextMsg.sender);\r\n                      const now =\r\n                        Number((msg as unknown as { serverTimestamp?: number }).serverTimestamp ?? msg.timestamp) || 0;\r\n                      const next =\r\n                        Number(\r\n                          (nextMsg as unknown as { serverTimestamp?: number }).serverTimestamp ?? nextMsg.timestamp,\r\n                        ) || 0;\r\n                      if (nextSender._id === senderInfo._id && next - now < 5 * 60 * 1000) {\r\n                        isEndOfGroup = false;\r\n                      }\r\n                    }\r\n\r\n                    const canGroupMedia = !isRecalled && (msg.type === 'image' || msg.type === 'video');\r\n                    if (canGroupMedia) {\r\n                      const mediaGroup: Message[] = [msg];\r\n                      const groupBatchId = (msg as Message).batchId;\r\n                      for (let k = index + 1; k < msgs.length; k++) {\r\n                        const next = msgs[k];\r\n                        if (next.isRecalled) break;\r\n                        if (!(next.type === 'image' || next.type === 'video')) break;\r\n                        const nextSender = getSenderInfo(next.sender);\r\n                        const dt = Math.abs(\r\n                          Number(next.timestamp) - Number(mediaGroup[mediaGroup.length - 1].timestamp),\r\n                        );\r\n                        const nextBatchId = (next as Message).batchId;\r\n                        if ((groupBatchId || nextBatchId) && groupBatchId !== nextBatchId) break;\r\n                        if (nextSender._id !== senderInfo._id || dt > 120000) break;\r\n                        mediaGroup.push(next);\r\n                      }\r\n                      if (mediaGroup.length > 1) {\r\n                        mediaGroup.slice(1).forEach((m) => consumedIds.add(m._id));\r\n                        const lastInGroup = mediaGroup[mediaGroup.length - 1];\r\n                        const isMeGroup = String(senderInfo._id) === String(currentUser._id);\r\n                        const groupIsLast = lastInGroup._id === messages[messages.length - 1]?._id;\r\n                        const nextIdx = index + mediaGroup.length;\r\n                        const nextAfterGroup = nextIdx < msgs.length ? msgs[nextIdx] : null;\r\n                        let endRun = true;\r\n                        if (nextAfterGroup && nextAfterGroup.type !== 'notify') {\r\n                          const nextSender = getSenderInfo(nextAfterGroup.sender);\r\n                          const lastTs =\r\n                            Number(\r\n                              (lastInGroup as unknown as { serverTimestamp?: number }).serverTimestamp ??\r\n                                lastInGroup.timestamp,\r\n                            ) || 0;\r\n                          const nextTs =\r\n                            Number(\r\n                              (nextAfterGroup as unknown as { serverTimestamp?: number }).serverTimestamp ??\r\n                                nextAfterGroup.timestamp,\r\n                            ) || 0;\r\n                          if (nextSender._id === senderInfo._id && nextTs - lastTs < 5 * 60 * 1000) {\r\n                            endRun = false;\r\n                          }\r\n                        }\r\n                        const groupUploading = mediaGroup.some((mm) => {\r\n                          const up = uploadingFiles[mm._id] !== undefined;\r\n                          const sending = !!(mm as unknown as { isSending?: boolean }).isSending;\r\n                          const blob = typeof mm.fileUrl === 'string' && mm.fileUrl.startsWith('blob:');\r\n                          return up || sending || blob;\r\n                        });\r\n                        return (\r\n                          <React.Fragment key={`group-${msg._id}-frag`}>\r\n                            {unreadDividerNode}\r\n                            {timeMarkerNode}\r\n                            <div\r\n                              key={`group-${msg._id}`}\r\n                              id={`msg-${msg._id}`}\r\n                              className={`\r\n                      w-full  sm:max-w-[23rem]\r\n                      flex gap-2 group relative\r\n                      ${isMeGroup ? 'ml-auto flex-row-reverse' : 'mr-auto flex-row'}\r\n                      ${isGrouped ? 'mt-2' : 'mt-4'}\r\n                      ${groupIsLast ? 'mb-8' : ''}\r\n                    `}\r\n                            >\r\n                              {!isMeGroup && (\r\n                                <div className={`${isGrouped ? 'opacity-0' : ''} flex-shrink-0`}>\r\n                                  {senderInfo.avatar ? (\r\n                                    <div className=\"w-9 h-9 rounded-full overflow-hidden flex-shrink-0\">\r\n                                      <Image\r\n                                        width={38}\r\n                                        height={38}\r\n                                        src={getProxyUrl(senderInfo.avatar)}\r\n                                        alt={senderInfo.name}\r\n                                        className=\"w-full h-full object-cover\"\r\n                                        unoptimized={String(senderInfo.avatar).includes('mega.nz')}\r\n                                      />\r\n                                    </div>\r\n                                  ) : (\r\n                                    <div className=\"w-9 h-9 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold\">\r\n                                      <Image\r\n                                        src=\"/logo/avata.webp\"\r\n                                        alt={senderInfo.name || 'User'}\r\n                                        width={38}\r\n                                        height={38}\r\n                                        className=\"w-full h-full rounded-full object-cover\"\r\n                                      />\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n                              <div className={`flex flex-col min-w-0 ${isMeGroup ? 'items-end' : 'items-start'}`}>\r\n                                {isGroup && !isGrouped && !isRecalled && !isMeGroup && (\r\n                                  <p\r\n                                    className={`text-sm mb-1 px-2 py-1 bg-white rounded-[2rem] ${isMeGroup ? 'text-gray-600' : 'text-gray-600'}`}\r\n                                  >\r\n                                    {allUsersMap.get(senderInfo._id) || senderInfo.name}\r\n                                  </p>\r\n                                )}\r\n                                <div\r\n                                  className={` px-0 py-0 rounded-lg shadow-none max-w-[70vw] sm:max-w-[22rem] mt-1 bg-transparent relative ${hasReactions ? 'mb-4' : ''}`}\r\n                                  style={\r\n                                    isMobile && swipeState.id === msg._id\r\n                                      ? { transform: `translateX(${Math.max(-100, Math.min(100, swipeState.dx))}px)` }\r\n                                      : undefined\r\n                                  }\r\n                                  onClick={() => {\r\n                                    setActiveMoreId(msg._id);\r\n                                    setReactionDetail(null);\r\n                                  }}\r\n                                  onTouchStart={(e) => {\r\n                                    try {\r\n                                      if (isRecalled) return;\r\n                                      longPressTriggeredRef.current = false;\r\n                                      if (longPressTimerRef.current != null) {\r\n                                        clearTimeout(longPressTimerRef.current);\r\n                                        longPressTimerRef.current = null;\r\n                                      }\r\n                                      const t = e.touches && e.touches[0];\r\n                                      const x0 = t ? t.clientX : 0;\r\n                                      const y0 = t ? t.clientY : 0;\r\n                                      const el = e.currentTarget as HTMLElement;\r\n                                      swipeStartRef.current = { x: x0, y: y0, id: msg._id, isMe: isMeGroup };\r\n                                      setSwipeState({ id: null, dx: 0 });\r\n                                      setLongPressActiveId(msg._id);\r\n                                      longPressTimerRef.current = window.setTimeout(() => {\r\n                                        longPressTriggeredRef.current = true;\r\n                                        setActiveMoreId(msg._id);\r\n                                        setReactionDetail(null);\r\n                                        onMobileLongPress?.(msg, el, x0, y0);\r\n                                      }, 420);\r\n                                    } catch {}\r\n                                  }}\r\n                                  onTouchEnd={(e) => {\r\n                                    try {\r\n                                      if (longPressTimerRef.current != null) {\r\n                                        clearTimeout(longPressTimerRef.current);\r\n                                        longPressTimerRef.current = null;\r\n                                      }\r\n                                      setLongPressActiveId(null);\r\n                                      if (longPressTriggeredRef.current) {\r\n                                        e.preventDefault();\r\n                                        e.stopPropagation();\r\n                                      }\r\n                                      if (isMobile && swipeStartRef.current.id === msg._id) {\r\n                                        const okDir = swipeStartRef.current.isMe\r\n                                          ? swipeState.dx < -64\r\n                                          : swipeState.dx > 64;\r\n                                        if (okDir) {\r\n                                          onReplyMessage?.(msg);\r\n                                        }\r\n                                        setSwipeState({ id: null, dx: 0 });\r\n                                        swipeStartRef.current = { x: 0, y: 0, id: null, isMe: false };\r\n                                      }\r\n                                    } catch {}\r\n                                  }}\r\n                                  onTouchMove={(e) => {\r\n                                    try {\r\n                                      if (longPressTimerRef.current != null) {\r\n                                        clearTimeout(longPressTimerRef.current);\r\n                                        longPressTimerRef.current = null;\r\n                                      }\r\n                                      setLongPressActiveId(null);\r\n                                      if (!isMobile) return;\r\n                                      const t = e.touches && e.touches[0];\r\n                                      const x = t ? t.clientX : 0;\r\n                                      const y = t ? t.clientY : 0;\r\n                                      const dx = x - swipeStartRef.current.x;\r\n                                      const dy = y - swipeStartRef.current.y;\r\n                                      if (swipeStartRef.current.id === msg._id) {\r\n                                        const horizontal = Math.abs(dx) > 8 && Math.abs(dy) < 24;\r\n                                        if (horizontal) {\r\n                                          const dirOk = swipeStartRef.current.isMe ? dx < 0 : dx > 0;\r\n                                          setSwipeState({ id: msg._id, dx: dirOk ? dx : 0 });\r\n                                          e.preventDefault();\r\n                                        }\r\n                                      }\r\n                                    } catch {}\r\n                                  }}\r\n                                  onTouchCancel={() => {\r\n                                    try {\r\n                                      if (longPressTimerRef.current != null) {\r\n                                        clearTimeout(longPressTimerRef.current);\r\n                                        longPressTimerRef.current = null;\r\n                                      }\r\n                                      setLongPressActiveId(null);\r\n                                      if (isMobile && swipeStartRef.current.id === msg._id) {\r\n                                        setSwipeState({ id: null, dx: 0 });\r\n                                        swipeStartRef.current = { x: 0, y: 0, id: null, isMe: false };\r\n                                      }\r\n                                    } catch {}\r\n                                  }}\r\n                                >\r\n                                  {!isRecalled && (\r\n                                    <>\r\n                                      <button\r\n                                        onClick={(e) => {\r\n                                          e.preventDefault();\r\n                                          const batchMsg = {\r\n                                            ...msg,\r\n                                            batchItems: mediaGroup.map((m) => ({\r\n                                              id: m._id,\r\n                                              content: m.content || '',\r\n                                              type: m.type === 'video' ? 'video' : 'image',\r\n                                              fileUrl: m.fileUrl || m.previewUrl,\r\n                                              fileName: m.fileName,\r\n                                            })),\r\n                                          } as Message;\r\n                                          onShareMessage(batchMsg);\r\n                                        }}\r\n                                        className={`absolute cursor-pointer top-1/2 -translate-y-1/2 p-1.5 bg-white/90 rounded-full shadow hover:bg-indigo-50 ${\r\n                                          isMeGroup ? 'right-full mr-2' : 'left-full ml-2'\r\n                                        }`}\r\n                                        aria-label=\"Chia sẻ nhóm media\"\r\n                                        title=\"Chia sẻ nhóm media\"\r\n                                      >\r\n                                        <ICShareMessage className=\"w-4 h-4 text-indigo-600\" />\r\n                                      </button>\r\n                                      {isMobile && swipeState.id === msg._id && (\r\n                                        <div\r\n                                          className={`absolute top-1/2 -translate-y-1/2 ${isMeGroup ? 'left-full ml-2' : 'right-full mr-2'}`}\r\n                                          style={{ opacity: Math.min(Math.abs(swipeState.dx) / 64, 1) }}\r\n                                        >\r\n                                          <div className=\"p-2 bg-white rounded-full shadow border border-gray-200\">\r\n                                            {isMeGroup ? (\r\n                                              <HiArrowUturnLeft className=\"w-5 h-5 text-blue-600\" />\r\n                                            ) : (\r\n                                              <HiArrowUturnRight className=\"w-5 h-5 text-blue-600\" />\r\n                                            )}\r\n                                          </div>\r\n                                        </div>\r\n                                      )}\r\n                                      {!isMobile && (\r\n                                        <>\r\n                                          <button\r\n                                            onClick={(e) => {\r\n                                              e.preventDefault();\r\n                                              onContextMenu(e, msg);\r\n                                            }}\r\n                                            className={`absolute cursor-pointer top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white/90 rounded-full shadow hover:bg-blue-50 ${isMeGroup ? 'right-full mr-10' : 'left-full ml-10'} opacity-0 pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto`}\r\n                                            aria-label=\"Mở menu\"\r\n                                            title=\"Thêm\"\r\n                                          >\r\n                                            <HiEllipsisVertical className=\"w-4 h-4 text-gray-600\" />\r\n                                          </button>\r\n                                        </>\r\n                                      )}\r\n                                      {!isMobile && (\r\n                                        <ReactionButton\r\n                                          isMine={isMeGroup}\r\n                                          visible={activeMoreId === msg._id}\r\n                                          onPick={(emoji) => {\r\n                                            onToggleReaction?.(msg, emoji);\r\n                                            setActiveMoreId(null);\r\n                                          }}\r\n                                          className={`${isMeGroup ? 'right-full mr-18' : 'left-full ml-18'} ${\r\n                                            activeMoreId === msg._id\r\n                                              ? 'opacity-100 pointer-events-auto'\r\n                                              : 'opacity-0 pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto'\r\n                                          }`}\r\n                                        />\r\n                                      )}\r\n                                    </>\r\n                                  )}\r\n                                  <div\r\n                                    className={`inline-grid gap-1 rounded-xl overflow-hidden ${isSidebarOpen ? 'sm:grid-cols-[6rem_6rem]' : 'sm:grid-cols-[10rem_10rem]'} grid-cols-[8rem_8rem]`}\r\n                                  >\r\n                                    {mediaGroup.map((m, idx) => {\r\n                                      const isVid = m.type === 'video' || (m.fileUrl && isVideoFile(m.fileUrl));\r\n                                      const url = String(m.fileUrl || m.previewUrl || '');\r\n                                      const prog = uploadingFiles[m._id];\r\n                                      const sendingFallback = !!(m as unknown as { isSending?: boolean }).isSending;\r\n                                      const blobFallback = String(url).startsWith('blob:');\r\n                                      const up = prog !== undefined || sendingFallback || blobFallback;\r\n\r\n                                      const isOddTotal = mediaGroup.length % 2 !== 0;\r\n                                      const isLastItem = idx === mediaGroup.length - 1;\r\n                                      const shouldSpan = isOddTotal && isLastItem;\r\n\r\n                                      return isVid ? (\r\n                                        <div\r\n                                          key={`${m._id}-${idx}`}\r\n                                          id={`msg-${m._id}`}\r\n                                          className={`relative bg-black rounded-[0.25rem] overflow-hidden cursor-pointer h-[8rem] ${shouldSpan ? 'col-span-2 w-full' : 'w-[8rem]'}  ${\r\n                                            isSidebarOpen\r\n                                              ? shouldSpan\r\n                                                ? 'sm:w-full sm:h-[6rem] aspect-square'\r\n                                                : 'sm:w-[6rem] sm:h-[6rem] aspect-square'\r\n                                              : shouldSpan\r\n                                                ? 'sm:w-full sm:h-[10rem] sm:aspect-video aspect-square'\r\n                                                : 'sm:aspect-video aspect-square sm:h-[10rem] sm:w-[10rem]'\r\n                                          } ${highlightedMsgId === m._id ? 'ring-2 ring-yellow-300' : ''} ${longPressActiveId === m._id ? 'ring-2 ring-blue-300 scale-[0.98] transition-transform' : ''}`}\r\n                                          onClick={() => !up && onOpenMedia(String(m.fileUrl!), 'video')}\r\n                                          onContextMenu={(e) => {\r\n                                            e.preventDefault();\r\n                                            e.stopPropagation();\r\n                                            onContextMenu(e, m);\r\n                                          }}\r\n                                          onTouchStart={(e) => {\r\n                                            try {\r\n                                              e.stopPropagation();\r\n                                              if (m.isRecalled) return;\r\n                                              longPressTriggeredRef.current = false;\r\n                                              if (longPressTimerRef.current != null) {\r\n                                                clearTimeout(longPressTimerRef.current);\r\n                                                longPressTimerRef.current = null;\r\n                                              }\r\n                                              const t = e.touches && e.touches[0];\r\n                                              const x0 = t ? t.clientX : 0;\r\n                                              const y0 = t ? t.clientY : 0;\r\n                                              const el = e.currentTarget as HTMLElement;\r\n                                              swipeStartRef.current = { x: x0, y: y0, id: msg._id, isMe: isMeGroup };\r\n                                              setSwipeState({ id: null, dx: 0 });\r\n                                              setLongPressActiveId(m._id);\r\n                                              longPressTimerRef.current = window.setTimeout(() => {\r\n                                                longPressTriggeredRef.current = true;\r\n                                                setActiveMoreId(m._id);\r\n                                                setReactionDetail(null);\r\n                                                onMobileLongPress?.(m, el, x0, y0);\r\n                                              }, 420);\r\n                                            } catch {}\r\n                                          }}\r\n                                          onTouchEnd={(e) => {\r\n                                            try {\r\n                                              if (longPressTimerRef.current != null) {\r\n                                                clearTimeout(longPressTimerRef.current);\r\n                                                longPressTimerRef.current = null;\r\n                                              }\r\n                                              setLongPressActiveId(null);\r\n                                              if (longPressTriggeredRef.current) {\r\n                                                e.preventDefault();\r\n                                                e.stopPropagation();\r\n                                              }\r\n                                            } catch {}\r\n                                          }}\r\n                                          onTouchMove={() => {\r\n                                            try {\r\n                                              if (longPressTimerRef.current != null) {\r\n                                                clearTimeout(longPressTimerRef.current);\r\n                                                longPressTimerRef.current = null;\r\n                                              }\r\n                                              setLongPressActiveId(null);\r\n                                            } catch {}\r\n                                          }}\r\n                                        >\r\n                                          <video\r\n                                            src={getProxyUrl(url)}\r\n                                            className=\"w-full h-full object-cover\"\r\n                                            playsInline\r\n                                            preload=\"metadata\"\r\n                                          />\r\n\r\n                                          {!up && (\r\n                                            <div className=\"absolute inset-0 flex items-center justify-center opacity-100\">\r\n                                              <div className=\"w-8 h-8 bg-white/80 rounded-full flex items-center justify-center shadow\">\r\n                                                <HiPlay className=\"w-5 h-5 text-blue-600 ml-0.5\" />\r\n                                              </div>\r\n                                            </div>\r\n                                          )}\r\n                                          {up && (\r\n                                            <div className=\"absolute inset-0 bg-black/60 text-white flex items-center justify-center\">\r\n                                              <div className=\"flex items-center gap-2\">\r\n                                                <div className=\"w-6 h-6 border-2 border-white/60 border-t-transparent rounded-full animate-spin\" />\r\n                                                {prog !== undefined && (\r\n                                                  <span className=\"text-sm font-semibold\">\r\n                                                    {Math.round(prog as number)}%\r\n                                                  </span>\r\n                                                )}\r\n                                              </div>\r\n                                            </div>\r\n                                          )}\r\n                                        </div>\r\n                                      ) : (\r\n                                        <div\r\n                                          key={`${m._id}-${idx}`}\r\n                                          id={`msg-${m._id}`}\r\n                                          className={`relative rounded-[0.25rem] overflow-hidden cursor-pointer hover:bg-gray-100 shadow-sm h-[8rem] ${shouldSpan ? 'col-span-2 w-full' : 'w-[8rem]'} ${\r\n                                            isSidebarOpen\r\n                                              ? shouldSpan\r\n                                                ? 'sm:w-full sm:h-[6rem]'\r\n                                                : 'sm:w-[6rem] sm:h-[6rem]'\r\n                                              : shouldSpan\r\n                                                ? 'sm:w-full sm:h-[10rem]'\r\n                                                : 'sm:w-[10rem] sm:h-[10rem]'\r\n                                          } ${highlightedMsgId === m._id ? 'ring-2 ring-yellow-300' : ''} ${longPressActiveId === m._id ? 'ring-2 ring-blue-300 scale-[0.98] transition-transform' : ''}`}\r\n                                          onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            if (!up) onOpenMedia(String(m.fileUrl || m.previewUrl || ''), 'image');\r\n                                          }}\r\n                                          onContextMenu={(e) => {\r\n                                            e.preventDefault();\r\n                                            e.stopPropagation();\r\n                                            onContextMenu(e, m);\r\n                                          }}\r\n                                          onTouchStart={(e) => {\r\n                                            try {\r\n                                              e.stopPropagation();\r\n                                              if (m.isRecalled) return;\r\n                                              longPressTriggeredRef.current = false;\r\n                                              if (longPressTimerRef.current != null) {\r\n                                                clearTimeout(longPressTimerRef.current);\r\n                                                longPressTimerRef.current = null;\r\n                                              }\r\n                                              const t = e.touches && e.touches[0];\r\n                                              const x0 = t ? t.clientX : 0;\r\n                                              const y0 = t ? t.clientY : 0;\r\n                                              const el = e.currentTarget as HTMLElement;\r\n                                              swipeStartRef.current = { x: x0, y: y0, id: msg._id, isMe: isMeGroup };\r\n                                              setSwipeState({ id: null, dx: 0 });\r\n                                              setLongPressActiveId(m._id);\r\n                                              longPressTimerRef.current = window.setTimeout(() => {\r\n                                                longPressTriggeredRef.current = true;\r\n                                                setActiveMoreId(m._id);\r\n                                                setReactionDetail(null);\r\n                                                onMobileLongPress?.(m, el, x0, y0);\r\n                                              }, 420);\r\n                                            } catch {}\r\n                                          }}\r\n                                          onTouchEnd={(e) => {\r\n                                            try {\r\n                                              if (longPressTimerRef.current != null) {\r\n                                                clearTimeout(longPressTimerRef.current);\r\n                                                longPressTimerRef.current = null;\r\n                                              }\r\n                                              setLongPressActiveId(null);\r\n                                              if (longPressTriggeredRef.current) {\r\n                                                e.preventDefault();\r\n                                                e.stopPropagation();\r\n                                              }\r\n                                            } catch {}\r\n                                          }}\r\n                                          onTouchMove={() => {\r\n                                            try {\r\n                                              if (longPressTimerRef.current != null) {\r\n                                                clearTimeout(longPressTimerRef.current);\r\n                                                longPressTimerRef.current = null;\r\n                                              }\r\n                                              setLongPressActiveId(null);\r\n                                            } catch {}\r\n                                          }}\r\n                                        >\r\n                                          {String(url).startsWith('blob:') ? (\r\n                                            <Image\r\n                                              width={600}\r\n                                              height={600}\r\n                                              src={url}\r\n                                              alt=\"Ảnh\"\r\n                                              className=\"w-full h-full object-cover\"\r\n                                            />\r\n                                          ) : (\r\n                                            <Image\r\n                                              width={600}\r\n                                              height={600}\r\n                                              src={getProxyUrl(url)}\r\n                                              alt=\"Ảnh\"\r\n                                              className=\"w-full h-full object-cover\"\r\n                                            />\r\n                                          )}\r\n\r\n                                          {up && (\r\n                                            <div className=\"absolute inset-0 bg-black/70 flex items-center justify-center\">\r\n                                              {(() => {\r\n                                                const size = 40;\r\n                                                const stroke = 4;\r\n                                                const r = (size - stroke) / 2;\r\n                                                const c = 2 * Math.PI * r;\r\n                                                const p = Math.max(0, Math.min(100, Number(prog || 0)));\r\n                                                return (\r\n                                                  <div className=\"flex flex-col items-center\">\r\n                                                    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\r\n                                                      <circle\r\n                                                        cx={size / 2}\r\n                                                        cy={size / 2}\r\n                                                        r={r}\r\n                                                        stroke=\"rgba(255,255,255,0.3)\"\r\n                                                        strokeWidth={stroke}\r\n                                                        fill=\"none\"\r\n                                                      />\r\n                                                      <circle\r\n                                                        cx={size / 2}\r\n                                                        cy={size / 2}\r\n                                                        r={r}\r\n                                                        stroke=\"white\"\r\n                                                        strokeWidth={stroke}\r\n                                                        fill=\"none\"\r\n                                                        strokeDasharray={c}\r\n                                                        strokeDashoffset={c - (p / 100) * c}\r\n                                                        strokeLinecap=\"round\"\r\n                                                        transform={`rotate(-90 ${size / 2} ${size / 2})`}\r\n                                                      />\r\n                                                    </svg>\r\n                                                    {/* <span className=\"text-xs text-white font-semibold\">{Math.round(p)}%</span> */}\r\n                                                  </div>\r\n                                                );\r\n                                              })()}\r\n                                            </div>\r\n                                          )}\r\n                                        </div>\r\n                                      );\r\n                                    })}\r\n                                  </div>\r\n                                  {(() => {\r\n                                    const items = Object.entries(reactions)\r\n                                      .map(([emoji, arr]) => ({\r\n                                        emoji,\r\n                                        count: (arr || []).length,\r\n                                        mine: (arr || []).includes(myId),\r\n                                        users: (arr || []).map((id) => allUsersMap.get(String(id)) || 'Người dùng'),\r\n                                      }))\r\n                                      .filter((x) => x.count > 0)\r\n                                      .sort((a, b) => b.count - a.count);\r\n                                    if (items.length === 0) return null;\r\n                                    return (\r\n                                      <div\r\n                                        className={`absolute ${isMeGroup ? 'right-2 -mr-1' : 'left-2 -ml-1'} bottom-1 flex items-center gap-1`}\r\n                                      >\r\n                                        <div className=\"flex items-center bg-white rounded-full shadow-lg border border-gray-200\">\r\n                                          {items.slice(0, 3).map((it, idx) => (\r\n                                            <div\r\n                                              key={`${msg._id}-react-group-${idx}`}\r\n                                              onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                setReactionDetail(\r\n                                                  reactionDetail?.msgId === msg._id &&\r\n                                                    reactionDetail?.emoji === it.emoji\r\n                                                    ? null\r\n                                                    : { msgId: msg._id, emoji: it.emoji },\r\n                                                );\r\n                                              }}\r\n                                              className={`flex items-center gap-0.5 py-0.5 rounded-full text-sm cursor-pointer transition-all duration-200 hover:bg-gray-100 active:scale-95 ${it.mine ? 'bg-blue-50' : 'bg-transparent'}`}\r\n                                              title={`${it.count} người`}\r\n                                            >\r\n                                              <span className=\"text-lg leading-none\">{it.emoji}</span>\r\n                                              {it.count > 1 && (\r\n                                                <span\r\n                                                  className={`text-xs font-medium ${it.mine ? 'text-blue-600' : 'text-gray-600'}`}\r\n                                                >\r\n                                                  {it.count}\r\n                                                </span>\r\n                                              )}\r\n                                            </div>\r\n                                          ))}\r\n                                          {items.length > 3 && (\r\n                                            <div className=\"px-2 text-xs text-gray-500 font-medium\">\r\n                                              +{items.length - 3}\r\n                                            </div>\r\n                                          )}\r\n                                        </div>\r\n                                        <div className=\"absolute inset-0 -z-10 bg-white/60 backdrop-blur-sm rounded-full scale-0 group-hover:scale-100 transition-transform duration-300\" />\r\n                                      </div>\r\n                                    );\r\n                                  })()}\r\n                                  {reactionDetail && reactionDetail.msgId === msg._id && (\r\n                                    <>\r\n                                      <div className=\"fixed inset-0 z-30\" onClick={() => setReactionDetail(null)} />\r\n                                      <div\r\n                                        ref={(el) => {\r\n                                          if (el && reactionDetail.msgId === msg._id) {\r\n                                            const rect = el.parentElement?.getBoundingClientRect();\r\n                                            if (rect) {\r\n                                              const spaceBelow = window.innerHeight - rect.bottom;\r\n                                              const spaceAbove = rect.top;\r\n                                              const popoverHeight = 250;\r\n                                              if (spaceBelow < popoverHeight && spaceAbove > spaceBelow) {\r\n                                                el.style.bottom = '100%';\r\n                                                el.style.top = 'auto';\r\n                                                el.style.marginBottom = '0.625rem';\r\n                                                el.style.marginTop = '0';\r\n                                              } else {\r\n                                                el.style.top = '100%';\r\n                                                el.style.bottom = 'auto';\r\n                                                el.style.marginTop = '0.625rem';\r\n                                                el.style.marginBottom = '0';\r\n                                              }\r\n                                            }\r\n                                          }\r\n                                        }}\r\n                                        className={`absolute ${isMeGroup ? 'right-2' : 'left-2'} z-40`}\r\n                                      >\r\n                                        {(() => {\r\n                                          const users = (reactions[reactionDetail.emoji] || []).map(\r\n                                            (id) => allUsersMap.get(String(id)) || String(id),\r\n                                          );\r\n                                          return (\r\n                                            <div className=\"min-w-[11.25rem] max-w-[15rem] px-3 py-2.5 bg-white rounded-xl border border-gray-200 shadow-xl animate-in fade-in zoom-in-95 duration-200\">\r\n                                              <div className=\"flex items-center gap-2 mb-2 pb-2 border-b border-gray-100\">\r\n                                                <span className=\"text-2xl\">{reactionDetail.emoji}</span>\r\n                                                <span className=\"text-sm font-semibold text-gray-700\">\r\n                                                  {users.length} người\r\n                                                </span>\r\n                                              </div>\r\n                                              {users.length > 0 ? (\r\n                                                <ul className=\"space-y-1.5 max-h-48 overflow-y-auto\">\r\n                                                  {users.map((name, idx) => (\r\n                                                    <li\r\n                                                      key={`${msg._id}-user-group-${idx}`}\r\n                                                      className=\"text-sm text-gray-700 py-1 hover:text-blue-600 transition-colors\"\r\n                                                    >\r\n                                                      {name}\r\n                                                    </li>\r\n                                                  ))}\r\n                                                </ul>\r\n                                              ) : (\r\n                                                <div className=\"text-sm text-gray-500 py-1\">Chưa có ai</div>\r\n                                              )}\r\n                                            </div>\r\n                                          );\r\n                                        })()}\r\n                                      </div>\r\n                                    </>\r\n                                  )}\r\n                                  {endRun && (\r\n                                    <div className={`text-xs mt-2 ${isMeGroup ? 'text-gray-700' : 'text-gray-500'}`}>\r\n                                      <span className=\"inline-block px-2 py-1 bg-white rounded-[2rem]\">\r\n                                        {formatTimestamp(\r\n                                          Number(\r\n                                            (lastInGroup as unknown as { serverTimestamp?: number }).serverTimestamp ??\r\n                                              lastInGroup.timestamp,\r\n                                          ) || 0,\r\n                                        )}\r\n                                      </span>\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                                <ReadStatus\r\n                                  message={lastInGroup}\r\n                                  isGroup={isGroup}\r\n                                  isRecalled={!!lastInGroup.isRecalled}\r\n                                  isMine={isMeGroup}\r\n                                  isLast={groupIsLast}\r\n                                  myId={myId}\r\n                                  allUsersMap={allUsersMap}\r\n                                  getSenderInfo={getSenderInfo}\r\n                                  isMobile={isMobile}\r\n                                  isUploading={groupUploading}\r\n                                />\r\n                              </div>\r\n                            </div>\r\n                          </React.Fragment>\r\n                        );\r\n                      }\r\n                    }\r\n\r\n                    const canGroupFiles = !isRecalled && msg.type === 'file' && !isVideo;\r\n                    if (canGroupFiles) {\r\n                      const fileGroup: Message[] = [msg];\r\n                      for (let k = index + 1; k < msgs.length; k++) {\r\n                        const next = msgs[k];\r\n                        if (next.isRecalled) break;\r\n                        const nextIsFile = next.type === 'file' && !(next.fileUrl && isVideoFile(next.fileUrl));\r\n                        if (!nextIsFile) break;\r\n                        const nextSender = getSenderInfo(next.sender);\r\n                        const dt = Math.abs(Number(next.timestamp) - Number(fileGroup[fileGroup.length - 1].timestamp));\r\n                        if (nextSender._id !== senderInfo._id || dt > 120000) break;\r\n                        fileGroup.push(next);\r\n                      }\r\n                      if (fileGroup.length > 1) {\r\n                        fileGroup.slice(1).forEach((m) => consumedIds.add(m._id));\r\n                        const lastInGroup = fileGroup[fileGroup.length - 1];\r\n                        const isMeGroup = String(senderInfo._id) === String(currentUser._id);\r\n                        const groupIsLast = lastInGroup._id === messages[messages.length - 1]?._id;\r\n                        const nextIdx = index + fileGroup.length;\r\n                        const nextAfterGroup = nextIdx < msgs.length ? msgs[nextIdx] : null;\r\n                        let endRun = true;\r\n                        if (nextAfterGroup && nextAfterGroup.type !== 'notify') {\r\n                          const nextSender = getSenderInfo(nextAfterGroup.sender);\r\n                          const lastTs =\r\n                            Number(\r\n                              (lastInGroup as unknown as { serverTimestamp?: number }).serverTimestamp ??\r\n                                lastInGroup.timestamp,\r\n                            ) || 0;\r\n                          const nextTs =\r\n                            Number(\r\n                              (nextAfterGroup as unknown as { serverTimestamp?: number }).serverTimestamp ??\r\n                                nextAfterGroup.timestamp,\r\n                            ) || 0;\r\n                          if (nextSender._id === senderInfo._id && nextTs - lastTs < 5 * 60 * 1000) {\r\n                            endRun = false;\r\n                          }\r\n                        }\r\n                        const groupUploading = fileGroup.some((mm) => {\r\n                          const up = uploadingFiles[mm._id] !== undefined;\r\n                          const sending = !!(mm as unknown as { isSending?: boolean }).isSending;\r\n                          const blob = typeof mm.fileUrl === 'string' && mm.fileUrl.startsWith('blob:');\r\n                          return up || sending || blob;\r\n                        });\r\n                        return (\r\n                          <React.Fragment key={`group-file-${msg._id}-frag`}>\r\n                            {unreadDividerNode}\r\n                            {timeMarkerNode}\r\n                            <div\r\n                              key={`group-file-${msg._id}`}\r\n                              id={`msg-${msg._id}`}\r\n                              className={`\r\n                      w-full  sm:max-w-[23rem]\r\n                      flex gap-2 group relative\r\n                      ${isMeGroup ? 'ml-auto flex-row-reverse' : 'mr-auto flex-row'}\r\n                      ${isGrouped ? 'mt-2' : 'mt-4'}\r\n                      ${groupIsLast ? 'mb-8' : ''}\r\n                    `}\r\n                            >\r\n                              {!isMeGroup && (\r\n                                <div className={`${isGrouped ? 'opacity-0' : ''} flex-shrink-0`}>\r\n                                  {senderInfo.avatar ? (\r\n                                    <div className=\"w-9 h-9 rounded-full overflow-hidden flex-shrink-0\">\r\n                                      <Image\r\n                                        width={38}\r\n                                        height={38}\r\n                                        src={getProxyUrl(senderInfo.avatar)}\r\n                                        alt={senderInfo.name}\r\n                                        className=\"w-full h-full object-cover\"\r\n                                        unoptimized={String(senderInfo.avatar).includes('mega.nz')}\r\n                                      />\r\n                                    </div>\r\n                                  ) : (\r\n                                    <div className=\"w-9 h-9 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold\">\r\n                                      <Image\r\n                                        src=\"/logo/avata.webp\"\r\n                                        alt={senderInfo.name || 'User'}\r\n                                        width={38}\r\n                                        height={38}\r\n                                        className=\"w-full h-full rounded-full object-cover\"\r\n                                      />\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n                              <div className={`flex flex-col min-w-0 ${isMeGroup ? '' : 'items-start'}`}>\r\n                                {isGroup && !isGrouped && !isRecalled && !isMeGroup && (\r\n                                  <p className={`text-sm  px-2  ${isMeGroup ? 'text-gray-600' : 'text-gray-600'}`}>\r\n                                    {allUsersMap.get(senderInfo._id) || senderInfo.name}\r\n                                  </p>\r\n                                )}\r\n                                <div\r\n                                  className={`py-2 rounded-lg max-w-[70vw] sm:max-w-[18rem] mt-1  relative ${hasReactions ? 'mb-4' : ''}`}\r\n                                  onClick={() => {\r\n                                    setActiveMoreId(msg._id);\r\n                                    setReactionDetail(null);\r\n                                  }}\r\n                                >\r\n                                  {!isRecalled && (\r\n                                    <>\r\n                                      {!isMobile && (\r\n                                        <>\r\n                                          <button\r\n                                            onClick={(e) => {\r\n                                              e.preventDefault();\r\n                                              onContextMenu(e, msg);\r\n                                            }}\r\n                                            className={`absolute top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white/90 rounded-full shadow hover:bg-blue-50 ${isMeGroup ? 'right-full mr-2' : 'left-full ml-2'} opacity-0 pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto`}\r\n                                            aria-label=\"Mở menu\"\r\n                                            title=\"Thêm\"\r\n                                          >\r\n                                            <HiEllipsisVertical className=\"w-4 h-4 text-gray-600\" />\r\n                                          </button>\r\n                                        </>\r\n                                      )}\r\n                                      {!isMobile && (\r\n                                        <ReactionButton\r\n                                          isMine={isMeGroup}\r\n                                          visible={activeMoreId === msg._id}\r\n                                          onPick={(emoji) => {\r\n                                            onToggleReaction?.(msg, emoji);\r\n                                            setActiveMoreId(null);\r\n                                          }}\r\n                                          className={`${isMeGroup ? 'right-full mr-10' : 'left-full ml-10'} ${\r\n                                            activeMoreId === msg._id\r\n                                              ? 'opacity-100 pointer-events-auto'\r\n                                              : 'opacity-0 pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto'\r\n                                          }`}\r\n                                        />\r\n                                      )}\r\n                                    </>\r\n                                  )}\r\n                                  <div className=\"space-y-2\">\r\n                                    {fileGroup.map((m, idx) => (\r\n                                      <a\r\n                                        key={`${m._id}-${idx}`}\r\n                                        id={`msg-${m._id}`}\r\n                                        href={getProxyUrl(String(m.fileUrl || ''), true)}\r\n                                        download={m.fileName || 'download'}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noreferrer\"\r\n                                        className={`relative flex items-center bg-white gap-3 p-2 rounded-xl border cursor-pointer ${\r\n                                          highlightedMsgId === m._id\r\n                                            ? 'bg-yellow-50 border-yellow-300'\r\n                                            : 'border-gray-200 hover:bg-gray-50'\r\n                                        } ${longPressActiveId === m._id ? 'ring-2 ring-blue-300 scale-[0.98] transition-transform' : ''}`}\r\n                                        onClick={(e) => {\r\n                                          const prog = uploadingFiles[m._id];\r\n                                          if (prog !== undefined) e.preventDefault();\r\n                                        }}\r\n                                        onContextMenu={(e) => {\r\n                                          e.preventDefault();\r\n                                          e.stopPropagation();\r\n                                          onContextMenu(e, m);\r\n                                        }}\r\n                                        onTouchStart={(e) => {\r\n                                          try {\r\n                                            if (m.isRecalled) return;\r\n                                            longPressTriggeredRef.current = false;\r\n                                            if (longPressTimerRef.current != null) {\r\n                                              clearTimeout(longPressTimerRef.current);\r\n                                              longPressTimerRef.current = null;\r\n                                            }\r\n                                            const t = e.touches && e.touches[0];\r\n                                            const x0 = t ? t.clientX : 0;\r\n                                            const y0 = t ? t.clientY : 0;\r\n                                            const el = e.currentTarget as HTMLElement;\r\n                                            setLongPressActiveId(m._id);\r\n                                            longPressTimerRef.current = window.setTimeout(() => {\r\n                                              longPressTriggeredRef.current = true;\r\n                                              setActiveMoreId(m._id);\r\n                                              setReactionDetail(null);\r\n                                              onMobileLongPress?.(m, el, x0, y0);\r\n                                            }, 420);\r\n                                          } catch {}\r\n                                        }}\r\n                                        onTouchEnd={(e) => {\r\n                                          try {\r\n                                            if (longPressTimerRef.current != null) {\r\n                                              clearTimeout(longPressTimerRef.current);\r\n                                              longPressTimerRef.current = null;\r\n                                            }\r\n                                            setLongPressActiveId(null);\r\n                                            if (longPressTriggeredRef.current) {\r\n                                              e.preventDefault();\r\n                                              e.stopPropagation();\r\n                                            }\r\n                                          } catch {}\r\n                                        }}\r\n                                        onTouchMove={() => {\r\n                                          try {\r\n                                            if (longPressTimerRef.current != null) {\r\n                                              clearTimeout(longPressTimerRef.current);\r\n                                              longPressTimerRef.current = null;\r\n                                            }\r\n                                            setLongPressActiveId(null);\r\n                                          } catch {}\r\n                                        }}\r\n                                        aria-disabled={uploadingFiles[m._id] !== undefined ? true : undefined}\r\n                                      >\r\n                                        <div className=\"p-2 bg-blue-600 rounded-xl\">\r\n                                          <HiOutlineDocumentText className=\"w-5 h-5 text-white\" />\r\n                                        </div>\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                          <p className=\"text-sm font-semibold text-gray-800 truncate\">\r\n                                            {m.fileName || 'Tệp đính kèm'}\r\n                                          </p>\r\n                                          <p className=\"text-xs text-gray-500 truncate\">Nhấn để tải xuống</p>\r\n                                        </div>\r\n                                        {uploadingFiles[m._id] !== undefined && (\r\n                                          <div className=\"absolute inset-0 bg-black/60 text-white flex items-center justify-center\">\r\n                                            {(() => {\r\n                                              const size = 32;\r\n                                              const stroke = 3;\r\n                                              const r = (size - stroke) / 2;\r\n                                              const c = 2 * Math.PI * r;\r\n                                              const p = Math.max(0, Math.min(100, Number(uploadingFiles[m._id] || 0)));\r\n                                              return (\r\n                                                <div className=\"flex flex-col items-center\">\r\n                                                  <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\r\n                                                    <circle\r\n                                                      cx={size / 2}\r\n                                                      cy={size / 2}\r\n                                                      r={r}\r\n                                                      stroke=\"rgba(255,255,255,0.35)\"\r\n                                                      strokeWidth={stroke}\r\n                                                      fill=\"none\"\r\n                                                    />\r\n                                                    <circle\r\n                                                      cx={size / 2}\r\n                                                      cy={size / 2}\r\n                                                      r={r}\r\n                                                      stroke=\"white\"\r\n                                                      strokeWidth={stroke}\r\n                                                      fill=\"none\"\r\n                                                      strokeDasharray={c}\r\n                                                      strokeDashoffset={c - (p / 100) * c}\r\n                                                      strokeLinecap=\"round\"\r\n                                                      transform={`rotate(-90 ${size / 2} ${size / 2})`}\r\n                                                    />\r\n                                                  </svg>\r\n                                                  <span className=\"text-xs font-semibold mt-1\">{Math.round(p)}%</span>\r\n                                                </div>\r\n                                              );\r\n                                            })()}\r\n                                          </div>\r\n                                        )}\r\n                                      </a>\r\n                                    ))}\r\n                                  </div>\r\n                                  {(() => {\r\n                                    const items = Object.entries(reactions)\r\n                                      .map(([emoji, arr]) => ({\r\n                                        emoji,\r\n                                        count: (arr || []).length,\r\n                                        mine: (arr || []).includes(myId),\r\n                                        users: (arr || []).map((id) => allUsersMap.get(String(id)) || 'Người dùng'),\r\n                                      }))\r\n                                      .filter((x) => x.count > 0)\r\n                                      .sort((a, b) => b.count - a.count);\r\n                                    if (items.length === 0) return null;\r\n                                    return (\r\n                                      <div\r\n                                        className={`absolute ${isMeGroup ? 'right-2 -mr-1' : 'left-2 -ml-1'} bottom-1 flex items-center gap-1`}\r\n                                      >\r\n                                        <div className=\"flex items-center bg-white rounded-full shadow-lg border border-gray-200\">\r\n                                          {items.slice(0, 3).map((it, idx) => (\r\n                                            <div\r\n                                              key={`${msg._id}-react-filegroup-${idx}`}\r\n                                              onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                setReactionDetail(\r\n                                                  reactionDetail?.msgId === msg._id &&\r\n                                                    reactionDetail?.emoji === it.emoji\r\n                                                    ? null\r\n                                                    : { msgId: msg._id, emoji: it.emoji },\r\n                                                );\r\n                                              }}\r\n                                              className={`flex items-center gap-0.5 py-0.5 rounded-full text-sm cursor-pointer transition-all duration-200 hover:bg-gray-100 active:scale-95 ${it.mine ? 'bg-blue-50' : 'bg-transparent'}`}\r\n                                              title={`${it.count} người`}\r\n                                            >\r\n                                              <span className=\"text-lg leading-none\">{it.emoji}</span>\r\n                                              {it.count > 1 && (\r\n                                                <span\r\n                                                  className={`text-xs font-medium ${it.mine ? 'text-blue-600' : 'text-gray-600'}`}\r\n                                                >\r\n                                                  {it.count}\r\n                                                </span>\r\n                                              )}\r\n                                            </div>\r\n                                          ))}\r\n                                          {items.length > 3 && (\r\n                                            <div className=\"px-2 text-xs text-gray-500 font-medium\">\r\n                                              +{items.length - 3}\r\n                                            </div>\r\n                                          )}\r\n                                        </div>\r\n                                        <div className=\"absolute inset-0 -z-10 bg-white/60 backdrop-blur-sm rounded-full scale-0 group-hover:scale-100 transition-transform duration-300\" />\r\n                                      </div>\r\n                                    );\r\n                                  })()}\r\n                                  {reactionDetail && reactionDetail.msgId === msg._id && (\r\n                                    <>\r\n                                      <div className=\"fixed inset-0 z-30\" onClick={() => setReactionDetail(null)} />\r\n                                      <div\r\n                                        ref={(el) => {\r\n                                          if (el && reactionDetail.msgId === msg._id) {\r\n                                            const rect = el.parentElement?.getBoundingClientRect();\r\n                                            if (rect) {\r\n                                              const spaceBelow = window.innerHeight - rect.bottom;\r\n                                              const spaceAbove = rect.top;\r\n                                              const popoverHeight = 250;\r\n                                              if (spaceBelow < popoverHeight && spaceAbove > spaceBelow) {\r\n                                                el.style.bottom = '100%';\r\n                                                el.style.top = 'auto';\r\n                                                el.style.marginBottom = '0.625rem';\r\n                                                el.style.marginTop = '0';\r\n                                              } else {\r\n                                                el.style.top = '100%';\r\n                                                el.style.bottom = 'auto';\r\n                                                el.style.marginTop = '0.625rem';\r\n                                                el.style.marginBottom = '0';\r\n                                              }\r\n                                            }\r\n                                          }\r\n                                        }}\r\n                                        className={`absolute ${isMeGroup ? 'right-2' : 'left-2'} z-40`}\r\n                                      >\r\n                                        {(() => {\r\n                                          const users = (reactions[reactionDetail.emoji] || []).map(\r\n                                            (id) => allUsersMap.get(String(id)) || String(id),\r\n                                          );\r\n                                          return (\r\n                                            <div className=\"min-w-[11.25rem] max-w-[15rem] px-3 py-2.5 bg-white rounded-xl border border-gray-200 shadow-xl animate-in fade-in zoom-in-95 duration-200\">\r\n                                              <div className=\"flex items-center gap-2 mb-2 pb-2 border-b border-gray-100\">\r\n                                                <span className=\"text-2xl\">{reactionDetail.emoji}</span>\r\n                                                <span className=\"text-sm font-semibold text-gray-700\">\r\n                                                  {users.length} người\r\n                                                </span>\r\n                                              </div>\r\n                                              {users.length > 0 ? (\r\n                                                <ul className=\"space-y-1.5 max-h-48 overflow-y-auto\">\r\n                                                  {users.map((name, idx) => (\r\n                                                    <li\r\n                                                      key={`${msg._id}-user-filegroup-${idx}`}\r\n                                                      className=\"text-sm text-gray-700 py-1 hover:text-blue-600 transition-colors\"\r\n                                                    >\r\n                                                      {name}\r\n                                                    </li>\r\n                                                  ))}\r\n                                                </ul>\r\n                                              ) : (\r\n                                                <div className=\"text-sm text-gray-500 py-1\">Chưa có ai</div>\r\n                                              )}\r\n                                            </div>\r\n                                          );\r\n                                        })()}\r\n                                      </div>\r\n                                    </>\r\n                                  )}\r\n                                  {endRun && (\r\n                                    <div\r\n                                      className={`text-xs mt-2 block ${isMeGroup ? 'text-gray-700' : 'text-gray-500'} flex items-center gap-2`}\r\n                                    >\r\n                                      <span>\r\n                                        {formatTimestamp(\r\n                                          Number(\r\n                                            (lastInGroup as unknown as { serverTimestamp?: number }).serverTimestamp ??\r\n                                              lastInGroup.timestamp,\r\n                                          ) || 0,\r\n                                        )}\r\n                                      </span>\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                                <ReadStatus\r\n                                  message={lastInGroup}\r\n                                  isGroup={isGroup}\r\n                                  isRecalled={!!lastInGroup.isRecalled}\r\n                                  isMine={isMeGroup}\r\n                                  isLast={groupIsLast}\r\n                                  myId={myId}\r\n                                  allUsersMap={allUsersMap}\r\n                                  getSenderInfo={getSenderInfo}\r\n                                  isMobile={isMobile}\r\n                                  isUploading={groupUploading}\r\n                                />\r\n                              </div>\r\n                            </div>\r\n                          </React.Fragment>\r\n                        );\r\n                      }\r\n                    }\r\n\r\n                    // Notify message\r\n                    if (msg.type === 'notify') {\r\n                      const isCall = !!(msg as Message & { callType?: 'voice' | 'video' }).callType;\r\n                      const rawContentLower = (msg.content || '').toLowerCase();\r\n                      const isReminder =\r\n                        rawContentLower.includes('đến giờ lịch hẹn') || rawContentLower.includes('đã tạo lịch hẹn');\r\n\r\n                      if (!isCall && !isReminder) {\r\n                        const prev = index > 0 ? msgs[index - 1] : null;\r\n                        const prevIsNotify = prev?.type === 'notify';\r\n                        const prevIsCall =\r\n                          prevIsNotify && !!(prev as Message & { callType?: 'voice' | 'video' }).callType;\r\n                        const prevContentLower = (prev?.content || '').toLowerCase();\r\n                        const prevIsReminder =\r\n                          prevIsNotify &&\r\n                          (prevContentLower.includes('đến giờ lịch hẹn') ||\r\n                            prevContentLower.includes('đã tạo lịch hẹn'));\r\n\r\n                        if (prevIsNotify && !prevIsCall && !prevIsReminder) {\r\n                          // Skip grouping check if previous was a non-call notify\r\n                        } else {\r\n                          const notifyGroup = [msg];\r\n                          for (let k = index + 1; k < msgs.length; k++) {\r\n                            const next = msgs[k];\r\n                            if (next.type !== 'notify') break;\r\n                            const nextIsCall = !!(next as Message & { callType?: 'voice' | 'video' }).callType;\r\n                            const nextContentLower = (next.content || '').toLowerCase();\r\n                            const nextIsReminder =\r\n                              nextContentLower.includes('đến giờ lịch hẹn') ||\r\n                              nextContentLower.includes('đã tạo lịch hẹn');\r\n\r\n                            if (nextIsCall || nextIsReminder) break;\r\n                            notifyGroup.push(next);\r\n                          }\r\n\r\n                          if (notifyGroup.length >= 3) {\r\n                            const groupId = msg._id;\r\n                            const isExpanded = expandedNotifyGroups.has(groupId);\r\n\r\n                            if (!isExpanded) {\r\n                              notifyGroup.slice(1).forEach((m) => consumedIds.add(m._id));\r\n                              return (\r\n                                <div key={`group-notify-${groupId}`} className=\"flex justify-center my-4\">\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      const newSet = new Set(expandedNotifyGroups);\r\n                                      newSet.add(groupId);\r\n                                      setExpandedNotifyGroups(newSet);\r\n                                    }}\r\n                                    className=\"px-4 py-1.5 bg-white text-xs font-medium text-blue-600 rounded-full shadow-sm border border-blue-100 hover:bg-blue-50 transition-all cursor-pointer\"\r\n                                  >\r\n                                    Xem cập nhật trước\r\n                                  </button>\r\n                                </div>\r\n                              );\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n\r\n                      if ((msg as Message & { callType?: 'voice' | 'video' }).callType) {\r\n                        // Group consecutive call notify messages and collapse if many\r\n                        const prev = index > 0 ? msgs[index - 1] : null;\r\n                        const prevIsNotify = prev?.type === 'notify';\r\n                        const prevIsCall =\r\n                          prevIsNotify && !!(prev as Message & { callType?: 'voice' | 'video' }).callType;\r\n                        if (!prevIsCall) {\r\n                          const callGroup = [msg];\r\n                          for (let k = index + 1; k < msgs.length; k++) {\r\n                            const next = msgs[k];\r\n                            if (next.type !== 'notify') break;\r\n                            const nextIsCall = !!(next as Message & { callType?: 'voice' | 'video' }).callType;\r\n                            if (!nextIsCall) break;\r\n                            callGroup.push(next);\r\n                          }\r\n                          if (callGroup.length >= 3) {\r\n                            const groupId = msg._id;\r\n                            const isExpanded = expandedNotifyGroups.has(groupId);\r\n                            if (!isExpanded) {\r\n                              callGroup.slice(1).forEach((m) => consumedIds.add(m._id));\r\n                              return (\r\n                                <div key={`group-notify-call-${groupId}`} className=\"flex justify-center my-4\">\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      const newSet = new Set(expandedNotifyGroups);\r\n                                      newSet.add(groupId);\r\n                                      setExpandedNotifyGroups(newSet);\r\n                                    }}\r\n                                    className=\"px-4 py-1.5 bg-white text-xs font-medium text-blue-600 rounded-full shadow-sm border border-blue-100 hover:bg-blue-50 transition-all cursor-pointer\"\r\n                                  >\r\n                                    Xem thông báo cuộc gọi trước\r\n                                  </button>\r\n                                </div>\r\n                              );\r\n                            }\r\n                          }\r\n                        }\r\n                        const callType =\r\n                          (msg as Message & { callType?: 'voice' | 'video' }).callType === 'video' ? 'video' : 'voice';\r\n                        const calleeId = (msg as Message & { calleeId?: string }).calleeId || '';\r\n                        const status =\r\n                          (msg as Message & { callStatus?: 'answered' | 'rejected' | 'timeout' }).callStatus ||\r\n                          'answered';\r\n                        const dur = Number((msg as Message & { callDurationSec?: number }).callDurationSec || 0);\r\n                        const incoming = String(currentUser._id) === String(calleeId);\r\n                        const iconType =\r\n                          callType === 'video' ? (\r\n                            status === 'rejected' || status === 'timeout' ? (\r\n                              <HiVideoCamera className=\"w-4 h-4 text-red-600\" />\r\n                            ) : (\r\n                              <HiVideoCamera className=\"w-4 h-4 text-blue-600\" />\r\n                            )\r\n                          ) : status === 'rejected' || status === 'timeout' ? (\r\n                            <HiPhone className=\"w-4 h-4 text-red-600\" />\r\n                          ) : (\r\n                            <HiPhone className=\"w-4 h-4 text-green-600\" />\r\n                          );\r\n                        const iconDir = incoming ? (\r\n                          <HiArrowDown className=\"w-4 h-4 text-gray-600\" />\r\n                        ) : (\r\n                          <HiArrowUp className=\"w-4 h-4 text-gray-600\" />\r\n                        );\r\n                        const title = `Cuộc gọi ${callType === 'video' ? 'video' : 'thoại'} ${incoming ? 'đến' : 'đi'}`;\r\n                        const detail =\r\n                          status === 'answered'\r\n                            ? `${Math.floor(dur / 60)} phút ${Math.floor(dur % 60)} giây`\r\n                            : status === 'rejected'\r\n                              ? 'Bị từ chối'\r\n                              : incoming\r\n                                ? 'Nhỡ'\r\n                                : 'Không phản hồi';\r\n                        const dt = new Date(msg.timestamp);\r\n                        const today = new Date();\r\n                        const yesterday = new Date();\r\n                        yesterday.setDate(today.getDate() - 1);\r\n                        const sameDate = (a: Date, b: Date) =>\r\n                          a.getFullYear() === b.getFullYear() &&\r\n                          a.getMonth() === b.getMonth() &&\r\n                          a.getDate() === b.getDate();\r\n                        const dateLabel = sameDate(dt, today)\r\n                          ? 'Hôm nay'\r\n                          : sameDate(dt, yesterday)\r\n                            ? 'Hôm qua'\r\n                            : dt.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });\r\n                        const timeLabel = dt.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });\r\n                        return (\r\n                          <React.Fragment key={`notify-call-${msg._id}-frag`}>\r\n                            {unreadDividerNode}\r\n                            {timeMarkerNode}\r\n                            <div\r\n                              key={msg._id}\r\n                              id={`msg-${msg._id}`}\r\n                              data-message-id={msg._id}\r\n                              className=\"flex justify-center my-3\"\r\n                            >\r\n                              <div\r\n                                className={`px-4 p-1.5  bg-white rounded-full max-w-[80vw]  sm:max-w-[28rem] overflow-hidden ${highlightedMsgId === msg._id ? 'bg-yellow-50' : 'bg-gray-100'}`}\r\n                              >\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  {iconType}\r\n                                  {iconDir}\r\n                                  <div>\r\n                                    <p className=\"text-xs text-gray-500 truncate\">{`${title} – ${detail}`}</p>\r\n                                    <p className=\"text-xs text-gray-500 truncate\">{` ${dateLabel} • ${timeLabel}`}</p>\r\n                                  </div>\r\n\r\n                                  {/* <button\r\n                                    onClick={(e) => {\r\n                                      e.stopPropagation();\r\n                                      const t = callType === 'video' ? 'video' : 'voice';\r\n                                      const rid = String(msg.roomId || '');\r\n                                      const isG = !(rid.includes('_') && rid.split('_').filter(Boolean).length === 2);\r\n                                      const me = String(currentUser._id || '');\r\n                                      const parts = rid.split('_').filter(Boolean);\r\n                                      const partnerId =\r\n                                        !isG && parts.length === 2 ? (parts[0] === me ? parts[1] : parts[0]) : '';\r\n                                      const partnerInfo = !isG && partnerId ? getSenderInfo(partnerId) : null;\r\n                                      const evt = new CustomEvent('startCall', {\r\n                                        detail: {\r\n                                          type: t,\r\n                                          roomId: rid,\r\n                                          isGroup: isG,\r\n                                          selectedChat: isG\r\n                                            ? { _id: rid }\r\n                                            : {\r\n                                                _id: partnerId,\r\n                                                name: partnerInfo?.name,\r\n                                                avatar: partnerInfo?.avatar || undefined,\r\n                                              },\r\n                                        },\r\n                                      });\r\n                                      window.dispatchEvent(evt);\r\n                                    }}\r\n                                    className=\"ml-2  py-1 text-xs font-semibold rounded-lg border-blue-200 text-blue-600 hover:bg-blue-50 hover:cursor-pointer\"\r\n                                  >\r\n                                    Gọi lại\r\n                                  </button> */}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </React.Fragment>\r\n                        );\r\n                      }\r\n                      const related = msg.replyToMessageId\r\n                        ? messages.find((m) => m._id === msg.replyToMessageId)\r\n                        : null;\r\n                      const rawDisplay = msg.content || '';\r\n                      const rawLower = rawDisplay.trim().toLowerCase();\r\n                      const isJoinByLink = rawLower.includes('tham gia nhóm');\r\n                      let display = rawDisplay;\r\n                      if (!isJoinByLink && isMe) {\r\n                        const myName = currentUser.name || '';\r\n                        const trimmedLower = display.trim().toLowerCase();\r\n                        if (!trimmedLower.startsWith('bạn') && myName && display.startsWith(myName)) {\r\n                          display = 'Bạn' + display.slice(myName.length);\r\n                        } else if (display.startsWith('Một thành viên')) {\r\n                          display = 'Bạn' + display.slice('Một thành viên'.length);\r\n                        }\r\n                      }\r\n                      const contentLower = display.toLowerCase();\r\n                      const isCreate = contentLower.includes('đã tạo lịch hẹn');\r\n                      const isDue = contentLower.includes('đến giờ lịch hẹn');\r\n                      const isEdit = contentLower.includes('đã chỉnh sửa') || contentLower.includes('chỉnh sửa');\r\n                      const isDelete = contentLower.includes('đã xóa') || contentLower.includes('xóa');\r\n                      const isPoll = related?.type === 'poll' || contentLower.includes('bình chọn');\r\n                      const isPin = contentLower.includes('ghim');\r\n                      // Group actions\r\n                      const isInvite =\r\n                        contentLower.includes('đã thêm') ||\r\n                        (contentLower.includes('mời') && contentLower.includes('vào nhóm'));\r\n                      const isLeave = contentLower.includes('đã rời nhóm');\r\n                      const isPromote = contentLower.includes('bổ nhiệm') || contentLower.includes('phó nhóm');\r\n                      const isDemote =\r\n                        contentLower.includes('hủy quyền phó nhóm') || contentLower.includes('bãi nhiệm');\r\n                      const isKick = contentLower.includes('ra khỏi nhóm') || contentLower.includes('xóa khỏi nhóm');\r\n                      const isCreateGroup = contentLower.includes('tạo nhóm');\r\n                      const isRenameGroup =\r\n                        contentLower.includes('đổi tên nhóm') || contentLower.includes('đã đổi tên nhóm');\r\n                      const isNickname = contentLower.includes('biệt danh');\r\n                      const isChangeAvatar = contentLower.includes('ảnh đại diện') || contentLower.includes('đổi ảnh');\r\n                      const icon = isDue ? (\r\n                        <HiOutlineClock className=\"w-4 h-4 text-red-500\" />\r\n                      ) : isCreate ? (\r\n                        <HiOutlineClock className=\"w-4 h-4 text-indigo-500\" />\r\n                      ) : isPoll ? (\r\n                        <HiChartBar className=\"w-4 h-4 text-blue-500\" />\r\n                      ) : isPin ? (\r\n                        <HiMapPin className=\"w-4 h-4 text-orange-500\" />\r\n                      ) : isRenameGroup ? (\r\n                        <HiPencil className=\"w-4 h-4 text-indigo-600\" />\r\n                      ) : isNickname ? (\r\n                        <HiPencil className=\"w-4 h-4 text-blue-600\" />\r\n                      ) : isChangeAvatar ? (\r\n                        <HiPhoto className=\"w-4 h-4 text-pink-600\" />\r\n                      ) : isInvite ? (\r\n                        <HiUserPlus className=\"w-4 h-4 text-emerald-600\" />\r\n                      ) : isLeave ? (\r\n                        <HiOutlineLogout className=\"w-4 h-4 text-red-600\" />\r\n                      ) : isPromote ? (\r\n                        <HiShieldCheck className=\"w-4 h-4 text-blue-600\" />\r\n                      ) : isDemote ? (\r\n                        <HiUserMinus className=\"w-4 h-4 text-yellow-600\" />\r\n                      ) : isKick ? (\r\n                        <HiUserMinus className=\"w-4 h-4 text-red-600\" />\r\n                      ) : isCreateGroup ? (\r\n                        <HiUserGroup className=\"w-4 h-4 text-purple-600\" />\r\n                      ) : null;\r\n                      const nameLabel = senderInfo.name || '';\r\n                      // Hiển thị rõ tên người join bằng link (clickable) — luôn ưu tiên tên thật\r\n                      let displayNode: React.ReactNode = <p className=\"text-xs text-gray-500 truncate\">{display}</p>;\r\n                      if (isJoinByLink) {\r\n                        const actualName =\r\n                          String(senderInfo._id) === String(currentUser._id)\r\n                            ? currentUser.name || nameLabel\r\n                            : nameLabel;\r\n                        const needle = 'đã tham gia nhóm';\r\n                        const idx = rawLower.indexOf(needle);\r\n                        const tail = idx > -1 ? rawDisplay.slice(idx) : 'đã tham gia nhóm qua link mời';\r\n                        displayNode = (\r\n                          <span className=\"text-xs text-gray-500 truncate\">\r\n                            <a href={`/profile/${senderInfo._id}`} className=\"text-blue-600 hover:underline\">\r\n                              {actualName || 'Một thành viên'}\r\n                            </a>\r\n                            {` ${tail}`}\r\n                          </span>\r\n                        );\r\n                      }\r\n                      const pillNode = (\r\n                        <React.Fragment key={`pill-${msg._id}-frag`}>\r\n                          {unreadDividerNode}\r\n                          {timeMarkerNode}\r\n                          <div\r\n                            key={`pill-${msg._id}`}\r\n                            id={`msg-${msg._id}`}\r\n                            className={`flex justify-center mt-3 ${isLastMsg ? 'mb-4' : 'mb-3'}`}\r\n                          >\r\n                            <div\r\n                              className={`px-4 p-1.5  bg-white rounded-full max-w-[80vw]  sm:max-w-[28rem] overflow-hidden ${highlightedMsgId === msg._id ? 'bg-yellow-50' : 'bg-gray-100'}`}\r\n                            >\r\n                              <div className=\"flex items-center gap-2\">\r\n                                {icon}\r\n                                {displayNode}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </React.Fragment>\r\n                      );\r\n                      if (isDue) {\r\n                        if (related?.type === 'reminder') {\r\n                          return (\r\n                            <React.Fragment key={`notify-${msg._id}-due`}>\r\n                              {pillNode}\r\n                              <div className={`flex justify-center -mt-2 ${isLastMsg ? 'mb-4' : ''}`}>\r\n                                <ReminderCard\r\n                                  variant=\"due\"\r\n                                  title={related.content || ''}\r\n                                  date={new Date(related.reminderAt || related.timestamp)}\r\n                                  onOpen={() => {\r\n                                    if (!isMobile) onOpenChatInfoSection?.('reminder');\r\n                                    setDetailMsg(related);\r\n                                  }}\r\n                                />\r\n                              </div>\r\n                            </React.Fragment>\r\n                          );\r\n                        }\r\n                        const inlineAt = (msg as Message & { reminderAt?: number }).reminderAt;\r\n                        const inlineContent =\r\n                          (msg as Message & { reminderContent?: string }).reminderContent || msg.content || '';\r\n                        const inlineNote = (msg as Message & { reminderNote?: string }).reminderNote;\r\n                        const stub: Message = {\r\n                          _id: (msg.replyToMessageId as unknown as string) || String(msg._id),\r\n                          roomId: String(msg.roomId || ''),\r\n                          sender: msg.sender,\r\n                          content: inlineContent,\r\n                          type: 'reminder',\r\n                          timestamp: Number(msg.timestamp) || Date.now(),\r\n                          reminderAt: typeof inlineAt === 'number' ? inlineAt : undefined,\r\n                          reminderNote: inlineNote,\r\n                          reminderRepeat: (\r\n                            msg as Message & { reminderRepeat?: 'none' | 'daily' | 'weekly' | 'monthly' }\r\n                          ).reminderRepeat,\r\n                        } as Message;\r\n                        return (\r\n                          <React.Fragment key={`notify-${msg._id}-due-inline`}>\r\n                            {pillNode}\r\n                            <div className={`flex justify-center -mt-2 ${isLastMsg ? 'mb-4' : ''}`}>\r\n                              <ReminderCard\r\n                                variant=\"due\"\r\n                                title={inlineContent || ''}\r\n                                date={\r\n                                  typeof inlineAt === 'number' && inlineAt\r\n                                    ? new Date(inlineAt)\r\n                                    : new Date(Number(msg.timestamp) || Date.now())\r\n                                }\r\n                                onOpen={() => {\r\n                                  if (!isMobile) onOpenChatInfoSection?.('reminder');\r\n                                  setDetailMsg(stub);\r\n                                }}\r\n                              />\r\n                            </div>\r\n                          </React.Fragment>\r\n                        );\r\n                      }\r\n                      if (related?.type === 'reminder' && isCreate) {\r\n                        return (\r\n                          <div key={`notify-${msg._id}-create`} className=\"flex justify-center my-4\">\r\n                            <ReminderCard\r\n                              variant=\"create\"\r\n                              title={related.content || ''}\r\n                              date={new Date(related.reminderAt || related.timestamp)}\r\n                              senderName={senderInfo.name}\r\n                              senderAvatar={senderInfo.avatar}\r\n                              isMe={isMe}\r\n                            />\r\n                          </div>\r\n                        );\r\n                      }\r\n\r\n                      if (related?.type === 'reminder' && (isEdit || isDelete)) {\r\n                        return (\r\n                          <React.Fragment key={`notify-${msg._id}-reminder`}>\r\n                            {pillNode}\r\n                            <div className=\"flex justify-center -mt-2\">\r\n                              <button\r\n                                onClick={() => setDetailMsg(related)}\r\n                                className=\"z-10 -mt-1 px-5 py-1.5 bg-white text-blue-600 text-xs font-bold rounded-full border border-blue-100 shadow-sm hover:bg-blue-50 transition-all uppercase tracking-wide cursor-pointer\"\r\n                              >\r\n                                XEM CHI TIẾT\r\n                              </button>\r\n                            </div>\r\n                          </React.Fragment>\r\n                        );\r\n                      }\r\n                      if (isCreate || isEdit || isDelete) {\r\n                        const inlineAt = (msg as Message & { reminderAt?: number }).reminderAt;\r\n                        const inlineContent = (msg as Message & { reminderContent?: string }).reminderContent || '';\r\n                        const inlineNote = (msg as Message & { reminderNote?: string }).reminderNote;\r\n                        if (typeof inlineAt === 'number' && inlineContent) {\r\n                          const stub: Message = {\r\n                            _id: (msg.replyToMessageId as unknown as string) || String(msg._id),\r\n                            roomId: String(msg.roomId || ''),\r\n                            sender: msg.sender,\r\n                            content: inlineContent,\r\n                            type: 'reminder',\r\n                            timestamp: Number(msg.timestamp) || Date.now(),\r\n                            reminderAt: inlineAt,\r\n                            reminderNote: inlineNote,\r\n                            reminderRepeat: (\r\n                              msg as Message & { reminderRepeat?: 'none' | 'daily' | 'weekly' | 'monthly' }\r\n                            ).reminderRepeat,\r\n                          } as Message;\r\n\r\n                          if (isCreate) {\r\n                            return (\r\n                              <div key={`notify-${msg._id}-create-inline`} className=\"flex justify-center my-4\">\r\n                                <ReminderCard\r\n                                  variant=\"create\"\r\n                                  title={inlineContent || ''}\r\n                                  date={new Date(inlineAt)}\r\n                                  senderName={senderInfo.name}\r\n                                  senderAvatar={senderInfo.avatar}\r\n                                  isMe={isMe}\r\n                                />\r\n                              </div>\r\n                            );\r\n                          }\r\n\r\n                          return (\r\n                            <React.Fragment key={`notify-${msg._id}-reminder-inline`}>\r\n                              {pillNode}\r\n                              <div className={`flex justify-center -mt-2 ${isLastMsg ? 'mb-4' : ''}`}>\r\n                                <button\r\n                                  onClick={() => setDetailMsg(stub)}\r\n                                  className=\"z-10 -mt-1 px-5 py-1.5 bg-white text-blue-600 text-xs font-bold rounded-full border border-blue-100 shadow-sm hover:bg-blue-50 transition-all uppercase tracking-wide cursor-pointer\"\r\n                                >\r\n                                  XEM CHI TIẾT\r\n                                </button>\r\n                              </div>\r\n                            </React.Fragment>\r\n                          );\r\n                        }\r\n                      }\r\n                      if (related?.type === 'poll') {\r\n                        return (\r\n                          <React.Fragment key={`notify-${msg._id}-poll`}>\r\n                            {pillNode}\r\n                            <div className=\"flex justify-center -mt-2 mb-2\">\r\n                              <button\r\n                                onClick={() => {\r\n                                  if (!isMobile) onOpenChatInfoSection?.('poll');\r\n                                  setDetailMsg(related);\r\n                                }}\r\n                                className=\"text-xs text-blue-600 hover:underline hover:cursor-pointer\"\r\n                              >\r\n                                Xem\r\n                              </button>\r\n                            </div>\r\n                          </React.Fragment>\r\n                        );\r\n                      }\r\n                      return pillNode;\r\n                    }\r\n\r\n                    if (msg.type === 'reminder') {\r\n                      return (\r\n                        <React.Fragment key={`reminder-${msg._id}-frag`}>\r\n                          {timeMarkerNode}\r\n                          <div key={msg._id} id={`msg-${msg._id}`} className=\"flex justify-center mt-4\">\r\n                            <div onClick={() => setDetailMsg(msg)}>\r\n                              <ReminderCard\r\n                                variant=\"message\"\r\n                                title={msg.content || ''}\r\n                                date={new Date((msg as Message & { reminderAt?: number }).reminderAt || msg.timestamp)}\r\n                                senderName={senderInfo.name}\r\n                                senderAvatar={senderInfo.avatar}\r\n                                isMe={isMe}\r\n                                highlighted={highlightedMsgId === msg._id}\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                        </React.Fragment>\r\n                      );\r\n                    }\r\n\r\n                    if (msg.type === 'poll') {\r\n                      const myId = String(currentUser._id);\r\n                      const options = Array.isArray(msg.pollOptions) ? (msg.pollOptions as string[]) : [];\r\n                      const votes = (msg.pollVotes || {}) as Record<string, string[]>;\r\n                      const locked = !!msg.isPollLocked;\r\n                      return (\r\n                        <React.Fragment key={`poll-${msg._id}-frag`}>\r\n                          {timeMarkerNode}\r\n                          <div\r\n                            key={msg._id}\r\n                            id={`msg-${msg._id}`}\r\n                            className={`flex justify-center mt-3 ${isLastMsg ? 'mb-4' : 'mb-3'}`}\r\n                          >\r\n                            <div\r\n                              className={`w-full max-w-[18rem] p-3 rounded-2xl border shadow-sm ${highlightedMsgId === msg._id ? 'bg-yellow-50 border-yellow-300' : 'bg-white border-gray-200'}`}\r\n                              onClick={() => setDetailMsg(msg)}\r\n                            >\r\n                              <div className=\"flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-2 min-w-0\">\r\n                                  <p className=\"text-base font-semibold text-gray-900 break-words truncate\">\r\n                                    {msg.content || msg.pollQuestion || 'Bình chọn'}\r\n                                  </p>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  {/* {typeof msg.isPinned === 'boolean' && onPinMessage && ( */}\r\n                                  <button\r\n                                    onClick={(e) => {\r\n                                      e.stopPropagation();\r\n                                      onPinMessage?.(msg);\r\n                                    }}\r\n                                    className=\"px-2 py-1 text-xs font-semibold rounded-lg \r\n                             border-blue-200 text-blue-600 hover:bg-blue-50 hover:cursor-pointer\"\r\n                                  >\r\n                                    {msg.isPinned ? 'Bỏ ghim' : 'Ghim'}\r\n                                  </button>\r\n                                  {/* )} */}\r\n                                </div>\r\n                              </div>\r\n                              {locked && (\r\n                                <p className=\"text-xs text-gray-500 mt-2\">\r\n                                  Kết thúc lúc{' '}\r\n                                  {new Date(msg.pollLockedAt || msg.editedAt || msg.timestamp).toLocaleString('vi-VN')}\r\n                                </p>\r\n                              )}\r\n                              <div className=\"flex flex-col gap-0.5 mt-1\">\r\n                                <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                                  {msg.pollAllowMultiple ? (\r\n                                    <>\r\n                                      <HiListBullet className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                                      <span>Chọn nhiều phương án</span>\r\n                                    </>\r\n                                  ) : (\r\n                                    <>\r\n                                      <HiCheckCircle className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                                      <span>Chọn 1 phương án</span>\r\n                                    </>\r\n                                  )}\r\n                                </div>\r\n                                {msg.pollHideVoters && (\r\n                                  <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                                    <HiEyeSlash className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                                    <span>Ẩn người bình chọn</span>\r\n                                  </div>\r\n                                )}\r\n                                {msg.pollAllowAddOptions && (\r\n                                  <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                                    <HiPlus className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                                    <span>Cho phép thêm phương án</span>\r\n                                  </div>\r\n                                )}\r\n                                {msg.pollHideResultsUntilVote && (\r\n                                  <div className=\"flex items-center gap-1.5 text-xs text-gray-500\">\r\n                                    <HiLockClosed className=\"w-3.5 h-3.5 flex-shrink-0\" />\r\n                                    <span>Ẩn kết quả khi chưa bình chọn</span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                              <button\r\n                                onClick={() => setDetailMsg(msg)}\r\n                                className=\"text-xs text-blue-600 hover:underline mt-1\"\r\n                              >\r\n                                {(() => {\r\n                                  const userIds = new Set<string>();\r\n                                  let totalVotes = 0;\r\n                                  let hasVoted = false;\r\n                                  (msg.pollOptions || []).forEach((opt) => {\r\n                                    const arr = Array.isArray(votes[opt]) ? (votes[opt] as string[]) : [];\r\n                                    totalVotes += arr.length;\r\n                                    arr.forEach((id) => userIds.add(String(id)));\r\n                                    if (arr.includes(myId)) hasVoted = true;\r\n                                  });\r\n                                  const showResults = !(msg.pollHideResultsUntilVote && !hasVoted);\r\n                                  if (!showResults) return 'Bình chọn để xem kết quả';\r\n\r\n                                  if (msg.pollHideVoters) {\r\n                                    return `${totalVotes} lượt bình chọn`;\r\n                                  }\r\n                                  return `${userIds.size} người bình chọn, ${totalVotes} lượt bình chọn`;\r\n                                })()}\r\n                              </button>\r\n                              <div className=\"mt-3 space-y-2\">\r\n                                {(() => {\r\n                                  const totalVotes = options.reduce((acc, opt) => {\r\n                                    const arr = Array.isArray(votes[opt]) ? (votes[opt] as string[]) : [];\r\n                                    return acc + arr.length;\r\n                                  }, 0);\r\n                                  const hasVoted = options.some((opt) => {\r\n                                    const arr = Array.isArray(votes[opt]) ? (votes[opt] as string[]) : [];\r\n                                    return arr.includes(myId);\r\n                                  });\r\n                                  const showResults = !(msg.pollHideResultsUntilVote && !hasVoted);\r\n\r\n                                  return options.map((opt, idx) => {\r\n                                    const arr = Array.isArray(votes[opt]) ? (votes[opt] as string[]) : [];\r\n                                    const count = arr.length;\r\n                                    const voted = arr.includes(myId);\r\n                                    const percent = showResults && totalVotes > 0 ? (count / totalVotes) * 100 : 0;\r\n\r\n                                    return (\r\n                                      <button\r\n                                        key={`${String(msg._id)}-${idx}`}\r\n                                        onClick={(e) => {\r\n                                          e.stopPropagation();\r\n                                          if (!isMobile) onOpenChatInfoSection?.('poll');\r\n                                          setDetailMsg(msg);\r\n                                        }}\r\n                                        className={`w-full cursor-pointer bg-gray-100  relative overflow-hidden px-2 py-1 rounded-[5px]  text-left transition-colors\r\n                                   \r\n                                  `}\r\n                                      >\r\n                                        <div\r\n                                          className={`absolute top-0 left-0 bottom-0 transition-all duration-500 ease-out ${voted ? 'bg-blue-200' : 'bg-blue-200'}`}\r\n                                          style={{ width: `${percent}%` }}\r\n                                        />\r\n                                        <div className=\"flex items-center justify-between  relative z-10\">\r\n                                          <span className=\"truncate text-[12px]\">{opt}</span>\r\n                                          <span className=\"text-sm\">{showResults ? count : ''}</span>\r\n                                        </div>\r\n                                      </button>\r\n                                    );\r\n                                  });\r\n                                })()}\r\n                              </div>\r\n                              <div className=\"pt-2\">\r\n                                <button\r\n                                  onClick={() => {\r\n                                    if (!isMobile) onOpenChatInfoSection?.('poll');\r\n                                    setDetailMsg(msg);\r\n                                  }}\r\n                                  className=\"w-full cursor-pointer px-2 py-1 mt-1 text-blue-600 border border-blue-300 rounded-xl hover:bg-blue-50 font-semibold text-sm\"\r\n                                >\r\n                                  {locked ? 'Xem lựa chọn' : 'Đổi lựa chọn'}\r\n                                </button>\r\n                              </div>\r\n\r\n                              {/* Chỉ cho phép bình chọn trong modal: bỏ thêm lựa chọn inline */}\r\n                            </div>\r\n                          </div>\r\n                        </React.Fragment>\r\n                      );\r\n                    }\r\n\r\n                    const senderName = allUsersMap.get(senderInfo._id) || senderInfo.name;\r\n\r\n                    return (\r\n                      <React.Fragment key={`${msg._id}-frag`}>\r\n                        {unreadDividerNode}\r\n                        {timeMarkerNode}\r\n                        <div\r\n                          key={msg._id}\r\n                          id={`msg-${msg._id}`}\r\n                          onContextMenu={(e) => {\r\n                            e.preventDefault();\r\n                            onContextMenu(e, msg);\r\n                          }}\r\n                          className={`\r\n                  w-full sm:max-w-[36rem] lg:max-w-[46rem]\r\n                  flex gap-2 group relative\r\n                  ${isMe ? 'ml-auto flex-row-reverse' : 'mr-auto flex-row'}\r\n                  ${isGrouped ? 'mt-2' : 'mt-2'}\r\n                  ${isLastMsg ? 'mb-8' : ''}\r\n                  ${highlightedMsgId === msg._id ? 'bg-yellow-50 rounded-xl' : ''}\r\n                `}\r\n                        >\r\n                          {/* Avatar */}\r\n                          {!isMe && (\r\n                            <div className={`${isGrouped ? 'opacity-0' : ''} flex-shrink-0`}>\r\n                              {senderInfo.avatar ? (\r\n                                <div className=\"w-9 h-9 rounded-full overflow-hidden flex-shrink-0\">\r\n                                  <Image\r\n                                    width={38}\r\n                                    height={38}\r\n                                    src={getProxyUrl(senderInfo.avatar)}\r\n                                    alt={senderInfo.name}\r\n                                    className=\"w-full h-full object-cover\"\r\n                                  />\r\n                                </div>\r\n                              ) : (\r\n                                <div className=\"w-9 h-9 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold\">\r\n                                  <Image\r\n                                    src=\"/logo/avata.webp\"\r\n                                    alt={senderInfo.name || 'User'}\r\n                                    width={38}\r\n                                    height={38}\r\n                                    className=\"w-full h-full rounded-full object-cover\"\r\n                                  />\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n\r\n                          {/* Content */}\r\n                          <div className={`flex flex-col min-w-0 ${isMe ? 'items-end' : 'items-start'}`}>\r\n                            {isEdited && !isRecalled && (\r\n                              <span\r\n                                className=\"text-[10px] px-1 text-blue-500 hover:underline hover:cursor-pointer\"\r\n                                onClick={() => setExpandedOriginalId((prev) => (prev === msg._id ? null : msg._id))}\r\n                              >\r\n                                {expandedOriginalId === msg._id ? <p>Ẩn chỉnh sửa</p> : <p>Đã chỉnh sửa</p>}\r\n                              </span>\r\n                            )}\r\n                            {/* Reply preview */}\r\n                            {repliedToMsg &&\r\n                              (() => {\r\n                                const url = String(repliedToMsg.fileUrl || repliedToMsg.previewUrl || '');\r\n                                const isVid =\r\n                                  repliedToMsg.type === 'video' ||\r\n                                  isVideoFile(repliedToMsg.fileName) ||\r\n                                  isVideoFile(url);\r\n                                const isImg =\r\n                                  repliedToMsg.type === 'image' ||\r\n                                  /\\.(jpg|jpeg|png|gif|webp|bmp|svg|avif)$/i.test(\r\n                                    String(repliedToMsg.fileName || url || ''),\r\n                                  );\r\n                                const label = repliedToMsg.isRecalled\r\n                                  ? 'Tin nhắn đã bị thu hồi'\r\n                                  : repliedToMsg.type === 'file'\r\n                                    ? repliedToMsg.fileName || '[File]'\r\n                                    : repliedToMsg.type === 'image'\r\n                                      ? '[Ảnh]'\r\n                                      : repliedToMsg.type === 'video'\r\n                                        ? '[Video]'\r\n                                        : repliedToMsg.type === 'sticker'\r\n                                          ? '[Sticker]'\r\n                                          : repliedToMsg.type === 'reminder'\r\n                                            ? repliedToMsg.content || '[Nhắc nhở]'\r\n                                            : repliedToMsg.content || 'Tin nhắn';\r\n                                return (\r\n                                  <div\r\n                                    onClick={() => onJumpToMessage(repliedToMsg._id)}\r\n                                    className=\"max-w-[88vw] sm:max-w-[26rem] lg:max-w-[34rem] px-3 py-2 mb-1 mt-2 text-xs bg-gray-100 border-l-2 border-blue-500 rounded-xl cursor-pointer\"\r\n                                  >\r\n                                    <p className=\"font-semibold text-blue-600\">\r\n                                      {msg.replyToMessageName || senderName}\r\n                                    </p>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      {!repliedToMsg.isRecalled &&\r\n                                        (isImg || isVid) &&\r\n                                        (isImg ? (\r\n                                          <Image\r\n                                            src={getProxyUrl(url)}\r\n                                            alt=\"Ảnh\"\r\n                                            width={40}\r\n                                            height={40}\r\n                                            className=\"w-10 h-10 rounded-md object-cover border border-blue-200\"\r\n                                            unoptimized={String(url).includes('mega.nz')}\r\n                                          />\r\n                                        ) : (\r\n                                          <div className=\"relative w-10 h-10 bg-black rounded-md overflow-hidden border border-blue-200\">\r\n                                            <video\r\n                                              src={getProxyUrl(url)}\r\n                                              className=\"w-full h-full object-cover\"\r\n                                              muted\r\n                                              playsInline\r\n                                              preload=\"metadata\"\r\n                                            />\r\n                                            <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                                              <div className=\"w-5 h-5 rounded-full bg-white/80 flex items-center justify-center\">\r\n                                                <svg viewBox=\"0 0 24 24\" className=\"w-3.5 h-3.5 text-gray-800\">\r\n                                                  <path d=\"M8 5v14l11-7z\" fill=\"currentColor\" />\r\n                                                </svg>\r\n                                              </div>\r\n                                            </div>\r\n                                          </div>\r\n                                        ))}\r\n                                      <p className=\"truncate text-gray-600\">{label}</p>\r\n                                    </div>\r\n                                  </div>\r\n                                );\r\n                              })()}\r\n\r\n                            {/* MAIN BUBBLE */}\r\n                            <div\r\n                              className={`  \r\n                  px-4 py-2 rounded-lg shadow-md max-w-[70vw] ${\r\n                    !isRecalled && msg.type === 'text' && isSidebarOpen && !isMobile\r\n                      ? 'sm:max-w-[26rem] lg:max-w-[32rem]'\r\n                      : 'sm:max-w-[34rem] lg:max-w-[38rem]'\r\n                  } break-words mt-1\r\n                  ${\r\n                    !isRecalled &&\r\n                    (isVideo ||\r\n                      msg.type === 'sticker' ||\r\n                      msg.type === 'file' ||\r\n                      msg.type === 'image' ||\r\n                      msg.type === 'contact')\r\n                      ? '!bg-transparent shadow-none'\r\n                      : isMe\r\n                        ? 'bg-blue-100 text-white'\r\n                        : 'bg-white text-gray-800 '\r\n                  }\r\n                      ${!isGrouped && isMe ? 'rounded-tr-md' : ''}\r\n                      ${!isGrouped && !isMe ? 'rounded-tl-md' : ''}\r\n                      ${isRecalled ? '!bg-gray-200 !text-gray-500 italic !px-4 !py-2 !max-w-[92vw] sm:!max-w-[34rem] lg:!max-w-[44rem]' : ''}\r\n                      ${!isRecalled && (isVideo || msg.type === 'sticker' || msg.type === 'file' || msg.type === 'image' || msg.type === 'contact') ? '!p-0 !shadow-none ' : ''}\r\n                    ${!isRecalled && msg.type === 'image' ? '!p-0' : ''}\r\n                    ${!isRecalled && msg.type === 'file' ? '!p-0' : ''}\r\n                  relative ${hasReactions ? 'mb-4' : ''}\r\n                  ${contextMenu?.visible && String(contextMenu.message._id) === String(msg._id) ? 'z-[9998]' : ''}\r\n                  ${longPressActiveId === msg._id ? 'ring-2 ring-blue-300 scale-[0.98]' : ''}\r\n                  `}\r\n                              style={\r\n                                isMobile && swipeState.id === msg._id\r\n                                  ? { transform: `translateX(${Math.max(-100, Math.min(100, swipeState.dx))}px)` }\r\n                                  : undefined\r\n                              }\r\n                              onClick={() => {\r\n                                setTimeVisibleId((prev) => (prev === msg._id ? null : msg._id));\r\n                                setActiveMoreId(msg._id);\r\n                                setReactionDetail(null);\r\n                              }}\r\n                              onTouchStart={(e) => {\r\n                                try {\r\n                                  if (isRecalled) return;\r\n                                  longPressTriggeredRef.current = false;\r\n                                  if (longPressTimerRef.current != null) {\r\n                                    clearTimeout(longPressTimerRef.current);\r\n                                    longPressTimerRef.current = null;\r\n                                  }\r\n                                  const t = e.touches && e.touches[0];\r\n                                  const x0 = t ? t.clientX : 0;\r\n                                  const y0 = t ? t.clientY : 0;\r\n                                  const el = e.currentTarget as HTMLElement;\r\n                                  swipeStartRef.current = { x: x0, y: y0, id: msg._id, isMe };\r\n                                  setSwipeState({ id: null, dx: 0 });\r\n                                  setLongPressActiveId(msg._id);\r\n                                  longPressTimerRef.current = window.setTimeout(() => {\r\n                                    longPressTriggeredRef.current = true;\r\n                                    setActiveMoreId(msg._id);\r\n                                    setReactionDetail(null);\r\n                                    if (isMobile && msg.type === 'text') {\r\n                                      setMobileCollapsedId(msg._id);\r\n                                    }\r\n                                    onMobileLongPress?.(msg, el, x0, y0);\r\n                                  }, 420);\r\n                                } catch {}\r\n                              }}\r\n                              onTouchEnd={(e) => {\r\n                                try {\r\n                                  if (longPressTimerRef.current != null) {\r\n                                    clearTimeout(longPressTimerRef.current);\r\n                                    longPressTimerRef.current = null;\r\n                                  }\r\n                                  setLongPressActiveId(null);\r\n                                  if (longPressTriggeredRef.current) {\r\n                                    e.preventDefault();\r\n                                    e.stopPropagation();\r\n                                  }\r\n                                  if (isMobile && swipeStartRef.current.id === msg._id) {\r\n                                    const okDir = swipeStartRef.current.isMe ? swipeState.dx < -64 : swipeState.dx > 64;\r\n                                    if (okDir) {\r\n                                      onReplyMessage?.(msg);\r\n                                    }\r\n                                    setSwipeState({ id: null, dx: 0 });\r\n                                    swipeStartRef.current = { x: 0, y: 0, id: null, isMe: false };\r\n                                  }\r\n                                } catch {}\r\n                              }}\r\n                              onTouchMove={(e) => {\r\n                                try {\r\n                                  if (longPressTimerRef.current != null) {\r\n                                    clearTimeout(longPressTimerRef.current);\r\n                                    longPressTimerRef.current = null;\r\n                                  }\r\n                                  setLongPressActiveId(null);\r\n                                  if (!isMobile) return;\r\n                                  const t = e.touches && e.touches[0];\r\n                                  const x = t ? t.clientX : 0;\r\n                                  const y = t ? t.clientY : 0;\r\n                                  const dx = x - swipeStartRef.current.x;\r\n                                  const dy = y - swipeStartRef.current.y;\r\n                                  if (swipeStartRef.current.id === msg._id) {\r\n                                    const horizontal = Math.abs(dx) > 8 && Math.abs(dy) < 24;\r\n                                    if (horizontal) {\r\n                                      const dirOk = swipeStartRef.current.isMe ? dx < 0 : dx > 0;\r\n                                      setSwipeState({ id: msg._id, dx: dirOk ? dx : 0 });\r\n                                      e.preventDefault();\r\n                                    }\r\n                                  }\r\n                                } catch {}\r\n                              }}\r\n                              onTouchCancel={() => {\r\n                                try {\r\n                                  if (longPressTimerRef.current != null) {\r\n                                    clearTimeout(longPressTimerRef.current);\r\n                                    longPressTimerRef.current = null;\r\n                                  }\r\n                                  setLongPressActiveId(null);\r\n                                  if (isMobile && swipeStartRef.current.id === msg._id) {\r\n                                    setSwipeState({ id: null, dx: 0 });\r\n                                    swipeStartRef.current = { x: 0, y: 0, id: null, isMe: false };\r\n                                  }\r\n                                } catch {}\r\n                              }}\r\n                            >\r\n                              {!isRecalled && (\r\n                                <>\r\n                                  {(msg.type === 'image' || msg.type === 'video') && (\r\n                                    <button\r\n                                      onClick={(e) => {\r\n                                        e.preventDefault();\r\n                                        onShareMessage(msg);\r\n                                      }}\r\n                                      className={`absolute top-1/2 -translate-y-1/2  cursor-pointer p-1.5 bg-white/90 rounded-full shadow hover:bg-blue-50 ${isMe ? 'right-full mr-2' : 'left-full ml-2'} opacity-100 pointer-events-auto`}\r\n                                      aria-label=\"Chia sẻ\"\r\n                                      title=\"Chia sẻ\"\r\n                                    >\r\n                                      <ICShareMessage className=\"w-4 h-4 text-indigo-600\" />\r\n                                    </button>\r\n                                  )}\r\n                                  {isMobile && swipeState.id === msg._id && (\r\n                                    <div\r\n                                      className={`absolute top-1/2 -translate-y-1/2 ${isMe ? 'left-full ml-2' : 'right-full mr-2'}`}\r\n                                      style={{ opacity: Math.min(Math.abs(swipeState.dx) / 64, 1) }}\r\n                                    >\r\n                                      <div className=\"p-2 bg-white rounded-full shadow border border-gray-200\">\r\n                                        {isMe ? (\r\n                                          <HiArrowUturnLeft className=\"w-5 h-5 text-blue-600\" />\r\n                                        ) : (\r\n                                          <HiArrowUturnRight className=\"w-5 h-5 text-blue-600\" />\r\n                                        )}\r\n                                      </div>\r\n                                    </div>\r\n                                  )}\r\n                                  {!isMobile && (\r\n                                    <>\r\n                                      <button\r\n                                        onClick={(e) => {\r\n                                          e.preventDefault();\r\n                                          onContextMenu(e, msg);\r\n                                        }}\r\n                                        className={`absolute top-1/2 -translate-y-1/2 z-10 cursor-pointer p-1.5 bg-white/90 rounded-full shadow hover:bg-blue-50 ${isMe ? 'right-full mr-10' : 'left-full ml-10'} opacity-0 pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto`}\r\n                                        aria-label=\"Mở menu\"\r\n                                        title=\"Thêm\"\r\n                                      >\r\n                                        <HiEllipsisVertical className=\"w-4 h-4 text-gray-600\" />\r\n                                      </button>\r\n                                      <ReactionButton\r\n                                        isMine={isMe}\r\n                                        visible={activeMoreId === msg._id}\r\n                                        onPick={(emoji) => {\r\n                                          onToggleReaction?.(msg, emoji);\r\n                                          setActiveMoreId(null);\r\n                                        }}\r\n                                        className={`absolute top-1/2 -translate-y-1/2  ${isMe ? 'right-full mr-18' : 'left-full ml-18'} ${activeMoreId === msg._id ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto'} transition-opacity duration-200`}\r\n                                      />\r\n                                    </>\r\n                                  )}\r\n                                </>\r\n                              )}\r\n\r\n                              {!isRecalled && (\r\n                                <>\r\n                                  {(() => {\r\n                                    const items = Object.entries(reactions)\r\n                                      .map(([emoji, arr]) => ({\r\n                                        emoji,\r\n                                        count: (arr || []).length,\r\n                                        mine: (arr || []).includes(myId),\r\n                                        users: (arr || []).map((id) => allUsersMap.get(String(id)) || 'Người dùng'),\r\n                                      }))\r\n                                      .filter((x) => x.count > 0)\r\n                                      .sort((a, b) => b.count - a.count);\r\n\r\n                                    if (items.length === 0) return null;\r\n\r\n                                    return (\r\n                                      <div\r\n                                        className={`\r\n                                  absolute ${isMe ? 'right-2 -mr-1' : 'left-2 -ml-1'} \r\n                                  -bottom-4 \r\n                                  flex items-center gap-1\r\n                                `}\r\n                                      >\r\n                                        <div className=\"flex items-center\">\r\n                                          {items.slice(0, 3).map((it, idx) => (\r\n                                            <div\r\n                                              key={`${msg._id}-react-${idx}`}\r\n                                              onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                setReactionDetail(\r\n                                                  reactionDetail?.msgId === msg._id &&\r\n                                                    reactionDetail?.emoji === it.emoji\r\n                                                    ? null\r\n                                                    : { msgId: msg._id, emoji: it.emoji },\r\n                                                );\r\n                                              }}\r\n                                              className={`\r\n                                          flex items-center gap-0.5 py-0.5 rounded-full text-sm cursor-pointer\r\n                                          transition-all duration-200 hover:bg-gray-100 active:scale-95\r\n                                          ${it.mine ? 'bg-blue-50' : 'bg-transparent'}\r\n                                        `}\r\n                                              title={`${it.count} người`}\r\n                                            >\r\n                                              <span className=\"text-lg leading-none\">{it.emoji}</span>\r\n                                              {it.count > 1 && (\r\n                                                <span\r\n                                                  className={`text-xs font-medium ${it.mine ? 'text-blue-600' : 'text-gray-600'}`}\r\n                                                >\r\n                                                  {it.count}\r\n                                                </span>\r\n                                              )}\r\n                                            </div>\r\n                                          ))}\r\n                                          {items.length > 3 && (\r\n                                            <div className=\"px-2 text-xs text-gray-500 font-medium\">\r\n                                              +{items.length - 3}\r\n                                            </div>\r\n                                          )}\r\n                                        </div>\r\n\r\n                                        <div className=\"absolute inset-0 -z-10 bg-white/60 backdrop-blur-sm rounded-full scale-0 group-hover:scale-100 transition-transform duration-300\" />\r\n                                      </div>\r\n                                    );\r\n                                  })()}\r\n\r\n                                  {reactionDetail && reactionDetail.msgId === msg._id && (\r\n                                    <>\r\n                                      <div className=\"fixed inset-0 z-30\" onClick={() => setReactionDetail(null)} />\r\n\r\n                                      <div\r\n                                        ref={(el) => {\r\n                                          if (el && reactionDetail.msgId === msg._id) {\r\n                                            const rect = el.parentElement?.getBoundingClientRect();\r\n                                            if (rect) {\r\n                                              const spaceBelow = window.innerHeight - rect.bottom;\r\n                                              const spaceAbove = rect.top;\r\n                                              const popoverHeight = 250;\r\n\r\n                                              if (spaceBelow < popoverHeight && spaceAbove > spaceBelow) {\r\n                                                el.style.bottom = '100%';\r\n                                                el.style.top = 'auto';\r\n                                                el.style.marginBottom = '0.625rem';\r\n                                                el.style.marginTop = '0';\r\n                                              } else {\r\n                                                el.style.top = '100%';\r\n                                                el.style.bottom = 'auto';\r\n                                                el.style.marginTop = '0.625rem';\r\n                                                el.style.marginBottom = '0';\r\n                                              }\r\n                                            }\r\n                                          }\r\n                                        }}\r\n                                        className={`\r\n                                    absolute ${isMe ? 'right-2' : 'left-2'} \r\n                                    z-40\r\n                                  `}\r\n                                      >\r\n                                        {(() => {\r\n                                          const users = (reactions[reactionDetail.emoji] || []).map(\r\n                                            (id) => allUsersMap.get(String(id)) || String(id),\r\n                                          );\r\n\r\n                                          return (\r\n                                            <div className=\"min-w-[11.25rem] max-w-[15rem] px-3 py-2.5 bg-white rounded-xl border border-gray-200 shadow-xl animate-in fade-in zoom-in-95 duration-200\">\r\n                                              <div className=\"flex items-center gap-2 mb-2 pb-2 border-b border-gray-100\">\r\n                                                <span className=\"text-2xl\">{reactionDetail.emoji}</span>\r\n                                                <span className=\"text-sm font-semibold text-gray-700\">\r\n                                                  {users.length} người\r\n                                                </span>\r\n                                              </div>\r\n                                              {users.length > 0 ? (\r\n                                                <ul className=\"space-y-1.5 max-h-48 overflow-y-auto\">\r\n                                                  {users.map((name, idx) => (\r\n                                                    <li\r\n                                                      key={`${msg._id}-user-${idx}`}\r\n                                                      className=\"text-sm text-gray-700 py-1 hover:text-blue-600 transition-colors\"\r\n                                                    >\r\n                                                      {name}\r\n                                                    </li>\r\n                                                  ))}\r\n                                                </ul>\r\n                                              ) : (\r\n                                                <div className=\"text-sm text-gray-500 py-1\">Chưa có ai</div>\r\n                                              )}\r\n                                            </div>\r\n                                          );\r\n                                        })()}\r\n                                      </div>\r\n                                    </>\r\n                                  )}\r\n                                </>\r\n                              )}\r\n                              {/* Group sender name - Show for everyone including me if set */}\r\n                              {isGroup && !isGrouped && !isRecalled && !isMe && (\r\n                                <p\r\n                                  className={`text-sm inline-block  ${msg.type === 'image' || msg.type === 'video' || msg.type === 'file' ? ' px-2 py-1 bg-white rounded-[2rem] mb-1' : 'py-1'} ${isMe ? 'text-gray-600' : 'text-gray-600'}`}\r\n                                >\r\n                                  {senderName}\r\n                                </p>\r\n                              )}\r\n\r\n                              {/* TEXT */}\r\n                              {msg.type === 'text' && !isRecalled && !isEditing && (\r\n                                <div\r\n                                  className={`relative text-[0.875rem] ${\r\n                                    isSidebarOpen && !isMobile ? 'md:text-[0.875rem]' : 'md:text-[1rem]'\r\n                                  } leading-relaxed text-black whitespace-pre-wrap select-none lg:select-text`}\r\n                                  style={\r\n                                    isMobile &&\r\n                                    contextMenu?.visible &&\r\n                                    String(contextMenu.message._id) === String(msg._id) &&\r\n                                    mobileCollapsedId === msg._id\r\n                                      ? { maxHeight: 'calc(var(--vvh) * 0.42)', overflow: 'hidden' }\r\n                                      : undefined\r\n                                  }\r\n                                >\r\n                                  {renderMessageContent(msg.content || '', msg.mentions, isMe)}\r\n                                  {isMobile &&\r\n                                    contextMenu?.visible &&\r\n                                    String(contextMenu.message._id) === String(msg._id) &&\r\n                                    mobileCollapsedId === msg._id && (\r\n                                      <div className=\"absolute bottom-0 left-0 right-0 h-16 flex items-end justify-center pointer-events-none\">\r\n                                        <div className=\"absolute inset-x-0 bottom-8 h-16 bg-gradient-to-t from-white/95 to-transparent\" />\r\n                                        <button\r\n                                          onClick={() => {\r\n                                            setMobileCollapsedId(null);\r\n                                            try {\r\n                                              document.dispatchEvent(new MouseEvent('mousedown', { bubbles: true }));\r\n                                            } catch {}\r\n                                          }}\r\n                                          className=\"pointer-events-auto mb-2 px-3 py-1 rounded-full bg-white/90 border border-gray-200 text-sm text-blue-600 shadow hover:bg-blue-50 active:scale-95\"\r\n                                        >\r\n                                          Xem thêm\r\n                                        </button>\r\n                                      </div>\r\n                                    )}\r\n                                  {(() => {\r\n                                    const linkMatch = (msg.content || '').match(/(https?:\\/\\/|www\\.)\\S+/i);\r\n                                    if (!linkMatch) return null;\r\n                                    const raw = linkMatch[0];\r\n                                    const href = raw.startsWith('http') ? raw : `https://${raw}`;\r\n                                    const hostname = (() => {\r\n                                      try {\r\n                                        return new URL(href).hostname.replace('www.', '');\r\n                                      } catch {\r\n                                        return 'Website';\r\n                                      }\r\n                                    })();\r\n                                    return (\r\n                                      <div\r\n                                        className={`mt-2 rounded-xl border ${isMe ? 'border-white/30' : 'border-gray-200'} bg-white overflow-hidden`}\r\n                                      >\r\n                                        <button\r\n                                          onClick={() => window.open(href, '_blank')}\r\n                                          className=\"w-full text-left p-3 flex items-center gap-3 cursor-pointer hover:bg-gray-50\"\r\n                                        >\r\n                                          <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-sky-500 via-blue-500 to-blue-500 text-white\">\r\n                                            <HiLink className=\"w-5 h-5\" />\r\n                                          </div>\r\n                                          <div className=\"flex-1 min-w-0\">\r\n                                            <p className=\"text-sm font-semibold text-purple-600 truncate\">{raw}</p>\r\n                                            <p className=\"text-xs text-gray-500 mt-0.5\">{hostname}</p>\r\n                                          </div>\r\n                                        </button>\r\n                                      </div>\r\n                                    );\r\n                                  })()}\r\n                                </div>\r\n                              )}\r\n\r\n                              {msg.type === 'text' && !isRecalled && isEditing && (\r\n                                <div className=\"text-sm leading-relaxed\">\r\n                                  <textarea\r\n                                    value={typeof editContent === 'string' ? editContent : msg.content || ''}\r\n                                    onChange={(e) => setEditContent?.(e.target.value)}\r\n                                    className={`w-full p-2 rounded-xl border ${isMe ? ' text-gray-800' : ' text-gray-800'}`}\r\n                                    rows={3}\r\n                                  />\r\n                                  <div className={`mt-2 flex gap-2 ${isMe ? 'justify-end' : 'justify-start'}`}>\r\n                                    <button\r\n                                      onClick={() => {\r\n                                        setEditingMessageId?.(null);\r\n                                        setEditContent?.('');\r\n                                      }}\r\n                                      className=\"px-3 py-1.5 cursor-pointer rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 hover:cursor-pointer\"\r\n                                    >\r\n                                      Hủy\r\n                                    </button>\r\n                                    <button\r\n                                      onClick={() => {\r\n                                        const content =\r\n                                          typeof editContent === 'string' ? editContent : msg.content || '';\r\n                                        onSaveEdit?.(msg._id, content);\r\n                                      }}\r\n                                      className=\"px-3 py-1.5 cursor-pointer rounded-lg bg-blue-500 text-white hover:bg-blue-600 hover:cursor-pointer\"\r\n                                    >\r\n                                      Lưu\r\n                                    </button>\r\n                                  </div>\r\n                                </div>\r\n                              )}\r\n\r\n                              {msg.type === 'contact' && !isRecalled && (\r\n                                <ContactCardBubble\r\n                                  currentUserId={String(currentUser._id || '')}\r\n                                  contact={\r\n                                    (\r\n                                      msg as Message & {\r\n                                        contactCard?: {\r\n                                          _id?: string;\r\n                                          name?: string;\r\n                                          username?: string;\r\n                                          avatar?: string;\r\n                                        };\r\n                                      }\r\n                                    ).contactCard\r\n                                  }\r\n                                />\r\n                              )}\r\n\r\n                              {/* IMAGE – FIX SIZE MOBILE */}\r\n                              {msg.type === 'image' && msg.fileUrl && !isRecalled && (\r\n                                <div\r\n                                  className=\"  rounded-[0.25rem] overflow-hidden cursor-pointer shadow-md max-w-[50vw] sm:max-w-[16rem] select-none lg:select-auto\"\r\n                                  onClick={() => !isUploading && onOpenMedia(String(msg.fileUrl), 'image')}\r\n                                  style={{ WebkitTouchCallout: 'none' }}\r\n                                >\r\n                                  {String(msg.fileUrl).startsWith('blob:') ? (\r\n                                    <Image\r\n                                      width={600}\r\n                                      height={600}\r\n                                      src={String(msg.fileUrl)}\r\n                                      alt=\"Ảnh\"\r\n                                      className=\"w-full h-full object-cover\"\r\n                                      draggable={false}\r\n                                    />\r\n                                  ) : (\r\n                                    <Image\r\n                                      src={getProxyUrl(msg.fileUrl)}\r\n                                      alt=\"Ảnh\"\r\n                                      width={600}\r\n                                      height={600}\r\n                                      className=\"w-full h-full object-cover\"\r\n                                      unoptimized={String(msg.fileUrl).includes('mega.nz')}\r\n                                      draggable={false}\r\n                                    />\r\n                                  )}\r\n\r\n                                  {isUploading && (\r\n                                    <div className=\"absolute inset-0 bg-black/70 flex items-center justify-center\">\r\n                                      {(() => {\r\n                                        const size = 40;\r\n                                        const stroke = 4;\r\n                                        const r = (size - stroke) / 2;\r\n                                        const c = 2 * Math.PI * r;\r\n                                        const p = Math.max(0, Math.min(100, Number(uploadProgress || 0)));\r\n                                        return (\r\n                                          <div className=\"flex flex-col items-center\">\r\n                                            <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\r\n                                              <circle\r\n                                                cx={size / 2}\r\n                                                cy={size / 2}\r\n                                                r={r}\r\n                                                stroke=\"rgba(255,255,255,0.3)\"\r\n                                                strokeWidth={stroke}\r\n                                                fill=\"none\"\r\n                                              />\r\n                                              <circle\r\n                                                cx={size / 2}\r\n                                                cy={size / 2}\r\n                                                r={r}\r\n                                                stroke=\"white\"\r\n                                                strokeWidth={stroke}\r\n                                                fill=\"none\"\r\n                                                strokeDasharray={c}\r\n                                                strokeDashoffset={c - (p / 100) * c}\r\n                                                strokeLinecap=\"round\"\r\n                                                transform={`rotate(-90 ${size / 2} ${size / 2})`}\r\n                                              />\r\n                                            </svg>\r\n                                            {/* <span className=\"text-xs text-white font-semibold\">{Math.round(p)}%</span> */}\r\n                                          </div>\r\n                                        );\r\n                                      })()}\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n                              {msg.type === 'image' && !isRecalled && msg.content && (\r\n                                <div className={`mt-2 text-sm leading-relaxed px-2 text-gray-700`}>\r\n                                  {renderMessageContent(msg.content || '', msg.mentions, isMe)}\r\n                                </div>\r\n                              )}\r\n\r\n                              {/* VIDEO – FIX SIZE MOBILE */}\r\n                              {isVideo && msg.fileUrl && !isRecalled && (\r\n                                <div\r\n                                  className=\"relative rounded-[0.25rem] overflow-hidden cursor-pointer shadow-lg max-w-[70vw] sm:max-w-[18rem] aspect-video bg-black select-none lg:select-auto\"\r\n                                  onClick={() => !isUploading && onOpenMedia(String(msg.fileUrl!), 'video')}\r\n                                  style={{ WebkitTouchCallout: 'none' }}\r\n                                >\r\n                                  <video\r\n                                    src={getProxyUrl(msg.fileUrl)}\r\n                                    className=\"w-full h-full object-cover m-[0.125rem]\"\r\n                                    playsInline\r\n                                    preload=\"metadata\"\r\n                                  />\r\n\r\n                                  {/* play overlay */}\r\n                                  <div className=\"absolute inset-0 flex items-center justify-center opacity-100\">\r\n                                    <div className=\"w-12 h-12 bg-white/80 rounded-full flex items-center justify-center shadow\">\r\n                                      <HiPlay className=\"w-7 h-7 text-blue-600 ml-1\" />\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  {isUploading && (\r\n                                    <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center text-white\">\r\n                                      {uploadProgress !== undefined ? (\r\n                                        <>{Math.round(uploadProgress)}%</>\r\n                                      ) : (\r\n                                        <div className=\"w-6 h-6 border-2 border-white/60 border-t-transparent rounded-full animate-spin\" />\r\n                                      )}\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n\r\n                              {isVideo && !isRecalled && msg.content && (\r\n                                <div className={`px-2 mt-2 text-sm leading-relaxed text-gray-700`}>\r\n                                  {renderMessageContent(msg.content || '', msg.mentions, isMe)}\r\n                                </div>\r\n                              )}\r\n\r\n                              {/* FILE – FIX SIZE MOBILE */}\r\n                              {msg.type === 'file' && msg.fileUrl && !isVideo && !isRecalled && (\r\n                                <a\r\n                                  href={getProxyUrl(msg.fileUrl, true)}\r\n                                  download={msg.fileName || 'download'}\r\n                                  target=\"_blank\"\r\n                                  rel=\"noreferrer\"\r\n                                  className=\"relative flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-2xl max-w-[70vw] sm:max-w-[18rem] shadow-sm hover:bg-gray-50 select-none lg:select-text\"\r\n                                  onClick={(e) => {\r\n                                    if (isUploading) e.preventDefault();\r\n                                  }}\r\n                                  aria-disabled={isUploading ? true : undefined}\r\n                                  draggable={false}\r\n                                  style={{ WebkitTouchCallout: 'none' }}\r\n                                >\r\n                                  <div className=\"p-2 bg-blue-600 rounded-xl\">\r\n                                    <HiOutlineDocumentText className=\"w-6 h-6 text-white\" />\r\n                                  </div>\r\n\r\n                                  <div className=\"flex-1 min-w-0\">\r\n                                    <p className=\"text-sm font-semibold text-gray-800 truncate\">\r\n                                      {msg.fileName || 'Tệp đính kèm'}\r\n                                    </p>\r\n                                    <p className=\"text-xs text-gray-500 truncate\">Nhấn để tải xuống</p>\r\n                                  </div>\r\n                                  {isUploading && (\r\n                                    <div className=\"absolute inset-0 bg-black/60 text-white flex items-center justify-center rounded-2xl\">\r\n                                      {(() => {\r\n                                        const size = 32;\r\n                                        const stroke = 3;\r\n                                        const r = (size - stroke) / 2;\r\n                                        const c = 2 * Math.PI * r;\r\n                                        const p = Math.max(0, Math.min(100, Number(uploadProgress || 0)));\r\n                                        return (\r\n                                          <div className=\"flex flex-col items-center\">\r\n                                            <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\r\n                                              <circle\r\n                                                cx={size / 2}\r\n                                                cy={size / 2}\r\n                                                r={r}\r\n                                                stroke=\"rgba(255,255,255,0.35)\"\r\n                                                strokeWidth={stroke}\r\n                                                fill=\"none\"\r\n                                              />\r\n                                              <circle\r\n                                                cx={size / 2}\r\n                                                cy={size / 2}\r\n                                                r={r}\r\n                                                stroke=\"white\"\r\n                                                strokeWidth={stroke}\r\n                                                fill=\"none\"\r\n                                                strokeDasharray={c}\r\n                                                strokeDashoffset={c - (p / 100) * c}\r\n                                                strokeLinecap=\"round\"\r\n                                                transform={`rotate(-90 ${size / 2} ${size / 2})`}\r\n                                              />\r\n                                            </svg>\r\n                                            <span className=\"text-xs font-semibold mt-1\">{Math.round(p)}%</span>\r\n                                          </div>\r\n                                        );\r\n                                      })()}\r\n                                    </div>\r\n                                  )}\r\n                                </a>\r\n                              )}\r\n                              {msg.type === 'file' && !isRecalled && msg.content && (\r\n                                <div className={`mt-2 text-sm leading-relaxed px-2 text-gray-700`}>\r\n                                  {renderMessageContent(msg.content || '', msg.mentions, isMe)}\r\n                                </div>\r\n                              )}\r\n\r\n                              {isRecalled && <p className=\"text-sm italic opacity-70\">đã thu hồi tin nhắn</p>}\r\n\r\n                              {/* ✅ Hiển thị nội dung gốc nếu đã chỉnh sửa */}\r\n                              {isEdited && !isRecalled && msg.originalContent && (\r\n                                <div className=\" border-gray-300 \">\r\n                                  {expandedOriginalId === msg._id && (\r\n                                    <div className=\"text-xs border-t-[1px] border-t-gray-300  text-gray-500 space-y-1 flex items-center justify-between\">\r\n                                      <p\r\n                                        className={`p-1 m-1 whitespace-pre-wrap pt-2 pb-1 rounded w-full ${isMe ? 'bg-white' : ''}`}\r\n                                      >\r\n                                        {msg.originalContent}\r\n                                      </p>\r\n                                    </div>\r\n                                  )}\r\n                                </div>\r\n                              )}\r\n                              {isEndOfGroup && (\r\n                                <div className={`text-xs mt-1 ${isMe ? 'text-gray-700' : 'text-gray-500'}`}>\r\n                                  <span\r\n                                    className={\r\n                                      msg.type === 'text' ? undefined : 'inline-block px-2 py-1 bg-white rounded-[2rem]'\r\n                                    }\r\n                                  >\r\n                                    {formatTimestamp(\r\n                                      Number(\r\n                                        (msg as unknown as { serverTimestamp?: number }).serverTimestamp ??\r\n                                          msg.timestamp,\r\n                                      ) || 0,\r\n                                    )}\r\n                                  </span>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                            <ReadStatus\r\n                              message={msg}\r\n                              isGroup={isGroup}\r\n                              isRecalled={isRecalled}\r\n                              isMine={isMe}\r\n                              isLast={isLastMsg}\r\n                              myId={myId}\r\n                              allUsersMap={allUsersMap}\r\n                              getSenderInfo={getSenderInfo}\r\n                              isMobile={isMobile}\r\n                              isUploading={(() => {\r\n                                const up = uploadingFiles[msg._id] !== undefined;\r\n                                const sending = !!(msg as unknown as { isSending?: boolean }).isSending;\r\n                                const blob = typeof msg.fileUrl === 'string' && msg.fileUrl.startsWith('blob:');\r\n                                const isMediaOrFile =\r\n                                  msg.type === 'image' || msg.type === 'video' || (msg.type === 'file' && !isVideo);\r\n                                return isMediaOrFile && (up || sending || blob);\r\n                              })()}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      </React.Fragment>\r\n                    );\r\n                  })}\r\n                </>\r\n              );\r\n            })()}\r\n          </React.Fragment>\r\n        );\r\n      })}\r\n      <ReminderDetailModal isOpen={!!detailMsg} message={detailMsg} onClose={() => setDetailMsg(null)} />\r\n      <PollDetailModal\r\n        isOpen={!!detailMsg && detailMsg.type === 'poll'}\r\n        message={detailMsg && detailMsg.type === 'poll' ? detailMsg : null}\r\n        onClose={() => setDetailMsg(null)}\r\n        onRefresh={onRefresh}\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAGA;AACA;AAEA,QAAQ;AACR;AAuBA;AACA;AACA;AACA;AAEA;AACA;AACA;AAzCA;;;;;;;;;;;;;;;;AAgFA,SAAS,kBAAkB,EACzB,OAAO,EACP,aAAa,EAId;IACC,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,YAAY,OAAO,SAAS,OAAO;IACzC,MAAM,OAAO,OAAO,SAAS,QAAQ;IACrC,MAAM,WAAW,OAAO,SAAS,YAAY;IAC7C,MAAM,SAAS,OAAO,SAAS,UAAU;IAEzC,MAAM,cAAc,IAAA,gNAAO,EAAC;QAC1B,MAAM,OAAO,OAAO,YAAY,aAAa,IAAI,IAAI;QACrD,IAAI,CAAC,MAAM,OAAO;QAClB,OAAO,CAAC,SAAS,EAAE,mBAAmB,OAAO;IAC/C,GAAG;QAAC;QAAW;KAAS;IAExB,MAAM,UAAU,IAAA,gNAAO,EAAC;QACtB,IAAI,CAAC,aAAa,OAAO;QACzB,wCAAmC,OAAO;;;QAC1C,MAAM;IAER,GAAG;QAAC;KAAY;IAEhB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAS;IAEnD,IAAA,kNAAS,EAAC;QACR,IAAI,YAAY;QAChB,IAAI,CAAC,SAAS;YACZ,aAAa;YACb;QACF;QACA,iJAAM,CAAC,SAAS,CAAC,SAAS;YAAE,sBAAsB;YAAK,QAAQ;YAAG,OAAO;QAAI,GAC1E,IAAI,CAAC,CAAC;YACL,IAAI,CAAC,WAAW,aAAa;QAC/B,GACC,KAAK,CAAC;YACL,IAAI,CAAC,WAAW,aAAa;QAC/B;QACF,OAAO;YACL,YAAY;QACd;IACF,GAAG;QAAC;KAAQ;IAEZ,MAAM,iBAAiB,IAAA,gNAAO,EAAC;QAC7B,IAAI,CAAC,iBAAiB,CAAC,WAAW,OAAO;QACzC,OAAO;YAAC,OAAO;YAAgB,OAAO;SAAW,CAAC,IAAI,GAAG,IAAI,CAAC;IAChE,GAAG;QAAC;QAAe;KAAU;IAE7B,MAAM,kBAAkB,CAAC;QACvB,EAAE,cAAc;QAChB,EAAE,eAAe;QACjB,IAAI,CAAC,aAAa,CAAC,gBAAgB;QACnC,IAAI;YACF,OAAO,aAAa,CAClB,IAAI,YAAY,aAAa;gBAC3B,QAAQ;oBACN,MAAM;oBACN,QAAQ;oBACR,SAAS;oBACT,cAAc;wBAAE,KAAK;wBAAW;wBAAM;wBAAU,QAAQ,UAAU;oBAAU;gBAC9E;YACF;QAEJ,EAAE,OAAM,CAAC;IACX;IAEA,MAAM,iBAAiB,CAAC;QACtB,EAAE,cAAc;QAChB,EAAE,eAAe;QACjB,IAAI,CAAC,WAAW;QAChB,IAAI;YACF,OAAO,aAAa,CAClB,IAAI,YAAY,kBAAkB;gBAChC,QAAQ;oBAAE,QAAQ;oBAAW;oBAAM;oBAAU,QAAQ,UAAU;gBAAU;YAC3E;QAEJ,EAAE,OAAM,CAAC;IACX;IAEA,MAAM,oBAAoB,CAAC;QACzB,IAAI,CAAC,aAAa;QAClB,EAAE,cAAc;QAChB,OAAO,IAAI,CAAC;IACd;IAEA,qBACE,8OAAC;QACC,MAAM,cAAc,WAAW;QAC/B,UAAU,cAAc,IAAI;QAC5B,SAAS;QACT,WAAW,CAAC;YACV,IAAI,CAAC,aAAa;YAClB,IAAI,EAAE,GAAG,KAAK,WAAW,EAAE,GAAG,KAAK,KAAK;YACxC,EAAE,cAAc;YAChB,OAAO,IAAI,CAAC;QACd;QACA,WAAW,CAAC,yIAAyI,EACnJ,cAAc,yCAAyC,IACvD;;0BAEF,8OAAC;gBAAI,WAAU;0BAAoF;;;;;;0BAGnG,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACZ,uBACC,8OAAC,wIAAK;oCAAC,KAAK,IAAA,oIAAW,EAAC;oCAAS,KAAI;oCAAG,OAAO;oCAAI,QAAQ;oCAAI,WAAU;;;;;yDAEzE,8OAAC,wIAAK;oCAAC,KAAI;oCAAmB,KAAI;oCAAG,OAAO;oCAAI,QAAQ;oCAAI,WAAU;;;;;;;;;;;0CAG1E,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAE,WAAU;kDAAgD;;;;;;oCAC5D,yBAAW,8OAAC;wCAAE,WAAU;kDAAkC;;;;;+CAAgB;;;;;;;;;;;;;kCAI/E,8OAAC;wBAAI,WAAU;kCACZ,0BACC,8OAAC,wIAAK;4BAAC,OAAO;4BAAK,QAAQ;4BAAK,KAAK;4BAAW,KAAI;4BAAQ,WAAU;;;;;iDAEtE,8OAAC;4BAAK,WAAU;sCAA4B;;;;;;;;;;;;;;;;;0BAKlD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,SAAS;wBACT,WAAU;;0CAEV,8OAAC,0JAAO;gCAAC,WAAU;;;;;;4BAA0B;;;;;;;kCAG/C,8OAAC;wBACC,SAAS;wBACT,WAAU;;0CAEV,8OAAC,wKAAqB;gCAAC,WAAU;;;;;;4BAA6B;;;;;;;;;;;;;;;;;;;AAMxE;AAEe,SAAS,YAAY,EAClC,eAAe,EACf,QAAQ,EACR,WAAW,EACX,WAAW,EACX,cAAc,EACd,gBAAgB,EAChB,OAAO,EACP,aAAa,EACb,iBAAiB,EACjB,cAAc,EACd,eAAe,EACf,aAAa,EACb,oBAAoB,EACpB,WAAW,EACX,gBAAgB,EAChB,mBAAmB,EACnB,WAAW,EACX,cAAc,EACd,UAAU,EACV,SAAS,EACT,YAAY,EACZ,gBAAgB,EAChB,WAAW,EACX,0BAA0B,KAAK,EAC/B,gBAAgB,KAAK,EACrB,WAAW,KAAK,EAChB,cAAc,EACd,qBAAqB,EACJ;IACjB,MAAM,GAAG,iBAAiB,GAAG,IAAA,iNAAQ,EAAgB;IACrD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,iNAAQ,EAAgB;IAC5E,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAgB;IAChE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAiB;IAC3D,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAA0C;IAC9F,MAAM,oBAAoB,IAAA,+MAAM,EAAgB;IAChD,MAAM,wBAAwB,IAAA,+MAAM,EAAC;IACrC,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,iNAAQ,EAAgB;IAC1E,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAoC;QAAE,IAAI;QAAM,IAAI;IAAE;IAClG,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,iNAAQ,EAAgB;IAC1E,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,iNAAQ,EAAc,IAAI;IAClF,MAAM,gBAAgB,IAAA,+MAAM,EAA6D;QACvF,GAAG;QACH,GAAG;QACH,IAAI;QACJ,MAAM;IACR;IAEA,+CAA+C;IAC/C,IAAA,kNAAS,EAAC;QACR,MAAM,qBAAqB,CAAC;YAC1B,IAAI,cAAc;gBAChB,MAAM,gBAAgB,SAAS,cAAc,CAAC,CAAC,IAAI,EAAE,cAAc;gBACnE,IAAI,iBAAiB,CAAC,cAAc,QAAQ,CAAC,MAAM,MAAM,GAAW;oBAClE,gBAAgB;gBAClB;YACF;QACF;QACA,MAAM,yBAAyB;YAC7B,IAAI,SAAS,MAAM,EAAE,gBAAgB;QACvC;QACA,MAAM,mBAAmB;YACvB,gBAAgB;QAClB;QACA,MAAM,gBAAgB,CAAC;YACrB,IAAI,EAAE,GAAG,KAAK,UAAU,gBAAgB;QAC1C;QAEA,SAAS,gBAAgB,CAAC,SAAS;QACnC,SAAS,gBAAgB,CAAC,oBAAoB;QAC9C,OAAO,gBAAgB,CAAC,QAAQ;QAChC,SAAS,gBAAgB,CAAC,WAAW;QACrC,OAAO;YACL,SAAS,mBAAmB,CAAC,SAAS;YACtC,SAAS,mBAAmB,CAAC,oBAAoB;YACjD,OAAO,mBAAmB,CAAC,QAAQ;YACnC,SAAS,mBAAmB,CAAC,WAAW;QAC1C;IACF,GAAG;QAAC;KAAa;IACjB,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,aAAa,SAAS,qBAAqB;IAClD,GAAG;QAAC;KAAY;IAEhB,MAAM,kBAAkB,CAAC;QACvB,MAAM,IAAI,IAAI,KAAK;QACnB,MAAM,MAAM,IAAI;QAChB,MAAM,UAAU,EAAE,YAAY,OAAO,IAAI,YAAY;QACrD,OAAO,UACH,EAAE,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;QAAU,KACnE,EAAE,cAAc,CAAC,SAAS;YACxB,MAAM;YACN,QAAQ;YACR,KAAK;YACL,OAAO;YACP,MAAM;QACR;IACN;IACA,MAAM,mBAAmB,CAAC;QACxB,MAAM,IAAI,IAAI,KAAK;QACnB,MAAM,QAAQ,IAAI;QAClB,MAAM,YAAY,IAAI;QACtB,UAAU,OAAO,CAAC,MAAM,OAAO,KAAK;QACpC,MAAM,WAAW,CAAC,GAAS,IACzB,EAAE,WAAW,OAAO,EAAE,WAAW,MAAM,EAAE,QAAQ,OAAO,EAAE,QAAQ,MAAM,EAAE,OAAO,OAAO,EAAE,OAAO;QACnG,MAAM,YAAY,EAAE,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;QAAU;QACrF,MAAM,YAAY,SAAS,GAAG,SAC1B,YACA,SAAS,GAAG,aACV,YACA,EAAE,kBAAkB,CAAC,SAAS;YAAE,KAAK;YAAW,OAAO;YAAW,MAAM;QAAU;QACxF,OAAO,GAAG,UAAU,CAAC,EAAE,WAAW;IACpC;IACA,IAAA,kNAAS,EAAC;QACR,IAAI,2BAA2B,CAAC,kBAAkB;QAElD,sBAAsB;QACtB,WAAW;YACT,MAAM,UAAU,SAAS,cAAc,CAAC,CAAC,IAAI,EAAE,kBAAkB;YACjE,IAAI,SAAS;gBACX,4BAA4B;gBAC5B,QAAQ,cAAc,CAAC;oBACrB,UAAU;oBACV,OAAO;oBACP,QAAQ;gBACV;gBAEA,sBAAsB;gBACtB,WAAW;oBACT,QAAQ,cAAc,CAAC;wBACrB,UAAU;wBACV,OAAO;oBACT;gBACF,GAAG;YACL;QACF,GAAG;IACL,GAAG;QAAC;QAAkB;KAAwB;IAE9C,qBACE;;YACG,MAAM,IAAI,CAAC,gBAAgB,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,SAAS,KAAK;gBACzD,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;sCAEb,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAK,WAAU;0CACb;;;;;;;;;;;wBAGJ,CAAC;4BACA,MAAM,cAAc,IAAI;4BACxB,qBACE;0CACG,KAAK,GAAG,CAAC,CAAC,KAAK;oCACd,IAAI,YAAY,GAAG,CAAC,IAAI,GAAG,GAAG,OAAO;oCACrC,MAAM,YAAY,IAAI,GAAG,KAAK,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,EAAE;oCAC7D,MAAM,aAAa,cAAc,IAAI,MAAM;oCAC3C,MAAM,OAAO,OAAO,WAAW,GAAG,MAAM,OAAO,YAAY,GAAG;oCAC9D,MAAM,eAAe,IAAI,gBAAgB,GACrC,SAAS,IAAI,CAAC,CAAC,IAAM,EAAE,GAAG,KAAK,IAAI,gBAAgB,IACnD;oCAEJ,MAAM,iBAAiB,cAAc,CAAC,IAAI,GAAG,CAAC;oCAC9C,MAAM,cAAc,CAAC,CAAC,AAAC,IAA2C,SAAS;oCAC3E,MAAM,WAAW,OAAO,IAAI,OAAO,KAAK,YAAY,IAAI,OAAO,CAAC,UAAU,CAAC;oCAC3E,MAAM,YAAY,IAAI,GAAG,KAAK;oCAC9B,MAAM,WAAW,IAAI,QAAQ,IAAI,CAAC;oCAClC,MAAM,aAAa,IAAI,UAAU;oCACjC,MAAM,UAAU,IAAI,IAAI,KAAK,WAAY,IAAI,OAAO,IAAI,IAAA,oIAAW,EAAC,IAAI,OAAO;oCAC/E,MAAM,gBACJ,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,WAAY,IAAI,IAAI,KAAK,UAAU,CAAC;oCAC3E,MAAM,cAAc,iBAAiB,CAAC,mBAAmB,aAAa,eAAe,QAAQ;oCAC7F,MAAM,YAAa,IAAI,SAAS,IAAI,CAAC;oCACrC,MAAM,OAAO,OAAO,YAAY,GAAG;oCACnC,MAAM,eAAe,OAAO,MAAM,CAAC,WAAW,IAAI,CAAC,CAAC,MAAQ,CAAC,OAAO,EAAE,EAAE,MAAM,GAAG;oCAEjF,kBAAkB;oCAClB,MAAM,UAAU,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,GAAG;oCAC9C,IAAI,YAAY;oCAChB,IAAI,WAAW,QAAQ,IAAI,KAAK,UAAU;wCACxC,MAAM,aAAa,cAAc,QAAQ,MAAM;wCAC/C,MAAM,MACJ,OAAO,AAAC,IAAgD,eAAe,IAAI,IAAI,SAAS,KAAK;wCAC/F,MAAM,OACJ,OACE,AAAC,QAAoD,eAAe,IAAI,QAAQ,SAAS,KACtF;wCACP,IAAI,WAAW,GAAG,KAAK,WAAW,GAAG,IAAI,MAAM,OAAO,IAAI,KAAK,MAAM;4CACnE,YAAY;wCACd;oCACF;oCACA,MAAM,QACJ,OAAO,AAAC,IAAgD,eAAe,IAAI,IAAI,SAAS,KAAK;oCAC/F,MAAM,SACJ,WAAW,OACP,OACE,AAAC,QAAoD,eAAe,IAAI,QAAQ,SAAS,KACtF,IACL;oCACN,MAAM,iBAAiB,UAAU,QAAQ,QAAS,UAAqB,KAAK,KAAK;oCACjF,MAAM,iBAAiB,+BACrB,8OAAC;wCAAI,WAAU;kDACb,cAAA,8OAAC;4CAAK,WAAU;sDACb,iBAAiB;;;;;;;;;;+CAGpB;oCACJ,MAAM,oBAAoB;oCAE1B,MAAM,UAAU,QAAQ,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,QAAQ,EAAE,GAAG;oCAC5D,IAAI,eAAe;oCACnB,IAAI,WAAW,QAAQ,IAAI,KAAK,UAAU;wCACxC,MAAM,aAAa,cAAc,QAAQ,MAAM;wCAC/C,MAAM,MACJ,OAAO,AAAC,IAAgD,eAAe,IAAI,IAAI,SAAS,KAAK;wCAC/F,MAAM,OACJ,OACE,AAAC,QAAoD,eAAe,IAAI,QAAQ,SAAS,KACtF;wCACP,IAAI,WAAW,GAAG,KAAK,WAAW,GAAG,IAAI,OAAO,MAAM,IAAI,KAAK,MAAM;4CACnE,eAAe;wCACjB;oCACF;oCAEA,MAAM,gBAAgB,CAAC,cAAc,CAAC,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,OAAO;oCAClF,IAAI,eAAe;wCACjB,MAAM,aAAwB;4CAAC;yCAAI;wCACnC,MAAM,eAAe,AAAC,IAAgB,OAAO;wCAC7C,IAAK,IAAI,IAAI,QAAQ,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;4CAC5C,MAAM,OAAO,IAAI,CAAC,EAAE;4CACpB,IAAI,KAAK,UAAU,EAAE;4CACrB,IAAI,CAAC,CAAC,KAAK,IAAI,KAAK,WAAW,KAAK,IAAI,KAAK,OAAO,GAAG;4CACvD,MAAM,aAAa,cAAc,KAAK,MAAM;4CAC5C,MAAM,KAAK,KAAK,GAAG,CACjB,OAAO,KAAK,SAAS,IAAI,OAAO,UAAU,CAAC,WAAW,MAAM,GAAG,EAAE,CAAC,SAAS;4CAE7E,MAAM,cAAc,AAAC,KAAiB,OAAO;4CAC7C,IAAI,CAAC,gBAAgB,WAAW,KAAK,iBAAiB,aAAa;4CACnE,IAAI,WAAW,GAAG,KAAK,WAAW,GAAG,IAAI,KAAK,QAAQ;4CACtD,WAAW,IAAI,CAAC;wCAClB;wCACA,IAAI,WAAW,MAAM,GAAG,GAAG;4CACzB,WAAW,KAAK,CAAC,GAAG,OAAO,CAAC,CAAC,IAAM,YAAY,GAAG,CAAC,EAAE,GAAG;4CACxD,MAAM,cAAc,UAAU,CAAC,WAAW,MAAM,GAAG,EAAE;4CACrD,MAAM,YAAY,OAAO,WAAW,GAAG,MAAM,OAAO,YAAY,GAAG;4CACnE,MAAM,cAAc,YAAY,GAAG,KAAK,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,EAAE;4CACvE,MAAM,UAAU,QAAQ,WAAW,MAAM;4CACzC,MAAM,iBAAiB,UAAU,KAAK,MAAM,GAAG,IAAI,CAAC,QAAQ,GAAG;4CAC/D,IAAI,SAAS;4CACb,IAAI,kBAAkB,eAAe,IAAI,KAAK,UAAU;gDACtD,MAAM,aAAa,cAAc,eAAe,MAAM;gDACtD,MAAM,SACJ,OACE,AAAC,YAAwD,eAAe,IACtE,YAAY,SAAS,KACpB;gDACP,MAAM,SACJ,OACE,AAAC,eAA2D,eAAe,IACzE,eAAe,SAAS,KACvB;gDACP,IAAI,WAAW,GAAG,KAAK,WAAW,GAAG,IAAI,SAAS,SAAS,IAAI,KAAK,MAAM;oDACxE,SAAS;gDACX;4CACF;4CACA,MAAM,iBAAiB,WAAW,IAAI,CAAC,CAAC;gDACtC,MAAM,KAAK,cAAc,CAAC,GAAG,GAAG,CAAC,KAAK;gDACtC,MAAM,UAAU,CAAC,CAAC,AAAC,GAA0C,SAAS;gDACtE,MAAM,OAAO,OAAO,GAAG,OAAO,KAAK,YAAY,GAAG,OAAO,CAAC,UAAU,CAAC;gDACrE,OAAO,MAAM,WAAW;4CAC1B;4CACA,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;oDACZ;oDACA;kEACD,8OAAC;wDAEC,IAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE;wDACpB,WAAW,CAAC;;;sBAGpB,EAAE,YAAY,6BAA6B,mBAAmB;sBAC9D,EAAE,YAAY,SAAS,OAAO;sBAC9B,EAAE,cAAc,SAAS,GAAG;oBAC9B,CAAC;;4DAEU,CAAC,2BACA,8OAAC;gEAAI,WAAW,GAAG,YAAY,cAAc,GAAG,cAAc,CAAC;0EAC5D,WAAW,MAAM,iBAChB,8OAAC;oEAAI,WAAU;8EACb,cAAA,8OAAC,wIAAK;wEACJ,OAAO;wEACP,QAAQ;wEACR,KAAK,IAAA,oIAAW,EAAC,WAAW,MAAM;wEAClC,KAAK,WAAW,IAAI;wEACpB,WAAU;wEACV,aAAa,OAAO,WAAW,MAAM,EAAE,QAAQ,CAAC;;;;;;;;;;yFAIpD,8OAAC;oEAAI,WAAU;8EACb,cAAA,8OAAC,wIAAK;wEACJ,KAAI;wEACJ,KAAK,WAAW,IAAI,IAAI;wEACxB,OAAO;wEACP,QAAQ;wEACR,WAAU;;;;;;;;;;;;;;;;0EAMpB,8OAAC;gEAAI,WAAW,CAAC,sBAAsB,EAAE,YAAY,cAAc,eAAe;;oEAC/E,WAAW,CAAC,aAAa,CAAC,cAAc,CAAC,2BACxC,8OAAC;wEACC,WAAW,CAAC,+CAA+C,EAAE,YAAY,kBAAkB,iBAAiB;kFAE3G,YAAY,GAAG,CAAC,WAAW,GAAG,KAAK,WAAW,IAAI;;;;;;kFAGvD,8OAAC;wEACC,WAAW,CAAC,6FAA6F,EAAE,eAAe,SAAS,IAAI;wEACvI,OACE,YAAY,WAAW,EAAE,KAAK,IAAI,GAAG,GACjC;4EAAE,WAAW,CAAC,WAAW,EAAE,KAAK,GAAG,CAAC,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK,WAAW,EAAE,GAAG,GAAG,CAAC;wEAAC,IAC7E;wEAEN,SAAS;4EACP,gBAAgB,IAAI,GAAG;4EACvB,kBAAkB;wEACpB;wEACA,cAAc,CAAC;4EACb,IAAI;gFACF,IAAI,YAAY;gFAChB,sBAAsB,OAAO,GAAG;gFAChC,IAAI,kBAAkB,OAAO,IAAI,MAAM;oFACrC,aAAa,kBAAkB,OAAO;oFACtC,kBAAkB,OAAO,GAAG;gFAC9B;gFACA,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,EAAE;gFACnC,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gFAC3B,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gFAC3B,MAAM,KAAK,EAAE,aAAa;gFAC1B,cAAc,OAAO,GAAG;oFAAE,GAAG;oFAAI,GAAG;oFAAI,IAAI,IAAI,GAAG;oFAAE,MAAM;gFAAU;gFACrE,cAAc;oFAAE,IAAI;oFAAM,IAAI;gFAAE;gFAChC,qBAAqB,IAAI,GAAG;gFAC5B,kBAAkB,OAAO,GAAG,OAAO,UAAU,CAAC;oFAC5C,sBAAsB,OAAO,GAAG;oFAChC,gBAAgB,IAAI,GAAG;oFACvB,kBAAkB;oFAClB,oBAAoB,KAAK,IAAI,IAAI;gFACnC,GAAG;4EACL,EAAE,OAAM,CAAC;wEACX;wEACA,YAAY,CAAC;4EACX,IAAI;gFACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oFACrC,aAAa,kBAAkB,OAAO;oFACtC,kBAAkB,OAAO,GAAG;gFAC9B;gFACA,qBAAqB;gFACrB,IAAI,sBAAsB,OAAO,EAAE;oFACjC,EAAE,cAAc;oFAChB,EAAE,eAAe;gFACnB;gFACA,IAAI,YAAY,cAAc,OAAO,CAAC,EAAE,KAAK,IAAI,GAAG,EAAE;oFACpD,MAAM,QAAQ,cAAc,OAAO,CAAC,IAAI,GACpC,WAAW,EAAE,GAAG,CAAC,KACjB,WAAW,EAAE,GAAG;oFACpB,IAAI,OAAO;wFACT,iBAAiB;oFACnB;oFACA,cAAc;wFAAE,IAAI;wFAAM,IAAI;oFAAE;oFAChC,cAAc,OAAO,GAAG;wFAAE,GAAG;wFAAG,GAAG;wFAAG,IAAI;wFAAM,MAAM;oFAAM;gFAC9D;4EACF,EAAE,OAAM,CAAC;wEACX;wEACA,aAAa,CAAC;4EACZ,IAAI;gFACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oFACrC,aAAa,kBAAkB,OAAO;oFACtC,kBAAkB,OAAO,GAAG;gFAC9B;gFACA,qBAAqB;gFACrB,IAAI,CAAC,UAAU;gFACf,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,EAAE;gFACnC,MAAM,IAAI,IAAI,EAAE,OAAO,GAAG;gFAC1B,MAAM,IAAI,IAAI,EAAE,OAAO,GAAG;gFAC1B,MAAM,KAAK,IAAI,cAAc,OAAO,CAAC,CAAC;gFACtC,MAAM,KAAK,IAAI,cAAc,OAAO,CAAC,CAAC;gFACtC,IAAI,cAAc,OAAO,CAAC,EAAE,KAAK,IAAI,GAAG,EAAE;oFACxC,MAAM,aAAa,KAAK,GAAG,CAAC,MAAM,KAAK,KAAK,GAAG,CAAC,MAAM;oFACtD,IAAI,YAAY;wFACd,MAAM,QAAQ,cAAc,OAAO,CAAC,IAAI,GAAG,KAAK,IAAI,KAAK;wFACzD,cAAc;4FAAE,IAAI,IAAI,GAAG;4FAAE,IAAI,QAAQ,KAAK;wFAAE;wFAChD,EAAE,cAAc;oFAClB;gFACF;4EACF,EAAE,OAAM,CAAC;wEACX;wEACA,eAAe;4EACb,IAAI;gFACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oFACrC,aAAa,kBAAkB,OAAO;oFACtC,kBAAkB,OAAO,GAAG;gFAC9B;gFACA,qBAAqB;gFACrB,IAAI,YAAY,cAAc,OAAO,CAAC,EAAE,KAAK,IAAI,GAAG,EAAE;oFACpD,cAAc;wFAAE,IAAI;wFAAM,IAAI;oFAAE;oFAChC,cAAc,OAAO,GAAG;wFAAE,GAAG;wFAAG,GAAG;wFAAG,IAAI;wFAAM,MAAM;oFAAM;gFAC9D;4EACF,EAAE,OAAM,CAAC;wEACX;;4EAEC,CAAC,4BACA;;kGACE,8OAAC;wFACC,SAAS,CAAC;4FACR,EAAE,cAAc;4FAChB,MAAM,WAAW;gGACf,GAAG,GAAG;gGACN,YAAY,WAAW,GAAG,CAAC,CAAC,IAAM,CAAC;wGACjC,IAAI,EAAE,GAAG;wGACT,SAAS,EAAE,OAAO,IAAI;wGACtB,MAAM,EAAE,IAAI,KAAK,UAAU,UAAU;wGACrC,SAAS,EAAE,OAAO,IAAI,EAAE,UAAU;wGAClC,UAAU,EAAE,QAAQ;oGACtB,CAAC;4FACH;4FACA,eAAe;wFACjB;wFACA,WAAW,CAAC,0GAA0G,EACpH,YAAY,oBAAoB,kBAChC;wFACF,cAAW;wFACX,OAAM;kGAEN,cAAA,8OAAC,sJAAc;4FAAC,WAAU;;;;;;;;;;;oFAE3B,YAAY,WAAW,EAAE,KAAK,IAAI,GAAG,kBACpC,8OAAC;wFACC,WAAW,CAAC,kCAAkC,EAAE,YAAY,mBAAmB,mBAAmB;wFAClG,OAAO;4FAAE,SAAS,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,WAAW,EAAE,IAAI,IAAI;wFAAG;kGAE5D,cAAA,8OAAC;4FAAI,WAAU;sGACZ,0BACC,8OAAC,mKAAgB;gGAAC,WAAU;;;;;qHAE5B,8OAAC,oKAAiB;gGAAC,WAAU;;;;;;;;;;;;;;;;oFAKpC,CAAC,0BACA;kGACE,cAAA,8OAAC;4FACC,SAAS,CAAC;gGACR,EAAE,cAAc;gGAChB,cAAc,GAAG;4FACnB;4FACA,WAAW,CAAC,6GAA6G,EAAE,YAAY,qBAAqB,kBAAkB,4FAA4F,CAAC;4FAC3Q,cAAW;4FACX,OAAM;sGAEN,cAAA,8OAAC,qKAAkB;gGAAC,WAAU;;;;;;;;;;;;oFAInC,CAAC,0BACA,8OAAC,8KAAc;wFACb,QAAQ;wFACR,SAAS,iBAAiB,IAAI,GAAG;wFACjC,QAAQ,CAAC;4FACP,mBAAmB,KAAK;4FACxB,gBAAgB;wFAClB;wFACA,WAAW,GAAG,YAAY,qBAAqB,kBAAkB,CAAC,EAChE,iBAAiB,IAAI,GAAG,GACpB,oCACA,+FACJ;;;;;;;;0FAKV,8OAAC;gFACC,WAAW,CAAC,6CAA6C,EAAE,gBAAgB,6BAA6B,6BAA6B,sBAAsB,CAAC;0FAE3J,WAAW,GAAG,CAAC,CAAC,GAAG;oFAClB,MAAM,QAAQ,EAAE,IAAI,KAAK,WAAY,EAAE,OAAO,IAAI,IAAA,oIAAW,EAAC,EAAE,OAAO;oFACvE,MAAM,MAAM,OAAO,EAAE,OAAO,IAAI,EAAE,UAAU,IAAI;oFAChD,MAAM,OAAO,cAAc,CAAC,EAAE,GAAG,CAAC;oFAClC,MAAM,kBAAkB,CAAC,CAAC,AAAC,EAAyC,SAAS;oFAC7E,MAAM,eAAe,OAAO,KAAK,UAAU,CAAC;oFAC5C,MAAM,KAAK,SAAS,aAAa,mBAAmB;oFAEpD,MAAM,aAAa,WAAW,MAAM,GAAG,MAAM;oFAC7C,MAAM,aAAa,QAAQ,WAAW,MAAM,GAAG;oFAC/C,MAAM,aAAa,cAAc;oFAEjC,OAAO,sBACL,8OAAC;wFAEC,IAAI,CAAC,IAAI,EAAE,EAAE,GAAG,EAAE;wFAClB,WAAW,CAAC,4EAA4E,EAAE,aAAa,sBAAsB,WAAW,EAAE,EACxI,gBACI,aACE,wCACA,0CACF,aACE,yDACA,0DACP,CAAC,EAAE,qBAAqB,EAAE,GAAG,GAAG,2BAA2B,GAAG,CAAC,EAAE,sBAAsB,EAAE,GAAG,GAAG,2DAA2D,IAAI;wFAC/J,SAAS,IAAM,CAAC,MAAM,YAAY,OAAO,EAAE,OAAO,GAAI;wFACtD,eAAe,CAAC;4FACd,EAAE,cAAc;4FAChB,EAAE,eAAe;4FACjB,cAAc,GAAG;wFACnB;wFACA,cAAc,CAAC;4FACb,IAAI;gGACF,EAAE,eAAe;gGACjB,IAAI,EAAE,UAAU,EAAE;gGAClB,sBAAsB,OAAO,GAAG;gGAChC,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,EAAE;gGACnC,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gGAC3B,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gGAC3B,MAAM,KAAK,EAAE,aAAa;gGAC1B,cAAc,OAAO,GAAG;oGAAE,GAAG;oGAAI,GAAG;oGAAI,IAAI,IAAI,GAAG;oGAAE,MAAM;gGAAU;gGACrE,cAAc;oGAAE,IAAI;oGAAM,IAAI;gGAAE;gGAChC,qBAAqB,EAAE,GAAG;gGAC1B,kBAAkB,OAAO,GAAG,OAAO,UAAU,CAAC;oGAC5C,sBAAsB,OAAO,GAAG;oGAChC,gBAAgB,EAAE,GAAG;oGACrB,kBAAkB;oGAClB,oBAAoB,GAAG,IAAI,IAAI;gGACjC,GAAG;4FACL,EAAE,OAAM,CAAC;wFACX;wFACA,YAAY,CAAC;4FACX,IAAI;gGACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,qBAAqB;gGACrB,IAAI,sBAAsB,OAAO,EAAE;oGACjC,EAAE,cAAc;oGAChB,EAAE,eAAe;gGACnB;4FACF,EAAE,OAAM,CAAC;wFACX;wFACA,aAAa;4FACX,IAAI;gGACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,qBAAqB;4FACvB,EAAE,OAAM,CAAC;wFACX;;0GAEA,8OAAC;gGACC,KAAK,IAAA,oIAAW,EAAC;gGACjB,WAAU;gGACV,WAAW;gGACX,SAAQ;;;;;;4FAGT,CAAC,oBACA,8OAAC;gGAAI,WAAU;0GACb,cAAA,8OAAC;oGAAI,WAAU;8GACb,cAAA,8OAAC,yJAAM;wGAAC,WAAU;;;;;;;;;;;;;;;;4FAIvB,oBACC,8OAAC;gGAAI,WAAU;0GACb,cAAA,8OAAC;oGAAI,WAAU;;sHACb,8OAAC;4GAAI,WAAU;;;;;;wGACd,SAAS,2BACR,8OAAC;4GAAK,WAAU;;gHACb,KAAK,KAAK,CAAC;gHAAgB;;;;;;;;;;;;;;;;;;;uFApFjC,GAAG,EAAE,GAAG,CAAC,CAAC,EAAE,KAAK;;;;6GA4FxB,8OAAC;wFAEC,IAAI,CAAC,IAAI,EAAE,EAAE,GAAG,EAAE;wFAClB,WAAW,CAAC,+FAA+F,EAAE,aAAa,sBAAsB,WAAW,CAAC,EAC1J,gBACI,aACE,0BACA,4BACF,aACE,2BACA,4BACP,CAAC,EAAE,qBAAqB,EAAE,GAAG,GAAG,2BAA2B,GAAG,CAAC,EAAE,sBAAsB,EAAE,GAAG,GAAG,2DAA2D,IAAI;wFAC/J,SAAS,CAAC;4FACR,EAAE,eAAe;4FACjB,IAAI,CAAC,IAAI,YAAY,OAAO,EAAE,OAAO,IAAI,EAAE,UAAU,IAAI,KAAK;wFAChE;wFACA,eAAe,CAAC;4FACd,EAAE,cAAc;4FAChB,EAAE,eAAe;4FACjB,cAAc,GAAG;wFACnB;wFACA,cAAc,CAAC;4FACb,IAAI;gGACF,EAAE,eAAe;gGACjB,IAAI,EAAE,UAAU,EAAE;gGAClB,sBAAsB,OAAO,GAAG;gGAChC,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,EAAE;gGACnC,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gGAC3B,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gGAC3B,MAAM,KAAK,EAAE,aAAa;gGAC1B,cAAc,OAAO,GAAG;oGAAE,GAAG;oGAAI,GAAG;oGAAI,IAAI,IAAI,GAAG;oGAAE,MAAM;gGAAU;gGACrE,cAAc;oGAAE,IAAI;oGAAM,IAAI;gGAAE;gGAChC,qBAAqB,EAAE,GAAG;gGAC1B,kBAAkB,OAAO,GAAG,OAAO,UAAU,CAAC;oGAC5C,sBAAsB,OAAO,GAAG;oGAChC,gBAAgB,EAAE,GAAG;oGACrB,kBAAkB;oGAClB,oBAAoB,GAAG,IAAI,IAAI;gGACjC,GAAG;4FACL,EAAE,OAAM,CAAC;wFACX;wFACA,YAAY,CAAC;4FACX,IAAI;gGACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,qBAAqB;gGACrB,IAAI,sBAAsB,OAAO,EAAE;oGACjC,EAAE,cAAc;oGAChB,EAAE,eAAe;gGACnB;4FACF,EAAE,OAAM,CAAC;wFACX;wFACA,aAAa;4FACX,IAAI;gGACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,qBAAqB;4FACvB,EAAE,OAAM,CAAC;wFACX;;4FAEC,OAAO,KAAK,UAAU,CAAC,yBACtB,8OAAC,wIAAK;gGACJ,OAAO;gGACP,QAAQ;gGACR,KAAK;gGACL,KAAI;gGACJ,WAAU;;;;;qHAGZ,8OAAC,wIAAK;gGACJ,OAAO;gGACP,QAAQ;gGACR,KAAK,IAAA,oIAAW,EAAC;gGACjB,KAAI;gGACJ,WAAU;;;;;;4FAIb,oBACC,8OAAC;gGAAI,WAAU;0GACZ,CAAC;oGACA,MAAM,OAAO;oGACb,MAAM,SAAS;oGACf,MAAM,IAAI,CAAC,OAAO,MAAM,IAAI;oGAC5B,MAAM,IAAI,IAAI,KAAK,EAAE,GAAG;oGACxB,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,OAAO,QAAQ;oGACnD,qBACE,8OAAC;wGAAI,WAAU;kHACb,cAAA,8OAAC;4GAAI,OAAO;4GAAM,QAAQ;4GAAM,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,MAAM;;8HAC5D,8OAAC;oHACC,IAAI,OAAO;oHACX,IAAI,OAAO;oHACX,GAAG;oHACH,QAAO;oHACP,aAAa;oHACb,MAAK;;;;;;8HAEP,8OAAC;oHACC,IAAI,OAAO;oHACX,IAAI,OAAO;oHACX,GAAG;oHACH,QAAO;oHACP,aAAa;oHACb,MAAK;oHACL,iBAAiB;oHACjB,kBAAkB,IAAI,AAAC,IAAI,MAAO;oHAClC,eAAc;oHACd,WAAW,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;;;;;;;;;;;;;;;;;gGAM1D,CAAC;;;;;;;uFAxHA,GAAG,EAAE,GAAG,CAAC,CAAC,EAAE,KAAK;;;;;gFA6H5B;;;;;;4EAED,CAAC;gFACA,MAAM,QAAQ,OAAO,OAAO,CAAC,WAC1B,GAAG,CAAC,CAAC,CAAC,OAAO,IAAI,GAAK,CAAC;wFACtB;wFACA,OAAO,CAAC,OAAO,EAAE,EAAE,MAAM;wFACzB,MAAM,CAAC,OAAO,EAAE,EAAE,QAAQ,CAAC;wFAC3B,OAAO,CAAC,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC,KAAO,YAAY,GAAG,CAAC,OAAO,QAAQ;oFAChE,CAAC,GACA,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,GAAG,GACxB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK;gFACnC,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;gFAC/B,qBACE,8OAAC;oFACC,WAAW,CAAC,SAAS,EAAE,YAAY,kBAAkB,eAAe,iCAAiC,CAAC;;sGAEtG,8OAAC;4FAAI,WAAU;;gGACZ,MAAM,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAI,oBAC1B,8OAAC;wGAEC,SAAS,CAAC;4GACR,EAAE,eAAe;4GACjB,kBACE,gBAAgB,UAAU,IAAI,GAAG,IAC/B,gBAAgB,UAAU,GAAG,KAAK,GAChC,OACA;gHAAE,OAAO,IAAI,GAAG;gHAAE,OAAO,GAAG,KAAK;4GAAC;wGAE1C;wGACA,WAAW,CAAC,mIAAmI,EAAE,GAAG,IAAI,GAAG,eAAe,kBAAkB;wGAC5L,OAAO,GAAG,GAAG,KAAK,CAAC,MAAM,CAAC;;0HAE1B,8OAAC;gHAAK,WAAU;0HAAwB,GAAG,KAAK;;;;;;4GAC/C,GAAG,KAAK,GAAG,mBACV,8OAAC;gHACC,WAAW,CAAC,oBAAoB,EAAE,GAAG,IAAI,GAAG,kBAAkB,iBAAiB;0HAE9E,GAAG,KAAK;;;;;;;uGAlBR,GAAG,IAAI,GAAG,CAAC,aAAa,EAAE,KAAK;;;;;gGAuBvC,MAAM,MAAM,GAAG,mBACd,8OAAC;oGAAI,WAAU;;wGAAyC;wGACpD,MAAM,MAAM,GAAG;;;;;;;;;;;;;sGAIvB,8OAAC;4FAAI,WAAU;;;;;;;;;;;;4EAGrB,CAAC;4EACA,kBAAkB,eAAe,KAAK,KAAK,IAAI,GAAG,kBACjD;;kGACE,8OAAC;wFAAI,WAAU;wFAAqB,SAAS,IAAM,kBAAkB;;;;;;kGACrE,8OAAC;wFACC,KAAK,CAAC;4FACJ,IAAI,MAAM,eAAe,KAAK,KAAK,IAAI,GAAG,EAAE;gGAC1C,MAAM,OAAO,GAAG,aAAa,EAAE;gGAC/B,IAAI,MAAM;oGACR,MAAM,aAAa,OAAO,WAAW,GAAG,KAAK,MAAM;oGACnD,MAAM,aAAa,KAAK,GAAG;oGAC3B,MAAM,gBAAgB;oGACtB,IAAI,aAAa,iBAAiB,aAAa,YAAY;wGACzD,GAAG,KAAK,CAAC,MAAM,GAAG;wGAClB,GAAG,KAAK,CAAC,GAAG,GAAG;wGACf,GAAG,KAAK,CAAC,YAAY,GAAG;wGACxB,GAAG,KAAK,CAAC,SAAS,GAAG;oGACvB,OAAO;wGACL,GAAG,KAAK,CAAC,GAAG,GAAG;wGACf,GAAG,KAAK,CAAC,MAAM,GAAG;wGAClB,GAAG,KAAK,CAAC,SAAS,GAAG;wGACrB,GAAG,KAAK,CAAC,YAAY,GAAG;oGAC1B;gGACF;4FACF;wFACF;wFACA,WAAW,CAAC,SAAS,EAAE,YAAY,YAAY,SAAS,KAAK,CAAC;kGAE7D,CAAC;4FACA,MAAM,QAAQ,CAAC,SAAS,CAAC,eAAe,KAAK,CAAC,IAAI,EAAE,EAAE,GAAG,CACvD,CAAC,KAAO,YAAY,GAAG,CAAC,OAAO,QAAQ,OAAO;4FAEhD,qBACE,8OAAC;gGAAI,WAAU;;kHACb,8OAAC;wGAAI,WAAU;;0HACb,8OAAC;gHAAK,WAAU;0HAAY,eAAe,KAAK;;;;;;0HAChD,8OAAC;gHAAK,WAAU;;oHACb,MAAM,MAAM;oHAAC;;;;;;;;;;;;;oGAGjB,MAAM,MAAM,GAAG,kBACd,8OAAC;wGAAG,WAAU;kHACX,MAAM,GAAG,CAAC,CAAC,MAAM,oBAChB,8OAAC;gHAEC,WAAU;0HAET;+GAHI,GAAG,IAAI,GAAG,CAAC,YAAY,EAAE,KAAK;;;;;;;;;6HAQzC,8OAAC;wGAAI,WAAU;kHAA6B;;;;;;;;;;;;wFAIpD,CAAC;;;;;;;;4EAIN,wBACC,8OAAC;gFAAI,WAAW,CAAC,aAAa,EAAE,YAAY,kBAAkB,iBAAiB;0FAC7E,cAAA,8OAAC;oFAAK,WAAU;8FACb,gBACC,OACE,AAAC,YAAwD,eAAe,IACtE,YAAY,SAAS,KACpB;;;;;;;;;;;;;;;;;kFAMf,8OAAC,0KAAU;wEACT,SAAS;wEACT,SAAS;wEACT,YAAY,CAAC,CAAC,YAAY,UAAU;wEACpC,QAAQ;wEACR,QAAQ;wEACR,MAAM;wEACN,aAAa;wEACb,eAAe;wEACf,UAAU;wEACV,aAAa;;;;;;;;;;;;;uDAnkBZ,CAAC,MAAM,EAAE,IAAI,GAAG,EAAE;;;;;;+CAJN,CAAC,MAAM,EAAE,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;wCA6kBhD;oCACF;oCAEA,MAAM,gBAAgB,CAAC,cAAc,IAAI,IAAI,KAAK,UAAU,CAAC;oCAC7D,IAAI,eAAe;wCACjB,MAAM,YAAuB;4CAAC;yCAAI;wCAClC,IAAK,IAAI,IAAI,QAAQ,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;4CAC5C,MAAM,OAAO,IAAI,CAAC,EAAE;4CACpB,IAAI,KAAK,UAAU,EAAE;4CACrB,MAAM,aAAa,KAAK,IAAI,KAAK,UAAU,CAAC,CAAC,KAAK,OAAO,IAAI,IAAA,oIAAW,EAAC,KAAK,OAAO,CAAC;4CACtF,IAAI,CAAC,YAAY;4CACjB,MAAM,aAAa,cAAc,KAAK,MAAM;4CAC5C,MAAM,KAAK,KAAK,GAAG,CAAC,OAAO,KAAK,SAAS,IAAI,OAAO,SAAS,CAAC,UAAU,MAAM,GAAG,EAAE,CAAC,SAAS;4CAC7F,IAAI,WAAW,GAAG,KAAK,WAAW,GAAG,IAAI,KAAK,QAAQ;4CACtD,UAAU,IAAI,CAAC;wCACjB;wCACA,IAAI,UAAU,MAAM,GAAG,GAAG;4CACxB,UAAU,KAAK,CAAC,GAAG,OAAO,CAAC,CAAC,IAAM,YAAY,GAAG,CAAC,EAAE,GAAG;4CACvD,MAAM,cAAc,SAAS,CAAC,UAAU,MAAM,GAAG,EAAE;4CACnD,MAAM,YAAY,OAAO,WAAW,GAAG,MAAM,OAAO,YAAY,GAAG;4CACnE,MAAM,cAAc,YAAY,GAAG,KAAK,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,EAAE;4CACvE,MAAM,UAAU,QAAQ,UAAU,MAAM;4CACxC,MAAM,iBAAiB,UAAU,KAAK,MAAM,GAAG,IAAI,CAAC,QAAQ,GAAG;4CAC/D,IAAI,SAAS;4CACb,IAAI,kBAAkB,eAAe,IAAI,KAAK,UAAU;gDACtD,MAAM,aAAa,cAAc,eAAe,MAAM;gDACtD,MAAM,SACJ,OACE,AAAC,YAAwD,eAAe,IACtE,YAAY,SAAS,KACpB;gDACP,MAAM,SACJ,OACE,AAAC,eAA2D,eAAe,IACzE,eAAe,SAAS,KACvB;gDACP,IAAI,WAAW,GAAG,KAAK,WAAW,GAAG,IAAI,SAAS,SAAS,IAAI,KAAK,MAAM;oDACxE,SAAS;gDACX;4CACF;4CACA,MAAM,iBAAiB,UAAU,IAAI,CAAC,CAAC;gDACrC,MAAM,KAAK,cAAc,CAAC,GAAG,GAAG,CAAC,KAAK;gDACtC,MAAM,UAAU,CAAC,CAAC,AAAC,GAA0C,SAAS;gDACtE,MAAM,OAAO,OAAO,GAAG,OAAO,KAAK,YAAY,GAAG,OAAO,CAAC,UAAU,CAAC;gDACrE,OAAO,MAAM,WAAW;4CAC1B;4CACA,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;oDACZ;oDACA;kEACD,8OAAC;wDAEC,IAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE;wDACpB,WAAW,CAAC;;;sBAGpB,EAAE,YAAY,6BAA6B,mBAAmB;sBAC9D,EAAE,YAAY,SAAS,OAAO;sBAC9B,EAAE,cAAc,SAAS,GAAG;oBAC9B,CAAC;;4DAEU,CAAC,2BACA,8OAAC;gEAAI,WAAW,GAAG,YAAY,cAAc,GAAG,cAAc,CAAC;0EAC5D,WAAW,MAAM,iBAChB,8OAAC;oEAAI,WAAU;8EACb,cAAA,8OAAC,wIAAK;wEACJ,OAAO;wEACP,QAAQ;wEACR,KAAK,IAAA,oIAAW,EAAC,WAAW,MAAM;wEAClC,KAAK,WAAW,IAAI;wEACpB,WAAU;wEACV,aAAa,OAAO,WAAW,MAAM,EAAE,QAAQ,CAAC;;;;;;;;;;yFAIpD,8OAAC;oEAAI,WAAU;8EACb,cAAA,8OAAC,wIAAK;wEACJ,KAAI;wEACJ,KAAK,WAAW,IAAI,IAAI;wEACxB,OAAO;wEACP,QAAQ;wEACR,WAAU;;;;;;;;;;;;;;;;0EAMpB,8OAAC;gEAAI,WAAW,CAAC,sBAAsB,EAAE,YAAY,KAAK,eAAe;;oEACtE,WAAW,CAAC,aAAa,CAAC,cAAc,CAAC,2BACxC,8OAAC;wEAAE,WAAW,CAAC,eAAe,EAAE,YAAY,kBAAkB,iBAAiB;kFAC5E,YAAY,GAAG,CAAC,WAAW,GAAG,KAAK,WAAW,IAAI;;;;;;kFAGvD,8OAAC;wEACC,WAAW,CAAC,6DAA6D,EAAE,eAAe,SAAS,IAAI;wEACvG,SAAS;4EACP,gBAAgB,IAAI,GAAG;4EACvB,kBAAkB;wEACpB;;4EAEC,CAAC,4BACA;;oFACG,CAAC,0BACA;kGACE,cAAA,8OAAC;4FACC,SAAS,CAAC;gGACR,EAAE,cAAc;gGAChB,cAAc,GAAG;4FACnB;4FACA,WAAW,CAAC,8FAA8F,EAAE,YAAY,oBAAoB,iBAAiB,4FAA4F,CAAC;4FAC1P,cAAW;4FACX,OAAM;sGAEN,cAAA,8OAAC,qKAAkB;gGAAC,WAAU;;;;;;;;;;;;oFAInC,CAAC,0BACA,8OAAC,8KAAc;wFACb,QAAQ;wFACR,SAAS,iBAAiB,IAAI,GAAG;wFACjC,QAAQ,CAAC;4FACP,mBAAmB,KAAK;4FACxB,gBAAgB;wFAClB;wFACA,WAAW,GAAG,YAAY,qBAAqB,kBAAkB,CAAC,EAChE,iBAAiB,IAAI,GAAG,GACpB,oCACA,+FACJ;;;;;;;;0FAKV,8OAAC;gFAAI,WAAU;0FACZ,UAAU,GAAG,CAAC,CAAC,GAAG,oBACjB,8OAAC;wFAEC,IAAI,CAAC,IAAI,EAAE,EAAE,GAAG,EAAE;wFAClB,MAAM,IAAA,oIAAW,EAAC,OAAO,EAAE,OAAO,IAAI,KAAK;wFAC3C,UAAU,EAAE,QAAQ,IAAI;wFACxB,QAAO;wFACP,KAAI;wFACJ,WAAW,CAAC,+EAA+E,EACzF,qBAAqB,EAAE,GAAG,GACtB,mCACA,mCACL,CAAC,EAAE,sBAAsB,EAAE,GAAG,GAAG,2DAA2D,IAAI;wFACjG,SAAS,CAAC;4FACR,MAAM,OAAO,cAAc,CAAC,EAAE,GAAG,CAAC;4FAClC,IAAI,SAAS,WAAW,EAAE,cAAc;wFAC1C;wFACA,eAAe,CAAC;4FACd,EAAE,cAAc;4FAChB,EAAE,eAAe;4FACjB,cAAc,GAAG;wFACnB;wFACA,cAAc,CAAC;4FACb,IAAI;gGACF,IAAI,EAAE,UAAU,EAAE;gGAClB,sBAAsB,OAAO,GAAG;gGAChC,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,EAAE;gGACnC,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gGAC3B,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;gGAC3B,MAAM,KAAK,EAAE,aAAa;gGAC1B,qBAAqB,EAAE,GAAG;gGAC1B,kBAAkB,OAAO,GAAG,OAAO,UAAU,CAAC;oGAC5C,sBAAsB,OAAO,GAAG;oGAChC,gBAAgB,EAAE,GAAG;oGACrB,kBAAkB;oGAClB,oBAAoB,GAAG,IAAI,IAAI;gGACjC,GAAG;4FACL,EAAE,OAAM,CAAC;wFACX;wFACA,YAAY,CAAC;4FACX,IAAI;gGACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,qBAAqB;gGACrB,IAAI,sBAAsB,OAAO,EAAE;oGACjC,EAAE,cAAc;oGAChB,EAAE,eAAe;gGACnB;4FACF,EAAE,OAAM,CAAC;wFACX;wFACA,aAAa;4FACX,IAAI;gGACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;oGACrC,aAAa,kBAAkB,OAAO;oGACtC,kBAAkB,OAAO,GAAG;gGAC9B;gGACA,qBAAqB;4FACvB,EAAE,OAAM,CAAC;wFACX;wFACA,iBAAe,cAAc,CAAC,EAAE,GAAG,CAAC,KAAK,YAAY,OAAO;;0GAE5D,8OAAC;gGAAI,WAAU;0GACb,cAAA,8OAAC,wKAAqB;oGAAC,WAAU;;;;;;;;;;;0GAEnC,8OAAC;gGAAI,WAAU;;kHACb,8OAAC;wGAAE,WAAU;kHACV,EAAE,QAAQ,IAAI;;;;;;kHAEjB,8OAAC;wGAAE,WAAU;kHAAiC;;;;;;;;;;;;4FAE/C,cAAc,CAAC,EAAE,GAAG,CAAC,KAAK,2BACzB,8OAAC;gGAAI,WAAU;0GACZ,CAAC;oGACA,MAAM,OAAO;oGACb,MAAM,SAAS;oGACf,MAAM,IAAI,CAAC,OAAO,MAAM,IAAI;oGAC5B,MAAM,IAAI,IAAI,KAAK,EAAE,GAAG;oGACxB,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,OAAO,cAAc,CAAC,EAAE,GAAG,CAAC,IAAI;oGACpE,qBACE,8OAAC;wGAAI,WAAU;;0HACb,8OAAC;gHAAI,OAAO;gHAAM,QAAQ;gHAAM,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,MAAM;;kIAC5D,8OAAC;wHACC,IAAI,OAAO;wHACX,IAAI,OAAO;wHACX,GAAG;wHACH,QAAO;wHACP,aAAa;wHACb,MAAK;;;;;;kIAEP,8OAAC;wHACC,IAAI,OAAO;wHACX,IAAI,OAAO;wHACX,GAAG;wHACH,QAAO;wHACP,aAAa;wHACb,MAAK;wHACL,iBAAiB;wHACjB,kBAAkB,IAAI,AAAC,IAAI,MAAO;wHAClC,eAAc;wHACd,WAAW,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;;;;;;;;;;;;0HAGpD,8OAAC;gHAAK,WAAU;;oHAA8B,KAAK,KAAK,CAAC;oHAAG;;;;;;;;;;;;;gGAGlE,CAAC;;;;;;;uFA7GA,GAAG,EAAE,GAAG,CAAC,CAAC,EAAE,KAAK;;;;;;;;;;4EAmH3B,CAAC;gFACA,MAAM,QAAQ,OAAO,OAAO,CAAC,WAC1B,GAAG,CAAC,CAAC,CAAC,OAAO,IAAI,GAAK,CAAC;wFACtB;wFACA,OAAO,CAAC,OAAO,EAAE,EAAE,MAAM;wFACzB,MAAM,CAAC,OAAO,EAAE,EAAE,QAAQ,CAAC;wFAC3B,OAAO,CAAC,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC,KAAO,YAAY,GAAG,CAAC,OAAO,QAAQ;oFAChE,CAAC,GACA,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,GAAG,GACxB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK;gFACnC,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;gFAC/B,qBACE,8OAAC;oFACC,WAAW,CAAC,SAAS,EAAE,YAAY,kBAAkB,eAAe,iCAAiC,CAAC;;sGAEtG,8OAAC;4FAAI,WAAU;;gGACZ,MAAM,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAI,oBAC1B,8OAAC;wGAEC,SAAS,CAAC;4GACR,EAAE,eAAe;4GACjB,kBACE,gBAAgB,UAAU,IAAI,GAAG,IAC/B,gBAAgB,UAAU,GAAG,KAAK,GAChC,OACA;gHAAE,OAAO,IAAI,GAAG;gHAAE,OAAO,GAAG,KAAK;4GAAC;wGAE1C;wGACA,WAAW,CAAC,mIAAmI,EAAE,GAAG,IAAI,GAAG,eAAe,kBAAkB;wGAC5L,OAAO,GAAG,GAAG,KAAK,CAAC,MAAM,CAAC;;0HAE1B,8OAAC;gHAAK,WAAU;0HAAwB,GAAG,KAAK;;;;;;4GAC/C,GAAG,KAAK,GAAG,mBACV,8OAAC;gHACC,WAAW,CAAC,oBAAoB,EAAE,GAAG,IAAI,GAAG,kBAAkB,iBAAiB;0HAE9E,GAAG,KAAK;;;;;;;uGAlBR,GAAG,IAAI,GAAG,CAAC,iBAAiB,EAAE,KAAK;;;;;gGAuB3C,MAAM,MAAM,GAAG,mBACd,8OAAC;oGAAI,WAAU;;wGAAyC;wGACpD,MAAM,MAAM,GAAG;;;;;;;;;;;;;sGAIvB,8OAAC;4FAAI,WAAU;;;;;;;;;;;;4EAGrB,CAAC;4EACA,kBAAkB,eAAe,KAAK,KAAK,IAAI,GAAG,kBACjD;;kGACE,8OAAC;wFAAI,WAAU;wFAAqB,SAAS,IAAM,kBAAkB;;;;;;kGACrE,8OAAC;wFACC,KAAK,CAAC;4FACJ,IAAI,MAAM,eAAe,KAAK,KAAK,IAAI,GAAG,EAAE;gGAC1C,MAAM,OAAO,GAAG,aAAa,EAAE;gGAC/B,IAAI,MAAM;oGACR,MAAM,aAAa,OAAO,WAAW,GAAG,KAAK,MAAM;oGACnD,MAAM,aAAa,KAAK,GAAG;oGAC3B,MAAM,gBAAgB;oGACtB,IAAI,aAAa,iBAAiB,aAAa,YAAY;wGACzD,GAAG,KAAK,CAAC,MAAM,GAAG;wGAClB,GAAG,KAAK,CAAC,GAAG,GAAG;wGACf,GAAG,KAAK,CAAC,YAAY,GAAG;wGACxB,GAAG,KAAK,CAAC,SAAS,GAAG;oGACvB,OAAO;wGACL,GAAG,KAAK,CAAC,GAAG,GAAG;wGACf,GAAG,KAAK,CAAC,MAAM,GAAG;wGAClB,GAAG,KAAK,CAAC,SAAS,GAAG;wGACrB,GAAG,KAAK,CAAC,YAAY,GAAG;oGAC1B;gGACF;4FACF;wFACF;wFACA,WAAW,CAAC,SAAS,EAAE,YAAY,YAAY,SAAS,KAAK,CAAC;kGAE7D,CAAC;4FACA,MAAM,QAAQ,CAAC,SAAS,CAAC,eAAe,KAAK,CAAC,IAAI,EAAE,EAAE,GAAG,CACvD,CAAC,KAAO,YAAY,GAAG,CAAC,OAAO,QAAQ,OAAO;4FAEhD,qBACE,8OAAC;gGAAI,WAAU;;kHACb,8OAAC;wGAAI,WAAU;;0HACb,8OAAC;gHAAK,WAAU;0HAAY,eAAe,KAAK;;;;;;0HAChD,8OAAC;gHAAK,WAAU;;oHACb,MAAM,MAAM;oHAAC;;;;;;;;;;;;;oGAGjB,MAAM,MAAM,GAAG,kBACd,8OAAC;wGAAG,WAAU;kHACX,MAAM,GAAG,CAAC,CAAC,MAAM,oBAChB,8OAAC;gHAEC,WAAU;0HAET;+GAHI,GAAG,IAAI,GAAG,CAAC,gBAAgB,EAAE,KAAK;;;;;;;;;6HAQ7C,8OAAC;wGAAI,WAAU;kHAA6B;;;;;;;;;;;;wFAIpD,CAAC;;;;;;;;4EAIN,wBACC,8OAAC;gFACC,WAAW,CAAC,mBAAmB,EAAE,YAAY,kBAAkB,gBAAgB,wBAAwB,CAAC;0FAExG,cAAA,8OAAC;8FACE,gBACC,OACE,AAAC,YAAwD,eAAe,IACtE,YAAY,SAAS,KACpB;;;;;;;;;;;;;;;;;kFAMf,8OAAC,0KAAU;wEACT,SAAS;wEACT,SAAS;wEACT,YAAY,CAAC,CAAC,YAAY,UAAU;wEACpC,QAAQ;wEACR,QAAQ;wEACR,MAAM;wEACN,aAAa;wEACb,eAAe;wEACf,UAAU;wEACV,aAAa;;;;;;;;;;;;;uDAhVZ,CAAC,WAAW,EAAE,IAAI,GAAG,EAAE;;;;;;+CAJX,CAAC,WAAW,EAAE,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;wCA0VrD;oCACF;oCAEA,iBAAiB;oCACjB,IAAI,IAAI,IAAI,KAAK,UAAU;wCACzB,MAAM,SAAS,CAAC,CAAC,AAAC,IAAmD,QAAQ;wCAC7E,MAAM,kBAAkB,CAAC,IAAI,OAAO,IAAI,EAAE,EAAE,WAAW;wCACvD,MAAM,aACJ,gBAAgB,QAAQ,CAAC,uBAAuB,gBAAgB,QAAQ,CAAC;wCAE3E,IAAI,CAAC,UAAU,CAAC,YAAY;4CAC1B,MAAM,OAAO,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,GAAG;4CAC3C,MAAM,eAAe,MAAM,SAAS;4CACpC,MAAM,aACJ,gBAAgB,CAAC,CAAC,AAAC,KAAoD,QAAQ;4CACjF,MAAM,mBAAmB,CAAC,MAAM,WAAW,EAAE,EAAE,WAAW;4CAC1D,MAAM,iBACJ,gBACA,CAAC,iBAAiB,QAAQ,CAAC,uBACzB,iBAAiB,QAAQ,CAAC,kBAAkB;4CAEhD,IAAI,gBAAgB,CAAC,cAAc,CAAC,gBAAgB;4CAClD,wDAAwD;4CAC1D,OAAO;gDACL,MAAM,cAAc;oDAAC;iDAAI;gDACzB,IAAK,IAAI,IAAI,QAAQ,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;oDAC5C,MAAM,OAAO,IAAI,CAAC,EAAE;oDACpB,IAAI,KAAK,IAAI,KAAK,UAAU;oDAC5B,MAAM,aAAa,CAAC,CAAC,AAAC,KAAoD,QAAQ;oDAClF,MAAM,mBAAmB,CAAC,KAAK,OAAO,IAAI,EAAE,EAAE,WAAW;oDACzD,MAAM,iBACJ,iBAAiB,QAAQ,CAAC,uBAC1B,iBAAiB,QAAQ,CAAC;oDAE5B,IAAI,cAAc,gBAAgB;oDAClC,YAAY,IAAI,CAAC;gDACnB;gDAEA,IAAI,YAAY,MAAM,IAAI,GAAG;oDAC3B,MAAM,UAAU,IAAI,GAAG;oDACvB,MAAM,aAAa,qBAAqB,GAAG,CAAC;oDAE5C,IAAI,CAAC,YAAY;wDACf,YAAY,KAAK,CAAC,GAAG,OAAO,CAAC,CAAC,IAAM,YAAY,GAAG,CAAC,EAAE,GAAG;wDACzD,qBACE,8OAAC;4DAAoC,WAAU;sEAC7C,cAAA,8OAAC;gEACC,SAAS;oEACP,MAAM,SAAS,IAAI,IAAI;oEACvB,OAAO,GAAG,CAAC;oEACX,wBAAwB;gEAC1B;gEACA,WAAU;0EACX;;;;;;2DARO,CAAC,aAAa,EAAE,SAAS;;;;;oDAavC;gDACF;4CACF;wCACF;wCAEA,IAAI,AAAC,IAAmD,QAAQ,EAAE;4CAChE,8DAA8D;4CAC9D,MAAM,OAAO,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,GAAG;4CAC3C,MAAM,eAAe,MAAM,SAAS;4CACpC,MAAM,aACJ,gBAAgB,CAAC,CAAC,AAAC,KAAoD,QAAQ;4CACjF,IAAI,CAAC,YAAY;gDACf,MAAM,YAAY;oDAAC;iDAAI;gDACvB,IAAK,IAAI,IAAI,QAAQ,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;oDAC5C,MAAM,OAAO,IAAI,CAAC,EAAE;oDACpB,IAAI,KAAK,IAAI,KAAK,UAAU;oDAC5B,MAAM,aAAa,CAAC,CAAC,AAAC,KAAoD,QAAQ;oDAClF,IAAI,CAAC,YAAY;oDACjB,UAAU,IAAI,CAAC;gDACjB;gDACA,IAAI,UAAU,MAAM,IAAI,GAAG;oDACzB,MAAM,UAAU,IAAI,GAAG;oDACvB,MAAM,aAAa,qBAAqB,GAAG,CAAC;oDAC5C,IAAI,CAAC,YAAY;wDACf,UAAU,KAAK,CAAC,GAAG,OAAO,CAAC,CAAC,IAAM,YAAY,GAAG,CAAC,EAAE,GAAG;wDACvD,qBACE,8OAAC;4DAAyC,WAAU;sEAClD,cAAA,8OAAC;gEACC,SAAS;oEACP,MAAM,SAAS,IAAI,IAAI;oEACvB,OAAO,GAAG,CAAC;oEACX,wBAAwB;gEAC1B;gEACA,WAAU;0EACX;;;;;;2DARO,CAAC,kBAAkB,EAAE,SAAS;;;;;oDAa5C;gDACF;4CACF;4CACA,MAAM,WACJ,AAAC,IAAmD,QAAQ,KAAK,UAAU,UAAU;4CACvF,MAAM,WAAW,AAAC,IAAwC,QAAQ,IAAI;4CACtE,MAAM,SACJ,AAAC,IAAuE,UAAU,IAClF;4CACF,MAAM,MAAM,OAAO,AAAC,IAA+C,eAAe,IAAI;4CACtF,MAAM,WAAW,OAAO,YAAY,GAAG,MAAM,OAAO;4CACpD,MAAM,WACJ,aAAa,UACX,WAAW,cAAc,WAAW,0BAClC,8OAAC,gKAAa;gDAAC,WAAU;;;;;qEAEzB,8OAAC,gKAAa;gDAAC,WAAU;;;;;uDAEzB,WAAW,cAAc,WAAW,0BACtC,8OAAC,0JAAO;gDAAC,WAAU;;;;;qEAEnB,8OAAC,0JAAO;gDAAC,WAAU;;;;;;4CAEvB,MAAM,UAAU,yBACd,8OAAC,8JAAW;gDAAC,WAAU;;;;;qEAEvB,8OAAC,4JAAS;gDAAC,WAAU;;;;;;4CAEvB,MAAM,QAAQ,CAAC,SAAS,EAAE,aAAa,UAAU,UAAU,QAAQ,CAAC,EAAE,WAAW,QAAQ,MAAM;4CAC/F,MAAM,SACJ,WAAW,aACP,GAAG,KAAK,KAAK,CAAC,MAAM,IAAI,MAAM,EAAE,KAAK,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,GAC3D,WAAW,aACT,eACA,WACE,QACA;4CACV,MAAM,KAAK,IAAI,KAAK,IAAI,SAAS;4CACjC,MAAM,QAAQ,IAAI;4CAClB,MAAM,YAAY,IAAI;4CACtB,UAAU,OAAO,CAAC,MAAM,OAAO,KAAK;4CACpC,MAAM,WAAW,CAAC,GAAS,IACzB,EAAE,WAAW,OAAO,EAAE,WAAW,MACjC,EAAE,QAAQ,OAAO,EAAE,QAAQ,MAC3B,EAAE,OAAO,OAAO,EAAE,OAAO;4CAC3B,MAAM,YAAY,SAAS,IAAI,SAC3B,YACA,SAAS,IAAI,aACX,YACA,GAAG,kBAAkB,CAAC,SAAS;gDAAE,KAAK;gDAAW,OAAO;gDAAW,MAAM;4CAAU;4CACzF,MAAM,YAAY,GAAG,kBAAkB,CAAC,SAAS;gDAAE,MAAM;gDAAW,QAAQ;4CAAU;4CACtF,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;oDACZ;oDACA;kEACD,8OAAC;wDAEC,IAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE;wDACpB,mBAAiB,IAAI,GAAG;wDACxB,WAAU;kEAEV,cAAA,8OAAC;4DACC,WAAW,CAAC,iFAAiF,EAAE,qBAAqB,IAAI,GAAG,GAAG,iBAAiB,eAAe;sEAE9J,cAAA,8OAAC;gEAAI,WAAU;;oEACZ;oEACA;kFACD,8OAAC;;0FACC,8OAAC;gFAAE,WAAU;0FAAkC,GAAG,MAAM,GAAG,EAAE,QAAQ;;;;;;0FACrE,8OAAC;gFAAE,WAAU;0FAAkC,CAAC,CAAC,EAAE,UAAU,GAAG,EAAE,WAAW;;;;;;;;;;;;;;;;;;;;;;;uDAb9E,IAAI,GAAG;;;;;;+CAJK,CAAC,YAAY,EAAE,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;wCAwDtD;wCACA,MAAM,UAAU,IAAI,gBAAgB,GAChC,SAAS,IAAI,CAAC,CAAC,IAAM,EAAE,GAAG,KAAK,IAAI,gBAAgB,IACnD;wCACJ,MAAM,aAAa,IAAI,OAAO,IAAI;wCAClC,MAAM,WAAW,WAAW,IAAI,GAAG,WAAW;wCAC9C,MAAM,eAAe,SAAS,QAAQ,CAAC;wCACvC,IAAI,UAAU;wCACd,IAAI,CAAC,gBAAgB,MAAM;4CACzB,MAAM,SAAS,YAAY,IAAI,IAAI;4CACnC,MAAM,eAAe,QAAQ,IAAI,GAAG,WAAW;4CAC/C,IAAI,CAAC,aAAa,UAAU,CAAC,UAAU,UAAU,QAAQ,UAAU,CAAC,SAAS;gDAC3E,UAAU,QAAQ,QAAQ,KAAK,CAAC,OAAO,MAAM;4CAC/C,OAAO,IAAI,QAAQ,UAAU,CAAC,mBAAmB;gDAC/C,UAAU,QAAQ,QAAQ,KAAK,CAAC,iBAAiB,MAAM;4CACzD;wCACF;wCACA,MAAM,eAAe,QAAQ,WAAW;wCACxC,MAAM,WAAW,aAAa,QAAQ,CAAC;wCACvC,MAAM,QAAQ,aAAa,QAAQ,CAAC;wCACpC,MAAM,SAAS,aAAa,QAAQ,CAAC,mBAAmB,aAAa,QAAQ,CAAC;wCAC9E,MAAM,WAAW,aAAa,QAAQ,CAAC,aAAa,aAAa,QAAQ,CAAC;wCAC1E,MAAM,SAAS,SAAS,SAAS,UAAU,aAAa,QAAQ,CAAC;wCACjE,MAAM,QAAQ,aAAa,QAAQ,CAAC;wCACpC,gBAAgB;wCAChB,MAAM,WACJ,aAAa,QAAQ,CAAC,cACrB,aAAa,QAAQ,CAAC,UAAU,aAAa,QAAQ,CAAC;wCACzD,MAAM,UAAU,aAAa,QAAQ,CAAC;wCACtC,MAAM,YAAY,aAAa,QAAQ,CAAC,eAAe,aAAa,QAAQ,CAAC;wCAC7E,MAAM,WACJ,aAAa,QAAQ,CAAC,yBAAyB,aAAa,QAAQ,CAAC;wCACvE,MAAM,SAAS,aAAa,QAAQ,CAAC,mBAAmB,aAAa,QAAQ,CAAC;wCAC9E,MAAM,gBAAgB,aAAa,QAAQ,CAAC;wCAC5C,MAAM,gBACJ,aAAa,QAAQ,CAAC,mBAAmB,aAAa,QAAQ,CAAC;wCACjE,MAAM,aAAa,aAAa,QAAQ,CAAC;wCACzC,MAAM,iBAAiB,aAAa,QAAQ,CAAC,mBAAmB,aAAa,QAAQ,CAAC;wCACtF,MAAM,OAAO,sBACX,8OAAC,iKAAc;4CAAC,WAAU;;;;;mDACxB,yBACF,8OAAC,iKAAc;4CAAC,WAAU;;;;;mDACxB,uBACF,8OAAC,6JAAU;4CAAC,WAAU;;;;;mDACpB,sBACF,8OAAC,2JAAQ;4CAAC,WAAU;;;;;mDAClB,8BACF,8OAAC,2JAAQ;4CAAC,WAAU;;;;;mDAClB,2BACF,8OAAC,2JAAQ;4CAAC,WAAU;;;;;mDAClB,+BACF,8OAAC,0JAAO;4CAAC,WAAU;;;;;mDACjB,yBACF,8OAAC,6JAAU;4CAAC,WAAU;;;;;mDACpB,wBACF,8OAAC,iKAAe;4CAAC,WAAU;;;;;mDACzB,0BACF,8OAAC,gKAAa;4CAAC,WAAU;;;;;mDACvB,yBACF,8OAAC,8JAAW;4CAAC,WAAU;;;;;mDACrB,uBACF,8OAAC,8JAAW;4CAAC,WAAU;;;;;mDACrB,8BACF,8OAAC,8JAAW;4CAAC,WAAU;;;;;mDACrB;wCACJ,MAAM,YAAY,WAAW,IAAI,IAAI;wCACrC,2EAA2E;wCAC3E,IAAI,4BAA+B,8OAAC;4CAAE,WAAU;sDAAkC;;;;;;wCAClF,IAAI,cAAc;4CAChB,MAAM,aACJ,OAAO,WAAW,GAAG,MAAM,OAAO,YAAY,GAAG,IAC7C,YAAY,IAAI,IAAI,YACpB;4CACN,MAAM,SAAS;4CACf,MAAM,MAAM,SAAS,OAAO,CAAC;4CAC7B,MAAM,OAAO,MAAM,CAAC,IAAI,WAAW,KAAK,CAAC,OAAO;4CAChD,4BACE,8OAAC;gDAAK,WAAU;;kEACd,8OAAC;wDAAE,MAAM,CAAC,SAAS,EAAE,WAAW,GAAG,EAAE;wDAAE,WAAU;kEAC9C,cAAc;;;;;;oDAEhB,CAAC,CAAC,EAAE,MAAM;;;;;;;wCAGjB;wCACA,MAAM,yBACJ,8OAAC,gNAAK,CAAC,QAAQ;;gDACZ;gDACA;8DACD,8OAAC;oDAEC,IAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE;oDACpB,WAAW,CAAC,yBAAyB,EAAE,YAAY,SAAS,QAAQ;8DAEpE,cAAA,8OAAC;wDACC,WAAW,CAAC,iFAAiF,EAAE,qBAAqB,IAAI,GAAG,GAAG,iBAAiB,eAAe;kEAE9J,cAAA,8OAAC;4DAAI,WAAU;;gEACZ;gEACA;;;;;;;;;;;;mDATA,CAAC,KAAK,EAAE,IAAI,GAAG,EAAE;;;;;;2CAJL,CAAC,KAAK,EAAE,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;wCAmB7C,IAAI,OAAO;4CACT,IAAI,SAAS,SAAS,YAAY;gDAChC,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;wDACZ;sEACD,8OAAC;4DAAI,WAAW,CAAC,0BAA0B,EAAE,YAAY,SAAS,IAAI;sEACpE,cAAA,8OAAC,4KAAY;gEACX,SAAQ;gEACR,OAAO,QAAQ,OAAO,IAAI;gEAC1B,MAAM,IAAI,KAAK,QAAQ,UAAU,IAAI,QAAQ,SAAS;gEACtD,QAAQ;oEACN,IAAI,CAAC,UAAU,wBAAwB;oEACvC,aAAa;gEACf;;;;;;;;;;;;mDAVe,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,IAAI,CAAC;;;;;4CAehD;4CACA,MAAM,WAAW,AAAC,IAA0C,UAAU;4CACtE,MAAM,gBACJ,AAAC,IAA+C,eAAe,IAAI,IAAI,OAAO,IAAI;4CACpF,MAAM,aAAa,AAAC,IAA4C,YAAY;4CAC5E,MAAM,OAAgB;gDACpB,KAAK,AAAC,IAAI,gBAAgB,IAA0B,OAAO,IAAI,GAAG;gDAClE,QAAQ,OAAO,IAAI,MAAM,IAAI;gDAC7B,QAAQ,IAAI,MAAM;gDAClB,SAAS;gDACT,MAAM;gDACN,WAAW,OAAO,IAAI,SAAS,KAAK,KAAK,GAAG;gDAC5C,YAAY,OAAO,aAAa,WAAW,WAAW;gDACtD,cAAc;gDACd,gBAAgB,AACd,IACA,cAAc;4CAClB;4CACA,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;oDACZ;kEACD,8OAAC;wDAAI,WAAW,CAAC,0BAA0B,EAAE,YAAY,SAAS,IAAI;kEACpE,cAAA,8OAAC,4KAAY;4DACX,SAAQ;4DACR,OAAO,iBAAiB;4DACxB,MACE,OAAO,aAAa,YAAY,WAC5B,IAAI,KAAK,YACT,IAAI,KAAK,OAAO,IAAI,SAAS,KAAK,KAAK,GAAG;4DAEhD,QAAQ;gEACN,IAAI,CAAC,UAAU,wBAAwB;gEACvC,aAAa;4DACf;;;;;;;;;;;;+CAde,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,WAAW,CAAC;;;;;wCAmBvD;wCACA,IAAI,SAAS,SAAS,cAAc,UAAU;4CAC5C,qBACE,8OAAC;gDAAqC,WAAU;0DAC9C,cAAA,8OAAC,4KAAY;oDACX,SAAQ;oDACR,OAAO,QAAQ,OAAO,IAAI;oDAC1B,MAAM,IAAI,KAAK,QAAQ,UAAU,IAAI,QAAQ,SAAS;oDACtD,YAAY,WAAW,IAAI;oDAC3B,cAAc,WAAW,MAAM;oDAC/B,MAAM;;;;;;+CAPA,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,OAAO,CAAC;;;;;wCAWxC;wCAEA,IAAI,SAAS,SAAS,cAAc,CAAC,UAAU,QAAQ,GAAG;4CACxD,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;oDACZ;kEACD,8OAAC;wDAAI,WAAU;kEACb,cAAA,8OAAC;4DACC,SAAS,IAAM,aAAa;4DAC5B,WAAU;sEACX;;;;;;;;;;;;+CANgB,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,SAAS,CAAC;;;;;wCAYrD;wCACA,IAAI,YAAY,UAAU,UAAU;4CAClC,MAAM,WAAW,AAAC,IAA0C,UAAU;4CACtE,MAAM,gBAAgB,AAAC,IAA+C,eAAe,IAAI;4CACzF,MAAM,aAAa,AAAC,IAA4C,YAAY;4CAC5E,IAAI,OAAO,aAAa,YAAY,eAAe;gDACjD,MAAM,OAAgB;oDACpB,KAAK,AAAC,IAAI,gBAAgB,IAA0B,OAAO,IAAI,GAAG;oDAClE,QAAQ,OAAO,IAAI,MAAM,IAAI;oDAC7B,QAAQ,IAAI,MAAM;oDAClB,SAAS;oDACT,MAAM;oDACN,WAAW,OAAO,IAAI,SAAS,KAAK,KAAK,GAAG;oDAC5C,YAAY;oDACZ,cAAc;oDACd,gBAAgB,AACd,IACA,cAAc;gDAClB;gDAEA,IAAI,UAAU;oDACZ,qBACE,8OAAC;wDAA4C,WAAU;kEACrD,cAAA,8OAAC,4KAAY;4DACX,SAAQ;4DACR,OAAO,iBAAiB;4DACxB,MAAM,IAAI,KAAK;4DACf,YAAY,WAAW,IAAI;4DAC3B,cAAc,WAAW,MAAM;4DAC/B,MAAM;;;;;;uDAPA,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,cAAc,CAAC;;;;;gDAW/C;gDAEA,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;wDACZ;sEACD,8OAAC;4DAAI,WAAW,CAAC,0BAA0B,EAAE,YAAY,SAAS,IAAI;sEACpE,cAAA,8OAAC;gEACC,SAAS,IAAM,aAAa;gEAC5B,WAAU;0EACX;;;;;;;;;;;;mDANgB,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,gBAAgB,CAAC;;;;;4CAY5D;wCACF;wCACA,IAAI,SAAS,SAAS,QAAQ;4CAC5B,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;oDACZ;kEACD,8OAAC;wDAAI,WAAU;kEACb,cAAA,8OAAC;4DACC,SAAS;gEACP,IAAI,CAAC,UAAU,wBAAwB;gEACvC,aAAa;4DACf;4DACA,WAAU;sEACX;;;;;;;;;;;;+CATgB,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;wCAejD;wCACA,OAAO;oCACT;oCAEA,IAAI,IAAI,IAAI,KAAK,YAAY;wCAC3B,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;gDACZ;8DACD,8OAAC;oDAAkB,IAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE;oDAAE,WAAU;8DACjD,cAAA,8OAAC;wDAAI,SAAS,IAAM,aAAa;kEAC/B,cAAA,8OAAC,4KAAY;4DACX,SAAQ;4DACR,OAAO,IAAI,OAAO,IAAI;4DACtB,MAAM,IAAI,KAAK,AAAC,IAA0C,UAAU,IAAI,IAAI,SAAS;4DACrF,YAAY,WAAW,IAAI;4DAC3B,cAAc,WAAW,MAAM;4DAC/B,MAAM;4DACN,aAAa,qBAAqB,IAAI,GAAG;;;;;;;;;;;mDATrC,IAAI,GAAG;;;;;;2CAFE,CAAC,SAAS,EAAE,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;oCAiBnD;oCAEA,IAAI,IAAI,IAAI,KAAK,QAAQ;wCACvB,MAAM,OAAO,OAAO,YAAY,GAAG;wCACnC,MAAM,UAAU,MAAM,OAAO,CAAC,IAAI,WAAW,IAAK,IAAI,WAAW,GAAgB,EAAE;wCACnF,MAAM,QAAS,IAAI,SAAS,IAAI,CAAC;wCACjC,MAAM,SAAS,CAAC,CAAC,IAAI,YAAY;wCACjC,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;gDACZ;8DACD,8OAAC;oDAEC,IAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE;oDACpB,WAAW,CAAC,yBAAyB,EAAE,YAAY,SAAS,QAAQ;8DAEpE,cAAA,8OAAC;wDACC,WAAW,CAAC,sDAAsD,EAAE,qBAAqB,IAAI,GAAG,GAAG,mCAAmC,4BAA4B;wDAClK,SAAS,IAAM,aAAa;;0EAE5B,8OAAC;gEAAI,WAAU;;kFACb,8OAAC;wEAAI,WAAU;kFACb,cAAA,8OAAC;4EAAE,WAAU;sFACV,IAAI,OAAO,IAAI,IAAI,YAAY,IAAI;;;;;;;;;;;kFAGxC,8OAAC;wEAAI,WAAU;kFAEb,cAAA,8OAAC;4EACC,SAAS,CAAC;gFACR,EAAE,eAAe;gFACjB,eAAe;4EACjB;4EACA,WAAU;sFAGT,IAAI,QAAQ,GAAG,YAAY;;;;;;;;;;;;;;;;;4DAKjC,wBACC,8OAAC;gEAAE,WAAU;;oEAA6B;oEAC3B;oEACZ,IAAI,KAAK,IAAI,YAAY,IAAI,IAAI,QAAQ,IAAI,IAAI,SAAS,EAAE,cAAc,CAAC;;;;;;;0EAGhF,8OAAC;gEAAI,WAAU;;kFACb,8OAAC;wEAAI,WAAU;kFACZ,IAAI,iBAAiB,iBACpB;;8FACE,8OAAC,+JAAY;oFAAC,WAAU;;;;;;8FACxB,8OAAC;8FAAK;;;;;;;yGAGR;;8FACE,8OAAC,gKAAa;oFAAC,WAAU;;;;;;8FACzB,8OAAC;8FAAK;;;;;;;;;;;;;oEAIX,IAAI,cAAc,kBACjB,8OAAC;wEAAI,WAAU;;0FACb,8OAAC,6JAAU;gFAAC,WAAU;;;;;;0FACtB,8OAAC;0FAAK;;;;;;;;;;;;oEAGT,IAAI,mBAAmB,kBACtB,8OAAC;wEAAI,WAAU;;0FACb,8OAAC,yJAAM;gFAAC,WAAU;;;;;;0FAClB,8OAAC;0FAAK;;;;;;;;;;;;oEAGT,IAAI,wBAAwB,kBAC3B,8OAAC;wEAAI,WAAU;;0FACb,8OAAC,+JAAY;gFAAC,WAAU;;;;;;0FACxB,8OAAC;0FAAK;;;;;;;;;;;;;;;;;;0EAIZ,8OAAC;gEACC,SAAS,IAAM,aAAa;gEAC5B,WAAU;0EAET,CAAC;oEACA,MAAM,UAAU,IAAI;oEACpB,IAAI,aAAa;oEACjB,IAAI,WAAW;oEACf,CAAC,IAAI,WAAW,IAAI,EAAE,EAAE,OAAO,CAAC,CAAC;wEAC/B,MAAM,MAAM,MAAM,OAAO,CAAC,KAAK,CAAC,IAAI,IAAK,KAAK,CAAC,IAAI,GAAgB,EAAE;wEACrE,cAAc,IAAI,MAAM;wEACxB,IAAI,OAAO,CAAC,CAAC,KAAO,QAAQ,GAAG,CAAC,OAAO;wEACvC,IAAI,IAAI,QAAQ,CAAC,OAAO,WAAW;oEACrC;oEACA,MAAM,cAAc,CAAC,CAAC,IAAI,wBAAwB,IAAI,CAAC,QAAQ;oEAC/D,IAAI,CAAC,aAAa,OAAO;oEAEzB,IAAI,IAAI,cAAc,EAAE;wEACtB,OAAO,GAAG,WAAW,eAAe,CAAC;oEACvC;oEACA,OAAO,GAAG,QAAQ,IAAI,CAAC,kBAAkB,EAAE,WAAW,eAAe,CAAC;gEACxE,CAAC;;;;;;0EAEH,8OAAC;gEAAI,WAAU;0EACZ,CAAC;oEACA,MAAM,aAAa,QAAQ,MAAM,CAAC,CAAC,KAAK;wEACtC,MAAM,MAAM,MAAM,OAAO,CAAC,KAAK,CAAC,IAAI,IAAK,KAAK,CAAC,IAAI,GAAgB,EAAE;wEACrE,OAAO,MAAM,IAAI,MAAM;oEACzB,GAAG;oEACH,MAAM,WAAW,QAAQ,IAAI,CAAC,CAAC;wEAC7B,MAAM,MAAM,MAAM,OAAO,CAAC,KAAK,CAAC,IAAI,IAAK,KAAK,CAAC,IAAI,GAAgB,EAAE;wEACrE,OAAO,IAAI,QAAQ,CAAC;oEACtB;oEACA,MAAM,cAAc,CAAC,CAAC,IAAI,wBAAwB,IAAI,CAAC,QAAQ;oEAE/D,OAAO,QAAQ,GAAG,CAAC,CAAC,KAAK;wEACvB,MAAM,MAAM,MAAM,OAAO,CAAC,KAAK,CAAC,IAAI,IAAK,KAAK,CAAC,IAAI,GAAgB,EAAE;wEACrE,MAAM,QAAQ,IAAI,MAAM;wEACxB,MAAM,QAAQ,IAAI,QAAQ,CAAC;wEAC3B,MAAM,UAAU,eAAe,aAAa,IAAI,AAAC,QAAQ,aAAc,MAAM;wEAE7E,qBACE,8OAAC;4EAEC,SAAS,CAAC;gFACR,EAAE,eAAe;gFACjB,IAAI,CAAC,UAAU,wBAAwB;gFACvC,aAAa;4EACf;4EACA,WAAW,CAAC;;kCAElB,CAAC;;8FAEK,8OAAC;oFACC,WAAW,CAAC,oEAAoE,EAAE,QAAQ,gBAAgB,eAAe;oFACzH,OAAO;wFAAE,OAAO,GAAG,QAAQ,CAAC,CAAC;oFAAC;;;;;;8FAEhC,8OAAC;oFAAI,WAAU;;sGACb,8OAAC;4FAAK,WAAU;sGAAwB;;;;;;sGACxC,8OAAC;4FAAK,WAAU;sGAAW,cAAc,QAAQ;;;;;;;;;;;;;2EAhB9C,GAAG,OAAO,IAAI,GAAG,EAAE,CAAC,EAAE,KAAK;;;;;oEAoBtC;gEACF,CAAC;;;;;;0EAEH,8OAAC;gEAAI,WAAU;0EACb,cAAA,8OAAC;oEACC,SAAS;wEACP,IAAI,CAAC,UAAU,wBAAwB;wEACvC,aAAa;oEACf;oEACA,WAAU;8EAET,SAAS,iBAAiB;;;;;;;;;;;;;;;;;mDA9I5B,IAAI,GAAG;;;;;;2CAHK,CAAC,KAAK,EAAE,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;oCA0J/C;oCAEA,MAAM,aAAa,YAAY,GAAG,CAAC,WAAW,GAAG,KAAK,WAAW,IAAI;oCAErE,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;4CACZ;4CACA;0DACD,8OAAC;gDAEC,IAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE;gDACpB,eAAe,CAAC;oDACd,EAAE,cAAc;oDAChB,cAAc,GAAG;gDACnB;gDACA,WAAW,CAAC;;;kBAGpB,EAAE,OAAO,6BAA6B,mBAAmB;kBACzD,EAAE,YAAY,SAAS,OAAO;kBAC9B,EAAE,YAAY,SAAS,GAAG;kBAC1B,EAAE,qBAAqB,IAAI,GAAG,GAAG,4BAA4B,GAAG;gBAClE,CAAC;;oDAGU,CAAC,sBACA,8OAAC;wDAAI,WAAW,GAAG,YAAY,cAAc,GAAG,cAAc,CAAC;kEAC5D,WAAW,MAAM,iBAChB,8OAAC;4DAAI,WAAU;sEACb,cAAA,8OAAC,wIAAK;gEACJ,OAAO;gEACP,QAAQ;gEACR,KAAK,IAAA,oIAAW,EAAC,WAAW,MAAM;gEAClC,KAAK,WAAW,IAAI;gEACpB,WAAU;;;;;;;;;;iFAId,8OAAC;4DAAI,WAAU;sEACb,cAAA,8OAAC,wIAAK;gEACJ,KAAI;gEACJ,KAAK,WAAW,IAAI,IAAI;gEACxB,OAAO;gEACP,QAAQ;gEACR,WAAU;;;;;;;;;;;;;;;;kEAQpB,8OAAC;wDAAI,WAAW,CAAC,sBAAsB,EAAE,OAAO,cAAc,eAAe;;4DAC1E,YAAY,CAAC,4BACZ,8OAAC;gEACC,WAAU;gEACV,SAAS,IAAM,sBAAsB,CAAC,OAAU,SAAS,IAAI,GAAG,GAAG,OAAO,IAAI,GAAG;0EAEhF,uBAAuB,IAAI,GAAG,iBAAG,8OAAC;8EAAE;;;;;yFAAmB,8OAAC;8EAAE;;;;;;;;;;;4DAI9D,gBACC,CAAC;gEACC,MAAM,MAAM,OAAO,aAAa,OAAO,IAAI,aAAa,UAAU,IAAI;gEACtE,MAAM,QACJ,aAAa,IAAI,KAAK,WACtB,IAAA,oIAAW,EAAC,aAAa,QAAQ,KACjC,IAAA,oIAAW,EAAC;gEACd,MAAM,QACJ,aAAa,IAAI,KAAK,WACtB,2CAA2C,IAAI,CAC7C,OAAO,aAAa,QAAQ,IAAI,OAAO;gEAE3C,MAAM,QAAQ,aAAa,UAAU,GACjC,2BACA,aAAa,IAAI,KAAK,SACpB,aAAa,QAAQ,IAAI,WACzB,aAAa,IAAI,KAAK,UACpB,UACA,aAAa,IAAI,KAAK,UACpB,YACA,aAAa,IAAI,KAAK,YACpB,cACA,aAAa,IAAI,KAAK,aACpB,aAAa,OAAO,IAAI,eACxB,aAAa,OAAO,IAAI;gEACtC,qBACE,8OAAC;oEACC,SAAS,IAAM,gBAAgB,aAAa,GAAG;oEAC/C,WAAU;;sFAEV,8OAAC;4EAAE,WAAU;sFACV,IAAI,kBAAkB,IAAI;;;;;;sFAE7B,8OAAC;4EAAI,WAAU;;gFACZ,CAAC,aAAa,UAAU,IACvB,CAAC,SAAS,KAAK,KACf,CAAC,sBACC,8OAAC,wIAAK;oFACJ,KAAK,IAAA,oIAAW,EAAC;oFACjB,KAAI;oFACJ,OAAO;oFACP,QAAQ;oFACR,WAAU;oFACV,aAAa,OAAO,KAAK,QAAQ,CAAC;;;;;yGAGpC,8OAAC;oFAAI,WAAU;;sGACb,8OAAC;4FACC,KAAK,IAAA,oIAAW,EAAC;4FACjB,WAAU;4FACV,KAAK;4FACL,WAAW;4FACX,SAAQ;;;;;;sGAEV,8OAAC;4FAAI,WAAU;sGACb,cAAA,8OAAC;gGAAI,WAAU;0GACb,cAAA,8OAAC;oGAAI,SAAQ;oGAAY,WAAU;8GACjC,cAAA,8OAAC;wGAAK,GAAE;wGAAgB,MAAK;;;;;;;;;;;;;;;;;;;;;;;;;;wFAKtC;8FACH,8OAAC;oFAAE,WAAU;8FAA0B;;;;;;;;;;;;;;;;;;4DAI/C,CAAC;0EAGH,8OAAC;gEACC,WAAW,CAAC;8DACoB,EAC1C,CAAC,cAAc,IAAI,IAAI,KAAK,UAAU,iBAAiB,CAAC,WACpD,sCACA,oCACL;kBACD,EACE,CAAC,cACD,CAAC,WACC,IAAI,IAAI,KAAK,aACb,IAAI,IAAI,KAAK,UACb,IAAI,IAAI,KAAK,WACb,IAAI,IAAI,KAAK,SAAS,IACpB,gCACA,OACE,2BACA,0BACP;sBACG,EAAE,CAAC,aAAa,OAAO,kBAAkB,GAAG;sBAC5C,EAAE,CAAC,aAAa,CAAC,OAAO,kBAAkB,GAAG;sBAC7C,EAAE,aAAa,qGAAqG,GAAG;sBACvH,EAAE,CAAC,cAAc,CAAC,WAAW,IAAI,IAAI,KAAK,aAAa,IAAI,IAAI,KAAK,UAAU,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,SAAS,IAAI,uBAAuB,GAAG;oBAC5J,EAAE,CAAC,cAAc,IAAI,IAAI,KAAK,UAAU,SAAS,GAAG;oBACpD,EAAE,CAAC,cAAc,IAAI,IAAI,KAAK,SAAS,SAAS,GAAG;2BAC5C,EAAE,eAAe,SAAS,GAAG;kBACtC,EAAE,aAAa,WAAW,OAAO,YAAY,OAAO,CAAC,GAAG,MAAM,OAAO,IAAI,GAAG,IAAI,aAAa,GAAG;kBAChG,EAAE,sBAAsB,IAAI,GAAG,GAAG,sCAAsC,GAAG;kBAC3E,CAAC;gEACW,OACE,YAAY,WAAW,EAAE,KAAK,IAAI,GAAG,GACjC;oEAAE,WAAW,CAAC,WAAW,EAAE,KAAK,GAAG,CAAC,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK,WAAW,EAAE,GAAG,GAAG,CAAC;gEAAC,IAC7E;gEAEN,SAAS;oEACP,iBAAiB,CAAC,OAAU,SAAS,IAAI,GAAG,GAAG,OAAO,IAAI,GAAG;oEAC7D,gBAAgB,IAAI,GAAG;oEACvB,kBAAkB;gEACpB;gEACA,cAAc,CAAC;oEACb,IAAI;wEACF,IAAI,YAAY;wEAChB,sBAAsB,OAAO,GAAG;wEAChC,IAAI,kBAAkB,OAAO,IAAI,MAAM;4EACrC,aAAa,kBAAkB,OAAO;4EACtC,kBAAkB,OAAO,GAAG;wEAC9B;wEACA,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,EAAE;wEACnC,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;wEAC3B,MAAM,KAAK,IAAI,EAAE,OAAO,GAAG;wEAC3B,MAAM,KAAK,EAAE,aAAa;wEAC1B,cAAc,OAAO,GAAG;4EAAE,GAAG;4EAAI,GAAG;4EAAI,IAAI,IAAI,GAAG;4EAAE;wEAAK;wEAC1D,cAAc;4EAAE,IAAI;4EAAM,IAAI;wEAAE;wEAChC,qBAAqB,IAAI,GAAG;wEAC5B,kBAAkB,OAAO,GAAG,OAAO,UAAU,CAAC;4EAC5C,sBAAsB,OAAO,GAAG;4EAChC,gBAAgB,IAAI,GAAG;4EACvB,kBAAkB;4EAClB,IAAI,YAAY,IAAI,IAAI,KAAK,QAAQ;gFACnC,qBAAqB,IAAI,GAAG;4EAC9B;4EACA,oBAAoB,KAAK,IAAI,IAAI;wEACnC,GAAG;oEACL,EAAE,OAAM,CAAC;gEACX;gEACA,YAAY,CAAC;oEACX,IAAI;wEACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;4EACrC,aAAa,kBAAkB,OAAO;4EACtC,kBAAkB,OAAO,GAAG;wEAC9B;wEACA,qBAAqB;wEACrB,IAAI,sBAAsB,OAAO,EAAE;4EACjC,EAAE,cAAc;4EAChB,EAAE,eAAe;wEACnB;wEACA,IAAI,YAAY,cAAc,OAAO,CAAC,EAAE,KAAK,IAAI,GAAG,EAAE;4EACpD,MAAM,QAAQ,cAAc,OAAO,CAAC,IAAI,GAAG,WAAW,EAAE,GAAG,CAAC,KAAK,WAAW,EAAE,GAAG;4EACjF,IAAI,OAAO;gFACT,iBAAiB;4EACnB;4EACA,cAAc;gFAAE,IAAI;gFAAM,IAAI;4EAAE;4EAChC,cAAc,OAAO,GAAG;gFAAE,GAAG;gFAAG,GAAG;gFAAG,IAAI;gFAAM,MAAM;4EAAM;wEAC9D;oEACF,EAAE,OAAM,CAAC;gEACX;gEACA,aAAa,CAAC;oEACZ,IAAI;wEACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;4EACrC,aAAa,kBAAkB,OAAO;4EACtC,kBAAkB,OAAO,GAAG;wEAC9B;wEACA,qBAAqB;wEACrB,IAAI,CAAC,UAAU;wEACf,MAAM,IAAI,EAAE,OAAO,IAAI,EAAE,OAAO,CAAC,EAAE;wEACnC,MAAM,IAAI,IAAI,EAAE,OAAO,GAAG;wEAC1B,MAAM,IAAI,IAAI,EAAE,OAAO,GAAG;wEAC1B,MAAM,KAAK,IAAI,cAAc,OAAO,CAAC,CAAC;wEACtC,MAAM,KAAK,IAAI,cAAc,OAAO,CAAC,CAAC;wEACtC,IAAI,cAAc,OAAO,CAAC,EAAE,KAAK,IAAI,GAAG,EAAE;4EACxC,MAAM,aAAa,KAAK,GAAG,CAAC,MAAM,KAAK,KAAK,GAAG,CAAC,MAAM;4EACtD,IAAI,YAAY;gFACd,MAAM,QAAQ,cAAc,OAAO,CAAC,IAAI,GAAG,KAAK,IAAI,KAAK;gFACzD,cAAc;oFAAE,IAAI,IAAI,GAAG;oFAAE,IAAI,QAAQ,KAAK;gFAAE;gFAChD,EAAE,cAAc;4EAClB;wEACF;oEACF,EAAE,OAAM,CAAC;gEACX;gEACA,eAAe;oEACb,IAAI;wEACF,IAAI,kBAAkB,OAAO,IAAI,MAAM;4EACrC,aAAa,kBAAkB,OAAO;4EACtC,kBAAkB,OAAO,GAAG;wEAC9B;wEACA,qBAAqB;wEACrB,IAAI,YAAY,cAAc,OAAO,CAAC,EAAE,KAAK,IAAI,GAAG,EAAE;4EACpD,cAAc;gFAAE,IAAI;gFAAM,IAAI;4EAAE;4EAChC,cAAc,OAAO,GAAG;gFAAE,GAAG;gFAAG,GAAG;gFAAG,IAAI;gFAAM,MAAM;4EAAM;wEAC9D;oEACF,EAAE,OAAM,CAAC;gEACX;;oEAEC,CAAC,4BACA;;4EACG,CAAC,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,OAAO,mBAC5C,8OAAC;gFACC,SAAS,CAAC;oFACR,EAAE,cAAc;oFAChB,eAAe;gFACjB;gFACA,WAAW,CAAC,yGAAyG,EAAE,OAAO,oBAAoB,iBAAiB,gCAAgC,CAAC;gFACpM,cAAW;gFACX,OAAM;0FAEN,cAAA,8OAAC,sJAAc;oFAAC,WAAU;;;;;;;;;;;4EAG7B,YAAY,WAAW,EAAE,KAAK,IAAI,GAAG,kBACpC,8OAAC;gFACC,WAAW,CAAC,kCAAkC,EAAE,OAAO,mBAAmB,mBAAmB;gFAC7F,OAAO;oFAAE,SAAS,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,WAAW,EAAE,IAAI,IAAI;gFAAG;0FAE5D,cAAA,8OAAC;oFAAI,WAAU;8FACZ,qBACC,8OAAC,mKAAgB;wFAAC,WAAU;;;;;6GAE5B,8OAAC,oKAAiB;wFAAC,WAAU;;;;;;;;;;;;;;;;4EAKpC,CAAC,0BACA;;kGACE,8OAAC;wFACC,SAAS,CAAC;4FACR,EAAE,cAAc;4FAChB,cAAc,GAAG;wFACnB;wFACA,WAAW,CAAC,6GAA6G,EAAE,OAAO,qBAAqB,kBAAkB,4FAA4F,CAAC;wFACtQ,cAAW;wFACX,OAAM;kGAEN,cAAA,8OAAC,qKAAkB;4FAAC,WAAU;;;;;;;;;;;kGAEhC,8OAAC,8KAAc;wFACb,QAAQ;wFACR,SAAS,iBAAiB,IAAI,GAAG;wFACjC,QAAQ,CAAC;4FACP,mBAAmB,KAAK;4FACxB,gBAAgB;wFAClB;wFACA,WAAW,CAAC,mCAAmC,EAAE,OAAO,qBAAqB,kBAAkB,CAAC,EAAE,iBAAiB,IAAI,GAAG,GAAG,oCAAoC,8FAA8F,gCAAgC,CAAC;;;;;;;;;;oEAOzS,CAAC,4BACA;;4EACG,CAAC;gFACA,MAAM,QAAQ,OAAO,OAAO,CAAC,WAC1B,GAAG,CAAC,CAAC,CAAC,OAAO,IAAI,GAAK,CAAC;wFACtB;wFACA,OAAO,CAAC,OAAO,EAAE,EAAE,MAAM;wFACzB,MAAM,CAAC,OAAO,EAAE,EAAE,QAAQ,CAAC;wFAC3B,OAAO,CAAC,OAAO,EAAE,EAAE,GAAG,CAAC,CAAC,KAAO,YAAY,GAAG,CAAC,OAAO,QAAQ;oFAChE,CAAC,GACA,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,GAAG,GACxB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK;gFAEnC,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;gFAE/B,qBACE,8OAAC;oFACC,WAAW,CAAC;2CACT,EAAE,OAAO,kBAAkB,eAAe;;;gCAGrD,CAAC;;sGAEO,8OAAC;4FAAI,WAAU;;gGACZ,MAAM,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,IAAI,oBAC1B,8OAAC;wGAEC,SAAS,CAAC;4GACR,EAAE,eAAe;4GACjB,kBACE,gBAAgB,UAAU,IAAI,GAAG,IAC/B,gBAAgB,UAAU,GAAG,KAAK,GAChC,OACA;gHAAE,OAAO,IAAI,GAAG;gHAAE,OAAO,GAAG,KAAK;4GAAC;wGAE1C;wGACA,WAAW,CAAC;;;0CAGhB,EAAE,GAAG,IAAI,GAAG,eAAe,iBAAiB;wCAC9C,CAAC;wGACK,OAAO,GAAG,GAAG,KAAK,CAAC,MAAM,CAAC;;0HAE1B,8OAAC;gHAAK,WAAU;0HAAwB,GAAG,KAAK;;;;;;4GAC/C,GAAG,KAAK,GAAG,mBACV,8OAAC;gHACC,WAAW,CAAC,oBAAoB,EAAE,GAAG,IAAI,GAAG,kBAAkB,iBAAiB;0HAE9E,GAAG,KAAK;;;;;;;uGAtBR,GAAG,IAAI,GAAG,CAAC,OAAO,EAAE,KAAK;;;;;gGA2BjC,MAAM,MAAM,GAAG,mBACd,8OAAC;oGAAI,WAAU;;wGAAyC;wGACpD,MAAM,MAAM,GAAG;;;;;;;;;;;;;sGAKvB,8OAAC;4FAAI,WAAU;;;;;;;;;;;;4EAGrB,CAAC;4EAEA,kBAAkB,eAAe,KAAK,KAAK,IAAI,GAAG,kBACjD;;kGACE,8OAAC;wFAAI,WAAU;wFAAqB,SAAS,IAAM,kBAAkB;;;;;;kGAErE,8OAAC;wFACC,KAAK,CAAC;4FACJ,IAAI,MAAM,eAAe,KAAK,KAAK,IAAI,GAAG,EAAE;gGAC1C,MAAM,OAAO,GAAG,aAAa,EAAE;gGAC/B,IAAI,MAAM;oGACR,MAAM,aAAa,OAAO,WAAW,GAAG,KAAK,MAAM;oGACnD,MAAM,aAAa,KAAK,GAAG;oGAC3B,MAAM,gBAAgB;oGAEtB,IAAI,aAAa,iBAAiB,aAAa,YAAY;wGACzD,GAAG,KAAK,CAAC,MAAM,GAAG;wGAClB,GAAG,KAAK,CAAC,GAAG,GAAG;wGACf,GAAG,KAAK,CAAC,YAAY,GAAG;wGACxB,GAAG,KAAK,CAAC,SAAS,GAAG;oGACvB,OAAO;wGACL,GAAG,KAAK,CAAC,GAAG,GAAG;wGACf,GAAG,KAAK,CAAC,MAAM,GAAG;wGAClB,GAAG,KAAK,CAAC,SAAS,GAAG;wGACrB,GAAG,KAAK,CAAC,YAAY,GAAG;oGAC1B;gGACF;4FACF;wFACF;wFACA,WAAW,CAAC;6CACP,EAAE,OAAO,YAAY,SAAS;;kCAEzC,CAAC;kGAEM,CAAC;4FACA,MAAM,QAAQ,CAAC,SAAS,CAAC,eAAe,KAAK,CAAC,IAAI,EAAE,EAAE,GAAG,CACvD,CAAC,KAAO,YAAY,GAAG,CAAC,OAAO,QAAQ,OAAO;4FAGhD,qBACE,8OAAC;gGAAI,WAAU;;kHACb,8OAAC;wGAAI,WAAU;;0HACb,8OAAC;gHAAK,WAAU;0HAAY,eAAe,KAAK;;;;;;0HAChD,8OAAC;gHAAK,WAAU;;oHACb,MAAM,MAAM;oHAAC;;;;;;;;;;;;;oGAGjB,MAAM,MAAM,GAAG,kBACd,8OAAC;wGAAG,WAAU;kHACX,MAAM,GAAG,CAAC,CAAC,MAAM,oBAChB,8OAAC;gHAEC,WAAU;0HAET;+GAHI,GAAG,IAAI,GAAG,CAAC,MAAM,EAAE,KAAK;;;;;;;;;6HAQnC,8OAAC;wGAAI,WAAU;kHAA6B;;;;;;;;;;;;wFAIpD,CAAC;;;;;;;;;;oEAOV,WAAW,CAAC,aAAa,CAAC,cAAc,CAAC,sBACxC,8OAAC;wEACC,WAAW,CAAC,sBAAsB,EAAE,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,SAAS,4CAA4C,OAAO,CAAC,EAAE,OAAO,kBAAkB,iBAAiB;kFAEzM;;;;;;oEAKJ,IAAI,IAAI,KAAK,UAAU,CAAC,cAAc,CAAC,2BACtC,8OAAC;wEACC,WAAW,CAAC,yBAAyB,EACnC,iBAAiB,CAAC,WAAW,uBAAuB,iBACrD,0EAA0E,CAAC;wEAC5E,OACE,YACA,aAAa,WACb,OAAO,YAAY,OAAO,CAAC,GAAG,MAAM,OAAO,IAAI,GAAG,KAClD,sBAAsB,IAAI,GAAG,GACzB;4EAAE,WAAW;4EAA2B,UAAU;wEAAS,IAC3D;;4EAGL,qBAAqB,IAAI,OAAO,IAAI,IAAI,IAAI,QAAQ,EAAE;4EACtD,YACC,aAAa,WACb,OAAO,YAAY,OAAO,CAAC,GAAG,MAAM,OAAO,IAAI,GAAG,KAClD,sBAAsB,IAAI,GAAG,kBAC3B,8OAAC;gFAAI,WAAU;;kGACb,8OAAC;wFAAI,WAAU;;;;;;kGACf,8OAAC;wFACC,SAAS;4FACP,qBAAqB;4FACrB,IAAI;gGACF,SAAS,aAAa,CAAC,IAAI,WAAW,aAAa;oGAAE,SAAS;gGAAK;4FACrE,EAAE,OAAM,CAAC;wFACX;wFACA,WAAU;kGACX;;;;;;;;;;;;4EAKN,CAAC;gFACA,MAAM,YAAY,CAAC,IAAI,OAAO,IAAI,EAAE,EAAE,KAAK,CAAC;gFAC5C,IAAI,CAAC,WAAW,OAAO;gFACvB,MAAM,MAAM,SAAS,CAAC,EAAE;gFACxB,MAAM,OAAO,IAAI,UAAU,CAAC,UAAU,MAAM,CAAC,QAAQ,EAAE,KAAK;gFAC5D,MAAM,WAAW,CAAC;oFAChB,IAAI;wFACF,OAAO,IAAI,IAAI,MAAM,QAAQ,CAAC,OAAO,CAAC,QAAQ;oFAChD,EAAE,OAAM;wFACN,OAAO;oFACT;gFACF,CAAC;gFACD,qBACE,8OAAC;oFACC,WAAW,CAAC,uBAAuB,EAAE,OAAO,oBAAoB,kBAAkB,yBAAyB,CAAC;8FAE5G,cAAA,8OAAC;wFACC,SAAS,IAAM,OAAO,IAAI,CAAC,MAAM;wFACjC,WAAU;;0GAEV,8OAAC;gGAAI,WAAU;0GACb,cAAA,8OAAC,wJAAM;oGAAC,WAAU;;;;;;;;;;;0GAEpB,8OAAC;gGAAI,WAAU;;kHACb,8OAAC;wGAAE,WAAU;kHAAkD;;;;;;kHAC/D,8OAAC;wGAAE,WAAU;kHAAgC;;;;;;;;;;;;;;;;;;;;;;;4EAKvD,CAAC;;;;;;;oEAIJ,IAAI,IAAI,KAAK,UAAU,CAAC,cAAc,2BACrC,8OAAC;wEAAI,WAAU;;0FACb,8OAAC;gFACC,OAAO,OAAO,gBAAgB,WAAW,cAAc,IAAI,OAAO,IAAI;gFACtE,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;gFAChD,WAAW,CAAC,6BAA6B,EAAE,OAAO,mBAAmB,kBAAkB;gFACvF,MAAM;;;;;;0FAER,8OAAC;gFAAI,WAAW,CAAC,gBAAgB,EAAE,OAAO,gBAAgB,iBAAiB;;kGACzE,8OAAC;wFACC,SAAS;4FACP,sBAAsB;4FACtB,iBAAiB;wFACnB;wFACA,WAAU;kGACX;;;;;;kGAGD,8OAAC;wFACC,SAAS;4FACP,MAAM,UACJ,OAAO,gBAAgB,WAAW,cAAc,IAAI,OAAO,IAAI;4FACjE,aAAa,IAAI,GAAG,EAAE;wFACxB;wFACA,WAAU;kGACX;;;;;;;;;;;;;;;;;;oEAON,IAAI,IAAI,KAAK,aAAa,CAAC,4BAC1B,8OAAC;wEACC,eAAe,OAAO,YAAY,GAAG,IAAI;wEACzC,SACE,AACE,IAQA,WAAW;;;;;;oEAMlB,IAAI,IAAI,KAAK,WAAW,IAAI,OAAO,IAAI,CAAC,4BACvC,8OAAC;wEACC,WAAU;wEACV,SAAS,IAAM,CAAC,eAAe,YAAY,OAAO,IAAI,OAAO,GAAG;wEAChE,OAAO;4EAAE,oBAAoB;wEAAO;;4EAEnC,OAAO,IAAI,OAAO,EAAE,UAAU,CAAC,yBAC9B,8OAAC,wIAAK;gFACJ,OAAO;gFACP,QAAQ;gFACR,KAAK,OAAO,IAAI,OAAO;gFACvB,KAAI;gFACJ,WAAU;gFACV,WAAW;;;;;qGAGb,8OAAC,wIAAK;gFACJ,KAAK,IAAA,oIAAW,EAAC,IAAI,OAAO;gFAC5B,KAAI;gFACJ,OAAO;gFACP,QAAQ;gFACR,WAAU;gFACV,aAAa,OAAO,IAAI,OAAO,EAAE,QAAQ,CAAC;gFAC1C,WAAW;;;;;;4EAId,6BACC,8OAAC;gFAAI,WAAU;0FACZ,CAAC;oFACA,MAAM,OAAO;oFACb,MAAM,SAAS;oFACf,MAAM,IAAI,CAAC,OAAO,MAAM,IAAI;oFAC5B,MAAM,IAAI,IAAI,KAAK,EAAE,GAAG;oFACxB,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,OAAO,kBAAkB;oFAC7D,qBACE,8OAAC;wFAAI,WAAU;kGACb,cAAA,8OAAC;4FAAI,OAAO;4FAAM,QAAQ;4FAAM,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,MAAM;;8GAC5D,8OAAC;oGACC,IAAI,OAAO;oGACX,IAAI,OAAO;oGACX,GAAG;oGACH,QAAO;oGACP,aAAa;oGACb,MAAK;;;;;;8GAEP,8OAAC;oGACC,IAAI,OAAO;oGACX,IAAI,OAAO;oGACX,GAAG;oGACH,QAAO;oGACP,aAAa;oGACb,MAAK;oGACL,iBAAiB;oGACjB,kBAAkB,IAAI,AAAC,IAAI,MAAO;oGAClC,eAAc;oGACd,WAAW,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;;;;;;;;;;;;;;;;;gFAM1D,CAAC;;;;;;;;;;;;oEAKR,IAAI,IAAI,KAAK,WAAW,CAAC,cAAc,IAAI,OAAO,kBACjD,8OAAC;wEAAI,WAAW,CAAC,+CAA+C,CAAC;kFAC9D,qBAAqB,IAAI,OAAO,IAAI,IAAI,IAAI,QAAQ,EAAE;;;;;;oEAK1D,WAAW,IAAI,OAAO,IAAI,CAAC,4BAC1B,8OAAC;wEACC,WAAU;wEACV,SAAS,IAAM,CAAC,eAAe,YAAY,OAAO,IAAI,OAAO,GAAI;wEACjE,OAAO;4EAAE,oBAAoB;wEAAO;;0FAEpC,8OAAC;gFACC,KAAK,IAAA,oIAAW,EAAC,IAAI,OAAO;gFAC5B,WAAU;gFACV,WAAW;gFACX,SAAQ;;;;;;0FAIV,8OAAC;gFAAI,WAAU;0FACb,cAAA,8OAAC;oFAAI,WAAU;8FACb,cAAA,8OAAC,yJAAM;wFAAC,WAAU;;;;;;;;;;;;;;;;4EAIrB,6BACC,8OAAC;gFAAI,WAAU;0FACZ,mBAAmB,0BAClB;;wFAAG,KAAK,KAAK,CAAC;wFAAgB;;iHAE9B,8OAAC;oFAAI,WAAU;;;;;;;;;;;;;;;;;oEAOxB,WAAW,CAAC,cAAc,IAAI,OAAO,kBACpC,8OAAC;wEAAI,WAAW,CAAC,+CAA+C,CAAC;kFAC9D,qBAAqB,IAAI,OAAO,IAAI,IAAI,IAAI,QAAQ,EAAE;;;;;;oEAK1D,IAAI,IAAI,KAAK,UAAU,IAAI,OAAO,IAAI,CAAC,WAAW,CAAC,4BAClD,8OAAC;wEACC,MAAM,IAAA,oIAAW,EAAC,IAAI,OAAO,EAAE;wEAC/B,UAAU,IAAI,QAAQ,IAAI;wEAC1B,QAAO;wEACP,KAAI;wEACJ,WAAU;wEACV,SAAS,CAAC;4EACR,IAAI,aAAa,EAAE,cAAc;wEACnC;wEACA,iBAAe,cAAc,OAAO;wEACpC,WAAW;wEACX,OAAO;4EAAE,oBAAoB;wEAAO;;0FAEpC,8OAAC;gFAAI,WAAU;0FACb,cAAA,8OAAC,wKAAqB;oFAAC,WAAU;;;;;;;;;;;0FAGnC,8OAAC;gFAAI,WAAU;;kGACb,8OAAC;wFAAE,WAAU;kGACV,IAAI,QAAQ,IAAI;;;;;;kGAEnB,8OAAC;wFAAE,WAAU;kGAAiC;;;;;;;;;;;;4EAE/C,6BACC,8OAAC;gFAAI,WAAU;0FACZ,CAAC;oFACA,MAAM,OAAO;oFACb,MAAM,SAAS;oFACf,MAAM,IAAI,CAAC,OAAO,MAAM,IAAI;oFAC5B,MAAM,IAAI,IAAI,KAAK,EAAE,GAAG;oFACxB,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,OAAO,kBAAkB;oFAC7D,qBACE,8OAAC;wFAAI,WAAU;;0GACb,8OAAC;gGAAI,OAAO;gGAAM,QAAQ;gGAAM,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,MAAM;;kHAC5D,8OAAC;wGACC,IAAI,OAAO;wGACX,IAAI,OAAO;wGACX,GAAG;wGACH,QAAO;wGACP,aAAa;wGACb,MAAK;;;;;;kHAEP,8OAAC;wGACC,IAAI,OAAO;wGACX,IAAI,OAAO;wGACX,GAAG;wGACH,QAAO;wGACP,aAAa;wGACb,MAAK;wGACL,iBAAiB;wGACjB,kBAAkB,IAAI,AAAC,IAAI,MAAO;wGAClC,eAAc;wGACd,WAAW,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;;;;;;;;;;;;0GAGpD,8OAAC;gGAAK,WAAU;;oGAA8B,KAAK,KAAK,CAAC;oGAAG;;;;;;;;;;;;;gFAGlE,CAAC;;;;;;;;;;;;oEAKR,IAAI,IAAI,KAAK,UAAU,CAAC,cAAc,IAAI,OAAO,kBAChD,8OAAC;wEAAI,WAAW,CAAC,+CAA+C,CAAC;kFAC9D,qBAAqB,IAAI,OAAO,IAAI,IAAI,IAAI,QAAQ,EAAE;;;;;;oEAI1D,4BAAc,8OAAC;wEAAE,WAAU;kFAA4B;;;;;;oEAGvD,YAAY,CAAC,cAAc,IAAI,eAAe,kBAC7C,8OAAC;wEAAI,WAAU;kFACZ,uBAAuB,IAAI,GAAG,kBAC7B,8OAAC;4EAAI,WAAU;sFACb,cAAA,8OAAC;gFACC,WAAW,CAAC,qDAAqD,EAAE,OAAO,aAAa,IAAI;0FAE1F,IAAI,eAAe;;;;;;;;;;;;;;;;oEAM7B,8BACC,8OAAC;wEAAI,WAAW,CAAC,aAAa,EAAE,OAAO,kBAAkB,iBAAiB;kFACxE,cAAA,8OAAC;4EACC,WACE,IAAI,IAAI,KAAK,SAAS,YAAY;sFAGnC,gBACC,OACE,AAAC,IAAgD,eAAe,IAC9D,IAAI,SAAS,KACZ;;;;;;;;;;;;;;;;;0EAMf,8OAAC,0KAAU;gEACT,SAAS;gEACT,SAAS;gEACT,YAAY;gEACZ,QAAQ;gEACR,QAAQ;gEACR,MAAM;gEACN,aAAa;gEACb,eAAe;gEACf,UAAU;gEACV,aAAa,CAAC;oEACZ,MAAM,KAAK,cAAc,CAAC,IAAI,GAAG,CAAC,KAAK;oEACvC,MAAM,UAAU,CAAC,CAAC,AAAC,IAA2C,SAAS;oEACvE,MAAM,OAAO,OAAO,IAAI,OAAO,KAAK,YAAY,IAAI,OAAO,CAAC,UAAU,CAAC;oEACvE,MAAM,gBACJ,IAAI,IAAI,KAAK,WAAW,IAAI,IAAI,KAAK,WAAY,IAAI,IAAI,KAAK,UAAU,CAAC;oEAC3E,OAAO,iBAAiB,CAAC,MAAM,WAAW,IAAI;gEAChD,CAAC;;;;;;;;;;;;;+CA5xBA,IAAI,GAAG;;;;;;uCAJK,GAAG,IAAI,GAAG,CAAC,KAAK,CAAC;;;;;gCAsyB1C;;wBAGN,CAAC;;mBA9gFkB;;;;;YAihFzB;0BACA,8OAAC,mLAAmB;gBAAC,QAAQ,CAAC,CAAC;gBAAW,SAAS;gBAAW,SAAS,IAAM,aAAa;;;;;;0BAC1F,8OAAC,+KAAe;gBACd,QAAQ,CAAC,CAAC,aAAa,UAAU,IAAI,KAAK;gBAC1C,SAAS,aAAa,UAAU,IAAI,KAAK,SAAS,YAAY;gBAC9D,SAAS,IAAM,aAAa;gBAC5B,WAAW;;;;;;;;AAInB"}}]
}