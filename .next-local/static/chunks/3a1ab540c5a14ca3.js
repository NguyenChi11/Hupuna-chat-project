(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,26106,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),a=e.i(37963),i=e.i(57688),n=e.i(50719),l=e.i(72637);function o({isOpen:e,inviteCode:r,onClose:o,onJoin:d}){let[c,m]=(0,s.useState)(null),[h,u]=(0,s.useState)(!0),[g,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null);(0,s.useEffect)(()=>{e&&r&&(async()=>{u(!0),f(null);try{let e=await fetch(`/api/groups/invite/${r}`),t=await e.json();if(!e.ok||!t.success)throw Error(t.message||"Link không hợp lệ hoặc đã hết hạn");m(t.group)}catch(e){f(e instanceof Error?e.message:"Không thể tải thông tin nhóm")}finally{u(!1)}})()},[e,r]);let b=async()=>{p(!0);try{await d(),o()}catch(e){alert(e instanceof Error?e.message:"Tham gia nhóm thất bại")}finally{p(!1)}};return e?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white rounded-xl shadow-2xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-br from-blue-600 to-indigo-700 text-white px-6 py-4 flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Tham gia nhóm"}),(0,t.jsx)("button",{onClick:o,className:"p-1 hover:cursor-pointer hover:bg-white/20 rounded-full transition",children:(0,t.jsx)(n.HiX,{className:"w-5 h-5"})})]}),(0,t.jsx)("div",{className:"p-6",children:h?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Đang tải thông tin nhóm..."})]}):x?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:"X"}),(0,t.jsx)("p",{className:"text-red-600 mb-4",children:x}),(0,t.jsx)("button",{onClick:o,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Đóng"})]}):c?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center ",children:[c.avatar?(0,t.jsx)(i.default,{src:(0,a.getProxyUrl)(c.avatar),alt:"",width:36,height:36,className:"w-20 h-20 object-cover rounded-full"}):(0,t.jsx)("div",{className:"w-[1.25rem] h-[1.25rem] bg-gradient-to-br rounded-full from-indigo-500 to-purple-600 text-white font-bold text-sm flex items-center justify-center",children:c.name?.charAt(0).toUpperCase()}),(0,t.jsx)("h4",{className:"text-xl font-bold text-gray-800 mb-2",children:c.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,t.jsx)(l.PiUserCircleGearDuotone,{className:"w-4 h-4"}),(0,t.jsxs)("span",{className:"text-sm",children:[c.members?.length||0," thành viên"]})]})]}),c.description&&(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-sm text-gray-700",children:c.description})}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:o,className:"flex-1 px-4 hover:cursor-pointer py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition",disabled:g,children:"Hủy"}),(0,t.jsx)("button",{onClick:b,disabled:g,className:"flex-1 px-4 py-3 hover:cursor-pointer bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Đang tham gia...":"Tham gia nhóm"})]})]}):null})]})}):null}var d=e.i(96085);function c(){let e=(0,r.useRouter)(),i=(0,r.useParams)(),n=i?.code,[l,c]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{try{let t=JSON.parse(localStorage.getItem("info_user")||"{}");t&&t._id?(h(t),c(!0)):e.push(`/?redirect=/invite/${n}`)}catch{e.push(`/?redirect=/invite/${n}`)}},[n,e]);let u=async()=>{if(!m||!n)return;let t=await fetch(`/api/groups/invite/${n}`),s=await t.json(),r=s?.group?.members||[],i=await fetch("/api/groups/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inviteCode:n,userId:m._id,userName:m.name})}),l=await i.json();if(!i.ok||!l.success)throw Error(l.message||"Tham gia nhóm thất bại");if(l.notifyId&&l.notifyContent&&l.groupId){let e=(0,d.io)((0,a.resolveSocketUrl)(),{transports:["websocket"],withCredentials:!1});e.on("connect",()=>{let t=r.map(e=>"string"==typeof e?{_id:String(e)}:{_id:String(e._id),role:e.role,name:e.name,avatar:e.avatar}),s=[...t,{_id:String(m._id),role:"MEMBER",name:m.name,avatar:m.avatar,joinedAt:Date.now()}];e.emit("group_members_updated",{roomId:String(l.groupId),members:s,prevMembers:t,sender:String(m._id),senderName:m.name}),e.emit("send_message",{_id:l.notifyId,roomId:l.groupId,sender:m._id,senderName:m.name||"Thành viên mới",type:"notify",content:l.notifyContent,timestamp:Date.now(),isGroup:!0,members:s.map(e=>e._id)}),setTimeout(()=>e.disconnect(),500)})}e.push("/home")};return(0,t.jsx)(o,{isOpen:l,inviteCode:n,onClose:()=>{c(!1),e.push("/home")},onJoin:u})}e.s(["default",()=>c],26106)}]);