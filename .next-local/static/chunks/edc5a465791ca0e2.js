(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67340,e=>{e.v("/_next/static/media/arrow-right-icon.c8ddb4c0.svg")},10880,e=>{"use strict";var t=e.i(43476),r=e.i(88014);let n=({children:e,className:r="text-white bg-green-500 hover:bg-green-700",style:n,onClick:s,type:i="button",title:o,disabled:l=!1,...a})=>(0,t.jsx)("button",{type:i,title:o,className:`${r} flex items-center cursor-pointer justify-center gap-2 py-[0.5rem] px-[1.25rem] text-md font-medium rounded-md`,style:{...n,backgroundColor:l?"#CECECE":"",cursor:l?"not-allowed":""},disabled:l,onClick:s,...a,children:e});var s=e.i(14674);function i(e){let{title:i="XÃ¡c nháº­n",message:o,okText:l="Äá»“ng Ã½",cancelText:a="Há»§y",onOk:c,onCancel:u}=e,d=document.createElement("div");d.className="fixed inset-0 z-[9999] flex items-center justify-center bg-black/30",document.body.appendChild(d);let h=(0,r.createRoot)(d),f=()=>{h.unmount(),d.remove()};h.render((0,t.jsx)(()=>(0,t.jsx)("div",{className:"w-full max-w-sm animate-in fade-in zoom-in duration-200",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/50 overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-5 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)(s.HiInformationCircle,{className:"w-8 h-8"}),(0,t.jsx)("h3",{className:"text-xl font-bold",children:i})]})}),(0,t.jsx)("div",{className:"p-6 text-center",children:(0,t.jsx)("p",{className:"text-gray-700 text-lg leading-relaxed",children:o})}),(0,t.jsxs)("div",{className:"flex gap-3 px-6 pb-6",children:[null!==a&&(0,t.jsxs)(n,{onClick:()=>{f(),u?.()},className:"flex-1 py-4 text-lg font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-2",children:[(0,t.jsx)(s.HiXMark,{className:"w-5 h-5"}),a]}),(0,t.jsxs)(n,{onClick:()=>{f(),c?.()},className:"flex-1 py-4 text-lg font-bold text-white bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 rounded-2xl shadow-lg hover:shadow-xl transition-all active:scale-95 flex items-center justify-center gap-2",children:[(0,t.jsx)(s.HiCheckCircle,{className:"w-5 h-5"}),l]})]})]})}),{}))}e.s(["confirmAlert",()=>i],10880)},16015,(e,t,r)=>{},98547,(e,t,r)=>{var n=e.i(47167);e.r(16015);var s=e.r(71645),i=s&&"object"==typeof s&&"default"in s?s:{default:s},o=void 0!==n.default&&n.default.env&&!0,l=function(e){return"[object String]"===Object.prototype.toString.call(e)},a=function(){function e(e){var t=void 0===e?{}:e,r=t.name,n=void 0===r?"stylesheet":r,s=t.optimizeForSpeed,i=void 0===s?o:s;c(l(n),"`name` must be a string"),this._name=n,this._deletedRulePlaceholder="#"+n+"-deleted-rule____{}",c("boolean"==typeof i,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=i,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var a="undefined"!=typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=a?a.getAttribute("content"):null}var t,r=e.prototype;return r.setOptimizeForSpeed=function(e){c("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),c(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},r.isOptimizeForSpeed=function(){return this._optimizeForSpeed},r.inject=function(){var e=this;if(c(!this._injected,"sheet already injected"),this._injected=!0,"undefined"!=typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(o||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,r){return"number"==typeof r?e._serverSheet.cssRules[r]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),r},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},r.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},r.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},r.insertRule=function(e,t){if(c(l(e),"`insertRule` accepts only strings"),"undefined"==typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var r=this.getSheet();"number"!=typeof t&&(t=r.cssRules.length);try{r.insertRule(e,t)}catch(t){return o||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var n=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,n))}return this._rulesCount++},r.replaceRule=function(e,t){if(this._optimizeForSpeed||"undefined"==typeof window){var r="undefined"!=typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!r.cssRules[e])return e;r.deleteRule(e);try{r.insertRule(t,e)}catch(n){o||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),r.insertRule(this._deletedRulePlaceholder,e)}}else{var n=this._tags[e];c(n,"old rule at index `"+e+"` not found"),n.textContent=t}return e},r.deleteRule=function(e){if("undefined"==typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];c(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},r.flush=function(){this._injected=!1,this._rulesCount=0,"undefined"!=typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},r.cssRules=function(){var e=this;return"undefined"==typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,r){return r?t=t.concat(Array.prototype.map.call(e.getSheetForTag(r).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},r.makeStyleTag=function(e,t,r){t&&c(l(t),"makeStyleTag accepts only strings as second parameter");var n=document.createElement("style");this._nonce&&n.setAttribute("nonce",this._nonce),n.type="text/css",n.setAttribute("data-"+e,""),t&&n.appendChild(document.createTextNode(t));var s=document.head||document.getElementsByTagName("head")[0];return r?s.insertBefore(n,r):s.appendChild(n),n},t=[{key:"length",get:function(){return this._rulesCount}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,t),e}();function c(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var u=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return t>>>0},d={};function h(e,t){if(!t)return"jsx-"+e;var r=String(t),n=e+r;return d[n]||(d[n]="jsx-"+u(e+"-"+r)),d[n]}function f(e,t){"undefined"==typeof window&&(t=t.replace(/\/style/gi,"\\/style"));var r=e+t;return d[r]||(d[r]=t.replace(/__jsx-style-dynamic-selector/g,e)),d[r]}var p=function(){function e(e){var t=void 0===e?{}:e,r=t.styleSheet,n=void 0===r?null:r,s=t.optimizeForSpeed,i=void 0!==s&&s;this._sheet=n||new a({name:"styled-jsx",optimizeForSpeed:i}),this._sheet.inject(),n&&"boolean"==typeof i&&(this._sheet.setOptimizeForSpeed(i),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"undefined"==typeof window||this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var r=this.getIdAndRules(e),n=r.styleId,s=r.rules;if(n in this._instancesCounts){this._instancesCounts[n]+=1;return}var i=s.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[n]=i,this._instancesCounts[n]=1},t.remove=function(e){var t=this,r=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(r in this._instancesCounts,"styleId: `"+r+"` not found"),this._instancesCounts[r]-=1,this._instancesCounts[r]<1){var n=this._fromServer&&this._fromServer[r];n?(n.parentNode.removeChild(n),delete this._fromServer[r]):(this._indices[r].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[r]),delete this._instancesCounts[r]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],r=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return r[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,r;return t=this.cssRules(),void 0===(r=e)&&(r={}),t.map(function(e){var t=e[0],n=e[1];return i.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:r.nonce?r.nonce:void 0,dangerouslySetInnerHTML:{__html:n}})})},t.getIdAndRules=function(e){var t=e.children,r=e.dynamic,n=e.id;if(r){var s=h(n,r);return{styleId:s,rules:Array.isArray(t)?t.map(function(e){return f(s,e)}):[f(s,t)]}}return{styleId:h(n),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),m=s.createContext(null);function g(){return new p}function y(){return s.useContext(m)}m.displayName="StyleSheetContext";var S=i.default.useInsertionEffect||i.default.useLayoutEffect,v="undefined"!=typeof window?g():void 0;function _(e){var t=v||y();return t&&("undefined"==typeof window?t.add(e):S(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}_.dynamic=function(e){return e.map(function(e){return h(e[0],e[1])}).join(" ")},r.StyleRegistry=function(e){var t=e.registry,r=e.children,n=s.useContext(m),o=s.useState(function(){return n||t||g()})[0];return i.default.createElement(m.Provider,{value:o},r)},r.createStyleRegistry=g,r.style=_,r.useStyleRegistry=y},37902,(e,t,r)=>{t.exports=e.r(98547).style},74715,83872,52773,e=>{"use strict";e.s(["formatTimeAgo",0,e=>{if(!e)return"";let t=Math.floor((Date.now()-e)/1e3),r=Math.floor(t/60),n=Math.floor(r/60),s=Math.floor(n/24);if(t<60)return"Vá»«a xong";{if(r<60)return`${r} ph\xfat`;if(n<24)return`${n} giá»`;if(s<7)return`${s} ng\xe0y`;let t=new Date(e);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}`}}],74715);var t=e.i(43476);let r=({className:e,stroke:r})=>(0,t.jsx)("div",{children:(0,t.jsxs)("svg",{className:e,width:"800px",height:"800px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2.75C6.89137 2.75 2.75 6.89137 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 6.89137 17.1086 2.75 12 2.75ZM1.25 12C1.25 6.06294 6.06294 1.25 12 1.25C17.9371 1.25 22.75 6.06294 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12ZM8.39747 15.5534C8.64413 15.2206 9.11385 15.1508 9.44661 15.3975C10.175 15.9373 11.0541 16.25 12 16.25C12.9459 16.25 13.825 15.9373 14.5534 15.3975C14.8862 15.1508 15.3559 15.2206 15.6025 15.5534C15.8492 15.8862 15.7794 16.3559 15.4466 16.6025C14.4742 17.3233 13.285 17.75 12 17.75C10.715 17.75 9.5258 17.3233 8.55339 16.6025C8.22062 16.3559 8.15082 15.8862 8.39747 15.5534Z",fill:r||"#1C274C"}),(0,t.jsx)("path",{d:"M16 10.5C16 11.3284 15.5523 12 15 12C14.4477 12 14 11.3284 14 10.5C14 9.67157 14.4477 9 15 9C15.5523 9 16 9.67157 16 10.5Z",fill:r||"#1C274C"}),(0,t.jsx)("path",{d:"M10 10.5C10 11.3284 9.55229 12 9 12C8.44772 12 8 11.3284 8 10.5C8 9.67157 8.44772 9 9 9C9.55229 9 10 9.67157 10 10.5Z",fill:r||"#1C274C"})]})});var n=e.i(71645);let s=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ˜¡"];function i({isMine:e,onPick:i,visible:o,className:l=""}){let[a,c]=(0,n.useState)(!1);return(0,t.jsx)("div",{className:`
        absolute top-1/2 -translate-y-1/2 z-20 ${e?"right-full mr-3":"left-full ml-3"}
        ${o?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}
        transition-opacity duration-150
        ${l}
      `,children:(0,t.jsxs)("div",{className:"relative inline-flex",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),c(e=>!e)},className:"w-8 h-8 hover:cursor-pointer rounded-full bg-white border border-gray-300 shadow-sm flex items-center justify-center text-base hover:scale-110 active:scale-95 transition-all","aria-label":"Tháº£ cáº£m xÃºc",children:(0,t.jsx)(r,{className:"w-4 h-4"})}),(0,t.jsx)("div",{className:`absolute ${e?"left-1/2 -translate-x-1/2":"left-1/2 -translate-x-3/4"} z-50 bottom-full mb-2 flex items-center gap-1 px-3 py-2 bg-white rounded-full shadow-xl border border-gray-200 transition-all ${a?"opacity-100 visible pointer-events-auto scale-100":"opacity-0 invisible pointer-events-none scale-95"} origin-bottom whitespace-nowrap overflow-x-auto no-scrollbar max-w-[calc(100vw-64px)] sm:max-w-[20rem]`,children:s.map(e=>(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),c(!1),i(e)},className:"w-9 h-9 flex items-center justify-center text-xl rounded-full hover:bg-gray-100 active:scale-90 transition-transform","aria-label":e,children:e},e))})]})})}e.s(["default",()=>i],83872),e.s(["uploadFileWithProgress",0,(e,t,r)=>new Promise(n=>{let s=new XMLHttpRequest;s.upload.onprogress=e=>{e.lengthComputable&&r(e.loaded/e.total*100)},s.open("POST",e),s.onload=()=>{if(s.status>=200&&s.status<300)try{let e=JSON.parse(s.responseText);n(e)}catch{n({success:!1,message:"Pháº£n há»“i tá»« server khÃ´ng pháº£i JSON há»£p lá»‡"})}else try{let e=JSON.parse(s.responseText),t="string"==typeof e?.message&&e.message.trim()?e.message:s.statusText||`Upload tháº¥t báº¡i (${s.status})`;n({success:!1,message:t})}catch{n({success:!1,message:s.statusText||`Upload tháº¥t báº¡i (${s.status})`})}},s.onerror=()=>{n({success:!1,message:"Lá»—i máº¡ng (Network Error)"})},s.send(t)})],52773)},15261,e=>{"use strict";var t=e.i(43476),r=e.i(71645),n=e.i(96085),s=e.i(37963),i=e.i(91350),o=e.i(41904),l=e.i(20978),a=e.i(20608),c=e.i(98340),u=e.i(23484),d=e.i(28479),h=e.i(94972),f=e.i(18566);function p(){let{currentUser:e,isLoading:p,allUsers:m,groups:g,selectedChat:y,searchTerm:S,setSearchTerm:v,showCreateGroupModal:_,setShowCreateGroupModal:x,showGlobalSearchModal:w,globalSearchTerm:b,globalSearchResults:C,scrollToMessageId:j,setScrollToMessageId:R,roomSearchKeyword:N,setRoomSearchKeyword:T,handleOpenGlobalSearch:F,handleGlobalSearch:k,handleSelectContact:z,handleNavigateToMessage:A,fetchAllData:M,handleChatAction:O,handleSelectChat:I,setSelectedChat:G}=(0,u.useHomePage)({onlyGroups:!0}),E=(0,f.useSearchParams)(),P=E?.get("with")||null,U=E?.get("open")||null,$=(0,r.useMemo)(()=>{if(!P)return g;let e=String(P),t=e=>{if("string"==typeof e||"number"==typeof e)return String(e);if("object"==typeof e&&null!==e){if(null!=e._id)return String(e._id);if(null!=e.id)return String(e.id)}return""};return g.filter(r=>Array.isArray(r.members)&&r.members.map(t).includes(e))},[g,P]),B=(0,r.useRef)(null),[H,L]=(0,r.useState)(null),[K,q]=(0,r.useState)(!1),D=(0,r.useMemo)(()=>P&&m.find(e=>String(e._id)===String(P))||null,[P,m]);return((0,r.useEffect)(()=>{(async()=>{if(!e||!e._id)return;await (0,d.waitForOneSignalReady)(),await (0,d.subscribeNotification)();let t=await (0,d.ensureSubscribed)();await (0,d.loginOneSignal)(String(e._id)),await (0,d.addUserTags)({userId:String(e._id)});try{console.log("OneSignal subscription id",t)}catch{}if(t)try{await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"addOneSignalSub",currentUserId:String(e._id),data:{subId:String(t)}})})}catch{}})()},[e]),(0,r.useEffect)(()=>{if(!e||!e._id)return;let t=B.current=(0,n.io)((0,s.resolveSocketUrl)(),{transports:["websocket"],withCredentials:!1});t.emit("join_user",{userId:String(e._id)}),t.off("call_offer"),t.off("call_end"),t.off("call_reject"),t.off("call_answer");let r=()=>{},i=()=>{(0,h.stopGlobalRingTone)(),L(null)},o=()=>{(0,h.stopGlobalRingTone)(),L(null)},l=()=>{(0,h.stopGlobalRingTone)()};return t.on("call_offer",r),t.on("call_end",i),t.on("call_reject",o),t.on("call_answer",l),()=>{t.off("call_offer",r),t.off("call_end",i),t.off("call_reject",o),t.off("call_answer",l)}},[e]),(0,r.useEffect)(()=>{if(!U)return;let e=g.find(e=>String(e._id)===String(U));e&&G(e)},[U,g,G]),p||!e)?(0,t.jsx)("div",{className:"flex h-screen items-center justify-center bg-white",children:"Loading..."}):(0,t.jsxs)("div",{className:"flex h-screen w-full font-sans",children:[(0,t.jsx)(i.default,{onNavigateToMessage:A,currentUser:e,groups:$,allUsers:m,searchTerm:S,setSearchTerm:v,setShowCreateGroupModal:x,selectedChat:y,onSelectChat:I,onBackFromChat:()=>G(null),onChatAction:O,scrollToMessageId:j,onScrollComplete:()=>R(null),roomSearchKeyword:N,setRoomSearchKeyword:T,fetchAllData:M,onShowGlobalSearch:F,onlyGroups:!0}),P&&D?(0,t.jsx)("div",{className:"md:hidden w-full h-full",children:(0,t.jsx)(l.default,{groups:$,partner:D,onBack:()=>{window.history.back()},onShowCreateGroup:()=>{try{window.__createGroupInitialMemberIds=[String(D._id)]}catch{}x(!0)},onShowAddToGroup:()=>q(!0)})}):(0,t.jsx)(o.default,{currentUser:e,groups:$,allUsers:m,searchTerm:S,setSearchTerm:v,setShowCreateGroupModal:x,selectedChat:y,onSelectChat:I,onBackFromChat:()=>G(null),onChatAction:O,scrollToMessageId:j,onScrollComplete:()=>{R(null),T(null)},roomSearchKeyword:N,setRoomSearchKeyword:T,fetchAllData:M,onShowGlobalSearch:F,onNavigateToMessage:A,onlyGroups:!0}),(0,t.jsx)(c.default,{currentUser:e,allUsers:m,showGlobalSearchModal:w,globalSearchTerm:b,globalSearchResults:C,onCloseGlobalSearch:F,onSearch:k,onNavigateToMessage:A,onSelectContact:z,showCreateGroupModal:_,onCloseCreateGroup:()=>x(!1),onGroupCreated:e=>{e&&G(e),x(!1)},reLoad:M}),K&&D&&(0,t.jsx)(a.default,{isOpen:K,onClose:()=>q(!1),currentUser:e,selectedChat:D,onShowCreateGroup:()=>{try{window.__createGroupInitialMemberIds=[String(D._id)]}catch{}q(!1),x(!0)},reLoad:M})]})}function m(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"h-screen w-full flex items-center justify-center",children:"Äang táº£i..."}),children:(0,t.jsx)(p,{})})}e.s(["default",()=>m])}]);